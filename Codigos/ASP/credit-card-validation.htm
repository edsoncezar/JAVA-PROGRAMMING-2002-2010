<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0087)http://www.planet-source-code.com/vb/scripts/ShowCodeAsText.asp?txtCodeId=8172&lngWId=4 -->
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<META content="MSHTML 6.00.2719.2200" name=GENERATOR></HEAD>
<BODY><XMP>
    '**************************************
    ' for :ASP Credit Card Validation (Mod10
    '     )
    '**************************************
    Open Source
    '**************************************
    ' Name: ASP Credit Card Validation (Mod1
    '     0)
    ' Description:These functions are what I
    '     use for credit card validation. I wrote 
    '     them awhile back and recently modified t
    '     hem.
    ValidateCCNumber(strCCNumber) = This function returns an integer value 1-5 depending on what type of card it is(see comments), will be positive if it passes the Mod10 and will be negative if it fails.
    GetCCType(strCCNumber) = This function determines what type of credit card was entered. (I did this cause a had some Visa's that started with 54..)
    ValidateMod10(strCCNumber) = This is the actual Mod10
    ValidateCCDate(strDate) = Validates the date making sure that it is valid.
    ' By: Brian Reeves
    '
    '
    ' Inputs:Need to pass the credit card nu
    '     mber
    '
    ' Returns:None
    '
    'Assumes:You can change the integer to a
    '     string if you want, do it in integer bec
    '     ause thats what matches my sql tables.
    '
    'Side Effects:None
    'This code is copyrighted and has limite
    '     d warranties.
    'Please see http://www.Planet-Source-Cod
    '     e.com/xq/ASP/txtCodeId.8172/lngWId.4/qx/
    '     vb/scripts/ShowCode.htm
    'for details.
    '**************************************
    
    'Created	03/15/2002	Brian Reeves
    'Modified	01/03/2003	Brian Reeves
    Public Function ValidateCCNumber(strCCNumber)
    'Function Validates a credit card number
    '     and returns an integer as follows
    ' if the number is invalid it returns a 
    '     negative number of the card. A
    ' valid visa would return '1' where an i
    '     nvalid one would return '-1'.
    '
    '0 = Number does not match a credit card
    '     type.
    '1 = Visa
    '2 = Mastercard
    '3 = Discover
    '4 = American Express
    '5 = Diners Club
    Dim intCCType
    
    ' Cleaning dashes, etc.. from number
    strCCNumber = Replace(strCCNumber, "-", "")
    strCCNumber = Replace(strCCNumber, " ", "")
    
    intCCType = GetCCType(strCCNumber)
    Select Case intCCType
    Case 1 'Visa
    'Validates Length Based on CardType If t
    '     rue actually validates number
    If (Len(strCCNumber) = 13 Or Len(strCCNumber) = 16) And ValidateMod10(strCCNumber) = True Then
    ValidateCCNumber = intCCType 'Valid
    Else: ValidateCCNumber = intCCType * -1'Invalid
    End If
    Case 2, 3 'Mastercard / Discover
    If Len(strCCNumber) = 16 And ValidateMod10(strCCNumber) = True Then
    ValidateCCNumber = intCCType 'Valid
    Else: ValidateCCNumber = intCCType * -1'Invalid
    End If
    Case 4 'American Express
    If Len(strCCNumber) = 15 And ValidateMod10(strCCNumber) = True Then
    ValidateCCNumber = intCCType 'Valid
    Else: ValidateCCNumber = intCCType * -1'Invalid
    End If
    Case 5 'Diners Club
    If Len(strCCNumber) = 14 And ValidateMod10(strCCNumber) = True Then
    ValidateCCNumber = intCCType 'Valid
    Else: ValidateCCNumber = intCCType * -1'Invalid
    End If
    Case Else
    ValidateCCNumber = 0
    End Select
    End Function
    'Created	03/15/2002	Brian Reeves
    'Modified	01/03/2003	Brian Reeves
    Public Function GetCCType(strCCNumber)
    'Function Gets Card Type Based on first 
    '     4 digits
    If Left(strCCNumber, 1) = 4 Then
    'Visa
    GetCCType = 1
    ElseIf Left(strCCNumber, 2) >= 51 And Left(strCCNumber, 2) <= 55 Then
    'Mastercard
    GetCCType = 2
    ElseIf Left(strCCNumber, 4) = 6011 Then
    'Discover
    GetCCType = 3
    ElseIf Left(strCCNumber, 2) = 34 Or Left(strCCNumber, 2) = 37 Then
    'American Express
    GetCCType = 4
    ElseIf (Left(strCCNumber, 3) >= 300 And Left(strCCNumber, 3) <= 305) Or _
    Left(strCCNumber, 2) = 36 Or Left(strCCNumber, 2) = 38 Then
    'Diners Club -- I don't know if this wor
    '     ks cause I don't have one to check it wi
    '     th.
    GetCCType = 5
    Else
    GetCCType = 0
    End If
    End Function
    ' This function is used to validate the 
    '     credit card with the
    ' Mod10 Algorithm for the ValidateCCNumb
    '     er() Function.
    '
    ' Params: strCCNumber - Digits only use 
    '     the TrimNum() Prior to calling
    ' Returns: True of False
    '
    'Created	03/15/2002	Brian Reeves
    'Modified	01/03/2003	Brian Reeves
    Private Function ValidateMod10(strCCNumber)
    Dim intCounter, intTotal
    Dim strTotal
    
    intTotal = 0
    For intCounter = 1 To Len(strCCNumber)
    If (intCounter Mod 2) <> 0 Then
    strTotal = strTotal & Mid(strCCNumber, intCounter, 1) * 2
    Else
    strTotal = strTotal & Mid(strCCNumber, intCounter, 1)
    End If
    Next
    
    For intCounter = 1 To Len(strTotal)
    intTotal = intTotal + Mid(strTotal, intCounter, 1)
    Next
    
    If (intTotal Mod 10) Then
    ValidateMod10 = False
    Else: ValidateMod10 = True
    End If
    End Function
    Public Function FixCCDate(strDate)
    End Function
    'Function expects strDate to be in 'mm/y
    '     y' format
    ' Returns True or False
    'Created	03/15/2002	Brian Reeves
    'Modified	01/03/2003	Brian Reeves
    Public Function ValidateCCDate(strDate)
    Dim intYear, intMonth, blnValid
    
    'Cleaning Date
    strDate = TrimNonNumeric(strDate)
    
    'Reading Date into intMonth
    If Len(strDate) = 3 Then
    intMonth = Int(Left(strDate, 1))
    		intYear = Int("20" & Right(strDate, 2))
    ElseIf Len(strDate) = 4 Then
    intMonth = Int(Left(strDate, 2))
    		intYear = Int("20" & Right(strDate, 2))
    	ElseIf Len(strDate) = 5 Then
    intMonth = Int(Left(strDate, 1))
    		intYear = Int(Right(strDate, 4))
    	ElseIf Len(strDate) = 6 Then
    intMonth = Int(Left(strDate, 2))
    		intYear = Int(Right(strDate, 4))
    End If
    
    'Validating intMonth is valid month
    If intMonth > 0 And intMonth < 13 Then
    'Validating year
    If intYear > Year(Now) And intYear < (Year(Now) + 10) Then
    blnValid = True
    ElseIf intYear = Year(Now) Then
    'Making sure the month has not already p
    '     assed
    If intMonth >= Month(Now) Then blnValid = True
    End If
    End If
    	
    	'Returning Info
    	If blnValid = True Then
    		If Len(intMonth) = 1 Then intMonth = "0" & intMonth
    		ValidateCCDate = intMonth & "/" & Right(intYear, 2)
    	Else
    		ValidateCCDate = False
    	End If
    End Function
		</XMP></BODY></HTML>
