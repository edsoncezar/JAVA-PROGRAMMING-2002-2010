<?xml version="1.0" encoding="ISO-8859-1"?>

    <!-- fragmento de arquivo XML que será inserido nos projetos que utilizam o 
         AspectJ. ESTE NÃO É UM ARQUIVO XML VÁLIDO! -->

    <!-- cria uma propriedade para acessar variaveis de ambiente -->
    <property 
        environment="env"
        />

    <!-- arquivo de propriedades do projeto todo -->
    <property
        file="${basedir}/common.properties"
        />

    <!-- classpath das ferramentas do AspectJ -->
    <path 
        id="aspectjtools.classpath"
        >
        <pathelement location="${aspectjtools.jar}"/>
    </path>

    <!-- path utilizado em tempo de execução -->
    <path
        id="run.classpath"
        >
        <pathelement location="${aspectjrt.jar}"/>
        <pathelement location="${classes.dir}"/>
    </path>

    <!-- utiliza o arquivo de propriedades do AspectJ para encontrar as tasks ANT -->
    <taskdef
        resource="org/aspectj/tools/ant/taskdefs/aspectjTaskdefs.properties"
        >
        <classpath refid="aspectjtools.classpath"/>
    </taskdef>

    <!-- tarefa de inicialização -->
    <target
        name="init"
        description="cria o diretorio de build da aplicacao"
        >
        <echo>java.home=${java.home}</echo>
        <echo>aspectj.home=${aspectj.home}</echo>
        <echo>project.dir=${project.dir}</echo>

        <mkdir dir="${classes.dir}"/>
    </target>

    <!-- tarefa de compilação -->
    <target 
        name="compile" 
        description="compila a aplicacao"
        depends="init"
        >
        <echo>Compilando...</echo>
        <iajc destdir="${classes.dir}" argfiles="${src.dir}/${project.dir}/files.lst" classpath="${aspectjrt.jar}"/>
    </target>

    <!-- tarefa p/ execução da classe de teste -->
    <target 
        name="run" 
        description="executa o programa de teste"
        depends="compile"
        >
        <echo>Executando a classe ${main-class} do projeto ${project.dir}</echo>
        <java classname="${main-class}">
            <classpath refid="run.classpath"/>
        </java>
    </target>

    <!-- tarefa p/ limpeza das classes geradas -->
    <target 
        name="clean"
        description="limpa o diretorio build do projeto"
        >
        <echo>Limpando o diretorio build...</echo>
        <delete dir="${build.dir}"/>
    </target>

    <!-- inicia o browser do AspectJ -->
    <target
        name="ajbrowser"
        description="inicia o browser do AspectJ"
        >
        <echo>Executando o browser do AspectJ</echo>
        <exec executable="${aspectj.home}/bin/ajbrowser.bat">
            <arg line="${src.dir}/${project.dir}/files.lst"/>
            <env key="CLASSPATH" value="${aspectjrt.jar}"/>
        </exec>
    </target>
