










<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<title>How to Write an Image Filter</title>
</head>
<body BGCOLOR="#ffffff">








<table width="100%">
<tr>
<td align=left>
<a href="usefilter.html"><img src="http://docs.rinet.ru/OLDui/images/PreviousArrow.gif" width=26 height=26 align=bottom border=0 alt="Previous | "></a><a
href="animation.html"><img src="http://docs.rinet.ru/OLDui/images/NextArrow.gif" width=26 height=26 align=bottom border=0 alt="Next | "></a><a
href="http://docs.rinet.ru:8080/OLDui/trailmap.html"><img src="http://docs.rinet.ru/OLDui/images/WayUpArrow.gif" width=26 height=26 align=bottom border=0 alt="Trail Map | "></a><a
href="..\index.html"><img src="http://docs.rinet.ru/OLDui/images/uiHeader.gif" width=26 height=26 align=bottom border=0 alt="Creating a User Interface (AWT Only) | "></a>
</td>
<td align=right>
<a href="index.html"><strong><em>Working with Graphics</em></strong></a>
</td>
</tr>
</table>
<p>
<center>
<IMG SRC="http://docs.rinet.ru/OLDui/images/shoeline2.GIF" ALIGN="BOTTOM" BORDER="0" WIDTH="202"
    HEIGHT="25" NATURALSIZEFLAG="3">
<IMG SRC="http://docs.rinet.ru/OLDui/images/shoeline2.GIF" ALIGN="BOTTOM" BORDER="0" WIDTH="202"
    HEIGHT="25" NATURALSIZEFLAG="3">
</center>
<p> 

<h2>
    How to Write an Image Filter
</h2>
<p>
<blockquote>


All image filters must be subclasses of the
<a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.image.ImageFilter.html">ImageFilter</a><a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.image.ImageFilter.html"><img src="http://docs.rinet.ru/OLDui/images/uiIcon.gif" width=20 height=20 border=0 alt="(in the Creating a User Interface trail)"></a> class.
If your image filter will modify
the colors or transparency of an image,
then instead of creating a direct subclass of ImageFilter,
you should probably create a subclass of 
<a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.image.RGBImageFilter.html">RGBImageFilter</a><a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.image.RGBImageFilter.html"><img src="http://docs.rinet.ru/OLDui/images/uiIcon.gif" width=20 height=20 border=0 alt="(in the Creating a User Interface trail)"></a>.

<p>

Before writing an image filter, 
you first should find others,
studying any that are similar to what you plan to write.
You should also study the ImageProducer and ImageConsumer interfaces,
becoming thoroughly familiar with them.

<h4>Finding Examples</h4>
<blockquote>

You can find examples of RGBImageFilter subclasses in the applets
mentioned on the previous page
(<a href=http://java.sun.com/applets/applets/Bullets/example1.html>Dynamically
Generated Color Bullets</a>, 
<a href=http://java.sun.com/applets/applets/ImageMap/example1.html>Live
Feedback ImageMap</a>, and 
<a href=http://java.sun.com/applets/applets/ImageTest/example1.html>Image
Test</a>).

<p>

Later in this page, 
you'll see an example of a direct ImageFilter subclass,
RotateFilter.

</blockquote>
<h4>Creating an ImageFilter Subclass</h4>
<blockquote>

As we mentioned before,
image filters implement the
<a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.image.ImageConsumer.html">ImageConsumer</a><a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.image.ImageConsumer.html"><img src="http://docs.rinet.ru/OLDui/images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a> interface.
This lets them intercept data intended for the image consumer.
ImageConsumer defines the following methods:

<blockquote>
<pre>
void setDimensions(int width, int height);
void setProperties(Hashtable props);
void setColorModel(ColorModel model);
void setHints(int hintflags);
void setPixels(int x, int y, int w, int h,
               ColorModel model, byte pixels[],
               int off, int scansize);
void setPixels(int x, int y, int w, int h,
               ColorModel model, int pixels[],
               int off, int scansize);
void imageComplete(int status);
</pre>
</blockquote>

The ImageFilter class implements all the above methods
so that they forward the method data to the filter's consumer.
For example, ImageFilter implements the <code>setDimensions()</code>
method as follows:
<blockquote>
<pre>
public void setDimensions(int width, int height) {
    consumer.setDimensions(width, height);
}
</pre>
</blockquote>

Thanks to these ImageFilter methods, 
your subclass probably doesn't need to implement every ImageConsumer method.
You need to implement only the methods
that transmit data you want to change.

<p>

For example, the 
<a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.image.CropImageFilter.html">CropImageFilter</a><a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.image.CropImageFilter.html"><img src="http://docs.rinet.ru/OLDui/images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a> class implements four of the ImageConsumer methods:
<code>setDimensions()</code>,
<code>setProperties()</code>,
and both varieties of
<code>setPixels()</code>.
It also implements a constructor with arguments
that specify the rectangle to be cropped.
As another example, the
<a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.image.RGBImageFilter.html">RGBImageFilter</a><a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.image.RGBImageFilter.html"><img src="http://docs.rinet.ru/OLDui/images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a> class implements some helper methods,
defines an abstract helper method to perform the actual color modifications of
each pixel, and implements
the following ImageConsumer methods:
<code>setColorModel()</code>
and both varieties of 
<code>setPixels()</code>.

<p>

Most, if not all, filters implement the <code>setPixels()</code> methods.
These methods determine exactly what image data is used to construct
the Image.
One or both of the <code>setPixels()</code> methods 
may be called multiple times
during the construction of a single image.
Each call gives the ImageConsumer information
about a rectangle of pixels within the image.
When the ImageConsumer's <code>imageComplete()</code> 
method is called with any status except SINGLEFRAMEDONE
(which implies that data for more frames will appear),
then the ImageConsumer can assume that it will receive
no further <code>setPixels()</code> calls.
An <code>imageComplete()</code> status of STATICIMAGEDONE
specifies that not only is the image data complete,
but that no errors have been detected.

<p>

The following illustration and table
describe the arguments to the <code>setPixels()</code> methods.

<blockquote><IMG SRC="http://docs.rinet.ru/OLDui/figures/ui/setPixels.gif" WIDTH="430" HEIGHT="301" ALIGN="BOTTOM" NATURALSIZEFLAG="3" ALT=""></blockquote>
<dl>
<dt><code>x</code>, <code>y</code>
<dd>Specify the location within the image,
    relative to its upper left corner,
    at which this rectangle begins.

<dt><code>w</code>, <code>h</code>
<dd>Specify the width and height, in pixels,
    of this rectangle.

<dt><code>model</code>
<dd>Specifies the color model
    used by the data in the pixels array.

<dt><code>pixels[]</code>
<dd>Specifies an array of pixels.
    The rectangle of image data is contained in this array,
    but the array might contain more than 
    <code>w</code>*<code>h</code> entries,
    depending on the values of <code>offset</code> and <code>scansize</code>.
    Here's the formula for determining
    what entry in the <code>pixels</code> array 
    contains the data for the pixel at
    (<code>x</code>+i, <code>y</code>+j),
    where (0 <= i < <code>w</code>) and (0 <= j < <code>h</code>):
    <blockquote>
    <pre>
    offset + (j * scansize) + i 
    </pre>
    </blockquote>
    The above formula assumes that
    (m,n) is in the rectangle this <code>setPixels()</code> call specifies,
    and that (m,n) is relative to the image origin.
    Below is an illustration of the <code>pixels</code> array
    to make this clearer.
    It shows how a specific pixel (for example, (x,y))
    maps to an entry in the <code>pixels</code> array.

<blockquote><IMG SRC="http://docs.rinet.ru/OLDui/figures/ui/pixelsArray.gif" WIDTH="457" HEIGHT="114" ALIGN="BOTTOM" NATURALSIZEFLAG="3" ALT=""></blockquote>
<dt><code>offset</code>
<dd>Specifies the index (in the <code>pixels</code> array)
    of the first pixel in the rectangle.

<dt><code>scansize</code>
<dd>Specifies the width of each row in the <code>pixels</code> array.
    Due to efficiency considerations, 
    this might be greater than <code>w</code>.
</dl>


</blockquote>
<h4>The RotateFilter Image Filter</h4>
<blockquote>

The <a href=http://docs.rinet.ru/OLDui/OLDui/drawing/example/RotateFilter.java>RotateFilter</a> class
rotates an image by the specified angle.
It relies on the following graphics formulas
to calculate the new position of each pixel:

<blockquote>
<pre>
newX = oldX*cos(angle) - oldY*sin(angle)
newY = oldX*sin(angle) + oldY*cos(angle)
</pre>
</blockquote>
        
RotateFilter implements the following ImageConsumer methods:

<dl>
<dt><code>setDimensions()</code>
<dd>Records the unfiltered image's width and height
    for use in the <code>setPixels()</code>
    and <code>imageComplete()</code> methods.
    Calculates the filtered image's final width and height,
    records it for use in its <code>imageComplete()</code> method,
    creates a buffer to store the image data as it comes in,
    and calls the consumer's <code>setDimensions()</code> method
    to set the new width and height.

<dt><code>setColorModel()</code>
<dd>Tells the consumer to expect pixels in the default RGB color model.

<dt><code>setHints()</code>
<dd>Tells the consumer to expect the image data
    in top-down-left-right order
    (the order in which you're reading this page),
    in complete scan lines,
    and with every pixel sent exactly once.

<dt><code>setPixels()</code> (both varieties of this method)
<dd>Converts the pixels to the default RGB model (if necessary)
    and copies the pixels into a storage buffer.
    Most image filters would simply modify the pixel data
    and forward it to the consumer,
    but because the sides of a rotated rectangle
    are no longer horizontal and vertical (for most angles),
    this filter can not efficiently forward pixels
    from its <code>setPixels()</code> method.
    Instead, RotateFilter stores all the pixel data
    until it receives an <code>imageComplete()</code> message.

<dt><code>imageComplete()</code>
<dd>Rotates the image
    and then invokes <code>consumer.setPixels()</code> repeatedly
    to send each line of the image to the consumer.
    After sending the whole image,
    this method invokes <code>consumer.imageComplete()</code>.
</dl>

<!--Should walk people through the code more.-->

</blockquote>
</blockquote>
<p>
<hr size=4>
<p> 
<table width="100%">
<tr>
<td align=left>
<a href="usefilter.html"><img src="http://docs.rinet.ru/OLDui/images/PreviousArrow.gif" width=26 height=26 align=top border=0 alt="Previous | "></a><a
href="animation.html"><img src="http://docs.rinet.ru/OLDui/images/NextArrow.gif" width=26 height=26 align=top border=0 alt="Next | "></a><a
href="http://docs.rinet.ru:8080/OLDui/trailmap.html"><img src="http://docs.rinet.ru/OLDui/images/WayUpArrow.gif" width=26 height=26 align=top border=0 alt="Trail Map | "></a><a
href="..\index.html"><img src="http://docs.rinet.ru/OLDui/images/uiHeader.gif" width=26 height=26 align=top border=0 alt="Creating a User Interface (AWT Only) | "></a>
</td>
<td align=right>
<a href="index.html"><strong><em>Working with Graphics</em></strong></a>
</td>
</tr>
</table>
</body>
</html>
