










<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<title>How to Use an Image Filter</title>
</head>
<body BGCOLOR="#ffffff">








<table width="100%">
<tr>
<td align=left>
<a href="manipimages.html"><img src="http://docs.rinet.ru/OLDui/images/PreviousArrow.gif" width=26 height=26 align=bottom border=0 alt="Previous | "></a><a
href="writefilter.html"><img src="http://docs.rinet.ru/OLDui/images/NextArrow.gif" width=26 height=26 align=bottom border=0 alt="Next | "></a><a
href="http://docs.rinet.ru:8080/OLDui/trailmap.html"><img src="http://docs.rinet.ru/OLDui/images/WayUpArrow.gif" width=26 height=26 align=bottom border=0 alt="Trail Map | "></a><a
href="..\index.html"><img src="http://docs.rinet.ru/OLDui/images/uiHeader.gif" width=26 height=26 align=bottom border=0 alt="Creating a User Interface (AWT Only) | "></a>
</td>
<td align=right>
<a href="index.html"><strong><em>Working with Graphics</em></strong></a>
</td>
</tr>
</table>
<p>
<center>
<IMG SRC="http://docs.rinet.ru/OLDui/images/shoeline2.GIF" ALIGN="BOTTOM" BORDER="0" WIDTH="202"
    HEIGHT="25" NATURALSIZEFLAG="3">
<IMG SRC="http://docs.rinet.ru/OLDui/images/shoeline2.GIF" ALIGN="BOTTOM" BORDER="0" WIDTH="202"
    HEIGHT="25" NATURALSIZEFLAG="3">
</center>
<p> 

<h2>
    How to Use an Image Filter
</h2>
<p>
<blockquote>


The following applet uses a filter
to rotate an image.
The filter is a custom one named RotateFilter
that you'll see discussed on the next page.
All you need to know about the filter to use it
is that its constructor takes a single <code>double</code> argument:
the rotation angle in radians.
The applet converts the number the user enters
from degrees into radians,
so that the applet can construct a RotateFilter.

<p>

<applet codebase=http://docs.rinet.ru:8080/OLDui/OLDui/drawing/example code=ImageRotator.class width=450 height=150>
<blockquote><IMG SRC="http://docs.rinet.ru/OLDui/figures/ui/ImageRotator.gif" WIDTH="432" HEIGHT="107" ALIGN="BOTTOM" NATURALSIZEFLAG="3" ALT=""></blockquote></applet>

<p>

Here's the source code that uses the filter.
(Here's the 
<a href=http://docs.rinet.ru/OLDui/OLDui/drawing/example/ImageRotator.java>whole program</a>.)

<blockquote>
<pre>
public class ImageRotator extends Applet {
    . . .
    RotatorCanvas rotator;
    double radiansPerDegree = Math.PI / 180;

    public void init() {
        //Load the image.
        Image image = getImage(getCodeBase(), "../images/rocketship.gif");

        <em>...//Create the component that uses the image filter:</em>
        rotator = new RotatorCanvas(image);
        . . .
        add(rotator);
        . . .
    }

    public boolean action(Event evt, Object arg) {
        int degrees;

        <em>...//Get the number of degrees to rotate the image by.</em>

        //Convert to radians.
        rotator.rotateImage((double)degrees * radiansPerDegree);

        return true;
    }
}

class RotatorCanvas extends Canvas {
    Image sourceImage;
    Image resultImage;

    public RotatorCanvas(Image image) {
        sourceImage = image;
        resultImage = sourceImage;
    }

    public void rotateImage(double angle) {
        ImageFilter filter = new RotateFilter(angle);
        ImageProducer producer = new FilteredImageSource(
                                        sourceImage.getSource(),
                                        filter);
        resultImage = createImage(producer);
        repaint();
    }

    public void paint(Graphics g) {
        Dimension d = size();
        int x = (d.width - resultImage.getWidth(this)) / 2;
        int y = (d.height - resultImage.getHeight(this)) / 2;

        g.drawImage(resultImage, x, y, this); 
    }
}
</pre>
</blockquote>

<h4>How the Code Works</h4>
<blockquote>
To use an image filter,
a program goes through the following steps:
<ol>
<li> Get an Image object
     (usually done with a <code>getImage()</code> method).
<li> Using the <code>getSource()</code> method,
     get the data source (an ImageProducer)
     for the Image object,
<li> Create an instance of the image filter,
     initializing the filter as necessary.
<li> Create a FilteredImageSource object,
     passing the constructor 
     the image source and filter objects.
<li> With the Component Code>createImage()</code> method,
     create a new Image object
     that has the FilteredImageSource as its image producer.
</ol>
<p>

This might sound complex,
but it's actually easy for you to implement.
The real complexity is behind the scenes,
as we'll explain a bit later.
First, we'll explain the code in the example applet
that uses the image filter.

<p>

In the example applet,
the RotatorCanvas <code>rotateImage()</code> method
performs most of the tasks associated with using the image filter.
The one exception is the first step,
getting the original Image object, 
which is performed by the applet's <code>init()</code> method.
This Image object is passed to the RotatorCanvas,
which refers to it as <code>sourceImage</code>.

<p>

The <code>rotateImage()</code> method
instantiates the image filter
by calling the filter's constructor.
The single argument to the constructor
is the angle, in radians,
to rotate the image by.

<blockquote>
<pre>
ImageFilter filter = new RotateFilter(angle);
</pre>
</blockquote>

Next, the <code>rotateImage()</code> method 
creates a FilteredImageSource instance.
The first argument to the FilteredImageSource constructor
is the image source,
obtained with the <code>getSource()</code> method.
The second argument is the filter object.

<blockquote>
<pre>
ImageProducer producer = new FilteredImageSource(
                                sourceImage.getSource(),
                                filter);
</pre>
</blockquote>

Finally, the code creates a second Image,
<code>resultImage</code>,
by invoking the Component <code>createImage()</code> method.
The lone argument to <code>createImage()</code>
is the FilteredImageSource created in the above step.

<blockquote>
<pre>
resultImage = createImage(producer);
</pre>
</blockquote>


</blockquote>
<h4>What Happens Behind the Scenes</h4>
<blockquote>

This section explains how image filtering works, behind the scenes.
If you don't care about these implementation details,
feel free to skip ahead to
<a href=#where>Where to Find Image Filters</a>.

<p>

The first thing you need to know 
is that the AWT uses ImageConsumers
behind the scenes,
in response to <code>drawImage()</code> requests.
So the Component that displays the image 
isn't the image consumer --
some object deep in the AWT is the image consumer.

<p>

The <code>createImage()</code> call above 
sets up an Image (<code>resultImage</code>)
that expects to get image data
from its producer, the FilteredImageSource instance.
Here's what the path for the image data looks like,
from the perspective of <code>resultImage</code>:
<blockquote><IMG SRC="http://docs.rinet.ru/OLDui/figures/ui/13ui44.gif" WIDTH="506" HEIGHT="59" ALIGN="BOTTOM" NATURALSIZEFLAG="3" ALT=""></blockquote><p>

The dotted line indicates that the image consumer
never actually gets data from the FilteredImageSource.
Instead, when the image consumer requests image data
(in response to <code>g.drawImage(resultImage,...)</code>),
the FilteredImageSource performs some sleight of hand
and then steps out of the way.
Here's the magic that FilteredImageSource performs:
<ul>
<li> It creates a new image filter object
     by invoking the <code>getFilterInstance()</code> method
     on the filter object
     that you gave to the FilteredImageSource constructor.
     By default, <code>getFilterInstance()</code>
     clones the filter object.
<li> It connects the new image filter object
     to the image consumer.
<li> It connects the image data source,
     which you gave to the FilteredImageSource constructor,
     to the image filter.
</ul>
<p>

Here is the result:
<blockquote><IMG SRC="http://docs.rinet.ru/OLDui/figures/ui/13ui46.gif" WIDTH="517" HEIGHT="65" ALIGN="BOTTOM" NATURALSIZEFLAG="3" ALT=""></blockquote><p>

</blockquote>
<a name=where>
<h4>Where to Find Image Filters</h4>
</a>
<blockquote>

So where can you find existing image filters?
The java.awt.image package includes one ready-to-use filter,
<a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.image.CropImageFilter.html">CropImageFilter</a><a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.image.CropImageFilter.html"><img src="http://docs.rinet.ru/OLDui/images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>,
which produces an image 
consisting of a rectangular region of the original image.
You can also find several image filters
used by applets at our website.
All of the following pages include
links to the source code for each applet and image filter:
<ul>
<li> The <a
     href=http://java.sun.com/applets/applets/Bullets/example1.html>Dynamically
     Generated Color Bullets</a> page contains two applets 
     that modify the color of an image.
     The first applet, AlphaBullet, defines and uses an AlphaColorFilter;
     the second, HueBullet, defines and uses a HueFilter.
<li> The <a
     href=http://java.sun.com/applets/applets/ImageMap/example1.html>Live
     Feedback ImageMap</a> page demonstrates an image mapping applet.
     It uses many filters to provide visual feedback
     when the cursor moves over certain areas
     or the user clicks a special area.
<li> The <a
     href=http://java.sun.com/applets/applets/ImageTest/example1.html>Image
     Test</a> page performs a variety of image processing.
     Besides letting the user scale and move the image,
     it defines and uses three filters.
     The AlphaFilter makes the image transparent,
     the RedBlueSwapFilter changes the colors in the image,
     and the RotateFilter rotates the image,
     as you've seen in this section.
</ul>

</blockquote>

</blockquote>
<p>
<hr size=4>
<p> 
<table width="100%">
<tr>
<td align=left>
<a href="manipimages.html"><img src="http://docs.rinet.ru/OLDui/images/PreviousArrow.gif" width=26 height=26 align=top border=0 alt="Previous | "></a><a
href="writefilter.html"><img src="http://docs.rinet.ru/OLDui/images/NextArrow.gif" width=26 height=26 align=top border=0 alt="Next | "></a><a
href="http://docs.rinet.ru:8080/OLDui/trailmap.html"><img src="http://docs.rinet.ru/OLDui/images/WayUpArrow.gif" width=26 height=26 align=top border=0 alt="Trail Map | "></a><a
href="..\index.html"><img src="http://docs.rinet.ru/OLDui/images/uiHeader.gif" width=26 height=26 align=top border=0 alt="Creating a User Interface (AWT Only) | "></a>
</td>
<td align=right>
<a href="index.html"><strong><em>Working with Graphics</em></strong></a>
</td>
</tr>
</table>
</body>
</html>
