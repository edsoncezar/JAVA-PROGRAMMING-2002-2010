










<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<title>Improving the Appearance and Performance of Image Animation</title>
</head>
<body BGCOLOR="#ffffff">








<table width="100%">
<tr>
<td align=left>
<a href="imagesequence.html"><img src="http://docs.rinet.ru/OLDui/images/PreviousArrow.gif" width=26 height=26 align=bottom border=0 alt="Previous | "></a><a
href="problems.html"><img src="http://docs.rinet.ru/OLDui/images/NextArrow.gif" width=26 height=26 align=bottom border=0 alt="Next | "></a><a
href="http://docs.rinet.ru:8080/OLDui/trailmap.html"><img src="http://docs.rinet.ru/OLDui/images/WayUpArrow.gif" width=26 height=26 align=bottom border=0 alt="Trail Map | "></a><a
href="..\index.html"><img src="http://docs.rinet.ru/OLDui/images/uiHeader.gif" width=26 height=26 align=bottom border=0 alt="Creating a User Interface (AWT Only) | "></a>
</td>
<td align=right>
<a href="index.html"><strong><em>Working with Graphics</em></strong></a>
</td>
</tr>
</table>
<p>
<center>
<IMG SRC="http://docs.rinet.ru/OLDui/images/shoeline2.GIF" ALIGN="BOTTOM" BORDER="0" WIDTH="202"
    HEIGHT="25" NATURALSIZEFLAG="3">
<IMG SRC="http://docs.rinet.ru/OLDui/images/shoeline2.GIF" ALIGN="BOTTOM" BORDER="0" WIDTH="202"
    HEIGHT="25" NATURALSIZEFLAG="3">
</center>
<p> 

<h2>
    Improving the Appearance and Performance of Image Animation
</h2>
<p>
<blockquote>

You might have noticed two things about
the animation on the previous page:
<ul>
<li> While the images were loading,
     the program displayed some images partially and others not at all.
<li> Loading the images took a long time.
</ul>
<p>

The problem of displaying partial images is easy to fix,
using the MediaTracker class.
MediaTracker also can decrease the amount of time
that loading images takes.
Another way to deal with the problem
of slow image loading 
is to change the image format somehow;
this page gives you some suggestions for doing so.


<h4>Using MediaTracker to Download Images and Delay Image Display</h4>
<blockquote>

The MediaTracker class lets you easily download data
for a group of images
and find out when the images are fully loaded.
Ordinarily, an image's data isn't downloaded 
until the image is drawn for the first time.
To request that the data for a group of images be preloaded asynchronously,
you can use the forms of
<code>checkID()</code> and
<code>checkAll()</code>
that take a boolean argument,
setting the argument to <code>true</code>.
To load data synchronously (waiting for the data to arrive),
use the 
<code>waitForID()</code> and
<code>waitForAll()</code>
methods.
The MediaTracker methods that load data
use several background threads to download the data,
resulting in increased speed.

<p>

To check on the status of image loading,
you can use the MediaTracker
<code>statusID()</code> and
<code>statusAll()</code> methods.
To simply check whether any image data remains to be loaded,
you can use the
<code>checkID()</code> and
<code>checkAll()</code> methods.

<p>

Here's a <a href=http://docs.rinet.ru/OLDui/OLDui/drawing/example/MTImageSequence.java>modified version
of the example applet</a>
that uses the MediaTracker
<code>waitForAll()</code> and
<code>checkAll()</code> methods.
Until every image is fully loaded,
this applet simply displays a "Please wait..." message.
See the 
<a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.MediaTracker.html">MediaTracker documentation</a><a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.awt.MediaTracker.html"><img src="http://docs.rinet.ru/OLDui/images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a> for an example that draws a background image immediately,
but delays drawing the animated images.

<p>

Here is the applet in action:

<p>

<applet codebase=http://docs.rinet.ru:8080/OLDui/OLDui/drawing/example code=MTImageSequence.class width=100 height=68>
<blockquote>
<hr>
<em>
Your browser can't run 1.0 Java applets.
If it could, you'd see Duke waving at you.
<blockquote><IMG SRC="http://docs.rinet.ru/OLDui/figures/ui/T10.gif" WIDTH="55" HEIGHT="68" ALIGN="BOTTOM" NATURALSIZEFLAG="3" ALT=""></blockquote></em>
<hr>
</blockquote>
</applet>

<p>

Below is the changed code,
which uses a MediaTracker to help delay image display.  
Differences are marked in a <b>bold</b> font.

<blockquote>
<pre>
...<em>//Where instance variables are declared:</em>
<b>MediaTracker tracker;</b>

...<em>//In the init() method:</em>
<b>tracker = new MediaTracker(this);</b>
for (int i = 1; i &lt;= 10; i++) {
    images[i-1] = getImage(getCodeBase(),
                           "../../../images/duke/T"+i+".gif");
    <b>tracker.addImage(images[i-1], 0);</b>
}

...<em>//At the beginning of the run() method:</em>
<b>try {
    //Start downloading the images. Wait until they're loaded.
    tracker.waitForAll();
} catch (InterruptedException e) {}</b>

...<em>//At the beginning of the update() method:</em>
//If not all the images are loaded, just clear the background
//and display a status string.
<b>if (!tracker.checkAll()) {
    g.clearRect(0, 0, d.width, d.height);
    g.drawString("Please wait...", 0, d.height/2);
}</b>

//If all images are loaded, draw.
else {
    ...<em>//same code as before</em>...
</pre>
</blockquote>


</blockquote>
<h4>Speeding Up Image Loading</h4>

<blockquote>
Whether or not you use MediaTracker,
loading images using URLs
(as applets usually do)
usually takes a long time.
Most of the time is taken up by 
initiating HTTP connections.
Each image file requires a separate HTTP connection,
and each connection can take several seconds to initiate.
The key to avoiding this performance hit
is to combine the images in a single file.
You can further improve performance by using some sort of compression scheme,
especially one that's designed for moving images.

<p>

One simple way to combine images in a single file
is to create an image strip --
a file that contains several images in a row.
Here's an example of an image strip:

<p>

jack.gif: 
<blockquote><IMG SRC="http://docs.rinet.ru/OLDui/figures/ui/jack_trans.gif" WIDTH="328" HEIGHT="90" ALIGN="BOTTOM" NATURALSIZEFLAG="3" ALT=""></blockquote>
<p>

To draw an image from the strip,
you first set the clipping area to the size of one image.
Then you draw the image strip,
shifted to the left (if necessary)
so that only the image you want appears within the clipping area.
For example:

<blockquote>
<pre>
//imageStrip is the Image object representing the image strip.
//imageWidth is the size of an individual image in the strip.
//imageNumber is the number (from 0 to numImages) of the image to draw.
int stripWidth = imageStrip.getWidth(this);
int stripHeight = imageStrip.getHeight(this);
int imageWidth = stripWidth / numImages;
g.clipRect(0, 0, imageWidth, stripHeight);
g.drawImage(imageStrip, -imageNumber*imageWidth, 0, this);
</pre>
</blockquote>

<p>

If you want image loading to be faster still,
you should look into image compression schemes,
especially ones like Flic 
that perform inter-frame compression.

</blockquote>

</blockquote>
<p>
<hr size=4>
<p> 
<table width="100%">
<tr>
<td align=left>
<a href="imagesequence.html"><img src="http://docs.rinet.ru/OLDui/images/PreviousArrow.gif" width=26 height=26 align=top border=0 alt="Previous | "></a><a
href="problems.html"><img src="http://docs.rinet.ru/OLDui/images/NextArrow.gif" width=26 height=26 align=top border=0 alt="Next | "></a><a
href="http://docs.rinet.ru:8080/OLDui/trailmap.html"><img src="http://docs.rinet.ru/OLDui/images/WayUpArrow.gif" width=26 height=26 align=top border=0 alt="Trail Map | "></a><a
href="..\index.html"><img src="http://docs.rinet.ru/OLDui/images/uiHeader.gif" width=26 height=26 align=top border=0 alt="Creating a User Interface (AWT Only) | "></a>
</td>
<td align=right>
<a href="index.html"><strong><em>Working with Graphics</em></strong></a>
</td>
</tr>
</table>
</body>
</html>
