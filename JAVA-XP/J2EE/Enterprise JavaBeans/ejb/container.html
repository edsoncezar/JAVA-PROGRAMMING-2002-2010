<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<title>EJB Containers by Gopalan Suresh Raj</title>
</head>

<body bgcolor="#FFFFFF" text="#000000">

<p align="center"><a
        href="http://www.execpc.com/~gopalan/index.html"><img
        src="..\..\resources\wc.gif"
        border="0" width="200" height="45"></a></p>

<p align="center"><font color="#000080" size="5" face="Arial"><strong>EJB
Containers</strong></font><font face="Verdana"><br>
</font><a href="http://www.execpc.com/~gopalan/personal/cv.html"><font
color="#000080" size="4" face="Verdana">Gopalan Suresh Raj</font></a></p>

<p><font size="2" face="Verdana">A container is a set of classes
generated by the deployment tool that manages among other things,
an enterprise Bean's persistence, transactional properties, and
security. </font></p>

<p><font face="Arial"><b>Obtaining Services from the Container</b></font></p>

<p><font size="2" face="Verdana">The EJB container provides EJBs
with a distributed object infrastructure<b>.</b> EJB assumes an
underlying ORB that understands the CORBA/IDL or RMI/IDL
semantics. The IIOP transport layer should be able to propagate
CORBA OTS transactions.</font></p>

<p><font size="2" face="Verdana">The container helps in component
packing and deployment. An EJB is packaged using JARs, manifests
and deployment descriptors. The container unJARs the EJBs and
then executes it based on the instructions it gets from the
manifest file and deployment descriptors</font></p>

<p><font size="2" face="Verdana">EJB containers provide
declarative transaction management. EJB supports transactions
built on the JTS service. The EJB container allows you to
declaratively define your transactional objects. Your application
need not make explicit calls to JTS to participate in a
distributed transaction. The EJB container can explicitly manage
the start, commit and rollback of a transaction. It starts a
transaction if none exist. It manages the completion of the
transaction using the underlying JTS services. You design the
transactional attributes of the EJB at design-time (or during
deployment) using declarative statements in the deployment
descriptors. Optionally EJBs can explicitly control the
boundaries of a transaction using explicit JTS semantics.</font></p>

<p><font size="2" face="Verdana">EJB containers manage the entire
life-cycle of an EJB Bean. As a Bean provider, you are
responsible for providing a remote interface for your EJB. You
must define a factory interface that extends the </font><font
size="1" face="Verdana">javax.ejb.EJBHome</font><font size="2"
face="Verdana"> Factory object (a class factory). The interface
should provide one or more </font><font size="1" face="Verdana">create()</font><font
size="2" face="Verdana"> methods, one for each way you create
your </font><font size="1" face="Verdana">EJBObject</font><font
size="2" face="Verdana">. The container provider will
automatically generate the factory implementation. However, your
EJB Bean must implement an </font><font size="1" face="Verdana">ejbCreate()</font><font
size="2" face="Verdana"> method for each </font><font size="1"
face="Verdana">create()</font><font size="2" face="Verdana">
method you defined in your factory interface. As a last step you
will have to register your factories with the container so that
clients can create new beans. The container also provides a
Finder interface to help clients locate existing entity beans.</font></p>

<p><font size="2" face="Verdana">As part of managing the life
cycle of an enterprise Bean, the container calls your Bean when
it is loaded into memory (or activated) and also calls it when it
is deactivated from memory (passivated). Your component can then
use these calls to explicitly manage its state and grab or
release system resources.</font></p>

<p><font size="2" face="Verdana">EJB containers can manage both
transient EJB beans and persistent EJB beans. Persistent or
entity beans encapsulate in their object reference a unique ID
that points to their state. An Entity Bean manages its own
persistence by implementing the persistence operations directly.
The container just hands down a unique key and tells it to load
its state. The entity EJB can also direct the EJB Container to
manage its state. The container can do this by simply serializing
the EJB Bean&#146;s state and store it in some persistent store
or it can be as sophisticated as to map the EJB Bean&#146;s
persistent fields to columns in an RDBMS. Alternately, the EJB
container may choose to implement persistence using an embedded
ODBMS. The more advanced EJB containers can load the state of an
EJB Bean from a persistent store and later save it on
transactional boundaries.</font></p>

<p><font size="2" face="Verdana">EJB containers can provide
metadata about the EJB beans that they contain. For eg., the EJB
container can return the class name of the EJB Bean that this
factory (</font><font size="1" face="Verdana">EJBHome</font><font
size="2" face="Verdana">) interface is associated with.</font></p>

<p><font size="2" face="Verdana">EJB containers automate the
management of some of the security aspects of the EJB Bean. The
EJB developer gets to define the security roles for his EJB Bean
in a </font><font size="1" face="Verdana">SecurityDescriptor</font><font
size="2" face="Verdana"> object. The developer then serializes
this object and puts it in his Bean&#146;s JAR. The EJB container
uses this object to perform all security checks on behalf of the
EJB Bean.</font></p>

<p><font face="Arial"><b>Relationship between EJB container and
the server</b></font></p>

<p><font size="2" face="Verdana">The interface between the
container and the server isn't specified yet, so it's not really
possible at this point in time to have a container without a
server. EJBs are intended to exist within an EJB container; they
don't run as standalone classes. The idea of the architecture is
that the container provides the logical interface between the
Bean and the outside world, and the server provides the
implementation of the functionality that the container requires
(persistence, transactions, pooling, multiple instances, etc).
The idea of the EJB architecture is that the server and container
are responsible for providing the hard stuff (transactions,
persistence, etc), so you only have to write the business logic.
With EJB, you don't need to roll your own persistence mechanisms,
or deal with multi-threading issues at all. These sorts of things
are the truly hard parts of distributed systems. EJB was created
so that programmers don&#146;t have to deal with these things.</font></p>

<p><font face="Arial"><b>Building Customized EJB containers</b></font></p>

<p><font size="2" face="Verdana">The EJB Spec allows
customization of the EJB Container. EJBeans which use customized
containers naturally cannot be deployed in &quot;vanilla&quot;
EJB containers, whereas the reverse is true (ie.
&quot;vanilla&quot; EJBs can be deployed in customized EJB
containers) The spec does not define the contract between the
container and the server, therefore the interfaces are
proprietary to each server. To build a custom container, you will
need to work with the EJB server vendor.</font></p>

<p><font size="2" face="Verdana">However, there may be multiple
reasons for extending the EJB model for a given enterprise and
create customized containers. The three reasons that come to mind
are:</font></p>

<ol>
    <li><font size="2" face="Verdana">Extending the
        Container-to-EJB contract for legacy integration; eg. To
        include a service currently not modeled into EJB. An
        event service is one such glaring example.</font></li>
    <li><font size="2" face="Verdana">Viewing the legacy
        application as a persistence provider. There is no change
        to the container-to-Bean and container-to-EJBClient
        contracts.</font></li>
    <li><font size="2" face="Verdana">Reimplementing the services
        used/provided by the EJB container. eg. integrating an
        organization&#146;s custom middleware will require the
        EJB server to use the appropriate middleware. Again,
        there is no change to any of the contracts.</font></li>
</ol>

<p><font size="2" face="Verdana">If one wishes to achieve the
componentization benefits of the EJB model, extension of the EJB
contracts should be the recommended approach over writing custom
containers from scratch. Theoretically, there is nothing wrong
with organizations implementing component models that have
entirely different interfaces/contracts other than the fact that
the benefits that may stem from such componentization are limited
to that organization. </font></p>

<p><font face="Arial"><b>Contract between the client and the EJB
container</b></font></p>

<p><font size="2" face="Verdana">The EJB provider has to adhere
to two contracts: the <strong>client contract </strong>and the <strong>component
contract</strong>. The <strong>client contract </strong>is
between the EJB client and the EJB container. It is actually the
view that the client sees of the Enterprise Bean. It establishes
a unique identity, defines the home interface and indicates how
the class methods work. The Java naming and directory interface
defines how to search and uniquely identify the EJB and container
objects. Within the container, a unique key identifies each EJB.
The home interface is a basic description of how to create EJBs
in various forms according to the different <code>create() </code>methods
and<code> how to destroy EJBs using the remove()</code> method. </font></p>

<p><font size="2" face="Verdana">There are two sides to the life
cycle of an EJB client-server session:</font></p>

<ul>
    <li><font size="2" face="Verdana">How the client sees the EJB
        and</font></li>
    <li><font size="2" face="Verdana">How the EJB container and
        server facilitate the client.</font></li>
</ul>

<p><font size="2" face="Verdana">Figure below illustrates the
classes involved in a typical EJB scenario. </font></p>
<div align="center"><center>

<table border="1" cellpadding="7" cellspacing="1" width="590">
    <tr>
        <td><p align="center"><font size="2" face="Verdana"><img
        src="contclass.gif" width="574" height="412"></font></p>
        <p align="center"><em>Figure: Classes available in a
        typical EJB scenario.</em></p>
        </td>
    </tr>
</table>
</center></div>

<p><font size="1" face="Verdana">The sequence diagram is shown
below.</font><font size="2" face="Verdana">The point of view of
the client is illustrated in Figure below. Starting at the top
left of the image, the client first creates a new context to look
up the EJBObject with the help of a JNDI server. Given this
context, the client then creates an EJB using the home interface.
The client can then call the available methods of the EJBObject.
And when all the activities are complete, the client calls the <code>remove()</code>
function -- also through the home interface -- which terminates
the session.</font></p>
<div align="center"><center>

<table border="1" cellpadding="5" cellspacing="1">
    <tr>
        <td><p align="center"><font size="2"><img
        src="contdesign.gif" width="415" height="407"><br>
        </font><i>Figure: Client View of an Enterprise JavaBean
        session.</i><font size="2"> </font></p>
        </td>
    </tr>
</table>
</center></div>

<p><font size="2" face="Verdana">The equivalent code looks like
this:</font></p>
<div align="center"><center>

<table border="1">
    <tr>
        <td bgcolor="#F4F4F4"><font size="2"
        face="Lucida Console">import javax.naming.*; <br>
        public class EJBClient { <br>
        &nbsp;public static void main (String[] argv) { <br>
        &nbsp; // get the JNDI naming context <br>
        &nbsp; <strong>Context initialCtx = new InitialContext
        ();</strong> <br>
        &nbsp; // use the context to lookup the EJB Home
        interface <br>
        &nbsp; <strong>AccountHome
        home=(AccountHome)initialCtx.lookup(&quot;Account&quot;);</strong>
        <br>
        &nbsp; // use the Home Interface to create a Session Bean
        object <br>
        &nbsp; <strong>Account account = home.create (1234,
        &quot;Athul&quot;, 1000225.28d)</strong>; <br>
        &nbsp; // invoke business methods <br>
        &nbsp; <strong>account.credit (1000001.55d); </strong><br>
        &nbsp; // remove the object <br>
        &nbsp; <strong>account.remove (); </strong><br>
        &nbsp;} <br>
        } </font></td>
    </tr>
</table>
</center></div>

<p><font face="Arial"><b>Contract between a container and an EJB</b></font></p>

<p><font size="2" face="Verdana">The <strong>component contract </strong>is
between an EJB container and the EJB and defines a callback
mechanism to the EJB instance for object state -management
purposes. This allows the container to inform the EJB of events
in the Enterprise JavaBean's life cycle. The Enterprise JavaBean
object and container&#146;s point of view is shown in Figure
below in simplified form. Both the EJB server and container
perform actions, which are invisible to the client. The container
allocation is a function of the EJB server and not the
responsibility of either the client or EJB programmer. </font></p>
<div align="center"><center>

<table border="0" cellpadding="5" cellspacing="0">
    <tr>
        <td><p align="center"><font size="2"><img
        src="contview.gif" width="577" height="435"><br>
        </font><i>Figure: The Container and Enterprise JavaBean
        Point of View of a Session.</i><font size="2"> </font></p>
        </td>
    </tr>
</table>
</center></div>

<p><font size="2" face="Verdana">The client begins a new session
by sending the <code>create()</code> command. The container then
creates a new EJB using the <code>newInstance()</code> call and
proceeds to define the context in which the EJB will run with <code>setSessionContext()</code>.
Elements of the context include: information about the container,
the environment, and the calling client's identity. Finally it
sends the <code>ejbCreate()</code> call, which contains the input
parameters as sent by the client. This creates a new EJB whose
methods can be accessed directly without any interference from
the container.</font></p>

<p><font size="2" face="Verdana">In some cases, the container may
choose to push EJB instances into a secondary cache when they are
idle, using the <code>ejbPassivate()</code> call. When the EJB
session object is needed again, it is recalled with <code>ejbActivate()</code></font><font
size="1" face="Verdana">.</font><font size="2" face="Verdana">
When the client has completed its session, it sends the <code>destroy()</code>
call, which is intercepted by the container. The container, in
turn, sends a </font><font size="1" face="Verdana">ejbDestroy()</font><font
size="2" face="Verdana"> call to the EJB instance, allowing it to
clean up any pieces as needed. </font></p>

<p><font size="2" face="Verdana">The container can do a lot more
than just pass operations safely to an EJB instance. Where many
session objects exist in parallel, for example, the container can
manage concurrency for maximum efficiency service. The container
can cache an EJB instance in secondary memory if it is idle for
too long. This reduces the overall memory usage while preserving
the EJB session and its state. The container can also use the
number of incoming connections to predict how many additional
sessions may be needed in the future and allocate them ahead of
time, thus saving on connection setup time. </font></p>

<p><font size="2" face="Verdana">The ability to cache an
Enterprise JavaBean session object is not the same as with a
persistent object. This cache is lost when the EJB server is shut
down or crashes or if the container is destroyed. It's a
temporary cache system that exists only to enhance performance
when the program has to handle a large number of session objects.
</font></p>

<p><font size="2" face="Verdana">The container manages this
working set of session objects automatically without the client
or server's direct intervention. There are specific callback
methods in each EJB which describes how to <em>passivate</em>
(store in cache) or <em>activate</em> (retrieve from cache) these
objects. When the <code>ejbPassivate()</code> call is made, the
EJB is serialized using the Java serialization API or other
similar methods and stored in secondary memory. The <code>ejbActivate()</code>
method causes just the opposite. </font></p>

<p><a href="..\ejb.html"><font
size="2" face="Verdana">click here to go to</font><font size="4"
face="Verdana"> </font><br>
<font size="4" face="Verdana">My EJB HomePage...</font></a></p>

<table border="1" cellpadding="2" width="95%">
    <tr>
        <td valign="top" width="100%" bgcolor="#004080"><font
        color="#FFCC00" size="4" face="Verdana">About the Author...</font></td>
    </tr>
    <tr>
        <td valign="top" width="100%" bgcolor="#FFF2F2"><a
        href="http://www.execpc.com/~gopalan/personal/cv.html"><font
        color="#000080" size="2" face="Tahoma"><strong>Gopalan
        Suresh Raj</strong></font></a><font size="2"
        face="Tahoma"><strong> </strong>is a Software Architect,
        Developer and an active Author. He is contributing author
        to a couple of books &quot;<strong>Enterprise Java
        Computing-Applications and Architecture</strong>&quot;
        and &quot;<strong>The Awesome Power of JavaBeans</strong>&quot;.
        His expertise spans enterprise component architectures
        and distributed object computing. Visit him at his </font><a
        href="http://www.execpc.com/~gopalan"><font size="2"
        face="Tahoma"><strong>Web Cornucopia</strong><sup><strong>©</strong></sup></font></a><font
        size="2" face="Tahoma"> site (<strong>http://www.execpc.com/~gopalan</strong>)
        or mail him at </font><a href="mailto:gopalan@execpc.com"><font
        size="2" face="Tahoma"><strong>gopalan@execpc.com</strong></font></a><font
        size="2" face="Tahoma">.</font></td>
    </tr>
</table>

<hr>

<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td align="center"><p align="center"><a
        href="http://www.execpc.com/~gopalan/index.html"><font
        color="#000000"><img
        src="..\..\resources\home(2).gif"
        alt="Go to the Component Engineering Cornucopia page"
        width="65" height="44" start="fileopen"></font></a></p>
        </td>
        <td align="center" colspan="2"><p align="center"><font
        color="#000080" size="4" face="Arial Narrow"><strong>This
        site was developed and is maintained by </strong></font><a
        href="http://www.execpc.com/~gopalan/personal/cv.html"
        style="COLOR: rgb(0,0,128)"><font color="#000080"
        size="4" face="Arial Narrow"><strong>Gopalan Suresh Raj</strong></font></a></p>
        <p align="center"><font color="#000080" size="4"
        face="Arial Narrow"><strong>This page has been visited </strong></font><font
        color="#000080"><img
        src="..\..\..\..\counter.execpc.com\cgi-bin\nph-count\width=5&link=~gopalan_misc_compare3.html"></font><font
        color="#000080" size="4" face="Arial Narrow"><strong>
        times since September 21,1998.</strong></font></p>
        </td>
    </tr>
</table>

<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td align="center"><p align="center"><font
        color="#800000" size="3">Last Updated : Dec 19, '98</font></p>
        </td>
        <td colspan="2"><p align="center"><a
        href="mailto:gopalan@execpc.com"><font color="#800000"
        size="4" face="Arial Narrow">If you have any questions,
        comments, or problems regarding this site, please write
        to me I would love to hear from you</font></a><font
        color="#800000" size="4" face="Arial Narrow">.</font></p>
        </td>
    </tr>
</table>

<hr>
<div align="center"><center>

<table border="0" cellspacing="1" width="693" height="54">
    <tr>
        <td width="689" height="27"><p align="center"><font
        color="#000000" size="1" face="Courier New">Copyright (c)
        1997-98, </font><a
        href="http://www.execpc.com/~gopalan/personal/cv.html"
        style="COLOR: rgb(0,0,128)"><font color="#000000"
        size="1" face="Courier New">Gopalan Suresh Raj</font></a><font
        color="#000000" size="1" face="Courier New"> - All rights
        reserved. </font><a
        href="http://www.execpc.com/~gopalan/misc/cpright.html"
        style="COLOR: rgb(0,0,128)"><font color="#000000"
        size="1" face="Courier New">Terms of use</font></a><font
        color="#000000" size="1" face="Courier New">.</font></p>
        </td>
    </tr>
    <tr>
        <td width="689" height="27"><p align="center"><font
        color="#000000" size="1" face="Courier New">All products
        and companies mentioned at this site are trademarks of
        their respective owners.</font></p>
        </td>
    </tr>
</table>
</center></div><!-- start of NedStat code -->

<p align="center"><a
href="http://usa.nedstat.net/cgi-bin/viewstat?name=java_tutorial"><img
src="..\..\..\..\usa.nedstat.net\cgi-bin\nedstat.gif\name=java_tutorial"
align="right" border="0" hspace="0"></a> <!-- end of NedStat code --> </p>
<script language="JavaScript">
<!--
  document.write("<img src=\"http://usa.nedstat.net/cgi-bin/referstat.gif?name=java_tutorial&refer="+escape(top.document.referrer)+"\" width=1 height=1 alt=\"\">");
// -->
</script>

<!-- eXTReMe digital Web Tracking Code Starts Here -->
<a target="_top" href="http://w.extreme-dm.com/?login=javatrac">
<img name=im src="..\..\..\..\w1.extreme-dm.com\i.gif" height=38
border=0 width=41 alt=""></a><script language="javascript"><!--
an=navigator.appName;d=document;function
pr(){d.write("<img src=\"http://w0.extreme-dm.com",
"/0.gif?tag=javatrac&j=y&srw="+srw+"&srb="+srb+"&",
"rs="+r+"&l="+escape(d.referrer)+"\" height=1 ",
"width=1>");}srb="na";srw="na";//-->
</script><script language="javascript1.2"><!--
s=screen;srw=s.width;an!="Netscape"?
srb=s.colorDepth:srb=s.pixelDepth;//-->
</script><script language="javascript"><!--
r=41;d.images?r=d.im.width:z=0;pr();//-->
</script><noscript><img height=1 width=1 alt=""
src="..\..\..\..\w0.extreme-dm.com\0.gif\tag=javatrac&j=n"></noscript>
<!-- eXTReMe digital Web Tracking Code Ends Here  -->


</body>
</html>
