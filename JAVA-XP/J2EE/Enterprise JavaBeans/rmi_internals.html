<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<title>Java RMI - Under the Hood by Gopalan Suresh Raj</title>
</head>

<body
background="..\resources\ivy.gif"
bgcolor="#FFFFFF" text="#000000">

<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td rowspan="3">&nbsp;</td>
        <td>
        <p align="center"><a href="http://gsraj.tripod.com/index.html">
<img
        src="..\resources\wc.gif"
        border="0" width="200" height="45"></a></td>
        <td rowspan="3">&nbsp;</td>
    </tr>
    <tr>
        <td><p align="center"><font color="#000080" size="6"
        face="Arial"><strong>Java RMI - Under the Hood</strong></font></p>
        <p align="center"><a
        href="http://www.execpc.com/~gopalan/personal/cv.html"><font
        color="#000080" size="3" face="Arial"><strong>Gopalan
        Suresh Raj</strong></font></a></p>
        </td>
    </tr>
    <tr>
        <td>
        <img
        src="..\resources\rings.gif"
        align="left" hspace="0" width="574" height="44"></td>
    </tr>
    <tr>
        <td valign="top" width="25%"><font face="Verdana">&nbsp; </font></td>
        <td valign="top" width="50%" bgcolor="#FFFFC4"><blockquote>
            <p align="center"><font color="#800000" size="4"
            face="Verdana"><strong></strong></font>&nbsp;</p>
            <p align="center"><font color="#800000" size="4"
            face="Verdana"><strong>Java RMI Internals</strong></font></p>
            <ol>
                <li><p align="left"><font color="#000000"
                    size="4" face="Verdana"><img
                    src="..\resources\arrow.gif"
                    width="11" height="17">The RMI Server creates
                    an instance of the 'Server Object' which
                    extends </font><font color="#800000" size="4"
                    face="Verdana"><em>UnicastRemoteObject</em></font></p>
                </li>
                <li><p align="left"><font color="#000000"
                    size="4" face="Verdana"><img
                    src="..\resources\arrow.gif"
                    width="11" height="17"> The constructor for
                    UnicastRemoteObject &quot;exports&quot; the
                    Server Object - basically making it available
                    to service incoming RMI calls. A TCP socket
                    which is bound to an arbitrary port number is
                    created and a thread is also created that
                    listens for connections on that socket.</font></p>
                </li>
                <li><p align="left"><font color="#000000"
                    size="4" face="Verdana"><img
                    src="..\resources\arrow.gif"
                    width="11" height="17"> The server registers
                    the server object with the registry. This
                    operation actually hands the registry </font><font
                    color="#000000" size="3" face="Verdana">(Note:
                    The RMI Registry is an RMI server itself)</font><font
                    color="#000000" size="4" face="Verdana"> the
                    client-side &quot;stub&quot; for that server
                    object. This stub contains the information
                    needed to &quot;call back&quot; to the server
                    when it is invoked </font><font
                    color="#000000" size="3" face="Verdana">(such
                    as the hostname/port of the server listening
                    socket)</font><font color="#000000" size="4"
                    face="Verdana">.</font></p>
                </li>
                <li><p align="left"><font color="#000000"
                    size="4" face="Verdana"><img
                    src="..\resources\arrow.gif"
                    width="11" height="17"> A client obtains this
                    stub by calling the registry, which hands it
                    the stub directly. </font><font
                    color="#000000" size="3" face="Verdana">(This
                    is also where the &quot;codebase&quot; comes
                    in: If the server specified a
                    &quot;codebase&quot; to use for clients to
                    obtain the classfile for the stub, this will
                    be passed along to the client via the
                    registry. The client can then use the
                    codebase to resolve the stub class - that is,
                    to load the stub classfile itself)</font><font
                    color="#000000" size="4" face="Verdana">.
                    That is all that the RMIRegistry really does:
                    It holds onto remote object stubs which it
                    can hand off to clients when requested.</font></p>
                </li>
                <li><p align="left"><font color="#000000"
                    size="4" face="Verdana"><img
                    src="..\resources\arrow.gif"
                    width="11" height="17"> When the client
                    issues a remote method invocation to the
                    server, the stub class creates a
                    &quot;RemoteCall&quot; which basically <br>
                    (a) opens a socket to the server on the port
                    specified in the stub itself, and <br>
                    (b) Sends the RMI header information as
                    described in the RMI spec.</font></p>
                </li>
                <li><p align="left"><font color="#000000"
                    size="4" face="Verdana"><img
                    src="..\resources\arrow.gif"
                    width="11" height="17"> The stub class
                    marshalls the arguments over the connection
                    by using methods on RemoteCall to obtain the
                    output stream which basically returns a
                    subclass of </font><font color="#800000"
                    size="4" face="Verdana"><em>ObjectOutputStream
                    </em></font><font color="#000000" size="4"
                    face="Verdana">which knows how to deal with
                    passing objects which extend java.rmi.Remote,
                    which serializes Java objects over the socket</font></p>
                </li>
                <li><p align="left"><font color="#000000"
                    size="4" face="Verdana"><img
                    src="..\resources\arrow.gif"
                    width="11" height="17"> The stub class calls </font><font
                    color="#800000" size="4" face="Verdana"><em>RemoteCall.executeCall</em></font><font
                    color="#000000" size="4" face="Verdana">
                    which causes the RMI to happen.</font></p>
                </li>
                <li><p align="left"><font color="#000000"
                    size="4" face="Verdana"><img
                    src="..\resources\arrow.gif"
                    width="11" height="17"> On the server side,
                    when a client connects to the server socket,
                    a new thread is forked to deal with the
                    incoming call. The original thread can
                    continue listening to the original socket so
                    that additional calls from other clients can
                    be made.</font></p>
                </li>
                <li><p align="left"><font color="#000000"
                    size="4" face="Verdana"><img
                    src="..\resources\arrow.gif"
                    width="11" height="17"> The server reads the
                    header information and creates a RemoteCall
                    of its own to deal with unmarshalling the RMI
                    arguments from the socket. </font></p>
                </li>
                <li><p align="left"><font color="#000000"
                    size="4" face="Verdana"><img
                    src="..\resources\arrow.gif"
                    width="11" height="17"> The server calls the
                    &quot;</font><font color="#800000" size="4"
                    face="Verdana"><em>dispatch</em></font><font
                    color="#000000" size="4" face="Verdana">&quot;
                    method of the skeleton class </font><font
                    color="#000000" size="3" face="Verdana">(the
                    server-side &quot;stub&quot; generated by
                    rmic)</font><font color="#000000" size="4"
                    face="Verdana">, which calls the appropriate
                    method on the object and pushes the result
                    back down the wire </font><font
                    color="#000000" size="3" face="Verdana">(using
                    the same 'RemoteCall' interface which the
                    client used to marshall the arguments)</font><font
                    color="#000000" size="4" face="Verdana">. If
                    the server object threw an exception then the
                    server catches this and marshalls that down
                    the wire instead of the return value.</font></p>
                </li>
                <li><p align="left"><font color="#000000"
                    size="4" face="Verdana"><img
                    src="..\resources\arrow.gif"
                    width="11" height="17"> Back on the client
                    side, the return value of the RMI is
                    unmarshalled </font><font color="#000000"
                    size="3" face="Verdana">(using the RemoteCall
                    created in step 5 above)</font><font
                    color="#000000" size="4" face="Verdana"> and
                    returned from the stub back to the client
                    code itself. If an exception was thrown from
                    the server that's unmarshalled and re-thrown
                    from the stub. </font></p>
                </li>
            </ol>
            <p align="left"><font color="#000000" size="4"
            face="Verdana">Now, it should be obvious how multiple
            clients call the same server object:</font></p>
            <p align="left"><font color="#000000" size="4"
            face="Verdana">They all get stubs which contain the
            same hostname/port number as the server-side socket
            which is listening for calls on the object. </font></p>
            <p align="left"><font color="#000000" size="4"
            face="Verdana">When a client connects, the server
            forks a new thread to deal with the incoming request,
            but keeps listening to that original socket </font><font
            color="#000000" size="3" face="Verdana">(in another
            thread)</font><font color="#000000" size="4"
            face="Verdana"> so that other calls can be made. </font></p>
            <p align="left"><font color="#000000" size="4"
            face="Verdana">There doesn't appear to be any
            synchronization within the server side components -
            if multiple clients simultaneously call into the
            server object they can all manipulate the server
            object state at the same time. You can of course make
            methods in your server object
            &quot;synchronized&quot; to synchronize access to
            them. </font></p>
            <p align="left"><font color="#000000" size="4"
            face="Verdana">Now, the RMI specification defines
            both a &quot;single op&quot; and a &quot;stream&quot;
            protocol for RMI calls. The former allows a single
            RMI call to be made on a socket which is then closed;
            the latter allows multiple RMI calls to be issued on
            the same socket one after the other. </font></p>
            <p align="left"><font color="#000000" size="4"
            face="Verdana">Sun's RMI implementation appears to be
            using this latter mechanism which means that a single
            client-side stub object will open a single socket to
            the server for all of its communication. </font></p>
            <p align="left"><font color="#000000" size="4"
            face="Verdana">Multiple stubs within the same JVM or
            different JVMs on the same host will each have their
            own socket to the server </font><font color="#000000"
            size="3" face="Verdana">(which might all dispatch
            calls to the same server-side object)</font><font
            color="#000000" size="4" face="Verdana">. The net
            result is that each time you obtain a stub </font><font
            color="#000000" size="3" face="Verdana">(from the
            registry)</font><font color="#000000" size="4"
            face="Verdana"> for a particular server-side object,
            you will eventually create a new socket to talk to
            the server.</font></p>
            <p align="left"><font color="#000000" size="4"
            face="Verdana">So basically:<br>
            ON THE SERVER: A single 'UnicastRemoteObject' which
            ends up creating multiple threads to listen for calls
            on this single object - one thread per socket </font><font
            color="#000000" size="3" face="Verdana">(basically
            meaning one thread per client)</font></p>
            <p align="left"><font color="#000000" size="4"
            face="Verdana">ON THE CLIENT: One socket to the
            server per stub, meaning that if the client has
            multiple stubs pointing to the same server object it
            will have multiple sockets open to that server.</font></p>
        </blockquote>
        <p align="left"><font color="#FF0000" size="4"
        face="Verdana">More on this soon...</font></p>
        </td>
        <td valign="top" width="25%"><font face="Verdana">&nbsp; </font></td>
    </tr>
</table>

<hr>

<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td align="center"><p align="center"><a
        href="http://www.execpc.com/~gopalan/index.html"><font
        color="#000000">
        <img
        src="..\resources\home.gif"
        alt="Go to the Component Engineering Cornucopia page" start="fileopen" width="60" height="60"></font></a></p>
        </td>
        <td align="center" colspan="2"><p align="center"><font
        color="#000080" size="4" face="Arial Narrow"><strong>This
        site was developed and is maintained by </strong></font><a
        href="http://www.execpc.com/~gopalan/personal/cv.html"
        style="COLOR: rgb(0,0,128)"><font color="#000080"
        size="4" face="Arial Narrow"><strong>Gopalan Suresh Raj</strong></font></a></p>
        <p align="center"><font color="#000080" size="4"
        face="Arial Narrow"><strong>This page has been visited </strong></font><font
        color="#000000"><img
        src="..\..\..\counter.execpc.com\cgi-bin\nph-count\width=5&link=~gopalan_java_rmi_internals.html"></font><font
        color="#000080" size="4" face="Arial Narrow"><strong>
        times since July 6,1998.</strong></font></p>
        </td>
    </tr>
</table>

<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td align="center"><p align="center"><font
        color="#800000">L</font><font color="#800000" size="3">ast
        Updated : July 6, '98</font></p>
        </td>
        <td colspan="2"><p align="center"><a
        href="mailto:gopalan@execpc.com"><font color="#800000"
        size="4" face="Arial Narrow">If you have any questions,
        comments, or problems regarding this site, please write
        to me I would love to hear from you.</font></a></p>
        </td>
    </tr>
</table>

<hr>
<div align="center"><center>

<table border="0" cellspacing="1" width="693" height="54">
    <tr>
        <td width="689" height="27"><p align="center"><font
        color="#000000" size="1" face="Courier New">Copyright (c)
        1997-98, </font><a
        href="http://www.execpc.com/~gopalan/personal/cv.html"
        style="COLOR: rgb(0,0,128)"><font color="#000000"
        size="1" face="Courier New">Gopalan Suresh Raj</font></a><font
        color="#000000" size="1" face="Courier New"> - All rights
        reserved. </font><a
        href="http://www.execpc.com/~gopalan/misc/cpright.html"
        style="COLOR: rgb(0,0,128)"><font color="#000000"
        size="1" face="Courier New">Terms of use</font></a><font
        color="#000000" size="1" face="Courier New">.</font></p>
        </td>
    </tr>
    <tr>
        <td width="689" height="27"><p align="center"><font
        color="#000000" size="1" face="Courier New">All products
        and companies mentioned at this site,are trademarks of
        their respective owners.</font></p>
        </td>
    </tr>
</table>
</center></div>

<!--  Web Tracking Code Starts Here -->
<a target="_top" href="http://w.extreme-dm.com/?login=javatrac">
<img name=im src="..\..\..\w1.extreme-dm.com\i.gif" height=38
border=0 width=41 alt=""></a><script language="javascript"><!--
an=navigator.appName;d=document;function
pr(){d.write("<img src=\"http://w0.extreme-dm.com",
"/0.gif?tag=javatrac&j=y&srw="+srw+"&srb="+srb+"&",
"rs="+r+"&l="+escape(d.referrer)+"\" height=1 ",
"width=1>");}srb="na";srw="na";//-->
</script><script language="javascript1.2"><!--
s=screen;srw=s.width;an!="Netscape"?
srb=s.colorDepth:srb=s.pixelDepth;//-->
</script><script language="javascript"><!--
r=41;d.images?r=d.im.width:z=0;pr();//-->
</script><noscript><img height=1 width=1 alt=""
src="..\..\..\w0.extreme-dm.com\0.gif\tag=javatrac&j=n"></noscript>
<!-- eXTReMe digital Web Tracking Code Ends Here  -->


</body>
</html>