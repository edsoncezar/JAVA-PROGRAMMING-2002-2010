<?xml version="1.0"?>

<!DOCTYPE ejb-jar PUBLIC "-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 2.0//EN" "http://java.sun.com/dtd/ejb-jar_2_0.dtd">

<ejb-jar>
 <enterprise-beans>
	<session>
	  <description>
			A service that handles monetary payments
	  </description>
	  <ejb-name>ProcessPaymentEJB</ejb-name>
	  <home>com.titan.processpayment.ProcessPaymentHomeRemote</home>
	  <remote>com.titan.processpayment.ProcessPaymentRemote</remote>
	  <ejb-class>com.titan.processpayment.ProcessPaymentBean</ejb-class>
	  <session-type>Stateless</session-type>
	  <transaction-type>Container</transaction-type>
     <env-entry>
		   <env-entry-name>minCheckNumber</env-entry-name>
		   <env-entry-type>java.lang.Integer</env-entry-type>
		   <env-entry-value>2000</env-entry-value>
	  </env-entry>
	  <resource-ref>
		   <description>DataSource for the Titan database</description>
         <res-ref-name>jdbc/titanDB</res-ref-name>
		   <res-type>javax.sql.DataSource</res-type>
		   <res-auth>Container</res-auth>
	  </resource-ref>
	</session>

   <entity>
      <ejb-name>CustomerEJB</ejb-name>
      <home>com.titan.customer.CustomerHomeRemote</home>
      <remote>com.titan.customer.CustomerRemote</remote>
      <ejb-class>com.titan.customer.CustomerBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>java.lang.Integer</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>Customer</abstract-schema-name>
	  <cmp-field><field-name>id</field-name></cmp-field>
      <cmp-field><field-name>lastName</field-name></cmp-field>
      <cmp-field><field-name>firstName</field-name></cmp-field>
      <cmp-field><field-name>hasGoodCredit</field-name></cmp-field>
      <primkey-field>id</primkey-field>
      <security-identity><use-caller-identity/></security-identity>
   </entity>

   <entity>
	  <ejb-name>AddressEJB</ejb-name>
	  <local-home>com.titan.address.AddressHomeLocal</local-home>
	  <local>com.titan.address.AddressLocal</local>
	  <ejb-class>com.titan.address.AddressBean</ejb-class>
	  <persistence-type>Container</persistence-type>
	  <prim-key-class>java.lang.Integer</prim-key-class>
	  <reentrant>False</reentrant>
	  <cmp-version>2.x</cmp-version>
	  <abstract-schema-name>Address</abstract-schema-name>
	  <cmp-field><field-name>id</field-name></cmp-field>
	  <cmp-field><field-name>street</field-name></cmp-field>
	  <cmp-field><field-name>city</field-name></cmp-field>
	  <cmp-field><field-name>state</field-name></cmp-field>
	  <cmp-field><field-name>zip</field-name></cmp-field>
	  <primkey-field>id</primkey-field>
	  <security-identity><use-caller-identity/></security-identity>
   </entity>

 </enterprise-beans>
 
    <relationships>
	    <ejb-relation>
		    <ejb-relation-name>Customer-HomeAddress</ejb-relation-name>
		    <ejb-relationship-role>
			    <ejb-relationship-role-name>
				    Customer-has-a-Address
			    </ejb-relationship-role-name>
			    <multiplicity>One</multiplicity>
			    <relationship-role-source>
				    <ejb-name>CustomerEJB</ejb-name>
			    </relationship-role-source>
			    <cmr-field>
				    <cmr-field-name>homeAddress</cmr-field-name>
			    </cmr-field>
		    </ejb-relationship-role>
		    <ejb-relationship-role>
			    <ejb-relationship-role-name>
				    Address-belongs-to-Customer
			    </ejb-relationship-role-name>
			    <multiplicity>One</multiplicity>
			    <relationship-role-source>
				    <ejb-name>AddressEJB</ejb-name>
			    </relationship-role-source>
		    </ejb-relationship-role>
	    </ejb-relation>
    </relationships>



 <assembly-descriptor>
   <security-role>
      <description>
         This role represents everyone who is allowed full access 
         to the ProcessPayment EJB.
      </description>
     <role-name>everyone</role-name>
   </security-role>

   <method-permission>
     <role-name>everyone</role-name>
     <method>
         <ejb-name>ProcessPaymentEJB</ejb-name>
         <method-name>*</method-name>
     </method>
     <method>
         <ejb-name>CustomerEJB</ejb-name>
         <method-name>*</method-name>
     </method>
     <method>
         <ejb-name>AddressEJB</ejb-name>
         <method-name>*</method-name>
     </method>
   </method-permission>

   <container-transaction>
     <method>
        <ejb-name>ProcessPaymentEJB</ejb-name>
        <method-name>*</method-name>
     </method>
     <method>
        <ejb-name>CustomerEJB</ejb-name>
        <method-name>*</method-name>
     </method>
     <method>
         <ejb-name>AddressEJB</ejb-name>
         <method-name>*</method-name>
     </method>
     <trans-attribute>Required</trans-attribute>
   </container-transaction>
 </assembly-descriptor>

</ejb-jar>

