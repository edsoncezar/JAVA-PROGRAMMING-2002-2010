<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Configuring and Using JAXP 1.1 In JBoss</title><link rel="stylesheet" href="styles.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets Vimages/callouts/"><link rel="home" href="index.html" title="JBoss 3.0 Documentation"><link rel="up" href="ch13.html" title="Chapter 13. HOWTO"><link rel="previous" href="ch13s131.html" title="Customizing the JRMPContainerInvoker Socket Factories"><link rel="next" href="ch13s144.html" title="Clustering in JBoss 3.0 alpha"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\jboss.gif" border="0"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="ch13.html"><img src="images\toc.gif" border="0"></a><a href="ch13s131.html"><img src="images\prev.gif" border="0"></a><a href="ch13s144.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table><div class="section"><a name="d0e11833"></a><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="d0e11833"></a>Configuring and Using JAXP 1.1 In JBoss</h2></div></div><p>
  <span class="author">Scott Stark</span>
  <tt>&lt;<a href="mailto:Scott_Stark@displayscape.com">Scott_Stark@displayscape.com</a>&gt;</tt>
 </p><div class="section"><a name="d0e11847"></a><div class="titlepage"><div><h3 class="title"><a name="d0e11847"></a>Introduction</h3></div></div><p>JBoss uses the JAXP 1.1 optional package to JAXP to parse and transform XML documents using a pure Java API that is independent of a particular XML processor implementation. This allows the flexibility to swap between XML processors without making application code changes. Version 1.1 includes an XSLT framework based on TrAX (Transformation API for XML) plus some updates to the parsing API to support DOM Level 2 and SAX version 2.0 and an improved scheme to locate pluggable implementations. </p></div><div class="section"><a name="d0e11852"></a><div class="titlepage"><div><h3 class="title"><a name="d0e11852"></a>Configuring XML Parsers and Transformers</h3></div></div><p>This section covers how one configures which xml parser and transformers the JBoss uses. It is based largely on the current <a href="http://java.sun.com/xml/download.html" target="_top">Java API for XML Processing (JAXP) 1.1</a> specification. The types of configurable objects include DOM parsers, SAX parsers and XSLT transformers. First we'll describe the configuration options for the various objects per the JAXP spec and then show how JBoss uses the configuration properties and how you can change them.</p><div class="section"><a name="howto.jaxp.sax"></a><div class="titlepage"><div><h4 class="title"><a name="howto.jaxp.sax"></a>SAX Parser Configuration</h4></div></div><p>The SAX Plugability classes allow an application programmer to provide an implementation of the
org.xml.sax.DefaultHandler API to a SAXParser implementation and parse XML documents. In order to obtain a SAXParser instance, an application programmer first obtains an instance of a SAXParserFactory.
The SAXParserFactory instance is obtained via the static newInstance method of the SAXParserFactory class. This method uses the following ordered lookup procedure to determine the SAXParserFactory implementation class to load:</p><div class="orderedlist"><ol type="1"><li><p><a name="d0e11866"></a>Use the javax.xml.parsers.SAXParserFactory system property</p></li><li><p><a name="d0e11869"></a>Use the properties file "lib/jaxp.properties" in the JRE directory. This configuration file is in standard java.util.Properties format and contains the fully qualified name of the implementation class with the key being the system property defined above.</p></li><li><p><a name="d0e11872"></a>Use the Services API (as detailed in the JAR specification), if available, to determine the classname. The Services API will look for the classname in the file META-INF/services/javax.xml.parsers.SAXParserFactory in jars available to the runtime.</p></li><li><p><a name="d0e11875"></a>Platform default SAXParserFactory instance.</p></li></ol></div></div><div class="section"><a name="howto.jaxp.dom"></a><div class="titlepage"><div><h4 class="title"><a name="howto.jaxp.dom"></a>DOM Parser Configuration</h4></div></div><p>The DOM plugability classes allow a programmer to parse an XML document and obtain an org.w3c.dom.Document object from a DocumentBuilder implementation which wraps an underlying DOM implementation. In order to obtain a DocumentBuilder instance, an application programmer first obtains an instance of a Document-BuilderFactory. The DocumentBuilderFactory instance is obtained via the static newInstance method of the DocumentBuilderFactory class. This method uses the following ordered lookup procedure to determine the DocumentBuilderFactory implementation class to load:</p><div class="orderedlist"><ol type="1"><li><p><a name="d0e11884"></a>Use the javax.xml.parsers.DocumentBuilderFactory system property</p></li><li><p><a name="d0e11887"></a>Use the properties file "lib/jaxp.properties" in the JRE directory. This configuration file is in standard java.util.Properties format and contains the fully qualified name of the implementation class with the key being the system property defined above.</p></li><li><p><a name="d0e11890"></a>Use the Services API (as detailed in the JAR specification), if available, to determine the classname. The Services API will look for the classname in the file META-INF/services/javax.xml.parsers.DocumentBuilderFactory in jars available to the runtime.</p></li><li><p><a name="d0e11893"></a>Platform default SAXParserFactory instance.</p></li></ol></div></div><div class="section"><a name="howto.jaxp.xslt"></a><div class="titlepage"><div><h4 class="title"><a name="howto.jaxp.xslt"></a>XSLT Transformer Configuration</h4></div></div><p>The XSLT Plugability classes allow an application programmer to obtain a Transformer object that is based on a specific XSLT stylesheet from a TransformerFactory implementation. In order to obtain a Transformer object, 
a programmer first obtains an instance of the TransformerFactory. The TransformerFactory instance is obtained via the static newInstance method of the TransformerFactory class. This method uses the following ordered lookup procedure to determine the TransformerFactory implementation class to load:</p><div class="orderedlist"><ol type="1"><li><p><a name="d0e11902"></a>Use the javax.xml.transform.TransformerFactory system property</p></li><li><p><a name="d0e11905"></a>Use the properties file "lib/jaxp.properties" in the JRE directory. This configuration file is in standard java.util.Properties format and contains the fully qualified name of the implementation class with the key being the system property defined above.</p></li><li><p><a name="d0e11908"></a>Use the Services API (as detailed in the JAR specification), if available, to determine the classname. The Services API will look for the classname in the file META-INF/services/javax.xml.transform.TransformerFactory in jars available to the runtime.</p></li><li><p><a name="d0e11911"></a>Platform default TransformFactory instance.</p></li></ol></div></div><div class="section"><a name="howto.jaxp.jboss.config"></a><div class="titlepage"><div><h4 class="title"><a name="howto.jaxp.jboss.config"></a>Changing the JBoss Defaults</h4></div></div><p>JBoss uses a DOM DocumentBuilder to parse the jboss.jcml configuration file. The run.bat and run.sh startup scripts sets the javax.xml.parsers.DocumentBuilderFactory and  javax.xml.parsers.SAXParserFactory system properties to the bundled Crimson 1.1 DOM and SAX parsers contained in lib/crimson.jar. <a href="ch13s135.html#howto.jaxp.run.sh.crimson" title="Figure 13.30. The run.sh setup for the Crimson xml parsers">Figure 13.30</a> shows the setup.</p><div class="figure"><p><a name="howto.jaxp.run.sh.crimson"></a><b>Figure 13.30. The run.sh setup for the Crimson xml parsers</b></p><pre class="programlisting"># Add the XML parser jars and set the JAXP factory names
# Crimson parser JAXP setup(default)
CLASSPATH=$CLASSPATH:../lib/crimson.jar
JAXP=-Djavax.xml.parsers.DocumentBuilderFactory=org.apache.crimson.jaxp.DocumentBuilderFactoryImpl
JAXP="$JAXP -Djavax.xml.parsers.SAXParserFactory=org.apache.crimson.jaxp.SAXParserFactoryImpl"</pre></div><p>To change JBoss to use the Xerces parser, you would need change the setup to that shown in <a href="ch13s135.html#howto.jaxp.run.sh.xerces" title="Figure 13.31. The run.sh setup for the Xerces xml parsers">Figure 13.31</a> assuming you copied the xerces.jar into the JBoss lib directory.</p><div class="figure"><p><a name="howto.jaxp.run.sh.xerces"></a><b>Figure 13.31. The run.sh setup for the Xerces xml parsers</b></p><pre class="programlisting"># Add the XML parser jars and set the JAXP factory names
# Xerces parser JAXP setup
CLASSPATH=$CLASSPATH:../lib/xerces.jar
JAXP=-Djavax.xml.parsers.DocumentBuilderFactory=org.apache.xerces.jaxp.DocumentBuilderFactoryImpl
JAXP="$JAXP -Djavax.xml.parsers.SAXParserFactory=org.apache.xerces.jaxp.SAXParserFactoryImpl"</pre></div><p>JBoss does not currently use any XSLT transformers and so does not set a default value for the javax.xml.transform.TransformerFactory system property. To setup the desired transformer you are free to use any of the approaches described in <a href="ch13s135.html#howto.jaxp.xslt" title="XSLT Transformer Configuration">the section called &#8220;XSLT Transformer Configuration&#8221;</a>.</p></div></div><div class="section"><a name="d0e11939"></a><div class="titlepage"><div><h3 class="title"><a name="d0e11939"></a>Using JAXP</h3></div></div><p>To aide in porting your xml parser creation to use the JAXP package, this section gives some small code fragments showing the use of each type of factory. See the JAXP spec or JavaDoc for the full usage details.</p><div class="figure"><p><a name="jaxp.howto.sax.example"></a><b>Figure 13.32. Example SAX Parser Creation</b></p><pre class="programlisting">import javax.xml.parsers.FactoryConfigurationError;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory
import org.xml.sax.SAXException;
import org.xml.sax.helpers.DefaultHandler;

SAXParser parser = null;
DefaultHandler handler = new DefaultHandler()
{
 ...
}

try
{
 SAXParserFactory factory = SAXParserFactory.newInstance();
 parser = factory.newSAXParser();
 String docURI = ...;
 parser.parse(docURI);
}
catch(SAXException e)
{
 ...
}
catch(java.io.IOException e)
{
 ...
}
catch(ParserConfigurationException e)
{
 ...
}
catch(FactoryConfigurationError e)
{
 ...
}</pre></div><div class="figure"><p><a name="jaxp.howto.dom.example"></a><b>Figure 13.33. Example DOM Parser Creation</b></p><pre class="programlisting">import javax.xml.parsers.FactoryConfigurationError;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.FactoryConfigurationError;
import javax.xml.parsers.ParserConfigurationException;
import org.xml.sax.SAXException;

DocumentBuilder parser = null;
try
{
 DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
 String docURI = ...;
 parser.parse(docURI);
}
catch(SAXException e)
{
 ...
}
catch(java.io.IOException e)
{
 ...
}
catch(ParserConfigurationException e)
{
 ...
}
catch(FactoryConfigurationError e)
{
 ...
}</pre></div><div class="figure"><p><a name="jaxp.howto.xslt.example"></a><b>Figure 13.34. Example XSLT Transformer Creation</b></p><pre class="programlisting">import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerConfigurationException;
import javax.xml.transform.TransformerException;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.TransformerFactoryConfigurationError;
import javax.xml.transform.stream.StreamResult;
import javax.xml.transform.stream.StreamSource;

Transformer transformer = null;
try
{
 TransformerFactory factory = TransformerFactory.newInstance();
 String stylesheet = "file:///ssheet.xsl";
 String xmldoc = "file:///application.xml";
 StreamSource style = new StreamSource(stylesheet);
 StreamSource src = new StreamSource(xmldoc);
 StreamResult result = new StreamResult(System.out);
 transformer = factory.newTransformer(style);
 transformer.transform(src, dest);
}
catch(TransformerFactoryConfigurationError e)
{
 ...
}
catch(TransformerConfigurationException e)
{
 ...
}
catch(TransformerException e)
{
 ...
}</pre></div></div><div class="section"><a name="d0e11959"></a><div class="titlepage"><div><h3 class="title"><a name="d0e11959"></a>Common Questions</h3></div></div><div class="qandaset"><dl><dt>1.  <a href="ch13s135.html#d0e11964">Do I have to use JAXP for xml parsing?</a></dt><dt>2.  <a href="ch13s135.html#d0e11971">Can I mix different xml parsers?</a></dt><dt>3.  <a href="ch13s135.html#d0e11978">What if I have to use an older parser that does not support JAXP?</a></dt></dl><div class="qandaentry"><div class="question"><p><a name="d0e11964"></a><b>1. </b>Do I have to use JAXP for xml parsing?</p></div><div class="answer"><p><a name="d0e11967"></a><b></b>Not necessarily. If you have a specific parser you want to use and you want to uses a parser specific factory you can as long as the parser supports JAXP as this is how JBoss is locating its xml parsers.</p></div></div><div class="qandaentry"><div class="question"><p><a name="d0e11971"></a><b>2. </b>Can I mix different xml parsers?</p></div><div class="answer"><p><a name="d0e11974"></a><b></b>If they are all support the same level of the xml standards and JAXP then you should be able to. However, if there are differences then you are likely to see a SecurityException("sealing violation") error thrown.</p></div></div><div class="qandaentry"><div class="question"><p><a name="d0e11978"></a><b>3. </b>What if I have to use an older parser that does not support JAXP?</p></div><div class="answer"><p><a name="d0e11981"></a><b></b>The you will need to use your own ClassLoader instance to isolate any common xml parser packages to avoid the sealing violation exception.</p></div></div></div></div></div><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\gbar.gif" width="432" height="79"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="ch13.html"><img src="images\toc.gif" border="0"></a><a href="ch13s131.html"><img src="images\prev.gif" border="0"></a><a href="ch13s144.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table></body></html>