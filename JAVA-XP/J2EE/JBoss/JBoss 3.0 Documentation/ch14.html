<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter 14. Third Party Examples</title><link rel="stylesheet" href="styles.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets Vimages/callouts/"><link rel="home" href="index.html" title="JBoss 3.0 Documentation"><link rel="up" href="index.html" title="JBoss 3.0 Documentation"><link rel="previous" href="ch13s144.html" title="Clustering in JBoss 3.0 alpha"><link rel="next" href="ch14s02.html" title="Deploying the Pet Store 1.1.2 Demo in JBoss"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\jboss.gif" border="0"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="index.html"><img src="images\toc.gif" border="0"></a><a href="ch13s144.html"><img src="images\prev.gif" border="0"></a><a href="ch14s02.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table><div class="chapter"><div class="titlepage"><div><h2 class="title"><a name="d0e12085"></a>Chapter 14. Third Party Examples</h2></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><a href="ch14.html#d0e12088">Running the Examples from Enterprise JavaBeans, by Richard Monson-Haefel (Unix) </a></dt><dt><a href="ch14s02.html">Deploying the Pet Store 1.1.2 Demo in JBoss</a></dt><dt><a href="ch14s07.html">Deploying Cocoon 2 in JBoss</a></dt><dt><a href="ch14s12.html">Using SSL with JBoss</a></dt></dl></div><div class="section"><a name="d0e12088"></a><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="d0e12088"></a>Running the Examples from Enterprise JavaBeans, by Richard Monson-Haefel (Unix) </h2></div></div><p>Author:<span class="author">Sebastien Alborini</span>
		<tt>&lt;<a href="mailto:sebastien.alborini@m4x.org">sebastien.alborini@m4x.org</a>&gt;</tt>  
	</p><p>This page describes how to run the examples from Richard Monson-Haefel's book Enterprise JavaBeans, 2nd Edition
(Chapter 4) in JBoss.</p><p>You can download <a href="http://www.oreilly.com/catalog/entjbeans2/chapter/examples.zip" target="_top">the examples</a> (zip file) from O'Reilly's site. I will assume you have unzipped this file and you work in
the chapter4/EJB11 directory.</p><p>These examples need to be slightly modified to run with JBoss. You can download the modified version <a href="http://www.jboss.org/documentation/rmh_jboss.zip" target="_top">here</a>, but I
recommend you to follow these instructions which tell exactly what has to be modified.</p><div class="itemizedlist"><ul><li><p><a name="d0e12115"></a>Setup your environment.</p><p>JBoss libraries will be needed to compile and run the examples, so you have to set the environment variable
     JBOSS_HOME to your JBoss installation. For example: 
	 <div class="itemizedlist"><ul><li><p><a name="d0e12121"></a>export JBOSS_HOME=$HOME/jboss_pr4 if you have the binary version in your home directory </p></li><li><p><a name="d0e12124"></a>export JBOSS_HOME=$HOME/jboss/dist if you have the CVS version.</p></li></ul></div> 
      
			</p></li><li><p><a name="d0e12128"></a>Compile and deploy the beans.</p><p>The beans are almost ok for JBoss, the only difference is about the reference made by TravelAgentBean to
     CabinBean: a bean must lookup in the java:comp/env namespace. Edit
     com/titan/travelagent/TravelAgentBean.java, and replace 
     <pre class="programlisting">     Object obj = jndiContext.lookup("ejb/CabinHome");</pre>    
     with 
     <pre class="programlisting">     Object obj = jndiContext.lookup("java:comp/env/ejb/CabinHome"); </pre>     
			</p><p>     This ejb-reference from TravelAgentBean (in travelagent.jar) to CabinBean (in cabin.jar) is an external
     reference (different ejb-jar file). You must then provide the full jndi name for CabinBean in a jboss.xml for
     TravelAgentBean: create and edit com/titan/travelagent/jboss.xml 

     <pre class="programlisting">
     &lt;?xml version="1.0"?&gt;                                                 
     &lt;jboss&gt;
       &lt;enterprise-beans&gt;
         &lt;session&gt;
           &lt;ejb-name&gt;TravelAgentBean&lt;/ejb-name&gt;
           &lt;ejb-ref&gt;
             &lt;ejb-ref-name&gt;ejb/CabinHome&lt;/ejb-ref-name&gt;
             &lt;jndi-name&gt;CabinBean&lt;/jndi-name&gt;
           &lt;/ejb-ref&gt;
         &lt;/session&gt;
       &lt;/enterprise-beans&gt;
     &lt;/jboss&gt;
     </pre>     
			</p><p> 
     You don't jave to change anything in ejb-jar.xml. You can now use the following script jbossMakeIt.sh to
     compile and deploy: 
      
     <div class="literallayout">&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
					<b><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#!/bin/sh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;make&nbsp;cabin&nbsp;bean<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;javac&nbsp;-classpath&nbsp;$JBOSS_HOME/lib/ext/ejb.jar:.&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com/titan/cabin/Cabin*.java<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp&nbsp;com/titan/cabin/ejb-jar.xml&nbsp;META-INF/ejb-jar.xml<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jar&nbsp;cvf&nbsp;cabin.jar&nbsp;com/titan/cabin/Cabin*.class&nbsp;META-INF/ejb-jar.xml<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;make&nbsp;travelagent&nbsp;bean<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;javac&nbsp;-classpath&nbsp;$JBOSS_HOME/lib/ext/ejb.jar:.&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com/titan/travelagent/TravelAgent*.java<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp&nbsp;com/titan/travelagent/ejb-jar.xml&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com/titan/travelagent/jboss.xml&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;META-INF/<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;JBoss&nbsp;needs&nbsp;the&nbsp;Home,&nbsp;Remote&nbsp;and&nbsp;primary&nbsp;key&nbsp;(PK)&nbsp;classes<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;of&nbsp;the&nbsp;Cabin&nbsp;in&nbsp;travelagent.jar&nbsp;so&nbsp;that&nbsp;TravelAgent*.class<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;can&nbsp;access&nbsp;the&nbsp;Cabin&nbsp;bean<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jar&nbsp;cvf&nbsp;travelagent.jar&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com/titan/cabin/CabinHome.class&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com/titan/cabin/Cabin.class&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com/titan/cabin/CabinPK.class&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com/titan/travelagent/TravelAgent*.class&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;META-INF/ejb-jar.xml&nbsp;META-INF/jboss.xml<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rm&nbsp;-f&nbsp;META-INF/ejb-jar.xml<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rm&nbsp;-f&nbsp;META-INF/jboss.xml<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;deploy<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp&nbsp;cabin.jar&nbsp;travelagent.jar&nbsp;$JBOSS_HOME/deploy<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b><br>
				</div>  
     
     
			</p></li><li><p><a name="d0e12152"></a>Compile the clients.</p><p>     The clients from the examples perform a lookup on the java:comp/env namespace, which is not
     currently supported by JBoss for the clients. You have to make the following edits: (CabinBean is the jndi
     name under which the Cabin Bean is deployed, see the jndi howto) 

     In com/titan/cabin/Client_1.java replace 
      
     <pre class="programlisting"> 
     Object obj = jndiContext.lookup("java:comp/env/ejb/CabinHome");</pre>     by 

     <pre class="programlisting"> 
     Object obj = jndiContext.lookup("CabinBean");</pre>     In com/titan/cabin/Client_2.java replace 

     <pre class="programlisting"> 
     Object obj = jndiContext.lookup("ejb/CabinHome");</pre>     by 

     <pre class="programlisting"> 
     Object obj = jndiContext.lookup("CabinBean");</pre>     In com/titan/travelagent/Client_1.java replace 

     <pre class="programlisting"> 
     Object obj = jndiContext.lookup("ejb/TravelAgentHome");</pre>     by 

     <pre class="programlisting"> 
     Object obj = jndiContext.lookup("TravelAgentBean");</pre>     You can now use jBossMakeClients.sh to compile:

     <div class="literallayout">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
					<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#!/bin/sh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;javac&nbsp;-classpath&nbsp;$JBOSS_HOME/lib/ext/ejb.jar:.&nbsp;&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com/titan/cabin/Client*.java&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com/titan/travelagent/Client*.java<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
				</div> 
     
			</p></li><li><p><a name="d0e12181"></a>Run the clients</p><p> 
     We don't use Sun's RI runclient tool, so RunIt.sh won't work. Instead, we provide the following script:
     jBossRunClient.sh. This file includes all the jBoss libraries needed in the classpath. 

     <div class="literallayout">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
					<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#!/bin/sh&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CP=$JBOSS_HOME/client/ejb.jar<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CP=$CP:$JBOSS_HOME/client/jndi.jar<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CP=$CP:$JBOSS_HOME/client/jta-spec1_0_1.jar<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CP=$CP:$JBOSS_HOME/client/jboss-client.jar<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CP=$CP:$JBOSS_HOME/client/jnp-client.jar<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CP=$CP:.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;java&nbsp;-cp&nbsp;$CP&nbsp;$1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
				</div>     You also have to set the jndi properties to connect to the server. This is done in the jndi.properties file (this file
     must be in the same directory as jBossRunClient.sh)

     <pre class="programlisting">                                                                       
     java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory
     java.naming.provider.url=localhost
     java.naming.factory.url.pkgs=org.jboss.naming;
     </pre>                                                                       



     You can now run the clients. The script take the name of the client as an argument, try 

     <div class="literallayout">&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
					<b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;./jBossRunClient.sh&nbsp;com.titan.cabin.Client_1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;./jBossRunClient.sh&nbsp;com.titan.cabin.Client_2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;./jBossRunClient.sh&nbsp;com.titan.travelagent.Client_1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b><br>
				</div>     
			</p><p>     NOTES:
         the clients will only run once, since they use the EJBHome.create() method: at second run, a
         DuplicateKeyException will occur. 
         I recommend you to turn off debug logging for these examples. Edit $JBOSS_HOME/conf/jboss.conf, in
         the ConsoleLogging section, set the first ARG to "Error". 
     </p></li></ul></div></div></div><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\gbar.gif" width="432" height="79"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="index.html"><img src="images\toc.gif" border="0"></a><a href="ch13s144.html"><img src="images\prev.gif" border="0"></a><a href="ch14s02.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table></body></html>