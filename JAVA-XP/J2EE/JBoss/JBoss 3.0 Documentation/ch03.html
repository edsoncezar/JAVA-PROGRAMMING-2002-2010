<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter 3. Using Databases and other Enterprise Resources</title><link rel="stylesheet" href="styles.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets Vimages/callouts/"><link rel="home" href="index.html" title="JBoss 3.0 Documentation"><link rel="up" href="index.html" title="JBoss 3.0 Documentation"><link rel="previous" href="ch02s03.html" title="Configuration files"><link rel="next" href="ch03s06.html" title="Resource Adapters"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\jboss.gif" border="0"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="index.html"><img src="images\toc.gif" border="0"></a><a href="ch02s03.html"><img src="images\prev.gif" border="0"></a><a href="ch03s06.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table><div class="chapter"><div class="titlepage"><div><h2 class="title"><a name="resource"></a>Chapter 3. Using Databases and other Enterprise Resources</h2></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><a href="ch03.html#resource-intro">Introduction</a></dt><dt><a href="ch03s06.html">Resource Adapters</a></dt><dt><a href="ch03s12.html">Examples for specific databases</a></dt><dt><a href="ch03s13.html">Migration from older jboss versions</a></dt></dl></div><p>
    <span class="author">David Jencks</span>
    <tt>&lt;<a href="mailto:d_jencks@users.sourceforge.net">d_jencks@users.sourceforge.net</a>&gt;</tt>
  </p><div class="section"><a name="resource-intro"></a><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="resource-intro"></a>Introduction</h2></div></div><div class="section"><a name="resource-intro-access"></a><div class="titlepage"><div><h3 class="title"><a name="resource-intro-access"></a>Access to Resource Managers</h3></div></div><p><span class="emphasis"><i>THIS CHAPTER IS PRIMARILY RELEVANT TO JBOSS 3 (RABBITHOLE) VERSIONS BEFORE RC1</i></span></p><p><span class="emphasis"><i>THE MBEANS FOR CONFIGURING DATASOURCES/ADAPTERS IN RC1 ARE COMPLETELY DIFFERENT FROM THOSE DESCRIBED HERE.  FOR DESCRIPTIONS OF EACH ATTRIBUTE, CONSULT THE GENERATED JMX-API DOCUMENTATION.</i></span></p><p><span class="emphasis"><i>You will probably have to generate this documentation yourself.  Check out jboss-all and run build/build.sh all.  You should find a build/output/jboss-###/docs/jmx-api directory, and following the package structure to org.jboss.resource.connectionmanager should reveal the documentation .</i></span></p><p>In order for your ejbs to do much useful work, they will need to communicate with a transactional resource manager such as a relational database, transactional message queue, or other enterprise information system.  Jboss now supports all such communication using Resource Adapters following the  <a href="http://java.sun.com/j2ee/connector/" target="_top"><i>jca 1.0 specification</i></a>.  This technology provides a uniform way to combine the application server's transaction management and connection pooling functionalities with a resource adapter's ability to connect to and do work with a resource manager.</p><p>Jboss provides the ability to deploy any compliant resource adapter, and connections from any adapter may be pooled by jboss, obtained from connection factories bound in jndi, and used by client code.  At the moment, however, only connection factories implementing javax.sql.DataSource and connections implementing java.sql.Connection may be used with CMP beans and the jboss ejb persistence manager to automate database access.</p><p>Since few database vendors have supplied resource adapters for their database products, the usual strategy for accessing relational databases consists of using a generic resource adapter that wraps a jdbc driver into a jca resource adapter.  Jboss comes with two such adapters, one for jdbc 1 drivers without xa transaction support, and one for jdbc 2 drivers implementing xa support with XADataSource, XAResource, and XAConnection.</p><p>As well as providing a systematic, well thought out framework for pooling and transaction control that can be used for relational databases, jca also provides another specification ("cci") for connection factories and connections unrelated to jdbc. An adaptor could use these to provide predefined access to stored procedures in a relational database, or these could be used to access a message que, or enterprise information system such as CICS or SAP.  Although there are no particular conceptual difficulties in using such resource adapters to automatically manage persistence of CMP beans, support for this is not yet integrated into jboss. </p></div><div class="section"><a name="resource-intro-pooling"></a><div class="titlepage"><div><h3 class="title"><a name="resource-intro-pooling"></a>Why pooling?</h3></div></div><p>Most often connections to resource managers such as relational databases take a significant amount of time to set up and consume a significant amount of resources.  It would be unacceptably inefficient to construct, use, and tear down a physical connection for each client request in an application server environment, nor would it usually be appropriate to reserve a connection for each user.  Some means of sharing and reusing expensive connections is necessary.  The jca solution to this involves ManagedConnections, which are "physical" connections to the resource manager provided by the resource adapter, and which are pooled by the ConnectionManager provided by the application server, and short lived connection handles to these ManagedConnections, which can be handed out on demand and returned (closed) when done with.  Note that there are three layers here: a client (or persistence framework such as JAWS) requests a (resource adapter-specific) connection from a (resource-adapter-specific) connection factory; the connection factory basically typecasts a generic connection handle from the (jboss supplied) ConnectionManager, which has just obtained the connection handle from a ManagedConnection (from the resource adapter) that it retrieved (from a pool) or created.</p></div><div class="section"><a name="resource-intro-transactionsupport"></a><div class="titlepage"><div><h3 class="title"><a name="resource-intro-transactionsupport"></a>Levels of Transaction Support</h3></div></div><p>There are three levels of transaction support mentioned in the jca specification: full xa support for distributed transactions with two phase commit, single phase local (to a single resource manager/adapter) transactions, and no transaction support.  Since the ConnectionManager mediates all connection handles supplied to clients, it is also the component that mediates between the transaction manager and the connections, making sure that each managed connection is enrolled in the correct transaction for the client that currently has its connection handle. For example, database XADataSource-based drivers can be wrapped into resource adapters supporting xa transactions, whereas database jdbc 1.0 drivers can be wrapped into resource adapters supporting local transactions.</p></div><div class="section"><a name="resource-intro-overview"></a><div class="titlepage"><div><h3 class="title"><a name="resource-intro-overview"></a>Organization</h3></div></div><p>We will start with an overview of the components of a resource adapter and related parts of an application server, and how these are set up in jboss.  We proceed with a description of how to configure a connection factory for an arbitrary resource adapter, followed by instructions for using the specific jdbc wrapper resource adapters provided with jboss for non xa and xa jdbc drivers.  This will be followed by a detailed discussion with examples of how to set up these wrappers for the most commonly used databases.  If you are using a database not listed here, please contribute a working setup to help others.  Finally we discuss migration from the previous jboss implementation, the XADataSourceLoader.</p></div></div></div><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\gbar.gif" width="432" height="79"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="index.html"><img src="images\toc.gif" border="0"></a><a href="ch02s03.html"><img src="images\prev.gif" border="0"></a><a href="ch03s06.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table></body></html>