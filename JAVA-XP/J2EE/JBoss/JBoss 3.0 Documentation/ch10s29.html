<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>How to generate Enterprise Java Beans with EJBDoclet (XDoclet)</title><link rel="stylesheet" href="styles.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets Vimages/callouts/"><link rel="home" href="index.html" title="JBoss 3.0 Documentation"><link rel="up" href="ch10.html" title="Chapter 10. Development Tools and IDE Integration"><link rel="previous" href="ch10s25.html" title="Using Verifier in Ant"><link rel="next" href="ch11.html" title="Chapter 11. JBoss in production"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\jboss.gif" border="0"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="ch10.html"><img src="images\toc.gif" border="0"></a><a href="ch10s25.html"><img src="images\prev.gif" border="0"></a><a href="ch11.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table><div class="section"><a name="howtoejbdoclet"></a><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="howtoejbdoclet"></a>How to generate Enterprise Java Beans with EJBDoclet (XDoclet)</h2></div><div><h2 class="subtitle">Under construction(!)</h2></div></div><p>Author:
      <span class="author">Ingo Bruell</span>
      <tt>&lt;<a href="mailto:ibruell@gmx.de">ibruell@gmx.de</a>&gt;</tt>
   </p><p>
    EJBDoclet is a tool that facilitates coding Enterprise Java Beans. You only
    have to code <span class="emphasis"><i>one</i></span> file to generate automatically the needed
    interfaces and descriptor files. By using <tt>ant</tt>
    and the <tt>verifier</tt> it is very easy to produce correct beans.
  </p><p>
    EJBDoclet is an OpenSource project started by Rickard Oberg and located at
    <a href="http://sourceforge.net/projects/ejbdoclet" target="_top">
    http://sourceforge.net/projects/ejbdoclet</a>.
  </p><p>
    EJBDoclet has been renamed XDoclet and a new project with this name has been started.
    XDoclet 1.0 was released in September 2001. Any questions about
    EJBDoclet and XDoclet must go to the new XDoclet mailing lists
    hosted at <a href="http://sourceforge.net/projects/xdoclet" target="_top">
    http://sourceforge.net/projects/xdoclet</a>
  </p><div class="section"><a name="ejbdoclet-requirements"></a><div class="titlepage"><div><h3 class="title"><a name="ejbdoclet-requirements"></a>Requirements</h3></div></div><p>
      You need to download the <tt>ejbdoclet.jar</tt> file and
      put it somewhere in you classpath. I think that the use of Ant is highly recommended
      (and, for now, it is the only way to use EJBDoclet!).
    </p><p>
      The <tt>tools.jar</tt> file from the J2SDK is also needed to
      call Javadoc, so place it in the classpath, too.
    </p></div><div class="section"><a name="ejbdoclet-createingthebean"></a><div class="titlepage"><div><h3 class="title"><a name="ejbdoclet-createingthebean"></a>Creating the Bean as a Template</h3></div></div><p>
      EJBDoclet uses Javadoc tags and the Javadoc mechanism to generate the needed files
      out of a <span class="emphasis"><i>template</i></span>. Here there is an example of a section for an
      Entity Bean class:

      <pre class="programlisting">
/**
 *   This is an account bean. It is an example of how to use the EJBDoclet tags.
 *
 *   @ejb:entity-cmp <a name="ejbdoclet-entity-cmp"></a><img src="images\callouts\1.png" alt="1" border="0">
 *   @ejb:ejb-name bank/Account
 *   @ejb:jndi-name ejb/bank/Account
 *   @ejb:finder Collection findAll() <a name="ejbdoclet-finder"></a><img src="images\callouts\2.png" alt="2" border="0">
 *   @ejb:finder Collection findByOwner(Customer owner)
 *   @ejb:finder Collection findLargeAccounts(int balance)
 *   @ejb:env-entry foo 1234 java.lang.Integer <a name="ejbdoclet-envvar"></a><img src="images\callouts\3.png" alt="3" border="0">
 *   @ejb:ejb-ref bank/Customer <a name="ejbdoclet-ref"></a><img src="images\callouts\4.png" alt="4" border="0">
 *   @ejb:security-role-ref admin Administrator
 *   @ejb:permission Teller
 *   @ejb:transaction Required
 *   @ejb:use-soft-locking
 *
 *   JBoss specific <a name="ejbdoclet-jboss"></a><img src="images\callouts\5.png" alt="5" border="0">
 *   @jboss:container-configuration Standard CMP EntityBean
 *
 *   JBoss/JAWS CMP specific <a name="ejbdoclet-jaws"></a><img src="images\callouts\6.png" alt="6" border="0">
 *   @jboss:table-name account
 *   @jboss:create-table true
 *   @jboss:remove-table true
 *   @jboss:tuned-updates true
 *   @jboss:read-only false
 *   @jboss:finder-query findLargeAccounts $1 &gt; 1000
 *   @jboss:finder-order findLargeAccounts balance
 */
public abstract class AccountBean
{
      </pre>
      <div class="calloutlist"><a name="d0e7459"></a><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="d0e7460"></a><a href="#ejbdoclet-entity-cmp"><img src="images\callouts\1.png" alt="1" border="0"></a> </td><td valign="top" align="left"><p>
            Here is where it is specified that this is an Entity Bean
          </p></td></tr><tr><td width="5%" valign="top" align="left"><a name="d0e7463"></a><a href="#ejbdoclet-finder"><img src="images\callouts\2.png" alt="2" border="0"></a> </td><td valign="top" align="left"><p>
            Definitions of the finder methods
          </p></td></tr><tr><td width="5%" valign="top" align="left"><a name="d0e7466"></a><a href="#ejbdoclet-envvar"><img src="images\callouts\3.png" alt="3" border="0"></a> </td><td valign="top" align="left"><p>
            Easy definition of environment variables
          </p></td></tr><tr><td width="5%" valign="top" align="left"><a name="d0e7469"></a><a href="#ejbdoclet-ref"><img src="images\callouts\4.png" alt="4" border="0"></a> </td><td valign="top" align="left"><p>
            Definition of references to other beans
          </p></td></tr><tr><td width="5%" valign="top" align="left"><a name="d0e7472"></a><a href="#ejbdoclet-jboss"><img src="images\callouts\5.png" alt="5" border="0"></a> </td><td valign="top" align="left"><p>
            With these tags you can define JBoss-specific parameters
            (see the EJBDoclet documentation for more details about the tags).
          </p></td></tr><tr><td width="5%" valign="top" align="left"><a name="d0e7475"></a><a href="#ejbdoclet-jaws"><img src="images\callouts\6.png" alt="6" border="0"></a> </td><td valign="top" align="left"><p>
            And here you can define JAWS-specific parameters
            (see the EJBDoclet documentation for more details about the tags).
          </p></td></tr></table></div>

      You can see that it is very easy to create the bean template. The JBoss- and JAWS-specific
      parts should only be used if the JBoss standard values do not fit.
    </p><p>
      Now you need to define the method level tags like this:
      <pre class="programlisting">
   /**
    * Create account.
    *
    * @ejb:permission Administrator <a name="ejbdoclet-permission"></a><img src="images\callouts\1.png" alt="1" border="0">
    */
   public AccountPK ejbCreate(AccountData data)
      throws CreateException
   {
   	  setId(data.getId());
      setData(data);

      return null;
   }

   /**
    * Id of this account.
    *
    * This is not remote since the primary key can be extracted by other means.
    *
    * @ejb:pk-field <a name="ejbdoclet-pk"></a><img src="images\callouts\2.png" alt="2" border="0">
    * @ejb:persistent-field
    *
    * @jboss:column-name pk
    */
   public abstract int getId();

   /**
    * Id of this account.
    *
    */
   public abstract void setId(int id);

   /**
    *  Owner of this account.
    *
    * @ejb:remote-method <a name="ejbdoclet-remote"></a><img src="images\callouts\3.png" alt="3" border="0">
    * @ejb:persistent-field <a name="ejbdoclet-persistent"></a><img src="images\callouts\4.png" alt="4" border="0">
    * @ejb:permission Administrator
    * @ejb:transaction Supports
    */
   public abstract Customer getOwner();

   /**
    *  Owner of this account.
    *
    */
   public abstract void setOwner(Customer owner);
      </pre>
      <div class="calloutlist"><a name="d0e7492"></a><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a name="d0e7493"></a><a href="#ejbdoclet-permission"><img src="images\callouts\1.png" alt="1" border="0"></a> </td><td valign="top" align="left"><p>
            Permissions can be defined at the method level with this tag
          </p></td></tr><tr><td width="5%" valign="top" align="left"><a name="d0e7496"></a><a href="#ejbdoclet-pk"><img src="images\callouts\2.png" alt="2" border="0"></a> </td><td valign="top" align="left"><p>
            With @ejb:pk-field a primary key field is defined
          </p></td></tr><tr><td width="5%" valign="top" align="left"><a name="d0e7499"></a><a href="#ejbdoclet-remote"><img src="images\callouts\3.png" alt="3" border="0"></a> </td><td valign="top" align="left"><p>
            @ejb:remote-method defines a remote method
          </p></td></tr><tr><td width="5%" valign="top" align="left"><a name="d0e7502"></a><a href="#ejbdoclet-persistent"><img src="images\callouts\4.png" alt="4" border="0"></a> </td><td valign="top" align="left"><p>
            An @ejb:persistent-field defines an attribute that should be stored
            persistently.
          </p></td></tr></table></div>
    </p></div><div class="section"><a name="ejbdoclet-calling"></a><div class="titlepage"><div><h3 class="title"><a name="ejbdoclet-calling"></a>Calling EJBDoclet</h3></div></div><p>
      For now there is no way to use EJBDoclet without Ant.
    </p></div><div class="section"><a name="ejbdoclet-ant"></a><div class="titlepage"><div><h3 class="title"><a name="ejbdoclet-ant"></a>Using EJBDoclet with Ant</h3></div></div><p>
      To use Ant you must download it from the <a href="http://jakarta.apache.org/" target="_top">Apache
      Jakarta project</a>. For EJBDoclet only the <tt>ant.jar</tt> file is needed.
    </p><p>
      I prefer a project directory structure like the one JBoss uses:
      <pre class="programlisting">
        project
        +-build
        .  +-[...]
        +-dist
        .  +-[...]
        +-lib
        .  +-ant.jar
        .  +-ejbdoclet.jar
        .  +-[...]
        +-src
        .  +-resources
        .  .  +-test
        .  .  .  +-META-INF
        .  +-main
        .  .  +-test
        .  .  .  +-ejb
        .  .  .  .  +-AccountBean.java
        .  .  .  .  +-CustomerBean.java
      </pre>

      Here it is my Ant script (<tt>build.xml</tt>) that first
      generates the bean interfaces and the descriptor files
      and then compiles the Java files and packages them into a JAR file:

      <pre class="programlisting">
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;!--
	$Revision: 3.0 $ $Date: 2001/11/18 20:10:58 $ $Author: gropi $
--&gt;
&lt;project name="test" default="main" basedir="../.."&gt;

   &lt;target name="init"&gt;
      &lt;property name="Name" value="TEST"/&gt;
      &lt;property name="name" value="test"/&gt;
      &lt;property name="version" value="1.0"/&gt;
      &lt;property name="encoding" value="ISO-8859-1"/&gt;
      &lt;property name="typemapping" value="Hypersonic SQL"/&gt;
      &lt;property name="datasource" value="java:/DefaultDS"/&gt;

      &lt;property name="src.dir" value="${basedir}/src/main"/&gt;
      &lt;property name="src.resources" value="${basedir}/src/resources"/&gt;
      &lt;property name="etc.dir" value="${basedir}/src/etc"/&gt;
      &lt;property name="lib.dir" value="${basedir}/lib"/&gt;
      &lt;property name="build.dir" value="${basedir}/build"/&gt;
      &lt;property name="build.lib.dir" value="${basedir}/build/lib"/&gt;
      &lt;property name="build.deploy.dir" value="${basedir}/build/deploy"/&gt;
      &lt;property name="build.classes.dir" value="${basedir}/build/classes"/&gt;
      &lt;property name="build.client.dir" value="${basedir}/build/client"/&gt;
      &lt;property name="dist.dir" value="dist"/&gt;
      &lt;property name="classpath" value="${lib.dir}/jboss-j2ee.jar;${lib.dir}/jta-spec1_0_1.jar" /&gt;
      &lt;property name="packages" value="test"/&gt;
      &lt;taskdef name="ejbdoclet" classname="ejbdoclet.EJBDocletTask"
               classpath="${basedir}/lib/ejbdoclet.jar" /&gt;
&lt;!--      &lt;property name="build.compiler" value="jikes"/&gt;--&gt;
   &lt;/target&gt;

   &lt;target name="prepare" depends="init"&gt;
      &lt;mkdir dir="${build.dir}"/&gt;
   &lt;/target&gt;

  &lt;!-- =================================================================== --&gt;
  &lt;!-- Creates the Bean Classes with EJBDoclet                             --&gt;
  &lt;!-- =================================================================== --&gt;
   &lt;target name="buildbeans" depends="prepare"&gt;

      &lt;mkdir dir="${src.resources}/test"/&gt;
      &lt;mkdir dir="${src.resources}/test/META-INF"/&gt;
      &lt;!-- Call EJBDoclet --&gt;
      &lt;ejbdoclet sourcepath="${src.dir}"
                 destdir="${src.dir}"
                 packagenames="test"
                 classpath="${classpath};${basedir}/lib/ejbdoclet.jar"
                 ejbspec="1.1"
                 excludedtags="@version,@author"&gt;
        &lt;dataobject/&gt;
        &lt;remoteinterface/&gt;
        &lt;homeinterface/&gt;
        &lt;entitypk/&gt;
        &lt;entitycmp/&gt;
        &lt;deploymentdescriptor xmlencoding="${encoding}"/&gt;
        &lt;jboss xmlencoding="${encoding}"
               typemapping="${typemapping}"
               datasource="${datasource}"/&gt;
      &lt;/ejbdoclet&gt;

      &lt;!-- copy the generated descriptor files in the resources directory --&gt;
      &lt;copy file="${src.dir}/ejb-jar.xml" todir="${src.resources}/test/META-INF" /&gt;
      &lt;copy file="${src.dir}/jboss.xml" todir="${src.resources}/test/META-INF" /&gt;
      &lt;copy file="${src.dir}/jaws.xml" todir="${src.resources}/test/META-INF" /&gt;
      &lt;delete&gt;
         &lt;fileset dir="${src.dir}" includes="*.xml"/&gt;
      &lt;/delete&gt;
   &lt;/target&gt;

  &lt;!-- =================================================================== --&gt;
  &lt;!-- Compiles the source code                                            --&gt;
  &lt;!-- =================================================================== --&gt;
   &lt;target name="compile" depends="prepare"&gt;
    &lt;mkdir dir="${build.classes.dir}"/&gt;
    &lt;javac srcdir="${src.dir}"
           destdir="${build.classes.dir}"
           classpath="${classpath}"
           debug="off"
           deprecation="off"
           optimize="on"
           includes="**/*.java"
           excludes="**/*.jbx"
    /&gt;
   &lt;/target&gt;

  &lt;!-- =================================================================== --&gt;
  &lt;!-- Creates the jar archives                                            --&gt;
  &lt;!-- =================================================================== --&gt;
  &lt;target name="jar" depends="compile"&gt;
    &lt;mkdir dir="${build.client.dir}"/&gt;
    &lt;mkdir dir="${build.lib.dir}"/&gt;
    &lt;mkdir dir="${build.deploy.dir}"/&gt;

    &lt;!-- Create Bean jar --&gt;
    &lt;copy todir="${build.classes.dir}"&gt;
       &lt;fileset dir="${src.resources}/test" includes="**/*.xml"/&gt;
    &lt;/copy&gt;
    &lt;jar jarfile="${build.deploy.dir}/test.jar"
         basedir="${build.classes.dir}"
         includes="test/**/*.class,
                   META-INF/**"
    /&gt;
    &lt;delete&gt;
       &lt;fileset dir="${build.classes.dir}/META-INF" /&gt;
    &lt;/delete&gt;

  &lt;/target&gt;

  &lt;!-- =================================================================== --&gt;
  &lt;!-- Verify Beans                                                        --&gt;
  &lt;!-- =================================================================== --&gt;
  &lt;target name="verify" depends="jar"&gt;
    &lt;java classname="org.jboss.verifier.Main" fork="true" failonerror="true"&gt;
      &lt;classpath path="${classpath}"/&gt;
      &lt;arg value="${build.deploy.dir}/test.jar"/&gt;
    &lt;/java&gt;
  &lt;/target&gt;

  &lt;!-- =================================================================== --&gt;
  &lt;!-- Creates the binary structure                                        --&gt;
  &lt;!-- =================================================================== --&gt;
   &lt;target name="main" depends="verify"&gt;
     &lt;mkdir dir="${dist.dir}"/&gt;
     &lt;mkdir dir="${dist.dir}/bin"/&gt;
     &lt;mkdir dir="${dist.dir}/lib"/&gt;
     &lt;mkdir dir="${dist.dir}/deploy"/&gt;
     &lt;mkdir dir="${dist.dir}/client"/&gt;
     &lt;mkdir dir="${dist.dir}/conf"/&gt;
     &lt;mkdir dir="${dist.dir}/images"/&gt;

     &lt;copy todir="${dist.dir}/client"&gt;
        &lt;fileset dir="${build.client.dir}"/&gt;
     &lt;/copy&gt;
     &lt;copy todir="${dist.dir}/lib"&gt;
        &lt;fileset dir="${build.lib.dir}"/&gt;
     &lt;/copy&gt;
     &lt;copy todir="${dist.dir}/deploy"&gt;
        &lt;fileset dir="${build.deploy.dir}"/&gt;
     &lt;/copy&gt;
     &lt;copy todir="${dist.dir}/lib"&gt;
        &lt;fileset dir="${src.resources}/test" includes="*.properties"/&gt;
     &lt;/copy&gt;
     &lt;copy todir="${dist.dir}/conf"&gt;
        &lt;fileset dir="${etc.dir}/conf"/&gt;
     &lt;/copy&gt;

     &lt;copy file="${src.lib}/connector.jar" todir="${dist.dir}/client" /&gt;
     &lt;copy file="${src.lib}/deploy.jar" todir="${dist.dir}/client" /&gt;
     &lt;copy file="${src.lib}/jboss-j2ee.jar" todir="${dist.dir}/client" /&gt;
     &lt;copy file="${src.lib}/jboss-client.jar" todir="${dist.dir}/client" /&gt;
     &lt;copy file="${src.lib}/jbosssx-client.jar" todir="${dist.dir}/client" /&gt;
     &lt;copy file="${src.lib}/jbossmq-client.jar" todir="${dist.dir}/client" /&gt;
     &lt;copy file="${src.lib}/jndi.jar" todir="${dist.dir}/client" /&gt;
     &lt;copy file="${src.lib}/jnp-client.jar" todir="${dist.dir}/client" /&gt;
     &lt;copy file="${src.lib}/jta-spec1_0_1.jar" todir="${dist.dir}/client" /&gt;
     &lt;copy file="${src.lib}/stop.jar" todir="${dist.dir}/client" /&gt;
     &lt;copy file="${src.lib}/jaas.jar" todir="${dist.dir}/client" /&gt;
     &lt;copy file="${src.lib}/auth.conf" todir="${dist.dir}/client" /&gt;
     &lt;copy file="${src.lib}/jlfgr-1_0.jar" todir="${dist.dir}/client" /&gt;

     &lt;copy file="${etc.dir}/conf/jndi.properties" todir="${dist.dir}/client" /&gt;

   &lt;/target&gt;

  &lt;!-- =================================================================== --&gt;
  &lt;!-- Cleans up generated stuff                                           --&gt;
  &lt;!-- =================================================================== --&gt;
  &lt;target name="clean" depends="init"&gt;
    &lt;delete dir="${build.dir}"/&gt;
    &lt;delete dir="${dist.dir}"/&gt;
  &lt;/target&gt;

&lt;/project&gt;
      </pre>
    </p><p>
      I have split the generation of the beans and the creation of the application in separate
      tasks. To generate the beans, call <tt>build buildbeans</tt> and to create the
      application, call <tt>build</tt>.
    </p><p>
      EJBDoclet throws some Exceptions the first time it is called, but they can be ignored.
    </p><p>
      The <tt>build.xml</tt> file generates first the PrimaryKey and DataObject classes, Home and
      Remote interfaces and the <tt>ejb-jar.xml</tt>,
      <tt>jboss.xml</tt> and <tt>jaws.xml</tt> descriptors. The
      Java files are then compiled into the <tt>build/classes</tt> directory. After that, the
      files will be archived in <tt>test.jar</tt> in directory
      <tt>dist/deploy</tt>. Now the JAR file
      can be deployed in JBoss.
    </p><p>
      If you are either specifying <tt>ejbspec="2.0"</tt> or nothing
      (the default is <tt>2.0</tt>), it is possible that JBoss will
      not find the DTDs defined in the deployment descriptors; in that case,
      just remove those lines or comment them out. For my own use, I have changed the
      EJBDoclet templates to avoid generating those lines.
    </p></div><div class="section"><a name="ejbdoclet-concluding"></a><div class="titlepage"><div><h3 class="title"><a name="ejbdoclet-concluding"></a>Conclusion</h3></div></div><p>
      In the EJBDoclet archive that can downloaded from
      <a href="http://sourceforge.net/projects/ejbdoclet" target="_top">
      http://sourceforge.net/projects/ejbdoclet</a> there is a brief
      explanation of all possible parameters and a complete example.
    </p></div></div><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\gbar.gif" width="432" height="79"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="ch10.html"><img src="images\toc.gif" border="0"></a><a href="ch10s25.html"><img src="images\prev.gif" border="0"></a><a href="ch11.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table></body></html>