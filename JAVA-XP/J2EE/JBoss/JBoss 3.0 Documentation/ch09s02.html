<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>EJB Security Overview</title><link rel="stylesheet" href="styles.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets Vimages/callouts/"><link rel="home" href="index.html" title="JBoss 3.0 Documentation"><link rel="up" href="ch09.html" title="Chapter 9. JBossSX Security Extension Framework"><link rel="previous" href="ch09.html" title="Chapter 9. JBossSX Security Extension Framework"><link rel="next" href="ch09s08.html" title="The JBoss Security Model"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\jboss.gif" border="0"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="ch09.html"><img src="images\toc.gif" border="0"></a><a href="ch09.html"><img src="images\prev.gif" border="0"></a><a href="ch09s08.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table><div class="section"><a name="sx.EJBSecurityOverview"></a><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="sx.EJBSecurityOverview"></a>EJB Security Overview</h2></div></div><div class="section"><a name="d0e6018"></a><div class="titlepage"><div><h3 class="title"><a name="d0e6018"></a>The EJB 1.1 Declarative Security Model</h3></div></div><p>The security model advocated by the EJB 1.1 spec is a declarative
		  model that avoids the introduction of security code into the EJB business
		  methods. From 
		  <i>Enterprise JavaBeans Specification, v1.1,
			 Section 15.1</i>:&#8220;The EJB architecture encourages the Bean
		  Provider to implement the enterprise bean class without hard-coding the
		  security policies and mechanisms into the business methods. In most cases, the
		  enterprise bean's business method should not contain any security-related
		  logic. This allows the Deployer to configure the security policies for the
		  application in a way that is most appropriate for the operational environment
		  of the enterprise.&#8221; 
			</p><div class="section"><a name="d0e6029"></a><div class="titlepage"><div><h4 class="title"><a name="d0e6029"></a>Declarative Security Setup</h4></div></div><p>The EJB1.1 declarative security model is specified using the ejb-jar security-role and method-permission elements. <a href="ch09s02.html#sx.ejb-jar.SecurityElements" title="Figure 9.1. EJB 1.1 ejb-jar.xml Security Elements">Figure 9.1</a> illustrates the security related  elements of the ejb-jar.xml deployment descriptor.</p><div class="figure"><p><a name="sx.ejb-jar.SecurityElements"></a><b>Figure 9.1. EJB 1.1 ejb-jar.xml Security Elements</b></p><div class="mediaobject"><img src="images\ejb_11_security_dtd.jpg"></div></div><p>The application assembler defines the required method permissions for each security role. A method permission is a permission to invoke a specified group of methods of the enterprise beans' home and remote interfaces.  A security role is a semantic grouping of method permissions. A user must  have at least one security role associated with a method in or to have permission invoke the method. Because the application assembler does not, in general, know the security environment of the operational environment, the security roles are meant to be logical roles, each representing a type of user that should have the same access rights  to the grouping of methods. 
	 <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a name="d0e6044"></a>What is a Role</h3><p>From <i>Enterprise JavaBeans Specification, v1.1, Section 15.3</i>: &#8220;It is important to keep in mind that the security roles are used to define the logical security view of an application. They should not be confused with the user groups, users, principals, and other concepts that exist in the target enterprise's operational environment.&#8221;  
						</p></div> 
				</p><p>A security role is defined using the following ejb-jar
			 elements:</p><div class="variablelist"><dl><dt><a name="d0e6059"></a><span class="term">security-role</span></dt><dd><p><a name="d0e6062"></a>The security-role element contains the definition of a
					 security role.</p></dd><dt><a name="d0e6065"></a><span class="term">role-name</span></dt><dd><p><a name="d0e6068"></a>The role-name element contains the name of a security role,
					 e.g., Admin, owner, Architect.</p></dd><dt><a name="d0e6071"></a><span class="term">description</span></dt><dd><p><a name="d0e6074"></a>An optional description of the security role</p></dd></dl></div><p>The following EJB 1.1 spec example illustrates a security role
			 definition in a deployment descriptor. 
			 <div class="example"><p><a name="sx.security-role.example"></a><b>Example 9.1. Sample security-role usage</b></p><pre class="programlisting">
...
&lt;assembly-descriptor&gt;
	&lt;security-role&gt;
		&lt;description&gt;
		This role includes the employees of the
		enterprise who are allowed to access the
		employee self-service application. This role
		is allowed only to access his/her own
		information.
		&lt;/description&gt;
		&lt;role-name&gt;employee&lt;/role-name&gt;
	&lt;/security-role&gt;
	&lt;security-role&gt;
		&lt;description&gt;
		This role includes the employees of the human
		resources department. The role is allowed to
		view and update all employee records.
		&lt;/description&gt;
		&lt;role-name&gt;hr-department&lt;/role-name&gt;
	&lt;/security-role&gt;
	&lt;security-role&gt;
		&lt;description&gt;
		This role includes the employees of the payroll
		department. The role is allowed to view and
		update the payroll entry for any employee.
		&lt;/description&gt;
		&lt;role-name&gt;payroll-department&lt;/role-name&gt;
	&lt;/security-role&gt;
...
&lt;/assembly-descriptor&gt;
				</pre></div> 
				</p><p>From <i>Enterprise JavaBeans Specification, v1.1, Section 15.3.2</i>, If the application assembler has defined security roles for the enterprise beans in the ejb-jar file, they can also specify the methods of the remote and home interface that each security role is allowed to invoke. The assembler defines the method permissions relation in the deployment descriptor using the method-permission elements as follows. </p><div class="itemizedlist"><ul><li><p><a name="d0e6091"></a>Each method-permission element includes a list of one or
					 more security roles and a list of one or more methods. All the listed security
					 roles are allowed to invoke all the listed methods.</p></li><li><p><a name="d0e6094"></a>Each security role in the list is identified by the
					 role-name element, and each method (or a set of methods, as described below) is
					 identified by the method element. An optional description can be associated
					 with a method-permission element using the description element.</p></li><li><p><a name="d0e6097"></a>The method permissions relation is defined as the union of
					 all the method permissions defined in the individual method-permission
					 elements.</p></li><li><p><a name="d0e6100"></a>A security role or a method may appear in multiple
					 method-permission elements. It is possible that some methods are not assigned
					 to any security roles. This means that none of the security roles defined by
					 the Application Assembler needs access to the methods.</p></li></ul></div><p>The method element uses the ejb-name, method-name, and
			 method-params elements to denote one or more methods of an enterprise bean's
			 home and remote interfaces. There are three legal styles for composing the
			 method element: </p><div class="variablelist"><dl><dt><a name="d0e6106"></a><span class="term">Style 1:</span></dt><dd><p><a name="d0e6109"></a> 
								<div class="literallayout"><br>
&lt;method&gt;<br>
<br>
	&lt;ejb-name&gt;EJBNAME&lt;/ejb-name&gt;<br>
	&lt;method-name&gt;*&lt;/method-name&gt;<br>
&lt;/method&gt;<br>
</div>This style is used for referring to all of the remote and
						home interface methods of a specified enterprise bean.</p></dd><dt><a name="d0e6115"></a><span class="term">Style 2:</span></dt><dd><p><a name="d0e6118"></a> 
								<div class="literallayout"><br>
&lt;method&gt;<br>
	&lt;ejb-name&gt;EJBNAME&lt;/ejb-name&gt;<br>
	&lt;method-name&gt;METHOD&lt;/method-name&gt;<br>
&lt;/method&gt;<br>
</div>This style is used for referring to a specified method of
						the remote or home interface of the specified enterprise bean. If there are
						multiple methods with the same overloaded name, this style refers to all of the
						overloaded methods.</p></dd><dt><a name="d0e6124"></a><span class="term">Style 3:</span></dt><dd><p><a name="d0e6127"></a> 
								<div class="literallayout"><br>
&lt;method&gt;<br>
	&lt;ejb-name&gt;EJBNAME&lt;/ejb-name&gt;<br>
	&lt;method-name&gt;METHOD&lt;/method-name&gt;<br>
	&lt;method-params&gt;<br>
		&lt;method-param&gt;PARAMETER_1&lt;/method-param&gt;<br>
		...<br>
		&lt;method-param&gt;PARAMETER_N&lt;/method-param&gt;<br>
	&lt;/method-params&gt;<br>
&lt;/method&gt;<br>
</div>This style is used to refer to a specified method within a
						set of methods with an overloaded name. The method must be defined in the
						specified enterprise bean's remote or home interface. The optional method-intf
						element can be used to differentiate methods with the same name and signature
						that are defined in both the remote and home interfaces.</p></dd></dl></div><p>The following EJB 1.1 spec example illustrates how security roles
			 are assigned method permissions in the deploymentvdescriptor: 
			 <div class="example"><p><a name="sx.security-role-assignment.example"></a><b>Example 9.2. Sample method-permission Element Usage</b></p><pre class="programlisting">
...
&lt;method-permission&gt;
	&lt;role-name&gt;employee&lt;/role-name&gt;
	&lt;method&gt;
		&lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
		&lt;method-name&gt;*&lt;/method-name&gt;
	&lt;/method&gt;
&lt;/method-permission&gt;

&lt;method-permission&gt;
	&lt;role-name&gt;employee&lt;/role-name&gt;
	&lt;method&gt;
		&lt;ejb-name&gt;AardvarkPayroll&lt;/ejb-name&gt;
		&lt;method-name&gt;findByPrimaryKey&lt;/method-name&gt;
	&lt;/method&gt;

	&lt;method&gt;
		&lt;ejb-name&gt;AardvarkPayroll&lt;/ejb-name&gt;
		&lt;method-name&gt;getEmployeeInfo&lt;/method-name&gt;
	&lt;/method&gt;

	&lt;method&gt;
		&lt;ejb-name&gt;AardvarkPayroll&lt;/ejb-name&gt;
		&lt;method-name&gt;updateEmployeeInfo&lt;/method-name&gt;
	&lt;/method&gt;
&lt;/method-permission&gt;

&lt;method-permission&gt;
	&lt;role-name&gt;admin&lt;/role-name&gt;
	&lt;method&gt;
		&lt;ejb-name&gt;EmployeeServiceAdmin&lt;/ejb-name&gt;
		&lt;method-name&gt;*&lt;/method-name&gt;
	&lt;/method&gt;
&lt;/method-permission&gt;
...</pre></div> 
				</p><p>The check of declarative method permissions is handled by the JBoss container SecurityInterceptor. When a method is invoked, the SecurityInterceptor obtains the set of roles declared in method-permission elements for the method and invokes RealmMapping.doesUserHaveRole(principal, methodRoles) to see if the prinicipal invoking the method has one of the roles in the methodRoles set. When the JaasSecurityManager is used as the RealmMapping implementation, the association of what roles a principal has occurs during authentication. One or more of the LoginModules associated with the security domain assigns the roles the principal belongs to the JAAS Subject instance that is created by the login process. The roles found in the Subject are then used by the JaasSecurityManager in its RealmMapping implementation.</p></div></div><div class="section"><a name="d0e6143"></a><div class="titlepage"><div><h3 class="title"><a name="d0e6143"></a>EJB Custom Security</h3></div></div><p>While a good concept, in general the declarative security model is often too simplistic to cover business application security requirements. Reasons for this include:</p><div class="itemizedlist"><ul><li><p><a name="d0e6149"></a>method permissions can be a function of the method arguments or
				bean state.</p></li><li><p><a name="d0e6152"></a>method permissions can be a function of the caller principal
				and some application state.</p></li><li><p><a name="d0e6155"></a>the caller principal roles may be assigned after deployment and
				therefore are not available for use in the deployment descriptor.</p></li></ul></div><div class="section"><a name="d0e6158"></a><div class="titlepage"><div><h4 class="title"><a name="d0e6158"></a>EJB 1.1 Custom Security</h4></div></div><p>The EJB 1.1 spec defines a mechanism by which custom security can
			 be implemented by the bean provider. This requires introduction of security
			 logic into the EJB's business method implementation. For this reason, 
			 <i>Enterprise JavaBeans Specification, v1.1, Section
				15.2.5</i> states: &#8220;Note: In general, security management should
			 be enforced by the Container in a manner that is transparent to the enterprise
			 beans business methods. The security API described in this section should be
			 used only in the less frequent situations in which the enterprise bean business
			 methods need to access the security context information.&#8221; 
				</p><p>The EJB 1.1 custom security api consists of the following two
			 javax.ejb.EJBContext interface methods:</p><div class="itemizedlist"><ul><li><p><a name="d0e6172"></a>java.security.Principal getCallerPrincipal()</p></li><li><p><a name="d0e6175"></a>boolean isCallerInRole(java.lang.String roleName)</p></li></ul></div><p>Using these methods along with custom code you can add any type
			 of security validation to your EJB. When using the isCallerInRole there must be
			 a security-role-ref element in the ejb-jar deployment descriptor for all the
			 security role names used in the enterprise bean code. Declaring the security
			 roles references in the code allows the application assembler or deployer to
			 link the names of the security roles used in the code to the security roles
			 defined for an assembled application through the security-role elements. A
			 role-link element must be used even if the value of role-name is the same as
			 the value of the role-link reference. The following EJB 1.1 spec deployment
			 descriptor example shows how to link the security role reference named payroll
			 to the security role named payroll-department.</p><div class="example"><p><a name="d0e6180"></a><b>Example 9.3. Sample security-role-ref Element Usage </b></p><pre class="programlisting">
...
	&lt;enterprise-beans&gt;
		...
		&lt;entity&gt;
			&lt;ejb-name&gt;AardvarkPayroll&lt;/ejb-name&gt;
			&lt;ejb-class&gt;com.aardvark.payroll.PayrollBean&lt;/ejb-class&gt;
			...
			&lt;security-role-ref&gt;
				&lt;description&gt;
				This role should be assigned to the employees of the payroll department.
				Members of this role have access to anyone&acirc;&#8364;&#8482;s payroll record.
				The role has been linked to the payroll-department role.
				&lt;/description&gt;
				&lt;role-name&gt;payroll&lt;/role-name&gt;
				&lt;role-link&gt;payroll-department&lt;/role-link&gt;
				&lt;/security-role-ref&gt;
			...
		&lt;/entity&gt;
		...
	&lt;/enterprise-beans&gt;
...
				</pre></div><p>A problem with this approach is that security tends to move
			 independent of the application business logic, and it is a function of the
			 deployment environment. The JBossSX framework provides a solution to custom
			 security problem in a manner that is transparent to the enterprise beans
			 business methods. This allows security logic to change independent of the
			 business logic and the security layer can be selected at deployment time to fit
			 operational environment.</p></div><div class="section"><a name="sx.security-proxy"></a><div class="titlepage"><div><h4 class="title"><a name="sx.security-proxy"></a>The JBossSX Security Proxy Model</h4></div></div><p>The custom security solution that the JBossSX framework offers is an extension of the method interceptor paradigm. We will see the details of this in  <a href="ch09s08.html" title="The JBoss Security Model">the section called &#8220;The JBoss Security Model&#8221;</a>. The concept of the security proxy is an implementation of the &#8220;protection proxy&#8221; form of the Proxy pattern described in the <i>Design Patterns</i> book. The security proxy model allows for development of an implementation of the business object remote or home interface whose sole responsibility is the implementation of the per-method security logic. This implementation object is the security proxy.  The container method interceptors first dispatch home and remote method invocations to the security proxy for custom security logic validation. If the security requirements are satisfied, the method invocation is dispatched to the business logic EJB. If the security requirements are not satisfied, a security exception is raised and the method invocation is halted.</p></div></div></div><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\gbar.gif" width="432" height="79"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="ch09.html"><img src="images\toc.gif" border="0"></a><a href="ch09.html"><img src="images\prev.gif" border="0"></a><a href="ch09s08.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table></body></html>