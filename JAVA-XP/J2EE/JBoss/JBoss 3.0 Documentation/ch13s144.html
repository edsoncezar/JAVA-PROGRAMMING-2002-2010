<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Clustering in JBoss 3.0 alpha</title><link rel="stylesheet" href="styles.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets Vimages/callouts/"><link rel="home" href="index.html" title="JBoss 3.0 Documentation"><link rel="up" href="ch13.html" title="Chapter 13. HOWTO"><link rel="previous" href="ch13s135.html" title="Configuring and Using JAXP 1.1 In JBoss"><link rel="next" href="ch14.html" title="Chapter 14. Third Party Examples"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\jboss.gif" border="0"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="ch13.html"><img src="images\toc.gif" border="0"></a><a href="ch13s135.html"><img src="images\prev.gif" border="0"></a><a href="ch14.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table><div class="section"><a name="clustering"></a><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="clustering"></a>Clustering in JBoss 3.0 alpha</h2></div></div><p>Authors:
		<span class="author">Sacha Labourey</span>
		<tt>&lt;<a href="mailto:sacha.labourey@cogito-info.ch">sacha.labourey@cogito-info.ch</a>&gt;</tt>
		<span class="author">Bill Burke</span>
		<tt>&lt;<a href="mailto:bill@burkecentral.com">bill@burkecentral.com</a>&gt;</tt>
	</p><div class="section"><a name="d0e12007"></a><div class="titlepage"><div><h3 class="title"><a name="d0e12007"></a>Introduction</h3></div></div><div class="section"><a name="d0e12010"></a><div class="titlepage"><div><h4 class="title"><a name="d0e12010"></a>What this article is about</h4></div></div><p>This document introduces basic clustering setup for Entity Beans, Stateful Session Beans and Stateless Session Beans. More advanced documentation will soon be available.</p><p>Clustering should be considered in alpha state. Feedback is highly welcome.</p><p>Clustering is built on top of the <a href="http://www.javagroups.com/" target="_top">JavaGroups</a> framework and requires JDK 1.3.x.</p><p>In order to create a cluster of JBoss nodes, you simply need to launch several JBoss (with clustering activated, see below) instances on different hosts. JBoss instances will automatically detect their neighbors and form a cluster.</p></div></div><div class="section"><a name="d0e12024"></a><div class="titlepage"><div><h3 class="title"><a name="d0e12024"></a>General setup</h3></div></div><div class="section"><a name="d0e12027"></a><div class="titlepage"></div><p>Clustering features are available in the pre 3.0 sources. First get the latest sources from CVS or download one of the sources daily snapshot. You then need to build JBoss server (run jboss-all/build/build.bat or jboss-all/build/build.sh). For more information read this <a href="ch01s08.html" title="Downloading the Documentation Example Source">the section called &#8220;Downloading the Documentation Example Source&#8221;</a>. </p><p>The resulting JBoss server can be found in jboss-all/build/output/jboss-3.0.0alpha.</p><p>To activate global clustering support, you need to copy the file jboss-all/cluster/etc/cluster-service.xml in the /deploy directory of your newly built JBoss server. Clustering is now activated in your JBoss server.</p></div></div><div class="section"><a name="d0e12036"></a><div class="titlepage"><div><h3 class="title"><a name="d0e12036"></a>Stateless Session Beans</h3></div></div><div class="section"><a name="d0e12039"></a><div class="titlepage"></div><p>To make a Stateless Session Bean (SLSB) active in a cluster, you need to modify its deployment settings in jboss.xml:</p><p><pre class="programlisting">
&lt;jboss&gt;
	&lt;enterprise-beans&gt;
		&lt;session&gt;
			&lt;ejb-name&gt;nextgen.StatelessSession&lt;/ejb-name&gt;
			&lt;jndi-name&gt;nextget.StatelessSession&lt;/jndi-name&gt;
			&lt;clustered&gt;True&lt;/clustered&gt;
		&lt;/session&gt;
	&lt;/enterprise-beans&gt;
&lt;/jboss&gt;
			</pre></p><p>Thus, you simply need to add the &lt;clustered&gt; tag to your existing jboss.xml configuration file.</p></div></div><div class="section"><a name="d0e12047"></a><div class="titlepage"><div><h3 class="title"><a name="d0e12047"></a>Stateful Session Beans</h3></div></div><div class="section"><a name="d0e12050"></a><div class="titlepage"></div><p>To make a Stateful Session Bean (SFSB) active in a cluster, you need to modify its deployment settings in jboss.xml:</p><p><pre class="programlisting">
&lt;jboss&gt;
	&lt;enterprise-beans&gt;
		&lt;session&gt;
			&lt;ejb-name&gt;nextgen.StatefulSession&lt;/ejb-name&gt;
			&lt;jndi-name&gt;nextget.StatefulSession&lt;/jndi-name&gt;
			&lt;clustered&gt;True&lt;/clustered&gt;
		&lt;/session&gt;
	&lt;/enterprise-beans&gt;
&lt;/jboss&gt;
			</pre></p><p>Thus, like for SLSB, you simply need to add the &lt;clustered&gt; tag to your existing jboss.xml configuration file. By default, bean state is replicated in-memory in sub-groups of two nodes.</p></div></div><div class="section"><a name="d0e12058"></a><div class="titlepage"><div><h3 class="title"><a name="d0e12058"></a>Entity Beans</h3></div></div><div class="section"><a name="d0e12061"></a><div class="titlepage"></div><p>To make an Entity Bean (EB) active in a cluster, you need to modify its deployment settings in jboss.xml:</p><p><pre class="programlisting">
&lt;jboss&gt;
	&lt;enterprise-beans&gt;
		&lt;entity&gt;
			&lt;ejb-name&gt;nextgen.EnterpriseEntity&lt;/ejb-name&gt;
			&lt;jndi-name&gt;nextget.EnterpriseEntity&lt;/jndi-name&gt;
			&lt;clustered&gt;True&lt;/clustered&gt;
		&lt;/entity&gt;
	&lt;/enterprise-beans&gt;
&lt;/jboss&gt;
			</pre></p><p>Thus, like for SLSB and SFSB, you simply need to add the &lt;clustered&gt; tag to your existing jboss.xml configuration file. By default, bean state is replicated in-memory in sub-groups of two nodes.</p><p>As Entity Beans clustering in JBoss is based on pessimistic locking at the database level, your database must support SQL instruction like "SELECT ... FOR UPDATE". Check in your database documentation if it supports such a feature.</p><p>Note: Entity Beans clustering has currently only been tested with Oracle.</p></div></div><div class="section"><a name="d0e12073"></a><div class="titlepage"><div><h3 class="title"><a name="d0e12073"></a>JNDI and HA-JNDI</h3></div></div><div class="section"><a name="d0e12076"></a><div class="titlepage"></div><p>By default, client code use the standard JBoss JNDI provider: JNP.</p><p>Nevertheless, a Highly Available (HA) JNDI server can also be used. To use it, you must have a list of cluster nodes in the provider URL list separated by commas (HA-JNDI default port is 1100): <pre class="programlisting">java.naming.provider.url=server1:1100,server2:1100,server3:1100</pre></p><p>Note that automatic discovery of HA-JNDI host is not yet available but is a planned feature.</p></div></div></div><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\gbar.gif" width="432" height="79"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="ch13.html"><img src="images\toc.gif" border="0"></a><a href="ch13s135.html"><img src="images\prev.gif" border="0"></a><a href="ch14.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table></body></html>