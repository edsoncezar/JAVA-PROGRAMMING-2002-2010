<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter 10. Development Tools and IDE Integration</title><link rel="stylesheet" href="styles.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets Vimages/callouts/"><link rel="home" href="index.html" title="JBoss 3.0 Documentation"><link rel="up" href="index.html" title="JBoss 3.0 Documentation"><link rel="previous" href="ch09.html#d0e6667" title="Bibliography"><link rel="next" href="ch10s10.html" title="&#xA;        How to Run and Debug EJBs using jBoss 2.2.2 inside of &#xA;        Visual Age for Java version 3.5 (patch 2)&#xA;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\jboss.gif" border="0"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="index.html"><img src="images\toc.gif" border="0"></a><a href="ch09.html#d0e6667"><img src="images\prev.gif" border="0"></a><a href="ch10s10.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table><div class="chapter"><div class="titlepage"><div><h2 class="title"><a name="d0e6730"></a>Chapter 10. Development Tools and IDE Integration</h2></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><a href="ch10.html#d0e6733">Integrating JBuilder 4.0 Foundation with JBoss 
for source level debugging</a></dt><dt><a href="ch10s10.html">
        How to Run and Debug EJBs using jBoss 2.2.2 inside of 
        Visual Age for Java version 3.5 (patch 2)
</a></dt><dt><a href="ch10s14.html">Integrating NetBeans/Forte for Java Community Edition with JBoss 
for source level debugging</a></dt><dt><a href="ch10s25.html">Using Verifier in Ant</a></dt><dt><a href="ch10s29.html">How to generate Enterprise Java Beans with EJBDoclet (XDoclet)</a></dt></dl></div><div class="section"><a name="d0e6733"></a><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="d0e6733"></a>Integrating JBuilder 4.0 Foundation with JBoss 
for source level debugging</h2></div></div><p>Author:<span class="author">John P. Coffey</span>
		<tt>&lt;<a href="mailto:jcoffey@pingtel.com">jcoffey@pingtel.com</a>&gt;</tt>
	</p><div class="section"><a name="d0e6747"></a><div class="titlepage"><div><h3 class="title"><a name="d0e6747"></a>Install the JBoss Server</h3></div></div><p>
For the purpose of this howto, I installed the JBossTomcat release version
2.2.1 into d:\JBoss-2.2.1_Tomcat-3.2.1.  Download it from
http://www.jboss.org and select the binary link from the page.  Don't worry 
about downloading a binary package, when all you want is the source code;
the binary package also contains the source code used for building.
</p></div><div class="section"><a name="d0e6752"></a><div class="titlepage"><div><h3 class="title"><a name="d0e6752"></a>Create a JBuilder 4.0 Project</h3></div></div><p>While setting up an EJB project the typical entry level screen
Project/Properties should look like:
</p><div class="mediaobject"><img src="images\jbuilder-prop-path.png"></div></div><div class="section"><a name="d0e6760"></a><div class="titlepage"><div><h3 class="title"><a name="d0e6760"></a>Create a JBoss-Server library</h3></div></div><p>
This is the most difficult aspect of the setup to get correct, however once
completed it does not need to be changed so you can setup multiple ejb
projects and reuse this library thanks to the folks at Borland.
</p><p>
To do this launch the Project/ProjectProperties/RequiredLibraries/Add...
dialog
</p><p>
Add the following library entries to the JBoss-Server classpath (the order
is crucual here).  Pay specific attention to the log and tmp folders,
faulure to put these in the Library class path will cause the classloader to
spit out error messages, the most confusing of which is that /log.properties
or /tmp.properties files could not be located.  This is because the folders
containing these files need to be in the classpath and the class loader
complains.
</p><p>
<pre class="programlisting">
/$JBOSS_TOMCAT_HOME/jboss/lib/crimson.jar
/$JBOSS_TOMCAT_HOME/jboss/bin/run.jar
/$JBOSS_TOMCAT_HOME/jboss/bin
/$JBOSS_TOMCAT_HOME/jboss/conf
/$JBOSS_TOMCAT_HOME/jboss/lib/jaas.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/jboss-jaas.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/jdbc2_0-stdext.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/jmxri.jar
/$JBOSS_TOMCAT_HOME/tomcat/lib/parser.jar
/$JBOSS_TOMCAT_HOME/tomcat/lib/servlet.jar
/$JBOSS_TOMCAT_HOME/tomcat/lib/jaxp.jar
/$JBOSS_TOMCAT_HOME/tomcat/lib/webserver.jar
/$JBOSS_TOMCAT_HOME/tomcat/lib/jasper.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/activation.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/awt.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/dynaserver.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/ejb.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/ejxeditor.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/ejxejb.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/ejxjaws.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/ejxjboss.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/hsql.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/idb.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jboss.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jetty-service.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jms.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jmxtools.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jndi.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jnpserver.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jpl-util-0_5b.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jta-spec1_0_1.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/mail.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/tomcat-service.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jbossmq.jar
/$JBOSS_TOMCAT_HOME/jboss/db
/$JBOSS_TOMCAT_HOME/jboss/conf/default
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/log4j.jar
/$JBOSS_TOMCAT_HOME/jboss/log
/$JBOSS_TOMCAT_HOME/jboss/tmp
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jbosssx.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jbosscx-0.2.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/connector.jar
/$JBOSS_TOMCAT_HOME/jboss/lib/ext/minerva-1_0b3.jar
</pre>
</p><p>
In the source tab for the JBoss-Server library point to
/$JBOSS_TOMCAT_HOME/jboss/src.  This is how JBuilder resolves where to find
the source for stepping through the code.  Without this step typically you
will be able to step through the code but the Main.java  will appear as
Main.class.
</p><p>
As per the diagram figure below, set the main class entry point to
'org.jboss.Main'.  This is where the JBoss server code starts up.  Make sure
that you set the working directory is set to $JBOSS_TOMCAT_HOME/jboss/bin in
the paths tab.
</p><div class="mediaobject"><img src="images\jbuilder-prop-run.png"></div><p>
Cut and paste the following line and place it into the 'vm parameters' entry
field (Project/Properties/Run)
</p><p><pre class="programlisting">
-classic -Dtomcat.home=D:\$JBOSS_TOMCAT_HOME\tomcat -Duser.dir=D:\$JBOSS_TOMCAT_HOME\jboss\bin
-Djavax.xml.parsers.SAXParserFactory=org.apache.crimson.jaxp.SAXParserFactoryImpl
-Djavax.xml.parsers.DocumentBuilderFactory=org.apache.crimson.jaxp.DocumentBuilderFactoryImpl
</pre></p><p>
The starup argument should be left blank with the above setting.  If you
want to run with the integrated tomcat you can put tomcat as the argument,
however beware that you MAY need to replace the
/$JBOSS_TOMCAT_HOME/jboss/conf/default with
/$JBOSS_TOMCAT_HOME/jboss/conf/tomcat
</p><p>
If the above steps have been done correctly, open up JBoss-Server.library,
this is located in the folder you specified when creating the library.
Typically this is C:\Documents and Settings\&lt;nt_username&gt;\.jbuilder4 or home
directory on Linux.  Do NOT edit this file, I found several problems
manually editing this file and I am unsure why but I got several instances
of resource not found exceptions afterwards.  If in doubt don't touch it!
</p><p>
<pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;library&gt;
  &lt;!--JBuilder Library Definition File--&gt;
  &lt;fullname&gt;JBoss-Server&lt;/fullname&gt;
  &lt;class&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/crimson.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/bin/run.jar]&lt;/path&gt;
    &lt;path&gt;/$JBOSS_TOMCAT_HOME/jboss/bin&lt;/path&gt;
    &lt;path&gt;/$JBOSS_TOMCAT_HOME/jboss/conf&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/jaas.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/jboss-jaas.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/jdbc2_0-stdext.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/jmxri.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/tomcat/lib/parser.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/tomcat/lib/servlet.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/tomcat/lib/jaxp.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/tomcat/lib/webserver.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/tomcat/lib/jasper.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/activation.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/awt.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/dynaserver.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/ejb.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/ejxeditor.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/ejxejb.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/ejxjaws.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/ejxjboss.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/hsql.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/idb.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jboss.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jetty-service.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jms.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jmxtools.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jndi.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jnpserver.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jpl-util-0_5b.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jta-spec1_0_1.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/mail.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/tomcat-service.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jbossmq.jar]&lt;/path&gt;
    &lt;path&gt;/$JBOSS_TOMCAT_HOME/jboss/db&lt;/path&gt;
    &lt;path&gt;/$JBOSS_TOMCAT_HOME/jboss/conf/default&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/log4j.jar]&lt;/path&gt;
    &lt;path&gt;/$JBOSS_TOMCAT_HOME/jboss/log&lt;/path&gt;
    &lt;path&gt;/$JBOSS_TOMCAT_HOME/jboss/tmp&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jbosssx.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/jbosscx-0.2.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/connector.jar]&lt;/path&gt;
    &lt;path&gt;[/$JBOSS_TOMCAT_HOME/jboss/lib/ext/minerva-1_0b3.jar]&lt;/path&gt;
  &lt;/class&gt;
  &lt;source&gt;
    &lt;path&gt;/$JBOSS_TOMCAT_HOME/jboss/src&lt;/path&gt;
  &lt;/source&gt;
&lt;/library&gt;
</pre></p><p>
A note about the initial file directory specifier.  I have seen this a
couple of ways, if you have multiple hard drives with the home on C and the
JBoss on D for example you will see 'D%|/' in place of / or alternatively
you may see a relative directory such as ../../JBoss-2.2.1....
</p></div><div class="section"><a name="d0e6796"></a><div class="titlepage"><div><h3 class="title"><a name="d0e6796"></a>Bypass the hanging InstantDB embedded database</h3></div></div><p>
I found that loading instant DB within its minnerva pool manager
occasionally causes the debugger to hang (on different setups), to work
around this, I made the following modifications to config/tomcat and also
config/default (it depends on the model you wish to start up JBoss in)
</p><p><pre class="programlisting">
&lt;!-- JDBC @JC org.enhydra.instantdb.jdbc.idbDriver  removed from list of drivers --&gt;
&lt;mbean code="org.jboss.jdbc.JdbcProvider"
name="DefaultDomain:service=JdbcProvider"&gt;
   &lt;!-- &lt;attribute name="Drivers"&gt;org.hsql.jdbcDriver,
    org.enhydra.instantdb.jdbc.idbDriver&lt;/attribute&gt; HANGS DRIVER --&gt;
   &lt;attribute name="Drivers"&gt;org.hsql.jdbcDriver&lt;/attribute&gt;
&lt;/mbean&gt;
</pre></p><p>
and comment out the minnerva pool definitions associated with InstantDB
</p><p><pre class="programlisting">
&lt;!--
  &lt;mbean code="org.jboss.jdbc.XADataSourceLoader" 
     name="DefaultDomain:service=XADataSource,name=InstantDB"&gt;
    &lt;attribute name="PoolName"&gt;InstantDB&lt;/attribute&gt;
    &lt;attribute name="DataSourceClass"&gt;org.opentools.minerva.jdbc.xa.wrapper.XADataSourceImpl&lt;/attribute&gt;
    &lt;attribute name="Properties"&gt;&lt;/attribute&gt;
    &lt;attribute name="URL"&gt;jdbc:idb:../conf/default/instantdb.properties&lt;/attribute&gt;
    &lt;attribute name="GCMinIdleTime"&gt;1200000&lt;/attribute&gt;
    &lt;attribute name="JDBCUser" /&gt;
    &lt;attribute name="MaxSize"&gt;10&lt;/attribute&gt;
    &lt;attribute name="Password" /&gt;
    &lt;attribute name="GCEnabled"&gt;false&lt;/attribute&gt;
    &lt;attribute name="InvalidateOnError"&gt;false&lt;/attribute&gt;
    &lt;attribute name="TimestampUsed"&gt;false&lt;/attribute&gt;
    &lt;attribute name="Blocking"&gt;true&lt;/attribute&gt;
    &lt;attribute name="GCInterval"&gt;120000&lt;/attribute&gt;
    &lt;attribute name="IdleTimeout"&gt;1800000&lt;/attribute&gt;
    &lt;attribute name="IdleTimeoutEnabled"&gt;false&lt;/attribute&gt;
    &lt;attribute name="LoggingEnabled"&gt;false&lt;/attribute&gt;
    &lt;attribute name="MaxIdleTimeoutPercent"&gt;1.0&lt;/attribute&gt;
    &lt;attribute name="MinSize"&gt;0&lt;/attribute&gt;
  &lt;/mbean&gt;
--&gt;
</pre></p></div><div class="section"><a name="d0e6809"></a><div class="titlepage"><div><h3 class="title"><a name="d0e6809"></a>Sprinkle breakpoints throughout your EJB and or Client Code</h3></div></div><p>
Firstly it is necessary to put breakpoints in your ejb's.  As outlined
previously project settings should point to the source of your beans.  Open
up a typical bean implementation and place breakpoints whereever desired.
</p></div><div class="section"><a name="d0e6814"></a><div class="titlepage"><div><h3 class="title"><a name="d0e6814"></a>Start the JBoss server</h3></div></div><p>
Using the IDE, select run / start debugger (shift + f9).  If you want to see
your beans being instantiated by the deployer, place breakpoints on the bean
constructors (if you specified them)  You will not need to have a client
running to exercise this functionality.
</p></div><div class="section"><a name="d0e6819"></a><div class="titlepage"><div><h3 class="title"><a name="d0e6819"></a>Deploy the Beans</h3></div></div><p>
copy of drag/drop (for windoze fans) the ejb jar file containing the
ejb-jar.xml and jboss.xml (optional) to the deploy folder.  If you have set
breakpoints in stateless session ejb's these should cause the debugger to
stop in your code!  Hurrah!
</p></div><div class="section"><a name="d0e6824"></a><div class="titlepage"><div><h3 class="title"><a name="d0e6824"></a>Start the Client Test Application</h3></div></div><p>
If you include a client test code in your project you can debug this also
(even though the project's main execution class is specified as
'org.jboss.Main'. To do this, select the test client class from the project
class pane and from the popup context meny, select debug. You should be
aware though that this debug session will run from the
$JBOSS_TOMCAST_HOME/jboss/bin directory since this is where we set the ejb
project to execute from (see above). If all goes well, you will have 2
running tabs in the messages window, one of these will be called Main (this
is the JBoss server process and this is where you can single step through
EJB code while the other is the test client.  One thing though, the timeouts
are somewhat short so if you spend too much time in a method within the EJB
you may find that transactions are rolled back.
</p><p>
If anyone has suggestions of feedback please let me know, I can be contacted
via email at jcoffey@pingtel.com
</p></div></div></div><table border="0" cellpadding="0" cellspacing="0" height="65"><tr height="65"><td rowspan="2"><img src="images\gbar.gif" width="432" height="79"></td><td rowspan="2" background="images\gbar.gif" width="100%" align="right" valign="top"><a href="index.html"><img src="images\doc.gif" border="0"></a><a href="index.html"><img src="images\toc.gif" border="0"></a><a href="ch09.html#d0e6667"><img src="images\prev.gif" border="0"></a><a href="ch10s10.html"><img src="images\next.gif" border="0"></a></td></tr><tr></tr></table></body></html>