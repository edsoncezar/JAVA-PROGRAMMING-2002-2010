<HTML>
<HEAD>
<META name=vscategory content="Enterprise Management Programming Languages">

<META name=vsisbn content="0471327565">
<META name=vstitle content="Developing Java Enterprise Applications">
<META name=vsauthor content="Stephen Asbury ; Scott R. Weiner">
<META name=searchdescription content="An in-depth, ground-floor introduction to the long-awaited Java Enterprise APIs. As Java rolls out its eagerly anticipated, eight-component battery of Java Enterprise APIs, this book is the ideal introduction for programmers and developers looking to quickly apply the technology's vast capabilities to real-world corporate programming. The authors discuss how to use the different APIs together and with other technologies such as CORBA, COM, Servlets, and Agents. The book also features invaluable information on building Servlet search engines, getting the most out of Java Server Pages, using Enterprise JavaBeans and JDBC to create N-Tier applications, and choosing the appropriate middleware to suit your particular needs. CD-ROM contains re-usable programs in Java and sample software.">
<META name=vsimprint  content="Wiley Computer Publishing ">
<META name=vspublisher content="John Wiley & Sons, Inc.">
<META name=vspubdate content="2/1/99">

<TITLE>Developing Java Enterprise Applications:Programming Servlets</TITLE>

<!-- HEADER -->

<STYLE type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
</STYLE>

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
         var Win = window.open(url,"displayWindow",'width=' + width +',height=' + height + ',resizable=1,scrollbars=yes');
	if (Win) {
		Win.focus();
	}
}
//-->
</script>
<SCRIPT>
<!--
function popUp(url) {
        var Win = window.open(url,"displayWindow",'width=400,height=300,resizable=1,scrollbars=yes');
	if (Win) {
		Win.focus();
	}
}
//-->
</SCRIPT>

</HEAD>

<body background="/images/back.jpg" bgcolor="#FFFFFF" link="#003399" alink="#FF0000" vlink="#003399" topmargin=0 leftmargin=0 marginheight=0 marginwidth=0>

<table bgcolor="#003366" width="100%" border="0" cellpadding="0" cellspacing="0">
	<tr>
		<td colspan="3">
		
		<table>
			<tr valign="top">
				<td bgcolor="#003366">&nbsp;&nbsp;<a href="http://www.earthweb.com" target="resource window"><img src="/images/ew_logo.jpg" width="109" height="93" vspace="5" alt="EarthWeb" border="0"></a>&nbsp;&nbsp;&nbsp;</td>
				<td bgcolor="#003366"><!--INSERTADTHISPAGE 1 -->

<!--  Begin Ads ITK.BOOKS.ENTERPRISEMANAGEMENT //-->

<!--ACCIPITERADINSERT /site=itknowledge/area=itk.books.enterprisemanagement/aamsz=468x60 -->

<!-- ITK.BOOKS.ENTERPRISEMANAGEMENT End Ads //--></td>
				<td bgcolor="#003366"><!--INSERTADTHISPAGE 1 -->

<!--  Begin Ads ITKBAN.FRONT //-->

<!--ACCIPITERADINSERT /site=itknowledge/area=itk.books.enterprisemanagement/aamsz=160x60/position=top -->

<!-- ITKBAN.FRONT End Ads //--></td>
			</tr>
		</table>
		
		</td>
	</tr>
		
	<tr>
		<td height="1" colspan="3" bgcolor="#003366"><img src="/images/dotclear.gif" border=0 alt=""></td>
	</tr>
</table>

<!-- END HEADER -->


<!-- BEGIN SUB HEADER -->

<table bgcolor="#003366" cellpadding="0" cellspacing="0" border="0" width="100%">

<!-- ITK TOPNAV -->
	
	<tr>
		<td align="left" valign="top" nowrap><a href="/"><img src="/images/top_tabs/home_off.gif" alt="Home" border="0"></a><a href="/pick-account.html"><img src="/images/top_tabs/accountinfo.gif" alt="Account Info" border="0"></a><a href="/PSUser/usrreg.htm?AdminAction=InitAdd&Locale=en&URI=/"><img src="/images/top_tabs/subscribe.gif" alt="Subscribe" border="0"></a><a href="/PSUser/en/acl/psuser_t.htm"><img src="/images/top_tabs/login.gif" alt="Login" border="0"></a><a href="/search/"><img src="/images/top_tabs/search.gif" alt="Search" border="0"></a><a href="/PSUser/en/acl/psuser_t.htm"><img src="/images/top_tabs/my_itknowledge.gif" alt="My ITknowlege" border="0"></a><a href="/faq/faq.html"><img src="/images/top_tabs/faq.gif" alt="FAQ" border="0"></a><a href="/sitemap.html"><img src="/images/top_tabs/sitemap.gif" alt="Sitemap" border="0"></a><a href="/contactus.html"><img src="/images/top_tabs/contact_us.gif" alt="Contact Us" border="0"></a></td> 
	</tr>
	
<!-- END of ITK TOPNAV -->

<!-- ITK LOGO and newsletter sign up -->

</table>
	
<table cellpadding="0" cellspacing="0" border="0" width="100%">

	<tr>
		<td align="left" valign="top" nowrap><img src="/images/itk_logo_sm.jpg" alt="" border="0"></td>
		<td align="right"><font face="verdana, sans-serif" size="1">

<script language="JavaScript">
<!-- 

var days = new Array(8);
days[1] = "Sunday";
days[2] = "Monday";
days[3] = "Tuesday";
days[4] = "Wednesday";
days[5] = "Thursday";
days[6] = "Friday";
days[7] = "Saturday";

var months = new Array(13);
months[1] = "January";
months[2] = "February";
months[3] = "March";
months[4] = "April";
months[5] = "May";
months[6] = "June";
months[7] = "July";
months[8] = "August";
months[9] = "September";
months[10] = "October";
months[11] = "November";
months[12] = "December";

var dateObj = new Date()
var wday = days[dateObj.getDay() + 1]
var lmonth = months[dateObj.getMonth() + 1]
var date = dateObj.getDate()
var fyear = dateObj.getYear()
if (fyear <1000) fyear += 1900;
document.write(wday + ", " + lmonth + " " + date + ", " + fyear)
                
//-->
</script>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>
<br><br>

<form action="/cgi-bin/list.cgi" method=post>
<table border="0" cellspacing="0" cellpadding="0"><tr><td align="right">
<img src="/images/newsletter.gif" alt="ITKnowledge Insider" border=0><br>
</td></tr>
<tr><td align="right">
<input type="hidden" name="state" value="Subscribe">
<input type="hidden" name="listname" value="ITKNOWLEDGE-L">
<input type="hidden" name="name" value="Anonymous">
<input type="text" name="email" value="Enter e-mail" size="12">&nbsp;<input type="image" width=69 height=25 border=0 value="Signup" name="Submit" src="/images/sign_up.gif" align=absmiddle>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;<img src="/images/arrows.gif" alt="" border="0"><font face="Arial,helvetica" size="1">Read the <a href="/newsletters/current.html">current newsletter!</a></font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr></table>
		</form></td>
	</tr>
</table>

<!-- END ITK LOGO and newsletter sign up-->
	
<!-- begin of ITK left NAV -->

<!-- BEGIN LEFT NAVBAR -->

<!-- BEGIN LEFT NAVBAR -->

	<table border="0" cellpadding="0" cellspacing="0">
	
	
		<tr>
		<td width="145" valign="top" align="left" rowspan=8>
		
	<!-- KEYWORD SEARCH -->	
	
	<form name="keyword" method="POST" action="http://ewsearch.earthweb.com:80/jsp/k2search/ewkwk2search.jsp">
<img src="/images/keyword_searcha.gif" vspace="5" width="145" alt="" border="0">
<INPUT type="hidden" name="collection" value="itk">
<INPUT type="hidden" name="altcoll" value="booksitk">
<INPUT type="hidden" name="hl" value="off">
<INPUT name="sortspec" type=hidden value="score desc">
<INPUT name=fields type=hidden value="vdkvgwkey score vstitle vsauthor vsisbn vspublisher vspubdate">		
<INPUT name=imageprefix type=hidden value="http://www.itknowledge.com">
<INPUT name=ssiFolder type=hidden value="itk">
		
		<table width="145" border="0" cellpadding="0" cellspacing="0">
		<tr>
		<td width="145">&nbsp;&nbsp;<input type="text" name="query" value="" size="11">&nbsp;<input type="image" width=28 height=23 border=0 value="Go" name="Go" src="/images/go.gif" align=absmiddle><br>
			<font face="arial, helvetica" size="2">
			<img src="/images/dotclear.gif" width="1" height="5" alt="" border="0"><br>
			
			&nbsp;&nbsp;<a href="/search/search-tips.html"><img src="/images/arrows_blue.gif" alt="" border="0"><font size="1" color="#ffffff">Search Tips</font></a><br>
			&nbsp;&nbsp;<a href="/search/"><img src="/images/arrows_blue.gif" alt="" border="0"><font size="1" color="#ffffff">Advanced Search</font></a><br>
			
			</font>
			
		</td>
		<td width="5"><img src="/images/dotclear.gif" width=5 height=10 hspace="5" alt="" border="0"></td>
		</tr>
		</table>
	</form>
		
		
<!-- BROWSE BY TOPIC -->
		

<form name="meta" method="POST" action="http://ewsearch.earthweb.com:80/jsp/k2search/ewmetak2search.jsp">
<img src="/images/publication_searcha.gif" width="145" alt="" border="0">
<INPUT type="hidden" name="collection" value="booksitk">
<INPUT type="hidden" name="altcoll" value="itk">
<INPUT type="hidden" name="hl" value="off">
<INPUT name=sortspec type=hidden value="score desc">
<INPUT name=fields type=hidden value="vdkvgwkey score vstitle vsauthor vspublisher vspubdate">
<INPUT name=imageprefix type=hidden value="http://www.itknowledge.com">
<INPUT name=ssiFolder type=hidden value="itk">
		
<table width="145" border="0" cellpadding="0" cellspacing="0">
	
			<tr>
			<td valign="top">
			&nbsp;&nbsp;<input type="text" name="query" value="" size="11">&nbsp;<input type="image" width=28 height=23 border=0 value="Go" name="Go" src="/images/go.gif" align=absmiddle><br><font face="arial, helvetica" size="2">
			&nbsp;&nbsp;<SELECT NAME="metatags" style="font-size: 12; font-family: sans-serif;" size="1">
			<option value="vstitle" SELECTED>Title
			<option value="vsauthor">Author
			<option value="vspublisher">Publisher
			<option value="vsisbn">ISBN			
			</SELECT><br><br></font>
			</td>
			</tr>
</table>
</form>

<form action="" name="catlist">	
<table width="145" border="0" cellpadding="0" cellspacing="0">				
			<tr>
			<td valign="top">
			<img src="/images/jump_topica.gif" width="145" alt="" border="0">
			</td>
			</tr>
			<tr>
			<td width="145">
				
	        	<font face="Arial,helvetica" size="1">
				&nbsp;&nbsp;<SELECT NAME="cat" onChange='top.location.href=this.options[selectedIndex].value;' style="font-size: 10; font-family: sans-serif;">
                        <option value="" selected>Please Select
                        <option value="">-----------
                        <option value="/reference/dir.components.html">Components
                        <option value="/reference/dir.contentmanagement.html">Content Mgmt
                        <option value="/reference/dir.certification1.html">Certification
                        <option value="/reference/dir.databases.html">Databases
                        <option value="/reference/dir.enterprisemanagement1.html">Enterprise Mgmt
                        <option value="/reference/dir.funandgames1.html">Fun/Games
                        <option value="/reference/dir.groupwareandcollaboration1.html">Groupware
                        <option value="/reference/dir.hardware1.html">Hardware
                        <option value="/reference/dir.ibmredbooks1.html">IBM Redbooks
                        <option value="/reference/dir.intranetandextranetdevelopment1.html">Intranet Dev
                        <option value="/reference/dir.middleware.html">Middleware
                        <option value="/reference/dir.multimediaandgraphicdesign1.html">Multimedia
                        <option value="/reference/dir.networkservices1.html">Networks 
                        <option value="/reference/dir.operatingsystems.html">OS
                        <option value="/reference/dir.productivityapplications1.html">Productivity Apps
                        <option value="/reference/dir.programminglanguages.html">Programming Langs
                        <option value="/reference/dir.security1.html">Security  
                        <!-- <option value="/reference/dir.ewtraining1.html">Training Guides -->
                        <option value="/reference/dir.userinterfaces.html">UI
                        <option value="/reference/dir.webservices.html">Web Services
                        <option value="/reference/dir.webmasterskills1.html">Webmaster
                        <option value="/reference/dir.y2k1.html">Y2K
                        <option value="">-----------
                        			<option value="/reference/whatsnew.html">New Arrivals
                        <option value="">-----------
                        <option value="/reference/dir.archive1.html">Free Archive               
                        </SELECT>
			</font>
			
		</td>
		</tr>
	</table>
	</form>
	
<!-- LEFT NAV SEARCH END -->

	</td>
		

<!-- END LEFT NAVBAR -->


<!-- END LEFT NAVBAR -->
	
	<td width="15"><img src="/images/dotclear.gif" width="15" alt="" border="0"></td>

<!-- end of ITK left NAV -->

<!-- begin main content -->
	
	<td width="100%" valign="top" align="left">
		<br>

<!-- END SUB HEADER -->
<!-- Created by dB Page Builder.  http://www.pchelponline.com/bluestem -->

<!--Begin Content Column -->

<TABLE border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img src="/images/sm_covers/0471327565.gif" width=60 height=73 alt="Developing Java Enterprise Applications" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Developing Java Enterprise Applications</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by Stephen Asbury ; Scott R. Weiner</i>
    <br>
    Wiley Computer Publishing,&nbsp;John Wiley & Sons, Inc.
    <br>
    <b>ISBN:</b>&nbsp;0471327565<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;02/01/99</font>
    &nbsp;&nbsp;&nbsp;&nbsp;<a href="/PSUser/EWBookMarks.html?url=http://www.itknowledge.com/reference/standard/0471327565/ewtoc.html&isbn=0471327565"><img src="/images/bookmarkit.gif" border=0 alt="Bookmark It" width=97 height=23></a>
</td>
</tr>
</table>
<P>
<FORM name= "search2" method="POST" action="http://ewsearch.earthweb.com:80/jsp/k2search/ewintrak2search.jsp"
>
<INPUT type="hidden" name="collection" value="itk">
<INPUT type="hidden" name="altcoll" value="booksitk">
<INPUT type="hidden" name="hl" value="off">
<INPUT name="sortspec" type=hidden value="score desc">
<INPUT name="fields" type=hidden value="vdkvgwkey score vstitle vsisbn vsauthor vspublisher vspubdate">
<INPUT name="imageprefix" type=hidden value="http://www.itknowledge.com">
<INPUT name="ssiFolder" type=hidden value="itk">
<INPUT type="hidden" name="bookid" value="www.itknowledge.comreferencestandard0471327565">

<font face="arial, helvetica" size=2><b>Search this book:</b></font><br>
<INPUT NAME="query" size=25 VALUE="">&nbsp;<input type="image" width=28 height=23 border=0 value="Go" name="Go" src="/images/go.gif" align=absmiddle>

</form>


<!-- Empty Reference Subhead -->

<!--ISBN=0471327565//-->
<!--TITLE=Developing Java Enterprise Applications//-->
<!--AUTHOR=Stephen Asbury//-->
<!--AUTHOR=Scott R. Weiner//-->
<!--PUBLISHER=Wiley Computer Publishing//-->
<!--CHAPTER=07//-->
<!--PAGES=195-202//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="07-14.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="07-16.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<H3><A NAME="Heading18"></A><FONT COLOR="#000077">Running and Hosting Servlets</FONT></H3>
<P>There are a growing number of products that support servlets. In writing this book, we have used several providers. First, the Java Servlet Development Kit, or JSDK, provides a command-line program called servletrunner. This program loads servlets and handles servlet requests, but it does not support normal HTML requests, so it doesn&#146;t provide the same complete environment as a Web server. Second, the Java Web Server, a product provided by Sun, supports both servlets and JavaServer Pages, as discussed in later chapters. BEA WebLogic Application Server also supports servlets. All of these hosts support initialization arguments that the servlet acquires via the ServletConfig object.
</P>
<P>Regardless of the host you pick, you need to know several things before running servlets:</P>
<DL>
<DD><B>Where do the servlet&#146;s class files go?</B> Often the host provides a directory called servlets for these files. The Java Web Server has a directory called servlets; servletrunner uses command-line arguments to indicate the directory all the servlet classes are contained in.
<DD><B>Where do supporting classes go?</B> Most likely, supporting files will go with the servlet, in the CLASSPATH, or in another special directory defined by the host. The Java Web Server provides a directory called classes that is a sibling to the servlets directory. Supporting classes should go in this directory. For servletrunner, the supporting classes should be in either the same directory as the servlet class or in the CLASSPATH used to run servletrunner.
<DD><B>How is the server told about a servlet?</B> In most cases, either a special file or tool is used to tell the server about servlets. The Java Web Server provides an administrative tool that can be used to add servlets to the server, set their names, and assign a class to each name. This name is used in the URL to indicate the servlet using the form <A HREF="http://server/servlet/servletname">http://server/servlet/servletname</A>. The servletrunner uses a properties file and expects lines of the form:
<!-- CODE SNIP //-->
<PRE>
servlet.adrotator.code=AdRotatorServlet
</PRE>
<!-- END CODE SNIP //-->
<BR>This indicates a servlet&#146;s name and class. This properties file can be assigned as a command-line argument to servlet runner.
<DD><B>How are initialization parameters set?</B> As with the previous question, either a file or tool is often used to set these parameters. The Java Web Server provides an administrative tool that can be used to add servlets to the server, set their names, and assign a class to each name. This name is used in the URL to indicate the servlet using the form <A HREF="http://server/servlet/servletname.">http://server/servlet/servletname.</A> The servletrunner uses a properties file and expects lines of the form:
<!-- CODE SNIP //-->
<PRE>
 servlet.adrotator.initArgs=\
                       imagedir=c:\\temp\\chapter_07\\images
</PRE>
<!-- END CODE SNIP //-->
<DD><B>This code indicates a servlet&#146;s arguments.</B> Multiple arguments should be comma delimited, and the \ character can be used to break the arguments across lines. A \ in the argument must be escaped, as shown in the preceding code. This properties file can be assigned as a command-line argument to servlet runner.
</DL>
<P>The Java Web Server provides excellent support for servlet programming. Even better is the fact that there is every indication that other major server vendors are adopting this technology as well. Expect support and additional functionality to appear in most server products. This means that if you write servlets now, you should see enhanced features and performance in the years to come at very little cost to you.
</P>
<P>The servlet development kit is included on the CD-ROM that accompanies this book. Visit java.sun.com for information on downloading a trial version of the Java Web Server or check with your server provider to see if it supports servlets. You might also want to browse to <A HREF="www.livesoftware.com">www.livesoftware.com</A>, a company that provides tools for adding servlet support to your existing Web server.</P>
<H3><A NAME="Heading19"></A><FONT COLOR="#000077">Debugging Servlets</FONT></H3>
<P>Perhaps one of the hardest aspects of programming servlets is testing them&#151;not testing the features as much as the reliability. Consider that the servlet runs on the Web server and therefore is probably not accessible to a debugger. Certainly, some servlet hosts might provide debug capabilities, but it is not the norm. When an uncaught exception occurs in a servlet, it simply fails to return data. The programmer won&#146;t get any information from the client about the error beyond the nagging message, &#147;document contains no data.&#148; Also, many developers may write and test their servlets on one Web server and deploy them to another one, making it hard to expect normal debugging facilities. Finally, although servlets do have access to the log file, there are a number of issues with using log statements to debug the program.
</P>
<P>The destination for the log is server dependent. Strings sent to the log may be altered and may have other log messages interspersed between them. Log-style debugging is also time consuming in the sense that you will often add logging comments to the code and then remove them for deployment. More important, the log is intended for administratively significant messages, not debugging. Despite these drawbacks, log-style debugging is perhaps the most portable and stable debugging mechanism for servlets.</P>
<P>To make log-style, or printf-style, debugging easier with servlets and other distributed programs, we have created a class listed in the code that follows; this code defines a class named DebugLog. The goal of this class is to provide multiple logging destinations, rather than just supporting the servlet log. In particular, the DebugLog object can be told to send log messages to a file, stream, or even to a log server that has been provided. This server prints messages to System.out or a file. In the case of the log server, you can watch log messages in real time while testing the servlet. Two methods are provided: one to log string messages and the other to log an exception&#146;s stack trace. This can be especially useful when an exception occurs.</P>
<P>We also want to minimize the code changes required to move from development to production. The technique we use to accomplish this is a simple one. First, the DebugLog object is not initialized with a specific log destination. If no destination is provided, the logging code will simply ignore all logging messages. This means that you can leave debugging code in your servlets at the cost of a message send and an if statement. In the context of a server, this is a minimal requirement for reducing the maintenance required to remove debugging code.</P>
<P>The code for DebugLog follows. Notice that the main issues are keeping track of the server in a way that allows the server to go down and the logger to reconnect appropriately. In fact, if either the servlet goes away or the server goes down, the other will self-correct.</P>
<!-- CODE //-->
<PRE>
import java.io.*;
import java.net.*;
import LogServer;

public class DebugLog extends Object
{
    private Socket server;
    private String serverName;
    private BufferedReader serverReader;

    private PrintWriter log;

    private static DebugLog sharedLog;

    public static synchronized DebugLog getSharedLog()
    {
        if(sharedLog == null) sharedLog = new DebugLog();
        return sharedLog;
    }

    public DebugLog()
    {
        log = null;
    }

    public synchronized boolean initialized()
    {
        return ((log != null)||(serverName!=null));
    }

    public synchronized void log(String str)
    {
//exit quick if no log
        if((log != null)||(serverName!=null))
        {
            log(str,true);//retry
        }
    }

    public synchronized void log(Exception exp)
    {
        if((log != null)||(serverName!=null))
        {
            StringWriter out;
            PrintWriter printOut;
            String logTrace;
            StringReader in;
            BufferedReader bufIn;
            String curLine;

            try
            {
                out = new StringWriter();
                printOut = new PrintWriter(out);

                exp.printStackTrace(printOut);
                printOut.close();


                logTrace = out.toString();
                in = new StringReader(logTrace);
                bufIn = new BufferedReader(in);

                while((curLine = bufIn.readLine()) != null)
                {
                    log(curLine,true);
                }

                bufIn.close();
            }
            catch(Exception ex)
            {
            }
        }
    }

    //protected method that allows the logger to reconnect
    //to a server
    protected synchronized void log(String str,boolean retry)
    {
        boolean error=false;

        if(log != null)//exit quick if no log
        {
            try
            {
                log.println(str);

                if(serverReader != null)
                {
                    //Read the response, but ignore
                    //This should force an exception
                    // if the socket is closed
                    serverReader.readLine();
                }
            }
            catch(Exception ex)
            {
                error = true;
                closeLog();
            }
        }
        else
        {
            error = true;
        }

        if((serverName != null) &amp&amp error)
        {
            if(retry)
            {
                logTo(serverName);
                log(str,false);//only retry one time
            }
            else
            {
                closeLog();
            }
        }
    }

    public synchronized void logTo(File f)
    {
        if(f!=null)
        {
            closeLog();

            try
            {
                FileWriter fileIn = new
                   FileWriter(f.getAbsolutePath(),true);
                log = new PrintWriter(fileIn,true);
            }
            catch(Exception exp)
            {
                log = null;
            }
        }
    }

    public synchronized void logTo(OutputStream stream)
    {
        if(stream!=null)
        {
            closeLog();

            try
            {
                log = new PrintWriter(stream,true);
            }
            catch(Exception exp)
            {
                log = null;
            }
        }
    }

    public synchronized void logTo(String logServer)
    {
        if(logServer!=null)
        {

            closeLog();

            serverName = logServer;

            try
            {
                server = new
                   Socket(logServer,LogServer.DEFAULT_PORT);

                InputStreamReader readIn;
                readIn = new
                  InputStreamReader(server.getInputStream());
                serverReader = new BufferedReader(readIn);

                log = new
                      PrintWriter(server.getOutputStream(),true);
                server.setSoTimeout(2000);//two seconds
            }
            catch(Exception exp)
            {
                log = null;
                server = null;
            }
        }
    }

    public synchronized void closeLog()
    {
        if((log!=null)&amp&amp(server!=null))
        {
            try
            {
                log.println(LogServer.DISCONNECT_MSG);
            }
            catch(Exception exp)
            {
            }
        }

        if(log != null)
        {
            log.flush();
            log.close();
            log = null;
        }

        if(server != null)
        {
            try
            {
                if(serverReader != null) serverReader.close();
                server.close();
                server = null;
                serverReader = null;
            }
            catch(Exception ex)
            {
            }
        }
    }

    public synchronized void finalize()
    {
        closeLog();
    }
}

class DebugLogTester
{
    public static int MSG_COUNT=100;

    public static void main(String[] args)
    {
        DebugLog logger = DebugLog.getSharedLog();
        int i;

        System.out.println(&#147;Created log.&#148;);
        logger.logTo(&#147;192.168.0.172&#148;);
        System.out.println(&#147;Set log dest.&#148;);

        System.out.println(&#147;Logging messages.&#148;);

        for(i=0;i&ltMSG_COUNT;i&#43;&#43;)
        {
            try
            {
                logger.log(&#147;Test &#148;&#43;i);

                Thread.sleep(100);
            }
            catch(Exception exp)
            {
                System.out.println(&#147;Exception: &#148;&#43;exp);
            }
        }

        System.out.println(&#147;Closing log.&#148;);
        logger.closeLog();
    }

}
</PRE>
<!-- END CODE //-->
<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="07-14.html">Previous</A></TD>
<TD><A HREF="../ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="07-16.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


<!-- all of the reference materials (books) have the footer and subfoot reveresed -->
<!-- reference_subfoot = footer -->
<!-- reference_footer = subfoot -->

<!-- BEGIN SUB FOOTER -->
	<br>
	<img src="/images/dotclear.gif" width="5" height="7" border="0">
	</TD>
    </TR>
	</TABLE>
	
	<table width="100%" border=0 cellpadding=0 cellspacing=0>
	<tr>
		<td align="left" width="160"><img src="/images/bot_curve.jpg" width="160" alt="" border="0"></td>
		<td align="left" valign="top" nowrap><a href="/"><img src="/images/top_tabs/home_bot.gif" alt="Home" border="0"></a><a href="/pick-account.html"><img src="/images/top_tabs/account_info_bot.gif" alt="Account Info" border="0"></a><a href="/PSUser/usrreg.htm?AdminAction=InitAdd&Locale=en&URI=/"><img src="/images/top_tabs/subscribe_bot.gif" alt="Subscribe" border="0"></a><a href="/PSUser/en/acl/psuser_t.htm"><img src="/images/top_tabs/login_bot.gif" alt="Login" border="0"></a><a href="/search/"><img src="/images/top_tabs/search_bot.gif" alt="Search" border="0"></a><a href="/PSUser/en/acl/psuser_t.htm"><img src="/images/top_tabs/my_itknowledge_bot.gif" alt="My ITKnowledge" border="0"></a><a href="/faq/faq.html"><img src="/images/top_tabs/faq_bot.gif" alt="FAQ" border="0"></a><a href="/sitemap.html"><img src="/images/top_tabs/sitemap_bot.gif" alt="Sitemap" border="0"></a><a href="/contactus.html"><img src="/images/top_tabs/contact_us_bot.gif" alt="Contact Us" border="0"></a></td> 
	</tr>
	</table>
		
	<table width="100%" bgcolor="#003366" border=0 cellpadding=0 cellspacing=0>
	<tr>
		<td align="left" width=145><img src="/images/clear_pixel.gif" width=145 height="1" alt="" border="0"></td>
				
<!-- END SUB FOOTER -->

<!-- all of the books have the footer and subfoot reveresed -->
<!-- reference_subfoot = footer -->
<!-- reference_footer = subfoot -->

<!-- FOOTER -->
			
<td align="left" bgcolor="#003366">
<table border="0" cellspacing="10" cellpadding="5">
<tr>
<td align="center">
<font face="arial, helvetica" size="1" color="#cccccc"><b><a href="/products.html"><font color="#0099CC">Products</font></a>&nbsp;|&nbsp; <a href="/contactus.html"><font color="#0099CC">Contact Us</font></a>&nbsp;|&nbsp; <a href="/aboutus.html"><font color="#0099CC">About Us</font></a>&nbsp;|&nbsp; <a href="http://www.earthweb.com/about_us/privacy.html" target="resource window"><font color="#0099CC">Privacy</font></a> &nbsp;|&nbsp; <a href="http://www.itmarketer.com/" target="resource window"><font color="#0099CC">Ad Info</font></a> &nbsp;|&nbsp; <a href="/"><font color="#0099CC">Home</font></a></b>
<br><br>Use of this site is subject to certain <a href="/agreement.html"><font color="#0099CC">Terms &amp; Conditions</font></a>, <a href="/copyright.html"><font color="#0099CC">Copyright &copy; 1996-2000 EarthWeb Inc.</font></a> All rights reserved.  Reproduction whole or in part in any form or medium without express written <a href="http://www.earthweb.com/about_us/perm.html" target="resource window"><font color="#0099CC">permission</font></a> of EarthWeb is prohibited. Read EarthWeb's <A HREF="http://www.earthweb.com/about_us/privacy.html" target="resource window"><font color="#0099CC">privacy</font></A> statement.</font><br><br>
</td>
</tr>
</table>

<!-- netranger link to stop spiders -->

<a href="ITKN1a2b3c4d5e6f7g8h9idefcon4.html">
<img src="/images/dotclear.gif" border="0" height="1" width="1" align="left"></a>
</td>
		</tr>
</table>
</BODY>
</HTML>

<!-- END FOOTER -->

