<HTML>
<HEAD>


<TITLE>Developing Java Enterprise Applications:MiniJMS: A Java Messaging Service Provider</TITLE>





<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="26-19.html">Previous</A></TD>
<TD><A HREF="..\ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="..\appendix-a.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P>The properties file used by the server defines the database connection information, the directory that the store will use to store messages, and the JNDI connection information.
</P>
<PRE>
db_url=jdbc:odbc:MiniJMS

db_driver=sun.jdbc.odbc.JdbcOdbcDriver

object_directory=c:\\temp\\objects

java.naming.factory.initial=\
                      com.sun.jndi.fscontext.RefFSContextFactory

java.naming.provider.url=file:///temp/jndistore
</PRE>
<P>MiniJMSMessageStore supports a username and password for the database connection information, but they are not used in this example.
</P>
<H3><A NAME="Heading17"></A><FONT COLOR="#000077">Building and Running MiniJMS</FONT></H3>
<P>MiniJMS, in the default configuration, relies on an ODBC data source called MiniJMS. The CD-ROM includes a Microsoft Access database file that contains the data for this database, or you can use the minijmsserver.BuildDB script to create a database using a different database vendor. Simply alter the script or create a different one that generates the database schema discussed in the section on the MiniJMSMessageStore. You will also need to create a directory called c:/temp/jndistore for use by the JNDI file system context.
</P>
<P>In order to compile and use MiniJMS, install the JMS libraries on your computer. These are in a package called javax.jms. You will also need the JNDI libraries discussed in Chapter 5, &#147;Using JNDI,&#148; and the file system JNDI service provider. All of these libraries can be obtained from the CD-ROM or the JavaSoft Web site at www.javasoft.com. All of these libraries must appear in your class path.</P>
<P>Several small batch files are included in the chapter_26 directory of the CD-ROM; they build the minijms and minijmsserver packages as well as run rmic on the three remote objects, MiniJMSServerImp, RemoteMiniConnectionImp, and RemoteMiniSessionImp. The script build.bat also builds the database and creates a jar file called minijms.jar that is used by the examples in Chapter 20, &#147;Programming with the Java Messaging Service.&#148; Once created, your client can use this jar file to get access to the MiniJMS classes.</P>
<P>Running JMS is a three-step process. First, make sure that all of the library files are in your class path. Next, start the RMI registry. The registry must have access to the minijms classes, so you may want to put the minijms.jar file in your class path. Then start the MiniJMS server. This server is called minijmsserver.MiniJMS and takes a single command-line argument containing the IP address of the local host. This address is used to find the RMI registry. For example, you might enter:</P>
<PRE>
&gt java -nojit minijmsserver.MiniJMS 192.168.0.172
</PRE>
<P>Notice that due to a bug in some versions of the JDK that causes errors when using RMI, the just-in-time compiler is not used. You may not need to take this precaution with your installation.
</P>
<P>Use the examples in Chapter 20 to test MiniJMS and see it in action.</P>
<H3><A NAME="Heading18"></A><FONT COLOR="#000077">Summary</FONT></H3>
<P>MiniJMS is a large application that ties together several Enterprise frameworks, including JNDI, JDBC, and RMI. The main take-home points from this example are as follows:
</P>
<DL>
<DD><B>&#149;</B>&nbsp;&nbsp;Use properties files when possible. This allows easier reconfiguration of the program.
<DD><B>&#149;</B>&nbsp;&nbsp;Use JNDI to access objects whose implementation should be hidden from the programmer. MiniJMS uses JNDI to register the destinations and connection factories, allowing the programmer to access these objects without knowing their implementation details or actual class names.
<DD><B>&#149;</B>&nbsp;&nbsp;Use JDBC for database access and try to use generic SQL to make porting between databases easier. MiniJMS uses basic SQL, although the build script for Microsoft Access does use the currency field for message numbers, because longs are not supported. However, the client is unaware of this &#147;hack.&#148;
<DD><B>&#149;</B>&nbsp;&nbsp;Recognize that JNDI providers may have limited functionality and the choice of provider can play an important role in your implementation or deployment. For example, the file system provider we used prevents the client from accessing the JNDI context unless the client and server share a file system.
<DD><B>&#149;</B>&nbsp;&nbsp;Recognize that JDBC drivers can also limit your implementation. The JDBC-ODBC driver, with Access, prevents the efficient storage of serialized objects in the database, causing us to store them on disk.
<DD><B>&#149;</B>&nbsp;&nbsp;Considering that MiniJMS is only an example program, realize that enterprise applications are large and can take a lot of time to write and test. Of course, you probably knew that already! This bullet is for your boss, who disagrees with you and wants it tomorrow, bug-free.
<DD><B>&#149;</B>&nbsp;&nbsp;Rely on thread synchronization to protect shared resources, keeping in mind that you may not be able to protect something with only synchronized methods. For example, when we read messages, we both retrieve and remove them. If we relied on synchronized messages, another thread could perform an operation between the retrieve and remove. Synchronizing a block of code protects against this type of interference.
</DL>
<P>All in all, there are many lessons to learn from this example. Not all are listed here, but hopefully this example, the one in Chapter 25, &#147;A Four-Tier Online Store,&#148; and all of the others from this book provide a great start for you on your journey into Java enterprise programming.
</P><P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="26-19.html">Previous</A></TD>
<TD><A HREF="..\ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="..\appendix-a.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>





</BODY>
</HTML>

