<HTML>
<HEAD>


<TITLE>Developing Java Enterprise Applications:What Are Servlets?</TITLE>





<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="06-02.html">Previous</A></TD>
<TD><A HREF="..\ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="06-04.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P><FONT SIZE="+1"><B><I>Processing Responses</I></B></FONT></P>
<P>When one of the processing methods of HTTPServlet is called, the typical steps are to read the values from the request, do any additional processing such as logging or database access, and then write a response to the client.
</P>
<P>To write a response to the client, HttpServletResponse has a method getWriter that returns a PrintWriter instance. Use this object to write data to the client. All HTTP responses are expected to include a content type. Because the servlet is handling a specific client request, the servlet should define this type as shown above. The value for this content type is included in the HTTP header returned to the client. Possible content types include text/html, text/plain, image/gif, and any other valid MIME type. Notice that the type is separated into a major and minor type. All text uses the text major type but can either be HTML or plain. Images use the image major type and can use a number of minor types, including gif, jpg, and tiff. The list of acceptable types is constantly growing. New types are often tested using the x- prefix to indicate that they are experimental. You can find more information about the available types by browsing to <A HREF="http://library.cs.tuiasi.ro/programming/java/developing_java_enterprise_app/ch06/www.ietf.org/">www.ietf.org/</A> and looking for a request for comments (RFC) search engine. Then go to RFC 2046. These RFCs can be hard to read, so the other option is to use your browser&#146;s preferences dialog to find a list of the types it supports.</P>
<P>In the example that follows, if you don&#146;t specify that the data you are sending is HTML, the browser parses HTML tags as regular text and just displays the text. For example, rather than seeing a horizontal rule, you would see &ltHR&gt in the browser. To specify the content type for a servlet&#146;s response, call the HttpServletResponse method setContentType and pass in an appropriate type. For example, the following line:</P>
<PRE>
response.setContentType(&#147;text/html&#148;);
</PRE>
<P>tells the browser we are sending HTML.
</P>
<H4 ALIGN="LEFT"><A NAME="Heading6"></A><FONT COLOR="#000077">Example Servlet</FONT></H4>
<P>The code that follows defines a basic servlet BookReviewServlet that can be used in place of the CGI program used to display the book review in the section &#147;Processing Forms with CGI.&#148; The only change to the HTML file is the &ltFORM&gt tag. The new tag looks like this:
</P>
<PRE>
&ltform action=&lthttp://localhost:8080/servlet/BookReviewServlet&gt method=POST&gt
</PRE>
<P>In the BookReviewServlet code, the servlet performs the same function as the Perl script by processing the form request and sending back an HTML response page. For simplicity, only POST is supported.
</P>
<PRE>
import java.io.*;

import javax.servlet.*;
import javax.servlet.http.*;

public class BookReviewServlet extends HttpServlet
{
    // Write a response to the client.
    public void doPost(HttpServletRequest req,
                       HttpServletResponse res)
        throws ServletException, IOException
    {
        /*
          Set the &#147;content type&#148; header of the response so that
          the browser knows we are sending HTML, not just raw
          text. If you don't do this, the HTML tags will not
          be interpreted.
          Try commenting out this line to see what happens.
        */
        res.setContentType(&#147;text/html&#148;);

        //Get the response's PrintWriter to return text to client.
        PrintWriter toClient = res.getWriter();

        // Read form values.
        String fName = req.getParameter(&#147;fname&#148;);
        String chp = req.getParameter(&#147;favchap&#148;);
        String writeServlet = req.getParameter(&#147;writeservlet&#148;);

        // Respond to client with a thank you.
        toClient.println(&#147;&ltHTML&gt&#148;);
        toClient.println(&#147;&ltTITLE&gtBook Review Response&lt/TITLE&gt&#148;);
        toClient.print(fName);
        toClient.println(&#147;, thank you for your feedback.&ltBR&gt&#148;);
        toClient.print(&#147;Your favorite chapter so far is chapter &#148;);
        toClient.println(chp &#43; &#147;.&ltBR&gt&#148;);
        toClient.println(&#147;&ltHR&gt&#148;);
        toClient.println(&#147;You are &#148;);
        if(writeServlet == null)
            toClient.print(&#147;not &#148;);
        toClient.println(&#147;planning to write a servlet.&#148;);

        toClient.println(&#147;&lt/HTML&gt&#148;);


        // Close the writer when response is done.
        toClient.close();
    }

}
</PRE>
<P>Also notice that doService() is a synchronized method. This is because servlets typically run in multithreaded environments. Because there is only one instance of the servlet object created by the Web server, the servlet must be able to service simultaneous requests. Servlets, therefore, need to ensure that they synchronize access to such shared resources as their instance variables, database connections, and file streams.
</P>
<H4 ALIGN="LEFT"><A NAME="Heading7"></A><FONT COLOR="#000077">Running the Servlet</FONT></H4>
<P>JSDK includes a testing application called servletrunner in the JSDK/bin directory. Put your compiled servlet in the examples directory of the JSDK and then execute servletrunner. If you make any changes to your servlet, restart the servletrunner. To load the servlet from the Web browser, specify the location <A HREF="http://localhost:8080/servlet/servletname">http://localhost:8080/servlet/ServletName</A>. If servletrunner is on another machine, replace localhost with the server name. Port 8080 is the default port that servletrunner is on.</P><P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="06-02.html">Previous</A></TD>
<TD><A HREF="..\ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="06-04.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>





</BODY>
</HTML>

