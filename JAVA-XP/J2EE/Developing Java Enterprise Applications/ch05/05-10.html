<HTML>
<HEAD>


<TITLE>Developing Java Enterprise Applications:Using JNDI</TITLE>





<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="05-09.html">Previous</A></TD>
<TD><A HREF="..\ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="05-11.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<PRE>
         NamingEnumeration result = dctx.search(&#147;ou=People&#148;, attrs);
    
         while (result.hasMore())
         System.out.println(result.next());
...
</PRE>
<P>In this code, BasicAttribute is created with a constructor that takes a boolean. By passing true into the constructor, the BasicAttributes object that is instantiated ignores the case of attributes it manages. If false was passed in, the BasicAttributes object would be case sensitive. This case sensitivity affects how searching will interpret the contents of the BasicAttributes. After the BasicAttributes object is created, two attributes of type BasicAttribute are added to the BasicAttributes object. After BasicAttributes is created and attributes have been inserted, it is passed to the search method of the context, which searches for all objects that have both a Web site and an e-mail attribute. The result of the search is a NamingEnumeration, which can be processed as it was in the Naming section. The output resembles Figure 5.6.
</P>
<P><A NAME="Fig6"></A><A HREF="images\05-06.jpg"><IMG SRC="images\05-06t.jpg"></A>
<BR><A HREF="images\05-06.jpg"><FONT COLOR="#000077"><B>Figure 5.6</B></FONT></A>&nbsp;&nbsp;Searching with attributes.</P>
<P>By setting values for these searches, you can look for all people who have an e-mail address and the Web site <A HREF="http://library.cs.tuiasi.ro/programming/java/developing_java_enterprise_app/ch05/www.pri.com">www.pri.com</A>. In the following code you will see that a value of <A HREF="http://library.cs.tuiasi.ro/programming/java/developing_java_enterprise_app/ch05/www.pri.com">www.pri.com</A> has been added to the construction of the Web site BasicAttribute. The attributes and their values affect the choice of objects that are retrieved as part of the search. An Attributes list can be reused. For example, you could update it to include new values and re-execute the search. In this way you could narrow a search by filling in more and more details, or widen a search by removing attributes from the Attributes collection.</P>
<PRE>
...
Hashtable env = new Hashtable(11);
env.put(Context.INITIAL_CONTEXT_FACTORY, 
            &#147;com.sun.jndi.ldap.LdapCtxFactory&#148;);
env.put(Context.PROVIDER_URL, &#147;ldap://MyHost/o=JNDIExample&#148;);
try 
{
   DirContext dctx = new InitialDirContext(env);
   
   Attributes attrs = new BasicAttributes(true); 
   attrs.put(new BasicAttribute(&#147;email&#148;));
   <B>attrs.put(new BasicAttribute(&#147;website&#148;,&#147;www.pri.com&#148;));</B>
   
   <B>NamingEnumeration result = dctx.search(&#147;ou=People&#148;, attrs);</B>
       
   while (result.hasMore())
         System.out.println(result.next());
...
</PRE>
<BLOCKQUOTE>
<P><FONT SIZE="-1"><HR><B>NOTE:&nbsp;&nbsp;</B>Updates to BasicAttributes such as removing an attribute do not affect the corresponding representation in the directory. Updates to the directory can be affected only using modification operations in the DirContext interface.
</FONT><HR>
</BLOCKQUOTE>
<P>The output will resemble Figure 5.7.
</P>
<P>A collection of attributes can be used to build a wide or narrow search criteria. Regardless of the directory service you are connected to, a collection of objects that represents matches for the search is returned. However, often you are not interested in getting back a collection of objects; rather, you would like only certain attributes from the objects. For example, you may want only the telephone numbers for all the customers rather than retrieving all the information you have on the customers. The next section will show you how to do this.</P>
<P><A NAME="Fig7"></A><A HREF="images\05-07.jpg"><IMG SRC="images\05-07t.jpg"></A>
<BR><A HREF="images\05-07.jpg"><FONT COLOR="#000077"><B>Figure 5.7</B></FONT></A>&nbsp;&nbsp;Results of fetching with attribute values.</P>
<P><FONT SIZE="+1"><B><I>Retrieving Specific Attributes</I></B></FONT></P>
<P>Another variation of the search method allows us to specify which attributes to fetch from the directory. In other words, rather than retrieving all attributes of all objects returned, we can specify specific attributes to be returned, thus optimizing the search. For instance, if we wanted to retrieve only the name and e-mail of each person in the last example, the code can be modified like this:
</P>
<PRE>
...
Hashtable env = new Hashtable(11);
env.put(Context.INITIAL_CONTEXT_FACTORY, 
            &#147;com.sun.jndi.ldap.LdapCtxFactory&#148;);
env.put(Context.PROVIDER_URL, &#147;ldap://MyHost/o=JNDIExample&#148;);
try 
{
     DirContext dctx = new InitialDirContext(env);
     
     <B>String[] attrIDs = {&#147;cn&#148;, &#147;email&#148;};</B>
     new BasicAttributes(true); 
     attrs.put(new BasicAttribute(&#147;email&#148;));
     attrs.put(new BasicAttribute(&#147;website&#148;,&#147;www.pri.com&#148;));
     
     NamingEnumeration result = 
         dctx.search(&#147;ou=People&#148;, attrs, <B>attrIDs</B> );
         
     while (result.hasMore())
        System.out.println(result.next());
...
</PRE>
<P>The output resembles Figure 5.8. Compare the results with Figure 5.7. In Figure 5.8, only the values specified in the attrIDs array were retrieved. In both cases, a set of objects that are stored in a NamingEnumeration were retrieved. The next section discusses how to process these objects.
</P>
<P><A NAME="Fig8"></A><A HREF="images\05-08.jpg"><IMG SRC="images\05-08t.jpg"></A>
<BR><A HREF="images\05-08.jpg"><FONT COLOR="#000077"><B>Figure 5.8</B></FONT></A>&nbsp;&nbsp;Results of fetching specific attributes.</P>
<P><FONT SIZE="+1"><B><I>Processing a Search Result</I></B></FONT></P>
<P>The result returned from these searches is actually a subclass of Bindings called a search result. Table 5.10 lists the SearchResult methods.
</P>
<TABLE WIDTH="90%"><TD CAPTION COLSPAN="2"><B>Table 5.10</B> SearchResult Methods
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TH WIDTH="35%" VALIGN="TOP" ALIGN="LEFT">Method 
<TH WIDTH="55%" VALIGN="TOP" ALIGN="LEFT">Use
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>SearchResult(String name, Object obj, Attributes attrs)</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">This constructor creates a search result with the non-null name of the search item relative to the context, the object (which can be null bound to the name), and the list of attributes to return from the search.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>SearchResult(String name, Object obj, Attributesattrs, boolean isRelative)</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">This constructor creates a search result with the non-null name of the search item, the object (which can be null bound to the name), and the list of attributes to return from the search. If isRelative is true, the name of the search item is relative to the context of the search. If isRelative is false, name is a complete URL.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>SearchResult(String name, String className, Object obj, Attributes attrs)</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">This constructor creates a search result with the non-null name of the search item relative to the context, the name of the class of the object bound to name, the object (which can be null bound to the name), and the list of attributes to return from the search. If className is null, the class name for obj is returned with getClassName(). If obj is null, getClassName() will return null.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>SearchResult(String name, String className, Object obj, Attributes attrs, boolean isRelative)</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">This constructor creates a search result with the non-null name of the search item, the name of the class of the object bound to name, the object (which can be null bound to the name), and the list of attributes to return from the search. If isRelative is true, the name of the search item is relative to the context of the search. If isRelative is false, name is a complete URL. If className is null, the class name for obj is returned with getClassName(). If obj is null, getClassName() will return null. 
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>Attributes getAttributes() </SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Returns the attributes of this search result.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>void setAttributes(Attributes attrs)</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Sets the attributes for this search result to attrs. 
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT"><SMALL>String toString()</SMALL>
<TD VALIGN="TOP" ALIGN="LEFT">Returns a string representation of this binding.
<TR>
<TD COLSPAN="2"><HR>
<TR>
</TABLE>
<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="05-09.html">Previous</A></TD>
<TD><A HREF="..\ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="05-11.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>





</BODY>
</HTML>

