<HTML>
<HEAD>


<TITLE>Developing Java Enterprise Applications:Using JNDI</TITLE>





<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="05-10.html">Previous</A></TD>
<TD><A HREF="..\ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="05-12.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P>Using a search result, you could you could use the following program to print the results:
</P>
<PRE>
import java.util.Hashtable;
import javax.naming.*;
<B>import javax.naming.directory.*;</B>

public class AttributeExample
{
    public static void main(String[] argc)
    {
        Hashtable env = new Hashtable(11);
        env.put(Context.INITIAL_CONTEXT_FACTORY,
             &#147;com.sun.jndi.ldap.LdapCtxFactory&#148;);
        
        // Replace MyHost with the host name of your LDAP server.
        env.put(Context.PROVIDER_URL,
            &#147;ldap://MyHost/o=JNDIExample&#148;);
        try
        {
            DirContext dctx = new InitialDirContext(env);

            Attributes attrs = new BasicAttributes(true);
            attrs.put(new BasicAttribute(&#147;email&#148;));
            attrs.put(new BasicAttribute(&#147;website&#148;,&#147;www.pri.com&#148;));

            <B>NamingEnumeration result =
              dctx.search(&#147;ou=People&#148;, attrs);</B>

            // Print each search result.
            while (result.hasMore())
            {
            <B>    SearchResult sr = (SearchResult)result.next();</B>
                System.out.println(&#147;Result = &#148; &#43; sr.getName());
            <B>    Attributes srchAttrs = sr.getAttributes();</B>

            <B>    NamingEnumeration attributes = srchAttrs.getAll();</B>

                // For each result, print the attributes.
            <B>    while(attributes.hasMore())
                {
                    Attribute attr = (Attribute)attributes.next();
                    System.out.println(&#147;Attribute: &#148; &#43;
                        attr.getID());
                    NamingEnumeration values = attr.getAll();

                    // Attributes can have multiple values
                    while(values.hasMore())
                    {
                        Object value = values.next();
                        System.out.println(&#147;Value = &#148; &#43; value);
                    }
                } 
            }</B>
        }catch(Exception e)
        {
            System.out.println(e);
        }
    }
}
</PRE>
<P>In this code listing, the directory package is imported, and then a context is initialized, as usual. Then the attributes are inserted in a BasicAttributes object and passed into the search method. The search method returns a NamingEnumeration containing a list of search results. Iterate through each search result, obtaining a list of attributes by calling the SearchResult method getAttributes. This method returns another NamingEnumeration containing a list of attributes associated with the current search result. An attribute can have more than one value associated with it, just as a person can have more than one home phone number, so we iterate through these by calling the Attribute method getAll, which returns yet another NamingEnumeration containing a list of values for this attribute. Each of these values is then printed. The output resembles Figure 5.9.
</P>
<P>The next section discusses how filters can be used to create even more robust searching criteria by using logical operators and other commands to create specific search criteria.</P>
<P><A NAME="Fig9"></A><A HREF="images\05-09.jpg"><IMG SRC="images\05-09t.jpg"></A>
<BR><A HREF="images\05-09.jpg"><FONT COLOR="#000077"><B>Figure 5.9</B></FONT></A>&nbsp;&nbsp;Processing SearchResults.</P>
<TABLE WIDTH="80%">
<TD CAPTION COLSPAN="2"><B>Table 5.11</B> Search Filter Symbols
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TH WIDTH="15%" VALIGN="TOP" ALIGN="LEFT">Symbol 
<TH WIDTH="65%" VALIGN="TOP" ALIGN="LEFT">Description 
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT">&amp 
<TD VALIGN="TOP" ALIGN="LEFT">Logical and. All items in the list must be true, as in (&amp(a=1)(b=2) ).
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT">| 
<TD VALIGN="TOP" ALIGN="LEFT">Logical or. One or more of the items must be true, as in (|(a=1)(b=2) ).
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT">! 
<TD VALIGN="TOP" ALIGN="LEFT">Not. The negated item must be false, as in (!(3=4)) is true.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT">= 
<TD VALIGN="TOP" ALIGN="LEFT">Checks for equality based on the matching rule of the attribute.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT">~= 
<TD VALIGN="TOP" ALIGN="LEFT">Checks for approximate equality based on the matching rule of the attribute.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT">&gt= 
<TD VALIGN="TOP" ALIGN="LEFT">Checks that the attribute is greater than the value.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT">&lt= 
<TD VALIGN="TOP" ALIGN="LEFT">Checks that the attribute is less than the value.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT">=* 
<TD VALIGN="TOP" ALIGN="LEFT">Checks for existence of the attribute.
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT">* 
<TD VALIGN="TOP" ALIGN="LEFT">In an equality test; represents a wildcard representing zero or more characters at that position, as in (name=Alb*).
<TR>
<TD COLSPAN="2"><HR>
<TR>
<TD VALIGN="TOP" ALIGN="LEFT">\
<TD VALIGN="TOP" ALIGN="LEFT">Used for escaping *, (, and ) inside an attribute value.
<TR>
<TD COLSPAN="2"><HR>
<TR>
</TABLE>
<P><FONT SIZE="+1"><B><I>Searching with Filters</I></B></FONT></P>
<P>The search methods of DirContext can take a filter string. The string follows the search expression patterns in RFC 2254. For example, to search for the person with <A HREF="http://library.cs.tuiasi.ro/programming/java/developing_java_enterprise_app/ch05/www.pri.com">www.pri.com</A> as a Web site and an e-mail address starting with &#147;kerry,&#148; you would use &#147;(&amp(email=kerry*)(website=<A HREF="http://library.cs.tuiasi.ro/programming/java/developing_java_enterprise_app/ch05/www.pri.com">www.pri.com</A>))&#148;.</P>
<P>Each item in the filter contains an attribute identifier and an attribute value or symbols representing the attribute value. Table 5.11 lists the expression symbols. In the example above, (website=<A HREF="http://library.cs.tuiasi.ro/programming/java/developing_java_enterprise_app/ch05/www.pri.com">www.pri.com</A>) would denote an attribute called website that must have the value <A HREF="http://library.cs.tuiasi.ro/programming/java/developing_java_enterprise_app/ch05/www.pri.com">www.pri.com</A>. The expression (email=kerry*) means that the attribute email must exist and have a value starting with kerry. It doesn&#146;t matter if the full e-mail address is kerry@pri.com, kerry@wiley.com, or some other value. To check if the object has an attribute called phone with any value, use the expression (phone=*). This means that phone attribute must exist, but its value does not matter.</P>
<P>Each set of attribute values must be enclosed in parentheses. Parenthetical attribute/value pairs can be combined using the logical operators in Table 5.11. To combine multiple operators, use parentheses. For example, to create a filter to find all people whose name began with the letter E or who have a phone number, an e-mail address, and a Web site, specify (|(cn=E*)(&amp(phone=*)(website=*))).</P>
<P>The following code list for a program called FilterExample returns a NamingEnumeration of people with a name beginning with E or having an account with more than $1,005 in it.</P>
<PRE>
import javax.naming.*;
import javax.naming.directory.*;
import java.util.Hashtable;

public class FilterExample
{
    public static void main(String[] argc)
    {
        Hashtable env = new Hashtable(11);

        env.put(Context.INITIAL_CONTEXT_FACTORY, 
            &#147;com.sun.jndi.ldap.LdapCtxFactory&#148;);
        env.put(Context.PROVIDER_URL,
            &#147;ldap://MyHost/o=JNDIExample&#148;);

        try 
        {
            DirContext dctx = new InitialDirContext(env);

<B>       String filter = &#147;(&amp(cn=E*)(account&gt1005))&#148;;

       NamingEnumeration result = 
           dctx.search(&#147;ou=People&#148;, filter, null);</B> 
    
       while (result.hasMore()) 
       {
           SearchResult sr = (SearchResult)result.next();
           System.out.println(&#147;Result = &#148; &#43; sr.getName());
       }
        }catch(NamingException e)
        {
      System.out.println(e);
        }
    }
}
</PRE>
<P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="05-10.html">Previous</A></TD>
<TD><A HREF="..\ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="05-12.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>





</BODY>
</HTML>

