<HTML>
<HEAD>


<TITLE>Developing Java Enterprise Applications:A JavaServer Page Online Store</TITLE>





<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="11-04.html">Previous</A></TD>
<TD><A HREF="..\ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="11-06.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<P><BR></P>
<P>At the bottom of doGet, the servlet sends a Web page back to the client. If there was an error message, it is returned; otherwise, the current list of items is sent back to the user. Because each item requires some processing, the internal method outputItem is called to create the HTML for each item in the cart. All of the output is formatted into an HTML table with a running total of the shopper&#146;s current purchases.
</P>
<PRE>
        out.println("&ltHTML&gt");
         out.println("&ltHEAD&gt");
        out.println("&ltTITLE&gt");
        out.println("Shopping Cart");
        out.println("&lt/TITLE&gt");
        out.println("&lt/HEAD&gt");
        out.println("&ltBODY TEXT=\"#000000\" BGCOLOR=\"#FFFFFF\"");
        out.println(" LINK=\"#FF0000\" VLINK=\"#800080\"&gt");
        out.println("&ltCENTER&gt");
        out.println("&ltTABLE WIDTH=500 BORDER=0&gt");
        out.println("&ltTR&gt");
        out.println("&ltTD&gt");
        
        if(errorMessage == null)
        {
            out.println("Your shopping cart contains"
                           &#43;" the following items:&ltBR&gt");
            out.println("&ltTABLE&gt");
            out.println("&ltTR&gt");
            out.println("&ltTH&gtDescription&lt/TH&gt");
            out.println("&ltTH&gtQuantity&lt/TH&gt");
            out.println("&ltTH&gtPrice&lt/TH&gt");
            out.println("&ltTH&gtTotal&lt/TH&gt");
            out.println("&ltTH&gt&lt/TH&gt");
            out.println("&lt/TR&gt");
            itemKeys = items.keys();
        
            while(itemKeys.hasMoreElements())
            {
                item = 
               (ShoppingCartItem) items.get(itemKeys.nextElement());
            
                outputItem(item,out,requestURL);
            
                total &#43;= item.getTotal();
            }
            
            out.println("&ltTR&gt");
            out.println("&ltTD&gt&lt/TD&gt");
            out.println("&ltTD&gt&lt/TD&gt");
            out.println("&ltTD&gt&ltB&gtTotal&lt/B&gt&lt/TD&gt");
            out.print("&ltTD&gt&ltB&gt");
            out.print(total);
            out.println("&lt/B&gt&lt/TD&gt");
            out.println("&ltTD&gt&lt/TD&gt");
            out.println("&lt/TR&gt");
            out.println("&lt/TABLE&gt");
        }
        else
        {
            out.println(errorMessage);
        }
        
        out.println("&lt/TD&gt");
        out.println("&lt/TR&gt");
        out.println("&lt/TABLE&gt");
        out.println("&lt/CENTER&gt");
        out.println("&lt/BODY&gt");
        out.println("&lt/HTML&gt");
        out.close();
    }
</PRE>
<P>The outputItem method creates a form for each item that provided a text field for changing the quantity and buttons for initiating an adjustment or deletion. Data that is read-only to the shopper, like the item description, is included as hidden items in the form so that it will be returned to the servlet. This method is called with the URL for the servlet as the act argument to define the action of this form.
</P>
<PRE>
    protected void outputItem(ShoppingCartItem item
                               ,PrintWriter out,String act)
    {
<B>        out.print(</B>"<B>&ltFORM ACTION=\</B>""<B>);
        out.print(act);
        out.println(</B>"<B>\</B>"<B> METHOD=\</B>"<B>GET\</B>"<B>&gt</B>"<B>);
</B>        out.println("&ltTR&gt");
        out.print("&ltTD&gt");
        out.print(item.desc);
        out.println("&lt/TD&gt");
<B>        out.print(</B>"<B>&ltTD&gt&ltINPUT TYPE=\</B>"<B>TEXT\</B>""<B>
                   &#43;</B>"<B> NAME=\</B>"<B>quantity\</B>"<B> VALUE=\</B>""<B>);
        out.print(item.quantity);
        out.println(</B>"<B>\</B>"<B> SIZE=3&gt&lt/TD&gt</B>"<B>);
</B>        out.print("&ltTD&gt");
        out.print(item.price);
        out.println("&lt/TD&gt");
        out.print("&ltTD&gt");
        out.print(item.getTotal());
        out.println("&lt/TD&gt");
        
        //Output the change form buttons and hidden fields.
        out.println("&ltTD&gt");
        
<B>        out.print(</B>"<B>&ltINPUT TYPE=\</B>"<B>HIDDEN\</B>"<B> NAME=\</B>"<B>item\</B>"<B> VALUE=\</B>""<B>);
        out.print(item.desc);
        out.println(</B>"<B>\</B>"<B>&gt</B>"<B>);
        out.print(</B>"<B>&ltINPUT TYPE=\</B>"<B>HIDDEN\</B>"<B> NAME=\</B>"<B>price\</B>"<B> VALUE=\</B>""<B>);
        out.print(item.price);
        out.println(</B>"<B>\</B>"<B>&gt</B>"<B>);
</B>        
        out.println("&ltINPUT TYPE=\"SUBMIT\""
                      &#43;" NAME=\"action\" VALUE=\"Adjust\"&gt");
        out.println("&ltINPUT TYPE=\"SUBMIT\""
                      &#43;" NAME=\"action\" VALUE=\"Delete\"&gt");
        
        out.println("&lt/TD&gt");
        
        out.println("&lt/TR&gt");
        
        out.println("&lt/FORM&gt");
    }
}
</PRE>
<P>This servlet also displays an error message if there is a problem with the request. You can see in the code that the forms used for each item include hidden fields that contain the information needed to create complete requests to the servlet.
</P>
<H4 ALIGN="LEFT"><A NAME="Heading6"></A><FONT COLOR="#000077">Using the Shopping Cart</FONT></H4>
<P>The other pages discussed thus far that access the shopping cart are the product pages. The product page pictured in Figure 11.6 displays information about a single book about JFC that is available at the store. This page shows how a form containing hidden fields can be used to access the cart and add an item to it.
</P><P><BR></P>
<CENTER>
<TABLE BORDER>
<TR>
<TD><A HREF="11-04.html">Previous</A></TD>
<TD><A HREF="..\ewtoc.html">Table of Contents</A></TD>
<TD><A HREF="11-06.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>





</BODY>
</HTML>

