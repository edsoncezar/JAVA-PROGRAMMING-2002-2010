<HTML>
<HEAD>
<TITLE>Implementation</TITLE>
</HEAD>
<BODY bgcolor="#FFFFFF">
 <img src="..\icons\cover75.gif" alt="Cover" align=right>
<b>Data Structures and Algorithms 
with Object-Oriented Design Patterns in Java</b><br>
<A NAME="tex2html6152" HREF="page345.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="..\icons\next_motif.gif"></A> <A NAME="tex2html6150" HREF="page343.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="..\icons\up_motif.gif"></A> <A NAME="tex2html6144" HREF="page343.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="..\icons\previous_motif.gif"></A> <A NAME="tex2html6154" HREF="page9.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="..\icons\contents_motif.gif"></A> <A NAME="tex2html6155" HREF="page618.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="..\icons\index_motif.gif"></A> <BR><HR>
<H3><A NAME="SECTION0011721000000000000000">Implementation</A></H3>
<P>
Insertion in a B-tree is a two-pass process.
The first pass moves down the tree from the root
in order to locate the leaf in which the insertion is to begin.
This part of the algorithm is quite similar to
the <tt>find</tt> method given in Program&nbsp;<A HREF="page336.html#progMWayTreed"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A>.
The second pass moves from the bottom of the tree back up to the root,
splitting nodes and inserting them further up the tree as needed.
Program&nbsp;<A HREF="page344.html#progBTreeb"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A> gives the code for the first (downward) pass
(<tt>insert</tt> method)
and the Program&nbsp;<A HREF="page344.html#progBTreec"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A> gives the code for the second (upward) pass
(<tt>insertPair</tt> method).
<P>
<P><A NAME="21966">&#160;</A><A NAME="progBTreeb">&#160;</A> <IMG WIDTH=575 HEIGHT=581 ALIGN=BOTTOM ALT="program21839" SRC="img1364.gif"  ><BR>
<STRONG>Program:</STRONG> <tt>BTree</tt> class <tt>insert</tt> method.<BR>
<P>
<P>
In the implementation shown,
the downward pass starts at the root node and descends the tree
until it arrives at an external node.
If the external node has no parent,
it must be the root and, therefore, the tree is empty.
In this case,
the root becomes an internal node containing a single key
and two empty subtrees (lines&nbsp;12-14).
Otherwise, we have arrived at an external node in a non-empty tree
and the second pass begins by calling <tt>insertPair</tt>
to insert the pair  <IMG WIDTH=35 HEIGHT=24 ALIGN=MIDDLE ALT="tex2html_wrap_inline64576" SRC="img1352.gif"  > in the parent.
<P>
The upward pass of the insertion algorithm is done by the
recursive <tt>insertPair</tt> method shown in Program&nbsp;<A HREF="page344.html#progBTreec"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A>.
The <tt>insertPair</tt> method takes two arguments.
The first, <tt>object</tt>, is a <tt>Comparable</tt> object
and the second, <tt>child</tt>, is a <tt>BTree</tt>.
It is assumed that all the keys in <tt>child</tt> are strictly greater than
<tt>object</tt>.
<P>
<P><A NAME="21968">&#160;</A><A NAME="progBTreec">&#160;</A> <IMG WIDTH=575 HEIGHT=810 ALIGN=BOTTOM ALT="program21858" SRC="img1365.gif"  ><BR>
<STRONG>Program:</STRONG> <tt>BTree</tt> class <tt>insertPair</tt> method.<BR>
<P>
<P>
The <tt>insertPair</tt> method calls <tt>findIndex</tt> to determine
the position in the array of keys
at which pair (<tt>object</tt>,<tt>child</tt>) should be inserted (line&nbsp;8).
If this node is full (line&nbsp;9),
the <tt>insertKey</tt> is called
to insert the given key at the specified position
in the <tt>key</tt> array (line&nbsp;11)
and <tt>insertSubtree</tt> is called
to insert the given tree at the specified position
in the <tt>subtree</tt> array (line&nbsp;12).
<P>
In the event that the node is full,
the <tt>insertKey</tt> method returns the key which falls off the right
end of the array.
This is assigned to <tt>extraKey</tt> (line&nbsp;17).
Similarly, the <tt>insertSubtree</tt>
method returns the tree which falls of the right
end of the array.
This is assigned to <tt>extraTree</tt> (line&nbsp;18).
<P>
The node has now overflowed and it is necessary to balance the B-tree.
If the node overflows and it is the root (line&nbsp;19),
then two new B-trees, <tt>left</tt> and <tt>right</tt> are created (lines&nbsp;21-22).
The first  <IMG WIDTH=71 HEIGHT=26 ALIGN=MIDDLE ALT="tex2html_wrap_inline64520" SRC="img1344.gif"  > keys and  <IMG WIDTH=43 HEIGHT=26 ALIGN=MIDDLE ALT="tex2html_wrap_inline64492" SRC="img1341.gif"  > subtrees of the
given node are moved to the <tt>left</tt> tree by the <tt>attachLeftHalfOf</tt>
method (line&nbsp;23);
and the last  <IMG WIDTH=112 HEIGHT=26 ALIGN=MIDDLE ALT="tex2html_wrap_inline64678" SRC="img1366.gif"  > keys
and  <IMG WIDTH=111 HEIGHT=26 ALIGN=MIDDLE ALT="tex2html_wrap_inline64680" SRC="img1367.gif"  > subtrees of
the given node are moved to the <tt>right</tt> tree
by the <tt>attachRightHalfOf</tt> method (line&nbsp;24).
Then, the pair (<tt>extraKey</tt>,<tt>extraTree</tt>) is inserted
into the <tt>right</tt> tree (line&nbsp;25).
<P>
The left-over key is the one in the middle of the array,
i.e.,  <IMG WIDTH=42 HEIGHT=23 ALIGN=MIDDLE ALT="tex2html_wrap_inline64616" SRC="img1360.gif"  >.
Finally, the root node is modified
so that it contains the two new subtrees
and the single left-over key (lines&nbsp;26-29).
<P>
If the node overflows and it is not the root,
then one new B-tree is created, <tt>right</tt> (line&nbsp;34).
The last  <IMG WIDTH=112 HEIGHT=26 ALIGN=MIDDLE ALT="tex2html_wrap_inline64678" SRC="img1366.gif"  > keys
and  <IMG WIDTH=111 HEIGHT=26 ALIGN=MIDDLE ALT="tex2html_wrap_inline64680" SRC="img1367.gif"  > subtrees of the
given node are moved to the <tt>left</tt> tree
by the <tt>attachRightHalfOf</tt> method (line&nbsp;35)
and the pair (<tt>extraKey</tt>,<tt>extraTree</tt>)
is inserted in the <tt>right</tt> tree (line&nbsp;36).
The first  <IMG WIDTH=71 HEIGHT=26 ALIGN=MIDDLE ALT="tex2html_wrap_inline64520" SRC="img1344.gif"  > keys and  <IMG WIDTH=43 HEIGHT=26 ALIGN=MIDDLE ALT="tex2html_wrap_inline64492" SRC="img1341.gif"  > subtrees of
the given node remain attached to it.
<P>
Finally, the <tt>insertPair</tt> method calls itself recursively
to insert the left-over key,  <IMG WIDTH=42 HEIGHT=23 ALIGN=MIDDLE ALT="tex2html_wrap_inline64616" SRC="img1360.gif"  >,
and the new B-tree, <tt>right</tt>, into the parent of this (line&nbsp;37).
This is the place where the <tt>parent</tt> field is needed!
<P>
<HR><A NAME="tex2html6152" HREF="page345.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="..\icons\next_motif.gif"></A> <A NAME="tex2html6150" HREF="page343.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="..\icons\up_motif.gif"></A> <A NAME="tex2html6144" HREF="page343.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="..\icons\previous_motif.gif"></A> <A NAME="tex2html6154" HREF="page9.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="..\icons\contents_motif.gif"></A> <A NAME="tex2html6155" HREF="page618.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="..\icons\index_motif.gif"></A> <P><ADDRESS>
<img src="..\icons\bruno.gif" alt="Bruno" align=right>
<a href="..\copyright.html">Copyright &#169; 1998</a> by <a href="..\signature.html">Bruno R. Preiss, P.Eng.</a>  All rights reserved.

</ADDRESS>
</BODY>
</HTML>
