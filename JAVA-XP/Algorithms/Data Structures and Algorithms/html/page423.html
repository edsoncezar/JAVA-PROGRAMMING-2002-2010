<HTML>
<HEAD>
<TITLE>Why Reference Counting Does Not Work</TITLE>
</HEAD>
<BODY bgcolor="#FFFFFF">
 <img src="..\icons\cover75.gif" alt="Cover" align=right>
<b>Data Structures and Algorithms 
with Object-Oriented Design Patterns in Java</b><br>
<A NAME="tex2html7124" HREF="page424.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="..\icons\next_motif.gif"></A> <A NAME="tex2html7122" HREF="page421.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="..\icons\up_motif.gif"></A> <A NAME="tex2html7118" HREF="page422.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="..\icons\previous_motif.gif"></A> <A NAME="tex2html7126" HREF="page9.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="..\icons\contents_motif.gif"></A> <A NAME="tex2html7127" HREF="page618.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="..\icons\index_motif.gif"></A> <BR><HR>
<H2><A NAME="SECTION0014220000000000000000">Why Reference Counting Does Not Work</A></H2>
<P>
So far, reference counting looks like a good idea.
However, the reference counting does not always work.
Consider a circular, singly-linked list
such as the one shown in Figure&nbsp;<A HREF="page423.html#figgarbage4"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A>&nbsp;(a).
In the figure, the variable <tt>head</tt> refers to the head of the linked list
and the last element of the linked list also refers to the head.
Therefore, the reference count on the first list element is two;
whereas, the remaining list elements all have a reference count of one.
<P>
<P><A NAME="30389">&#160;</A><A NAME="figgarbage4">&#160;</A> <IMG WIDTH=575 HEIGHT=223 ALIGN=BOTTOM ALT="figure30097" SRC="img1707.gif"  ><BR>
<STRONG>Figure:</STRONG> Why reference counting fails.<BR>
<P>
<P>
Consider what happens when we assign the value <tt>null</tt> to the
<tt>head</tt> variable.
This results in the situation shown in Figure&nbsp;<A HREF="page423.html#figgarbage4"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A>&nbsp;(b).
The reference count on the first list element has been decreased by one
because the <tt>head</tt> variable no longer refers to it.
However, its reference count is not zero,
because the tail of the list still refers to the head.
<P>
We now have a problem.
The reference counts on all the lists elements are non-zero.
Therefore, they are not considered to be garbage by a reference counting
garbage collector.
On the other hand,
no external references to the linked-list elements remain.
Therefore, the list elements are indeed garbage.
<P>
This example illustrates the Achilles' heel of reference counting--circular data structures.
In general, reference counting will fail to work whenever
the data structure contains a cycle of references.
Java does not prevent the creation of cyclic structures.
Therefore, reference counting by itself is not a suitable
garbage collection scheme for arbitrary objects.
Nevertheless, it is an extremely useful technique for dealing
with simple objects that don't refer to other objects,
such as <tt>Integer</tt>s and <tt>String</tt>s.
<P>
<HR><A NAME="tex2html7124" HREF="page424.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="..\icons\next_motif.gif"></A> <A NAME="tex2html7122" HREF="page421.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="..\icons\up_motif.gif"></A> <A NAME="tex2html7118" HREF="page422.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="..\icons\previous_motif.gif"></A> <A NAME="tex2html7126" HREF="page9.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="..\icons\contents_motif.gif"></A> <A NAME="tex2html7127" HREF="page618.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="..\icons\index_motif.gif"></A> <P><ADDRESS>
<img src="..\icons\bruno.gif" alt="Bruno" align=right>
<a href="..\copyright.html">Copyright &#169; 1998</a> by <a href="..\signature.html">Bruno R. Preiss, P.Eng.</a>  All rights reserved.

</ADDRESS>
</BODY>
</HTML>
