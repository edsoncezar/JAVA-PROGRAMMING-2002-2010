<HTML>
<HEAD>
<TITLE>Character String Keys</TITLE>
</HEAD>
<BODY bgcolor="#FFFFFF">
 <img src="..\icons\cover75.gif" alt="Cover" align=right>
<b>Data Structures and Algorithms 
with Object-Oriented Design Patterns in Java</b><br>
<A NAME="tex2html4613" HREF="page221.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="..\icons\next_motif.gif"></A> <A NAME="tex2html4611" HREF="page217.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="..\icons\up_motif.gif"></A> <A NAME="tex2html4605" HREF="page219.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="..\icons\previous_motif.gif"></A> <A NAME="tex2html4615" HREF="page9.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="..\icons\contents_motif.gif"></A> <A NAME="tex2html4616" HREF="page618.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="..\icons\index_motif.gif"></A> <BR><HR>
<H2><A NAME="SECTION009330000000000000000">Character String Keys</A></H2>
<P>
Strings of characters are represented in Java as instances
of the <tt>String</tt> class.
A character string is simply a sequence of characters.
Since such a sequence may be arbitrarily long,
to devise a suitable hash function
we must find a mapping from an unbounded domain
into the finite range of <tt>int</tt>.
<P>
We can view a character string, <I>s</I>,
as a sequence of <I>n</I> characters,
<P> <IMG WIDTH=312 HEIGHT=16 ALIGN=BOTTOM ALT="displaymath61548" SRC="img897.gif"  ><P>
where <I>n</I> is the length of the string.
(The length of a string can be determined by calling
the <tt>String</tt> method <tt>length</tt>).
One very simple way to hash such a string would be to simply
sum the numeric values associated with each character:
<P><A NAME="eqnhashingstring1">&#160;</A> <IMG WIDTH=500 HEIGHT=46 ALIGN=BOTTOM ALT="equation10709" SRC="img898.gif"  ><P>
As it turns out,
this is not a particularly good way to hash character strings.
Given that a Java <tt>char</tt> is a 16-bit quantity,
 <IMG WIDTH=110 HEIGHT=28 ALIGN=MIDDLE ALT="tex2html_wrap_inline61556" SRC="img899.gif"  >, for all  <IMG WIDTH=64 HEIGHT=25 ALIGN=MIDDLE ALT="tex2html_wrap_inline61558" SRC="img900.gif"  >.
As a result,  <IMG WIDTH=149 HEIGHT=25 ALIGN=MIDDLE ALT="tex2html_wrap_inline61560" SRC="img901.gif"  >.
For example,
given a string of length <I>n</I>=5,
the value of <I>f</I>(<I>s</I>) falls between zero and  <IMG WIDTH=49 HEIGHT=12 ALIGN=BOTTOM ALT="tex2html_wrap_inline61566" SRC="img902.gif"  >.
In fact, the situation is even worse,
in North America we typically use only
the <em>ASCII</em><A NAME=10718>&#160;</A> subset
of the <em>Unicode</em><A NAME=10720>&#160;</A> character set.
The ASCII character set uses only the least-significant seven bits
of a <tt>char</tt>.
If the string is comprised of only ASCII characters,
the result falls in the range between zero and 640.
<P>
Essentially the problem with a function <I>f</I> which produces a result
in a relatively small interval
is the situation which arises when that function is composed with
the function  <IMG WIDTH=116 HEIGHT=24 ALIGN=MIDDLE ALT="tex2html_wrap_inline61570" SRC="img903.gif"  >.
If the size of the range of the function <I>f</I> is less than <I>M</I>,
then  <IMG WIDTH=62 HEIGHT=22 ALIGN=MIDDLE ALT="tex2html_wrap_inline61464" SRC="img880.gif"  > does not spread its values uniformly
on the interval [0,<I>M</I>-1].
For example, if <I>M</I>=1031 only the first 640 values
(62% of the range) are used!
<P>
Alternatively,
suppose we have <em>a priori</em> knowledge
that character strings are limited to length <I>n</I>=4.
Then, we can construct an integer by concatenating
the binary representations of each of the characters.
For example, given  <IMG WIDTH=121 HEIGHT=24 ALIGN=MIDDLE ALT="tex2html_wrap_inline61584" SRC="img904.gif"  >,
we can construct an integer with the function
<P><A NAME="eqnhashingstring2">&#160;</A> <IMG WIDTH=500 HEIGHT=18 ALIGN=BOTTOM ALT="equation10723" SRC="img905.gif"  ><P>
where  <IMG WIDTH=48 HEIGHT=13 ALIGN=BOTTOM ALT="tex2html_wrap_inline61586" SRC="img906.gif"  >.
Since <I>B</I> is a power of two,
this function is easy to write in Java:
<PRE>static int f (String s)
{
    return s.charAt(0) &lt;&lt; 21 | s.charAt (1) &lt;&lt; 14
	| s.charAt (2) &lt;&lt; 7 | s.charAt (3);
}</PRE>
While this function certainly has a larger range,
it still has a problems--it cannot deal strings of arbitrary length.
<P>
Equation&nbsp;<A HREF="page220.html#eqnhashingstring2"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A> can be generalized to deal
with strings of arbitrary length as follows:
<P> <IMG WIDTH=500 HEIGHT=46 ALIGN=BOTTOM ALT="equation10727" SRC="img907.gif"  ><P>
This function produces a unique integer for every possible string.
Unfortunately, the range of <I>f</I>(<I>s</I>) is unbounded.
A simple modification of this algorithm suffices to bound the range:
<P><A NAME="eqnhashingstring3">&#160;</A> <IMG WIDTH=500 HEIGHT=48 ALIGN=BOTTOM ALT="equation10732" SRC="img908.gif"  ><P>
where  <IMG WIDTH=54 HEIGHT=12 ALIGN=BOTTOM ALT="tex2html_wrap_inline61190" SRC="img851.gif"  > such that <I>w</I> is word size of the machine.
Unfortunately, since <I>W</I> and <I>B</I> are both powers of two,
the value computed by this hash function depends only on
the last <I>W</I>/<I>B</I> characters in the character string.
For example, for  <IMG WIDTH=58 HEIGHT=13 ALIGN=BOTTOM ALT="tex2html_wrap_inline61292" SRC="img861.gif"  > and  <IMG WIDTH=48 HEIGHT=13 ALIGN=BOTTOM ALT="tex2html_wrap_inline61586" SRC="img906.gif"  >,
this result depends only on the last five characters in the string--all character strings having exactly the same last five characters collide!
<P>
Writing the code to compute Equation&nbsp;<A HREF="page220.html#eqnhashingstring3"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A> is actually
quite straightforward if we realize that <I>f</I>(<I>s</I>)
can be viewed as a polynomial in <I>B</I>,
the coefficients of which are  <IMG WIDTH=13 HEIGHT=15 ALIGN=MIDDLE ALT="tex2html_wrap_inline61610" SRC="img909.gif"  >,  <IMG WIDTH=12 HEIGHT=15 ALIGN=MIDDLE ALT="tex2html_wrap_inline61612" SRC="img910.gif"  >, ...,  <IMG WIDTH=13 HEIGHT=15 ALIGN=MIDDLE ALT="tex2html_wrap_inline61614" SRC="img911.gif"  >.
Therefore, we can use <em>Horner's rule</em><A NAME=10741>&#160;</A>
(see Section&nbsp;<A HREF="page41.html#secmodelhorner"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A>) to compute <I>f</I>(<I>s</I>) as follows:
<PRE>static int f (String s)
{
    int result = 0;
    for (int i = 0; i &lt; s.length (); ++i)
	result = result * B + s.charAt (i);
    return result;
}</PRE>
This implementation can be simplified even further if we make
use of the fact that  <IMG WIDTH=47 HEIGHT=13 ALIGN=BOTTOM ALT="tex2html_wrap_inline61618" SRC="img912.gif"  >, where <I>b</I>=7.
Since <I>B</I> is a power of two,
in order to multiply the variable <tt>result</tt> by <I>B</I>
all we need to do is to shift it left by <I>b</I> bits.
Furthermore, having just shifted <tt>result</tt> left by <I>b</I> bits,
we know that the least significant <I>b</I> bits of the result are zero.
And since each character has no more than <I>b</I>=7 bits,
we can replace the addition operation
with an <em>exclusive or</em><A NAME=10746>&#160;</A> operation.
<PRE>static int f (String s)
{
    int result = 0;
    for (int i = 0; i &lt; s.length () ; ++i)
	result = result &lt;&lt; b ^ s.charAt (i);
    return result;
}</PRE>
<P>
Of the 128 characters in the 7-bit ASCII character set,
only 97 characters are printing characters
including the space, tab, and newline characters
(see Appendix&nbsp;<A HREF="page616.html#appcharcode"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A>).
The remaining characters are control characters which,
depending on the application,
rarely occur in strings.
Furthermore, if we assume that letters and digits
are the most common characters in strings,
then only 62 of the 128 ASCII codes are used frequently.
Notice, the letters (both upper and lower case)
all fall between  <IMG WIDTH=39 HEIGHT=21 ALIGN=MIDDLE ALT="tex2html_wrap_inline61634" SRC="img913.gif"  > and  <IMG WIDTH=38 HEIGHT=21 ALIGN=MIDDLE ALT="tex2html_wrap_inline61636" SRC="img914.gif"  >.
All the information is in the least significant six bits.
Similarly, the digits fall between  <IMG WIDTH=30 HEIGHT=21 ALIGN=MIDDLE ALT="tex2html_wrap_inline61638" SRC="img915.gif"  > and  <IMG WIDTH=30 HEIGHT=21 ALIGN=MIDDLE ALT="tex2html_wrap_inline61640" SRC="img916.gif"  >--these differ in the least significant four bits.
These observations suggest that using  <IMG WIDTH=49 HEIGHT=12 ALIGN=BOTTOM ALT="tex2html_wrap_inline61642" SRC="img917.gif"  > should work well.
That is, for  <IMG WIDTH=58 HEIGHT=13 ALIGN=BOTTOM ALT="tex2html_wrap_inline61292" SRC="img861.gif"  >, the hash value depends on the last five characters
plus two bits of the sixth-last character.
<P>
We have developed a hashing scheme which works quite well
given strings which differ in the trailing letters.
For example, the strings <tt>&quot;temp1&quot;</tt>, <tt>&quot;temp2&quot;</tt>, and <tt>&quot;temp3&quot;</tt>,
all produce different hash values.
However, in certain applications the strings differ in the leading letters.
For example, the two <em>Internet domain names</em><A NAME=10757>&#160;</A>
<tt>&quot;ece.uwaterloo.ca&quot;</tt> and <tt>&quot;cs.uwaterloo.ca&quot;</tt> collide
when using Equation&nbsp;<A HREF="page220.html#eqnhashingstring3"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A>.
Essentially, the effect of the characters that differ is lost
because the corresponding bits have been shifted out of the hash value.
<P>
<P><A NAME="10981">&#160;</A><A NAME="progStrb">&#160;</A> <IMG WIDTH=575 HEIGHT=351 ALIGN=BOTTOM ALT="program10761" SRC="img918.gif"  ><BR>
<STRONG>Program:</STRONG> <tt>Str</tt> class <tt>hashCode</tt> method.<BR>
<P>
<P>
This suggests a final modification
which shown in Program&nbsp;<A HREF="page220.html#progStrb"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A>.
Instead of losing the <I>b</I>=6 most significant bits
when the variable <tt>result</tt> is shifted left,
we retain those bits and <em>exclusive or</em><A NAME=10773>&#160;</A> them back into
the shifted <tt>result</tt> variable.
Using this approach,
the two strings <tt>&quot;ece.uwaterloo.ca&quot;</tt> and <tt>&quot;cs.uwaterloo.ca&quot;</tt>
produce different hash values.
<P>
Table&nbsp;<A HREF="page220.html#tblhashingwords"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A> lists a number of different
character strings together with the hash values obtained
using Program&nbsp;<A HREF="page220.html#progStrb"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A>.
For example, to hash the string <tt>&quot;fyra&quot;</tt>,
the following computation is performed
(all numbers in octal):
<DIV ALIGN=CENTER><P ALIGN=CENTER><TABLE COLS=11 BORDER RULES=GROUPS>
<COL ALIGN=CENTER><COL ALIGN=CENTER><COL ALIGN=CENTER><COL ALIGN=CENTER><COL ALIGN=CENTER><COL ALIGN=CENTER><COL ALIGN=CENTER><COL ALIGN=CENTER><COL ALIGN=CENTER><COL ALIGN=CENTER><COL ALIGN=CENTER>
<TBODY>
<TR><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>
            </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>1</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>4</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>6</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP><code>f</code></TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> 
     <IMG WIDTH=10 HEIGHT=20 ALIGN=MIDDLE ALT="tex2html_wrap_inline61648" SRC="img919.gif"  ></TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>1</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>7</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>1</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP><code>y</code></TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> 
     <IMG WIDTH=10 HEIGHT=20 ALIGN=MIDDLE ALT="tex2html_wrap_inline61648" SRC="img919.gif"  ></TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>1</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>6</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>2</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP><code>r</code></TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> 
     <IMG WIDTH=10 HEIGHT=20 ALIGN=MIDDLE ALT="tex2html_wrap_inline61648" SRC="img919.gif"  ></TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP> </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>1</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>4</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>1</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP><code>a</code></TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>
<P>
            </TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>1</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>4</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>7</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>7</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>0</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>6</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>3</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>4</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP>1</TD><TD VALIGN=BASELINE ALIGN=CENTER NOWRAP></TD></TR>
</TBODY>
</TABLE>
</P></DIV>
<P>
<P><A NAME="10983">&#160;</A>
<P>
    <A NAME="tblhashingwords">&#160;</A>
    <DIV ALIGN=CENTER><P ALIGN=CENTER><TABLE COLS=2 BORDER FRAME=HSIDES RULES=GROUPS>
<COL ALIGN=LEFT><COL ALIGN=RIGHT>
<TBODY>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP>
	    <I>x</I> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>Hash(<I>x</I>)</tt> (octal) </TD></TR>
</TBODY><TBODY>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP><tt>&quot;ett&quot;</tt> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>01446564</tt> </TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP> 
	    <tt>&quot;tv&#229;&quot;</tt> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>01656545</tt> </TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP> 
	    <tt>&quot;tre&quot;</tt> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>01656345</tt> </TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP> 
	    <tt>&quot;fyra&quot;</tt> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>0147706341</tt> </TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP> 
	    <tt>&quot;fem&quot;</tt> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>01474455</tt> </TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP> 
	    <tt>&quot;sex&quot;</tt> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>01624470</tt> </TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP> 
	    <tt>&quot;sju&quot;</tt> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>01625365</tt> </TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP> 
	    <tt>&quot;&#229;tta&quot;</tt> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>0344656541</tt> </TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP> 
	    <tt>&quot;nio&quot;</tt> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>01575057</tt> </TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP> 
	    <tt>&quot;tio&quot;</tt> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>01655057</tt> </TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP> 
	    <tt>&quot;elva&quot;</tt> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>044556741</tt> </TD></TR>
<TR><TD VALIGN=BASELINE ALIGN=LEFT NOWRAP> 
	    <tt>&quot;tolv&quot;</tt> </TD><TD VALIGN=BASELINE ALIGN=RIGHT NOWRAP> <tt>065565566</tt> </TD></TR>
</TBODY>
<CAPTION ALIGN=BOTTOM><STRONG>Table:</STRONG> Sample character string keys and the hash values obtained using
	Program&nbsp;<A HREF="page220.html#progStrb"><IMG  ALIGN=BOTTOM ALT="gif" SRC="..\icons\cross_ref_motif.gif"></A>.</CAPTION></TABLE>
</P></DIV><P><HR><A NAME="tex2html4613" HREF="page221.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="..\icons\next_motif.gif"></A> <A NAME="tex2html4611" HREF="page217.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="..\icons\up_motif.gif"></A> <A NAME="tex2html4605" HREF="page219.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="..\icons\previous_motif.gif"></A> <A NAME="tex2html4615" HREF="page9.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="..\icons\contents_motif.gif"></A> <A NAME="tex2html4616" HREF="page618.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="..\icons\index_motif.gif"></A> <P><ADDRESS>
<img src="..\icons\bruno.gif" alt="Bruno" align=right>
<a href="..\copyright.html">Copyright &#169; 1998</a> by <a href="..\signature.html">Bruno R. Preiss, P.Eng.</a>  All rights reserved.

</ADDRESS>
</BODY>
</HTML>
