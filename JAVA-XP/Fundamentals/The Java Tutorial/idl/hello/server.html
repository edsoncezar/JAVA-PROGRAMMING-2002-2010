


















<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<title>Developing the Hello World Server</title>
</head>
<body BGCOLOR="#ffffff">










<table width="100%">
<tr>
<td align=left>
<a href="client.html"><img src="http://docs.rinet.ru/Jtuta/images/PreviousArrow.gif" width=26 height=26 align=bottom border=0 alt="Previous | "></a><a
href="compiling.html"><img src="http://docs.rinet.ru/Jtuta/images/NextArrow.gif" width=26 height=26 align=bottom border=0 alt="Next | "></a><a
href="..\..\trailmap.html"><img src="http://docs.rinet.ru/Jtuta/images/WayUpArrow.gif" width=26 height=26 align=bottom border=0 alt="Trail Map | "></a><a
href="..\index.html"><img src="http://docs.rinet.ru/Jtuta/images/security1_2Header.gif" width=26 height=26 align=bottom border=0 alt="IDL | "></a>
</td>
<td align=right>
<a href="index.html"><strong><em>The Hello Client Server Example</em></strong></a>
</td>
</tr>
</table>
<p>
<center>
<IMG SRC="http://docs.rinet.ru/Jtuta/images/shoeline2.GIF" ALIGN="BOTTOM" BORDER="0" WIDTH="202"
    HEIGHT="25" NATURALSIZEFLAG="3">
<IMG SRC="http://docs.rinet.ru/Jtuta/images/shoeline2.GIF" ALIGN="BOTTOM" BORDER="0" WIDTH="202"
    HEIGHT="25" NATURALSIZEFLAG="3">
</center>
<p> 

<h2>
    Developing the Hello World Server
</h2>
<p>
<blockquote>

This  lesson introduces the basics of writing a CORBA transient server.
Here's the complete version of
<a href="http://docs.rinet.ru/Jtuta/idl/hello/example-1dot2/HelloServer.java">
<CODE CLASS="UnderlineCODE">HelloServer.java</CODE></a>.

<H4>Performing Basic Setup</H4>
<blockquote>
The structure of a CORBA server program is the same as most Java
applications: You import required library packages, declare the server
class, define a <CODE>main</CODE> method,
and remember to handle any exceptions.

<h4>Importing Required Packages</h4>
Start your text editor and save a new file titled
<CODE>HelloServer.java</CODE>.
Next, import the packages required for the client class:
<blockquote>
<PRE>
// The package containing our stubs.
import HelloApp.*;
// HelloServer will use the naming service.
import org.omg.CosNaming.*;
// The package containing special exceptions thrown by the name // service.
import org.omg.CosNaming.NamingContextPackage.*;
// All CORBA applications need these classes.
import org.omg.CORBA.*;
</PRE>
</blockquote>

<h4>Declaring the Server Class</h4>
Declare the server class:
<blockquote>
<PRE>
public class HelloServer {
    // Add the main method here in the next step.
}
</PRE>
</blockquote>

<h4>Defining the main Method</h4>
Declare a standard <CODE>main</CODE> method:
<blockquote>
<PRE>
public static void main(String args[]) {
    // Add the try-catch block here in the next step.
}
</PRE>
</blockquote>

<h4>Handling CORBA System Exceptions</h4>
Because all CORBA programs can throw CORBA system exceptions at
runtime, you will place all of the <CODE>main</CODE>
functionality within a <CODE>try-catch</CODE> block.
CORBA programs throw runtime exceptions whenever trouble occurs during
any of the processes (marshaling, unmarshaling, upcall) involved in
invocation. The exception handler simply prints the exception and its
stack trace to standard output so you can see what kind of thing has
gone wrong.
<P>
Inside <CODE>main</CODE>, set up a <CODE>try-catch</CODE> block:
<blockquote>
<PRE>
try {
    // Add the rest of the HelloServer code here.
} catch(Exception e) {
    System.err.println(&quot;ERROR: &quot; + e);
    e.printStackTrace(System.out);
}
</PRE>
</blockquote>

<h4>Creating an ORB Object</h4>
Just like a client, a CORBA server also needs a local ORB object. Every
server instantiates an ORB and registers its servant objects so that
the ORB can find the server when it receives an invocation for it.
<P>
Inside <CODE>HelloServer.java</CODE>'s <CODE>try-catch</CODE>
block, declare and initialize an ORB variable:
<blockquote>
<PRE>
ORB orb = ORB.init(args, null);
</PRE>
</blockquote>
<P>
The call to the ORB's <CODE>init</CODE>
method passes in the server's command line arguments,
allowing you to set certain properties at runtime.
</blockquote>

<H4>Managing the Servant Object</H4>
<blockquote>
A server is a process that instantiates one or more servant objects.
The servant implements the interface generated by <CODE>idltojava</CODE>
and actually performs the work of the operations on that interface.
Our <CODE> HelloServer</CODE> needs a <CODE>HelloServant</CODE>.

<h4>Instantiating the Servant Object</h4>
Inside the <CODE>try-catch</CODE> block,
just below the call to <CODE>init</CODE>,
instantiate the servant object:
<blockquote>
<PRE>
HelloServant helloRef = new HelloServant();
</PRE>
</blockquote>
<P>
This servant class isn't defined yet; you will do that in a later step.
Next, connect the servant to the ORB, so that the ORB can recognize
invocations on it and pass them along to the correct servant:
<blockquote>
<PRE>
orb.connect(helloRef);
</PRE>
</blockquote>

<h4>Defining the Servant Class</h4>
At the end of <CODE>HelloServer.java</CODE>,
outside the <CODE>HelloServer </CODE>
class, define the class for the servant object.
<OL>
<LI> Declare the servant class:
<blockquote>
<PRE>
class HelloServant extends _HelloImplBase {
    // Add the sayHello method here in the next step.
}
</PRE>
</blockquote>

<LI> The servant is a subclass of <CODE>_HelloImplBase</CODE>
     so that it inherits the general CORBA functionality generated for
     it by the compiler.
<LI> Declare the required <CODE>sayHello</CODE> method:
<blockquote>
<PRE>
public String sayHello() {
    // Add the method implementation here in the next step.
}
</PRE>
</blockquote>
<LI>Write the <CODE>sayHello</CODE> implementation:
<blockquote>
<PRE>
return &quot;\nHello World!!\n&quot;;
</PRE>
</blockquote>
</ol>
</blockquote>

<H4>Working with COS Naming</H4>
<blockquote>
The <CODE>HelloServer</CODE>
works with the naming service to make the servant object's operations
available to clients. The server needs an object reference to the name
service, so that it can register itself and ensure that invocations on
the Hello interface are routed to its servant object.

<h4>Obtaining the Initial Naming Context</h4>
In the <CODE>try-catch</CODE> block,
below instantiation of the servant, call
<CODE>orb.resolve_initial_references</CODE>
to get an object reference to the name server:
<blockquote>
<PRE>
org.omg.CORBA.Object objRef = orb.resolve_initial_references(&quot;NameService&quot;);
</PRE>
</blockquote>
<P>
The string <CODE>NameService</CODE>
is defined for all CORBA ORBs. When you pass in that string, the ORB
returns a naming context object that is an object reference for the
name service.

<h4>Narrowing the Object Reference</h4>
As with all CORBA object references, <CODE>objRef</CODE>
is a generic CORBA object. To use it as a <CODE>NamingContext</CODE>
object, you must narrow it to its proper type.
Add the call to <CODE>narrow</CODE>
just below the previous statement:
<blockquote>
<PRE>
NamingContext ncRef = NamingContextHelper.narrow(objRef);
</PRE>
</blockquote>
<P>
Here you see the use of an <CODE>idltojava</CODE>
-generated helper class, similar in function to <CODE>HelloHelper</CODE>.
The <CODE>ncRef</CODE> object is now an
<CODE>org.omg.CosNaming.NamingContext</CODE>
 and you can use it to access the naming service and register the
 server. You will do that in the next step.

<h4>Registering the Servant with the Name Server</h4>
<OL>
<LI> Just below the call to <CODE>narrow</CODE>,
     create a new <CODE>NameComponent</CODE> member:
<blockquote>
<PRE>
NameComponent nc = new NameComponent(&quot;Hello&quot;, &quot;&quot;);
</PRE>
</blockquote>

<LI> This statement sets the <CODE>id</CODE> field of <CODE>nc</CODE>,
     the new <CODE>NameComponent</CODE>,
     to &quot;Hello&quot; and the <CODE>kind</CODE>
     component to the empty string. Because the path to the
     <CODE>Hello</CODE> has a single element,
     create the single-element array that <CODE>NamingContext.resolve</CODE>
     requires for its work:
<blockquote>
<PRE>
NameComponent path[] = {nc};
</PRE>
</blockquote>
<LI>Finally, pass <CODE>path</CODE>
and the servant object to the naming service,
binding the servant object to the &quot;Hello&quot; id:
<blockquote>
<PRE>
ncRef.rebind(path, helloRef);
</PRE>
</blockquote>
</OL>
Now, when the client calls <CODE>resolve(&quot;Hello&quot;)</CODE>
on the initial naming context, the naming service returns an object
reference to the <CODE>Hello </CODE>servant.
</blockquote>

<H4>Waiting for Invocation</H4>
<blockquote>
The server is ready; it simply needs to wait around for a client to
request its service. To achieve that, enter the following code at the
end of (but within) the <CODE>try-catch</CODE> block:
<blockquote>
<PRE>
java.lang.Object sync = new java.lang.Object();
synchronized(sync) {
		sync.wait();
}
</PRE>
</blockquote>
<P>
This form of <CODE>Object.wait</CODE> requires <CODE>HelloServer</CODE>
to remain alive (though quiescent) until an invocation comes from the
ORB. Because of its placement in <CODE>main</CODE>,
after an invocation completes and <CODE>sayHello </CODE>
returns, the server will wait again.
</blockquote>

</blockquote>
<p>
<hr size=4>
<p> 
<table width="100%">
<tr>
<td align=left>
<a href="client.html"><img src="http://docs.rinet.ru/Jtuta/images/PreviousArrow.gif" width=26 height=26 align=top border=0 alt="Previous | "></a><a
href="compiling.html"><img src="http://docs.rinet.ru/Jtuta/images/NextArrow.gif" width=26 height=26 align=top border=0 alt="Next | "></a><a
href="..\..\trailmap.html"><img src="http://docs.rinet.ru/Jtuta/images/WayUpArrow.gif" width=26 height=26 align=top border=0 alt="Trail Map | "></a><a
href="..\index.html"><img src="http://docs.rinet.ru/Jtuta/images/security1_2Header.gif" width=26 height=26 align=top border=0 alt="IDL | "></a>
</td>
<td align=right>
<a href="index.html"><strong><em>The Hello Client Server Example</em></strong></a>
</td>
</tr>
</table>
</body>
</html>
