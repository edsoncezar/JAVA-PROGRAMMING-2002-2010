




















<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<title>Handling Plurals</title>
</head>
<body BGCOLOR="#ffffff">










<table width="100%">
<tr>
<td align=left>
<a href="messageformat.html"><img src="http://docs.rinet.ru/Jtuta/images/PreviousArrow.gif" width=26 height=26 align=bottom border=0 alt="Previous | "></a><a
href="..\text\index.html"><img src="http://docs.rinet.ru/Jtuta/images/NextArrow.gif" width=26 height=26 align=bottom border=0 alt="Next | "></a><a
href="..\..\trailmap.html"><img src="http://docs.rinet.ru/Jtuta/images/WayUpArrow.gif" width=26 height=26 align=bottom border=0 alt="Trail Map | "></a><a
href="..\index.html"><img src="http://docs.rinet.ru/Jtuta/images/internat.GIF" width=26 height=26 align=bottom border=0 alt="Internationalization | "></a>
</td>
<td align=right>
<a href="index.html"><strong><em>Formatting</em></strong></a>
</td>
</tr>
</table>
<p>
<center>
<IMG SRC="http://docs.rinet.ru/Jtuta/images/shoeline2.GIF" ALIGN="BOTTOM" BORDER="0" WIDTH="202"
    HEIGHT="25" NATURALSIZEFLAG="3">
<IMG SRC="http://docs.rinet.ru/Jtuta/images/shoeline2.GIF" ALIGN="BOTTOM" BORDER="0" WIDTH="202"
    HEIGHT="25" NATURALSIZEFLAG="3">
</center>
<p> 

<h2>
    Handling Plurals
</h2>
<p>
<blockquote>

The words in a message may vary if both plural and singular word forms
are possible. With the <CODE>ChoiceFormat</CODE> class, you can map a
number to a word or a phrase, allowing you to construct grammatically
correct messages.
<P>
In English the plural and singular forms of a word are usually
different. This can present a problem when you are constructing
messages that refer to quantities. For example, if your message reports
the number of files on a disk, the following variations are possible:
<blockquote>
<pre>
There are no files on XDisk.
There is one file on XDisk.
There are 2 files on XDisk.
</PRE>
</blockquote>
<P>
The fastest way to solve this problem is to create a
<CODE>MessageFormat</CODE> pattern like this:
<blockquote>
<pre>
There are {0,number} file(s) on {1}.
</PRE>
</blockquote>
<P>
Unfortunately the preceding pattern results in incorrect grammar: 
<blockquote>
<pre>
There are 1 file(s) on XDisk.
</PRE>
</blockquote>
<P>
You can do better than that, provided that you use the
<a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.text.ChoiceFormat.html"><code>ChoiceFormat</code></a><a target="_top" href="http://java.sun.com/products/jdk/1.1/api/java.text.ChoiceFormat.html"><img src="http://docs.rinet.ru/Jtuta/images/apiIcon.gif" width=20 height=20 border=0 alt="(in the API reference documentation)"></a>
 class.
In this section you'll learn how to deal with plurals in a message by
stepping through a sample program called
<a href="http://docs.rinet.ru/Jtuta/i18n/format/example-1dot1/ChoiceFormatDemo.java"><code>ChoiceFormatDemo</code></a>.
This program also uses the <CODE>MessageFormat</CODE> class, which is
discussed in the previous section, <A HREF="messageformat.html">Dealing
with Compound Messages</A>.

<a name="step1">
<H4>1. Define the Message Pattern</H4>
</a>
<blockquote>
First, identify the variables in the message: 

<blockquote><IMG SRC="http://docs.rinet.ru/Jtuta/figures/i18n/i18n-3.gif" WIDTH="227" HEIGHT="114" ALIGN="BOTTOM" NATURALSIZEFLAG="3" ALT=""></blockquote>
<P>
Next, replace the variables in the message with arguments, creating a
pattern that can be applied to a <CODE>MessageFormat</CODE> object: 
<blockquote>
<pre>
There {0} on {1}.
</PRE>
</blockquote>
<P>
The argument for the disk name, which is represented by<CODE>{1}</CODE>,
is easy enough to deal with. You just treat it like any other
<CODE>String</CODE> variable in a <CODE>MessageFormat</CODE> pattern.
This argument matches the element at index 1 in the array of argument
values. (See <a href="#step7">step 7</a>.)
<P>
Dealing with argument<CODE>{0}</CODE> is more complex, for a couple of reasons: 
<UL>
<LI> The phrase that this argument replaces varies with the number of
files. To construct this phrase at run time, you need to map the number
of files to a particular <CODE>String</CODE>. For example, the number 1
will map to the <CODE>String</CODE> containing the phrase <CODE>is one
file</CODE>. The <CODE>ChoiceFormat</CODE> class allows you to perform
the necessary mapping.
<LI> If the disk contains multiple files, the phrase includes an
integer. The <CODE>MessageFormat</CODE> class lets you insert a number
into a phrase.
</UL>
</blockquote>

<H4> 2. Create a ResourceBundle</H4>
<blockquote>
Because the message text must be translated, isolate it in a
<CODE>ResourceBundle</CODE>:
<blockquote>
<pre>
ResourceBundle bundle =
   ResourceBundle.getBundle(&quot;ChoiceBundle&quot;, currentLocale);
</PRE>
</blockquote>
<P>
The sample program backs the <CODE>ResourceBundle</CODE> with
properties files. The
<a href="example-1dot1\choicebundle_en_us.properties">
<CODE>ChoiceBundle_en_US.properties</CODE></a> file
contains the following lines:
<blockquote>
<pre>
pattern = There {0} on {1}.
noFiles = are no files
oneFile = is one file
multipleFiles = are {2} files
</PRE>
</blockquote>
<P>
The contents of this properties file show how the message will be
constructed and formatted. The first line contains the pattern for
<CODE>MessageFormat</CODE> . (See <a href="#step1">step 1</a>.) The other lines contain
phrases that will replace argument <CODE>{0}</CODE> in the pattern. The
phrase for the <CODE>multipleFiles</CODE> key contains the argument
<CODE>{2}</CODE>, which will be replaced by a number.
<P>
Here is the French version of the properties file,
<a href="example-1dot1\choicebundle_fr_fr.properties">
<CODE>ChoiceBundle_fr_FR.properties</CODE></a>: 
<blockquote>
<pre>
pattern = Il {0} sur {1}.
noFiles = n'y a pas des fichiers
oneFile = y a un fichier
multipleFiles = y a {2} fichiers
</PRE>
</blockquote>
</blockquote>

<H4> 3. Create a Message Formatter</H4>
<blockquote>
In this step you instantiate <CODE>MessageFormat</CODE> and set its
<CODE>Locale</CODE>:
<blockquote>
<pre>
MessageFormat messageForm = new MessageFormat(&quot;&quot;);
messageForm.setLocale(currentLocale);
</PRE>
</blockquote>
</blockquote>

<H4> 4. Create a Choice Formatter</H4>
<blockquote>
The <CODE>ChoiceFormat</CODE> object allows you to choose, based on a
<CODE>double </CODE> number, a particular <CODE>String</CODE>. The
range of <CODE>double</CODE> numbers, and the <CODE>String</CODE>
objects to which they map, are specified in arrays:
<blockquote>
<pre>
double[] fileLimits = {0,1,2};
String [] fileStrings = {
    bundle.getString(&quot;noFiles&quot;),
    bundle.getString(&quot;oneFile&quot;),
    bundle.getString(&quot;multipleFiles&quot;)
};
</PRE>
</blockquote>
<P>
<CODE>ChoiceFormat</CODE> maps each element in the <CODE>double</CODE>
array to the element in the <CODE>String</CODE> array that has the same
index. In the sample code the 0 maps to the <CODE>String</CODE>
returned by calling <CODE>bundle.getString(&quot;noFiles&quot;)</CODE>.
By coincidence the index is the same as the value in the
<CODE>fileLimits</CODE> array. If the code had set
<CODE>fileLimits[0]</CODE> to seven, <CODE>ChoiceFormat</CODE> would
map the number 7 to <CODE>fileStrings[0]</CODE>.
<P>
You specify the <CODE>double</CODE> and <CODE>String</CODE> arrays when
instantiating <CODE>ChoiceFormat</CODE>:
<blockquote>
<pre>
ChoiceFormat choiceForm = new ChoiceFormat(fileLimits, fileStrings);
</PRE>
</blockquote>
</blockquote>

<H4> 4. Apply the Pattern</H5>
<blockquote>
Remember the pattern you constructed in step 1? It's time to retrieve
the pattern from the <CODE>ResourceBundle</CODE> and apply it to the
<CODE>MessageFormat </CODE> object:
<blockquote>
<pre>
String pattern = bundle.getString(&quot;pattern&quot;);
messageForm.applyPattern(pattern);
</PRE>
</blockquote>
</blockquote>

<H4> 6. Assign the Formats</H4>
<blockquote>
In this step you assign to the <CODE>MessageFormat</CODE> object the
<CODE>ChoiceFormat</CODE> object created in step 4:
<blockquote>
<pre>
Format[] formats = {choiceForm, null, NumberFormat.getInstance()};
messageForm.setFormats(formats);
</PRE>
</blockquote>
<P>
The <CODE>setFormats</CODE> method assigns <CODE>Format</CODE> objects
to the arguments in the message pattern. You must invoke the
<CODE>applyPattern</CODE> method before you call the
<CODE>setFormats</CODE> method. The following table shows how the
elements of the <CODE>Format</CODE> array correspond to the arguments
in the message pattern:
<P>
<TABLE BORDER="1">
<caption>
<h4>The <CODE>Format</CODE> Array of the <CODE> ChoiceFormatDemo</CODE> Program</h4>
</caption>
<TR>
<TH>
Array Element
</TH>
<TH>
Pattern Argument
</TH>
</TR>
<TR>
<TD>
<CODE>choiceForm</CODE>

</TD>
<TD>
<CODE>{0}</CODE>

</TD>
</TR>
<TR>
<TD>
<CODE>null</CODE>

</TD>
<TD>
<CODE>{1}</CODE>

</TD>
</TR>
<TR>
<TD>
<CODE>NumberFormat.getInstance()</CODE>

</TD>
<TD>
<CODE>{2}</CODE>

</TD>
</TR>
</TABLE>

</blockquote>

<a name="step7">
<H4>7. Set the Arguments and Format the Message</H4>
</a>
<blockquote>
At run time the program assigns the variables to the array of arguments
it passes to the <CODE>MessageFormat</CODE> object. The elements in the
array correspond to the arguments in the pattern. For example,
<CODE>messageArgument[1] </CODE> maps to pattern argument
<CODE>{1}</CODE>, which is a <CODE>String</CODE> containing the name of
the disk. In the previous step the program assigned a
<CODE>ChoiceFormat </CODE> object to argument <CODE>{0}</CODE> of the
pattern. Therefore the number assigned to
<CODE>messageArgument[0]</CODE> determines which <CODE>String</CODE>
the <CODE>ChoiceFormat </CODE> object selects. If
<CODE>messageArgument[0]</CODE> is greater than or equal to 2, the
<CODE>String</CODE> containing the phrase <CODE>are {2} files</CODE>
replaces argument <CODE>{0}</CODE> in the pattern. The number assigned
to <CODE>messageArgument[2]</CODE> will be substituted in place of
pattern argument <CODE>{2}</CODE>. Here's the code that tries this
out:
<blockquote>
<pre>
Object[] messageArguments = {null, &quot;XDisk&quot;, null};
for (int numFiles = 0; numFiles &lt; 4; numFiles++) {
    messageArguments[0] = new Integer(numFiles);
    messageArguments[2] = new Integer(numFiles);
    String result = messageForm.format(messageArguments);
    System.out.println(result);
}
</PRE>
</blockquote>
</blockquote>

<H4>8. Run the Demo Program</H4>
<blockquote>
Compare the messages displayed by the program with the phrases in the
<CODE>ResourceBundle </CODE> of step 2. Notice that the
<CODE>ChoiceFormat</CODE> object selects the correct phrase, which the
<CODE>MessageFormat</CODE> object uses to construct the proper message.
The output of the <CODE>ChoiceFormatDemo</CODE> program is as follows: 
<blockquote>
<PRE>
currentLocale = en_US
There are no files on XDisk.
There is one file on XDisk.
There are 2 files on XDisk.
There are 3 files on XDisk.

currentLocale = fr_FR
Il n'y a pas des fichiers sur XDisk.
Il y a un fichier sur XDisk.
Il y a 2 fichiers sur XDisk.
Il y a 3 fichiers sur XDisk.
</pre>
</blockquote>
</blockquote>

</blockquote>
<p>
<hr size=4>
<p> 
<table width="100%">
<tr>
<td align=left>
<a href="messageformat.html"><img src="http://docs.rinet.ru/Jtuta/images/PreviousArrow.gif" width=26 height=26 align=top border=0 alt="Previous | "></a><a
href="..\text\index.html"><img src="http://docs.rinet.ru/Jtuta/images/NextArrow.gif" width=26 height=26 align=top border=0 alt="Next | "></a><a
href="..\..\trailmap.html"><img src="http://docs.rinet.ru/Jtuta/images/WayUpArrow.gif" width=26 height=26 align=top border=0 alt="Trail Map | "></a><a
href="..\index.html"><img src="http://docs.rinet.ru/Jtuta/images/internat.GIF" width=26 height=26 align=top border=0 alt="Internationalization | "></a>
</td>
<td align=right>
<a href="index.html"><strong><em>Formatting</em></strong></a>
</td>
</tr>
</table>
</body>
</html>
