<HTML>
<HEAD>
<TITLE>Use class extension to model permanent IS-A relationships</TITLE>
<META name="description" content="An object-oriented design idiom from Interface Design: Best Practices in Object-Oriented API Design in Java by Bill Venners.">
<META name="keywords" content="Java Design, Java Book, Object Oriented Design, Thread Safe Design">
<LINK rel="stylesheet" type="text/css" href="http://www.artima.com/artima.css">
</HEAD>
<BODY text="#000000" alink="#006666">
<TABLE width="100%" cellspacing="0">
<TR>
<TD align="left" valign="bottom">
<A href="http://www.artima.com/index.jsp"><IMG src="..\images\ac.gif" alt="artima.com" border="0" width="150" height="31"></A>
</TD>
<TD align="right">
<a href="http://www.artima.com/cgi-bin/redirect.cgi/b0d0e160?REGION=Cyan&CAMPAIGN=Default&ACCOUNT=Artima&BANNER=ObjNJava" ><img src="..\cgi-bin\getimage.cgi\b0d0e160\region=cyan&campaign=default&account=artima&banner" border=0 width=468 height=60 alt="ad" ></a>
</TD>
</TR>
</TABLE>
<TABLE width="100%" bgcolor="#006666">
<TR>
<TD align="center">
<DIV class="ml">
<A href="http://www.artima.com/search.html" class="hl">Search</A>&nbsp;|
<A href="http://www.artima.com/java/index.html" class="hl">Java</A>&nbsp;|
<A href="http://www.artima.com/javadesign/index.html" class="hl">Design</A>&nbsp;|
<A href="http://www.artima.com/jvm/index.html" class="hl">JVM</A>&nbsp;|
<A href="http://www.artima.com/jini/index.html" class="hl">Jini</A>&nbsp;|
<A href="http://www.artima.com/forums/index.jsp" class="hl">Forums</A>&nbsp;|
<A href="http://www.artima.com/javaseminars/index.html" class="hl">Seminars</A>&nbsp;|
<A href="http://lists.artima.com/mailman/listinfo/artima-newsletter/" class="hl">Subscribe</A>
</DIV>
</TD>
</TR>
</TABLE>
<BR>
<DIV class="vegies">
<DIV class="tc">
<SPAN class="sts">Interface Design by Bill Venners</SPAN><BR>
<SPAN class="ts">Use class extension to model permanent IS-A relationships</SPAN><BR>
</DIV>

<!--BEGIN_PRECISE_OBJECT_LINKS-->
<CENTER>
<FONT size="1" face="geneva, arial, sans-serif">
<STRONG>
<A href="index.html">Interface&nbsp;Design</A>&nbsp;|
<A href="contents.html">Contents</A>&nbsp;|
<A href="enlisthelp.html">Previous</A>&nbsp;|
<A href="compoinhdiff.html">Next</A>
</STRONG>
</FONT>
</CENTER>
<!--END_PRECISE_OBJECT_LINKS-->

<P>
As an example of when an interface isn't exactly what you want, use LinkMap and Map. Couldn't use
Map because of RemoteException.

<H2>Class Extension</H2>
<UL>
<LI>
Guideline: <EM>Use class extension to model permanent IS-A relationships.</EM>
<LI>
Subclasses inherit the interface and, by default, the implementation of
their superclass.
<LI>
A subclass should have some kind of specialized behavior (it should provide
the same service as the superclass, only differently)
<LI>
A subclass may also offer new services not offered by the superclass
<LI>
IS-A means "Is a specialized kind of,"  so watch out for:
<UL>
<LI><CODE>Bootsie</CODE> IS-A <CODE>Dog</CODE>
<LI><CODE>Car</CODE> IS-AN <CODE>Automobile</CODE>
</UL>
</UL>

<HR align="left" width="100%" size="4" noshade>
<H2>An <CODE>OverdraftAccount</CODE> Object</H2>
<UL>
<LI>
An <CODE>OverdraftAccount</CODE> IS-AN <CODE>Account</CODE>
</FONT>
<BR>
<BR>
<CENTER>
<IMG src="images\isakindof.gif">
</CENTER>
<LI>
<CODE>OverdraftAccount</CODE> has the same interface and fulfills the
same semantic contract as <CODE>Account</CODE>
<LI>
But, <CODE>OverdraftAccount</CODE> fulfills the semantic contract
<EM>differently</EM> than <CODE>Account</CODE>
</UL>
<PRE>
  1 package com.artima.examples.account.ex1;
  2
  3 <EM>/**
  4 * Represents a bank account with overdraft protection. Instances
  5 * of this class are instantiated with a specified maximum
  6 * overdraft. If a client attempts to withdraw more than the
  7 * current account balance, the bank may loan the amount in
  8 * excess of the balance to the client. The overdraft maximum
  9 * passed to an &lt;code&gt;OverdraftAccount&lt;/code&gt;'s constructor
 10 * is the maximum amount the bank will lend to the client in
 11 * this manner. When a client makes a deposit, the bank will
 12 * pay itself back first before increasing the account's balance.
 13 *
 14 * &lt;p&gt;
 15 * As described in class &lt;code&gt;Account&lt;/code&gt;, money is stored in
 16 * this account in integral units. Clients
 17 * can use this account to store any kind of value, such as money
 18 * or points, etc. The meaning of the integral units stored in
 19 * this account is a decision of the client that instantiates the
 20 * account. The maximum amount of units that can be stored as
 21 * the current balance of an &lt;code&gt;Account&lt;/code&gt; is Long.MAX_VALUE.
 22 */</EM>
 23 public class OverdraftAccount extends Account {
 24
 25     <EM>/**
 26     * The maximum amount the bank will loan to the client.
 27     */</EM>
 28     private final long overdraftMax;
 29
 30     <EM>/**
 31     * The current amount the bank has loaned to the client
 32     * which has not yet been repaid. This must be zero to
 33     * overdraftMax.
 34     */</EM>
 35     private long overdraft;
 36
 37     <EM>/**
 38     * Constructs a new &lt;code&gt;OverdraftAccount&lt;/code&gt; with the
 39     * passed &lt;code&gt;overdraftMax&lt;/code&gt;.
 40     *
 41     * @param overdraftMax the maximum amount the bank will loan
 42     *     to the client
 43     */</EM>
 44     public OverdraftAccount(long overdraftMax) {
 45         this.overdraftMax = overdraftMax;
 46     }
 47
 48     <EM>/**
 49     * Returns the current overdraft, the amount the bank has
 50     * loaned to the client that has not yet been repaid.
 51     *
 52     * @returns the current overdraft
 53     */</EM>
 54     public long getOverdraft() {
 55         return overdraft;
 56     }
 57
 58     <EM>/**
 59     * Returns the overdraft maximum, the maximum amount the
 60     * bank will allow the client to owe it. For each instance
 61     * of &lt;code&gt;OverdraftAccount&lt;/code&gt;, the overdraft maximum
 62     * is constant.
 63     *
 64     * @returns the overdraft maximum
 65     */</EM>
 66     public long getOverdraftMax() {
 67         return overdraftMax;
 68     }
 69
 70     <EM>/**
 71     * Withdraws exactly the passed amount from the
 72     * &lt;code&gt;Account&lt;/code&gt;. If the passed amount is
 73     * less than or equal to the current balance, all withdrawn
 74     * funds will be taken from the balance, and the balance
 75     * will be decremented by the passed amount. If the passed amount
 76     * exceeds the current balance, the bank may loan the client the
 77     * difference. The bank will make the loan only if the difference
 78     * between the passed amount and the balance is less than or equal to
 79     * the available overdraft. The available overdraft is equal to
 80     * the current overdraft (the amount already loaned to the client and
 81     * not yet repaid), subtracted from the overdraft maximum, which
 82     * is passed to the constructor of any &lt;code&gt;OverdraftAccount&lt;/code&gt;.
 83     *
 84     * &lt;p&gt;
 85     * If the passed amount less the current balance is less than or equal
 86     * to the available overdraft, the &lt;code&gt;withdraw&lt;/code&gt; method returns
 87     * the requested amount, sets the current balance to zero, and records
 88     * the loan. Otherwise, if the passed amount less the current balance
 89     * exceeds the available overdraft, the &lt;code&gt;withdraw&lt;/code&gt; method throws
 90     * &lt;code&gt;InsufficientFundsException&lt;/code&gt;.
 91     *
 92     * @param amount amount to withdraw
 93     * @returns amount withdrawn from the &lt;code&gt;Account&lt;/code&gt;
 94     * @throws InsufficientFundsException if the &lt;code&gt;Account&lt;/code&gt;
 95     *     contains insufficient funds for the requested withdrawal
 96     */</EM>
 97     public long withdraw(long amount)
 98         throws InsufficientFundsException {
 99
100         long balance = getBalance();
101         if (balance &gt;= amount) {
102
103             <EM>// Balance has sufficient funds, just take the</EM>
104             <EM>// money from the balance.</EM>
105             balance -= amount;
106             return amount;
107         }
108
109         long shortfall = amount - balance;
110         long extraAvailable = overdraftMax - overdraft;
111
112         if (shortfall &gt; extraAvailable) {
113             throw new InsufficientFundsException(shortfall - extraAvailable);
114         }
115         overdraft += shortfall;
116         super.withdraw(amount - shortfall);
117
118         return amount;
119     }
120
121     <EM>/**
122     * Deposits exactly the passed amount into the &lt;code&gt;Account&lt;/code&gt;.
123     * If the current overdraft is zero, the balance will be increased
124     * by the passed amount. Otherwise, the bank will attempt to pay
125     * off the overdraft first, before increasing the current balance
126     * by the amount remaining after the overdraft is repaid, if any.
127     *
128     * &lt;p&gt;
129     * For example, if the balance is 200, the overdraft is 100, and the
130     * &lt;code&gt;deposit&lt;/code&gt; method is invoked with a passed &lt;code&gt;amount&lt;/code&gt;
131     * of 50, the bank would use all 50 of those monetary units to pay down
132     * the overdraft. The overdraft would be reduced to 50 and the balance would
133     * remain at 200. If subsequently, the client deposits another 100 units,
134     * the bank would use 50 of those units to pay off the overdraft loan and
135     * direct the remaining 50 into the balance. The new overdraft would
136     * be 0 and the new balance would be 250.
137     *
138     * @param amount amount to deposit
139     * @throws ArithmeticException if requested deposit would cause the
140     *     balance of this &lt;code&gt;Account&lt;/code&gt; to exceed Long.MAX_VALUE.
141     */</EM>
142     public void deposit(long amount) {
143         if (overdraft &gt; 0) {
144             if (amount &lt; overdraft) {
145                 overdraft -= amount;
146             }
147             else {
148                 long diff = amount - overdraft;
149                 overdraft = 0;
150                 super.deposit(diff);
151             }
152         }
153         else {
154             super.deposit(amount);
155         }
156     }
157 }
</PRE>
<UL>
<LI>
An <CODE>OverdraftAccount</CODE> object on the heap:
<BR>
<BR>
<CENTER>
<IMG src="images\overdraftaccountobject.gif">
</CENTER>
</UL>

<HR align="left" width="100%" size="4" noshade>
<H2>Roles and Attributes</H2>
<UL>
<LI>
IS-A is necessary but not sufficient
<LI>
Watch out for impermanent roles (try composition):
<UL>
<LI><CODE>Manager</CODE> IS-AN <CODE>Employee</CODE>
<LI><CODE>Peon</CODE> IS-AN <CODE>Employee</CODE>
</UL>
<LI>
Watch out for attributes (try a final instance variable):
<UL>
<LI><CODE>RedCup</CODE> IS-A <CODE>Cup</CODE>
<LI><CODE>BlueCup</CODE> IS-A <CODE>Cup</CODE>
</UL>
</UL>

<HR align="left" width="100%" size="4" noshade>
<H2>State and Class</H2>
<UL>
<LI>Behavior influenced by object's state (e.g. <CODE>Account</CODE> balance is $5000)
<LI>Behavior influenced by object's class (e.g. <CODE>OverDraftAccount</CODE>)
<LI>Non-permanent IS-A relationships (roles) must be modeled with state
(perhaps composition)
<LI>Permanent IS-A relationships can be modeled either with state or with
subclasses
</UL>

<HR align="left" width="100%" size="4" noshade>
<H2>How do You Decide?</H2>
<UL>
<LI>To accomodate a likely vector of change by making it possible to plug in new subclasses in the future
<LI>To define a tight, close-knit family, such as the <CODE>StampMachine.State</CODE> family
<LI>To communicate important concepts in the design, where each subclass is about one concept
<LI>To form a vocabulary for programmers: <EM>If there's an account in the problem domain, there should likely
be an </EM><CODE>Account</CODE><EM> in the solution.</EM>
<LI>Be unsurprising: <CODE>Square</CODE> IS-A <CODE>Rectangle</CODE>?
</UL>

<P>
Wouldn't want to say: Overdraft100Account, Overdraft500Account, and Overdraft1000Account if there were just
three legal overdraft maxes. Just use OverdraftAccount that takes a max. And either allow client to establish
legal values for overdraft (other than negative), or check at constructor for legal values.

<HR align="left" width="100%" size="4" noshade>
<H2>Why IS-A?</H2>
<UL>
<LI>
Inheritance gives you code reuse. (OO Claim: promotes code reuse)
<LI>
Inheritance gives you polymorphism:<BR>
<BLOCKQUOTE>
<CODE>Account a = new OverdraftAccount(50000);</CODE>
</BLOCKQUOTE>
<LI>
Don't use inheritance to get at code reuse or polymorphism without
IS-A
<LI>
Why? Because that's what inheritance <EM>means</EM>
</UL>

</TD>
</TR>

</DIV>
<HR width="100%">
<TABLE width="100%">
<TR>
<TD align="left">
<DIV class="sp">
Last Updated: Sunday, March 3, 2002<BR>
<A href="http://www.artima.com/copyright.html">Copyright</A> &copy; 1996-2002 Artima Software, Inc. All Rights Reserved.
</DIV>
</TD>
<TD align="right">
<DIV class="sp">
URL: http://www.artima.com/interfacedesign/ISA.html<BR>
Artima.com is created by <A href="http://www.artima.com/consulting.html">Bill Venners</A>
</DIV>
</TD>
</TR>
</TABLE>
</BODY>
</HTML>
