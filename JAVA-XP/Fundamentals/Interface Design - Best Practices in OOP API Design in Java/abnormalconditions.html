<HTML>
<HEAD>
<TITLE>Throw exceptions on abnormal conditions</TITLE>
<META name="description" content="An object-oriented design guideline from Interface Design: Best Practices in Object Oriented API Design in Java by Bill Venners.">
<META name="keywords" content="Java Design, Java Book, Object Oriented Design, Thread Safe Design">
<LINK rel="stylesheet" type="text/css" href="http://www.artima.com/artima.css">
</HEAD>
<BODY text="#000000" alink="#006666">
<TABLE width="100%" cellspacing="0">
<TR>
<TD align="left" valign="bottom">
<A href="http://www.artima.com/index.jsp"><IMG src="..\images\ac.gif" alt="artima.com" border="0" width="150" height="31"></A>
</TD>
<TD align="right">
<a href="http://www.artima.com/cgi-bin/redirect.cgi/1d4a06e6?REGION=Cyan&CAMPAIGN=Default&ACCOUNT=Artima&BANNER=ArtimaTraining" ><img src="..\cgi-bin\getimage.cgi\1d4a06e6\region=cyan&campaign=default&account=artima&banner" border=0 width=468 height=60 alt="ad" ></a>
</TD>
</TR>
</TABLE>
<TABLE width="100%" bgcolor="#006666">
<TR>
<TD align="center">
<DIV class="ml">
<A href="http://www.artima.com/search.html" class="hl">Search</A>&nbsp;|
<A href="http://www.artima.com/java/index.html" class="hl">Java</A>&nbsp;|
<A href="http://www.artima.com/javadesign/index.html" class="hl">Design</A>&nbsp;|
<A href="http://www.artima.com/jvm/index.html" class="hl">JVM</A>&nbsp;|
<A href="http://www.artima.com/jini/index.html" class="hl">Jini</A>&nbsp;|
<A href="http://www.artima.com/forums/index.jsp" class="hl">Forums</A>&nbsp;|
<A href="http://www.artima.com/javaseminars/index.html" class="hl">Seminars</A>&nbsp;|
<A href="http://lists.artima.com/mailman/listinfo/artima-newsletter/" class="hl">Subscribe</A>
</DIV>
</TD>
</TR>
</TABLE>
<BR>
<DIV class="vegies">
<DIV class="tc">
<SPAN class="sts">Interface Design by Bill Venners</SPAN><BR>
<SPAN class="ts">Throw exceptions on abnormal conditions</SPAN><BR>
</DIV>

<!--BEGIN_PRECISE_OBJECT_LINKS-->
<CENTER>
<FONT size="1" face="geneva, arial, sans-serif">
<STRONG>
<A href="index.html">Interface&nbsp;Design</A>&nbsp;|
<A href="contents.html">Contents</A>&nbsp;|
<A href="brokencontract.html">Previous</A>&nbsp;|
<A href="checkedexceptions.html">Next</A>
</STRONG>
</FONT>
</CENTER>
<!--END_PRECISE_OBJECT_LINKS-->

<P>
This is in deciding your contract. You shouldn't promise to do something unless the chances
are you'll be able to do it most of the time.

<H2>Abnormal Conditions</H2>
<UL>
<LI>
Guideline: <EM>Throw exceptions on abnormal conditions.</EM>
<LI>
But what's an abnormal condition?
<LI>
Avoid using exceptions to indicate conditions that can reasonably be expected
as part of the typical functioning of the method.
</UL>

<HR align="left" width="100%" size="4" noshade>
<H2>Example: <CODE>FileInputStream</CODE></H2>
<UL>
<LI>
<CODE>FileInputStream</CODE> returns -1 on end of file.
<LI>
Even if you call <CODE>read()</CODE> again after hitting EOF, you'll
still get -1.
<LI>
Says: hitting EOF is a normal condition to encounter when using the
<CODE>read()</CODE> method
</UL>
<PRE>
 1 // In file ex9/Example9a.java
 2 import java.io.*;
 3 class Example9a {
 4
 5     public static void main(String[] args)
 6         throws IOException {
 7
 8         if (args.length == 0) {
 9             System.out.println("Must give filename as first arg.");
10             return;
11         }
12
13         FileInputStream in;
14         try {
15             in = new FileInputStream(args[0]);
16         }
17         catch (FileNotFoundException e) {
18             System.out.println("Can't find file: " + args[0]);
19             return;
20         }
21
22         int ch;
23         while ((ch = in.read()) != -1) {
24             System.out.print((char) ch);
25         }
26         System.out.println();
27
28         in.close();
29     }
30
</PRE>

<!--
<HR align="left" width="100%" size="4" noshade>
<H2>Example: <CODE>DataInputStream</CODE></H2>
<UL>
<LI>
<CODE>DataInputStream</CODE> throws (checked) <CODE>EOFException</CODE> on end of file.
<LI>
Says: hitting EOF is an abnormal condition to encounter when using the
<CODE>readInt()</CODE> method
<LI>
From javadoc: "<CODE>EOFException</CODE> is mainly used by data input streams,
which generally expect a binary file in a specific
format, and for which an end of stream is an unusual condition."
</UL>
<PRE>
 1 // In file ex9/Example9b.java
 2 import java.io.*;
 3 class Example9b {
 4
 5     public static void main(String[] args)
 6         throws IOException {
 7
 8         if (args.length == 0) {
 9             System.out.println("Must give filename as first arg.");
10             return;
11         }
12
13         FileInputStream fin;
14         try {
15             fin = new FileInputStream(args[0]);
16         }
17         catch (FileNotFoundException e) {
18             System.out.println("Can't find file: " + args[0]);
19             return;
20         }
21
22         DataInputStream din = new DataInputStream(fin);
23         try {
24             int i;
25             for (;;) {
26                 i = din.readInt();
27                 System.out.println(i);
28             }
29         }
30         catch (EOFException e) {
31         }
32
33         fin.close();
34     }
35
</PRE>
-->

<HR align="left" width="100%" size="4" noshade>
<H2>Example: <CODE>StringTokenizer</CODE> and <CODE>Stack</CODE></H2>
<UL>
<LI>
<CODE>StringTokenizer</CODE> makes you ask <CODE>hasMoreTokens()</CODE> before
calling <CODE>nextToken()</CODE>
<LI>
If you call <CODE>nextToken()</CODE> after <CODE>hasMoreTokens()</CODE>
returns (or would return) <CODE>false</CODE>, you get an (unchecked)
<CODE>NoSuchElementException</CODE>
<LI>
Says: hitting "end of tokens" is an abnormal condition to encounter when
using the <CODE>nextToken()</CODE> method, because you are supposed to
check with <CODE>hasTokens()</CODE> first
</UL>
<PRE>
 1 // In file ex9/Example9c.java
 2 // This program prints the white-space separated tokens of an
 3 // ASCII file in reverse order of their appearance in the file.
 4 import java.io.*;
 5 import java.util.*;
 6 class Example9c {
 7
 8     public static void main(String[] args)
 9         throws IOException {
10
11         if (args.length == 0) {
12             System.out.println("Must give filename as first arg.");
13             return;
14         }
15
16         FileInputStream in = null;
17         try {
18             in = new FileInputStream(args[0]);
19         }
20         catch (FileNotFoundException e) {
21             System.out.println("Can't find file: " + args[0]);
22             return;
23         }
24
25         // Read file into a StringBuffer
26         StringBuffer buf = new StringBuffer();
27         try {
28             int ch;
29             while ((ch = in.read()) != -1) {
30                 buf.append((char) ch);
31             }
32         }
33         finally {
34             in.close();
35         }
36
37         // Separate StringBuffer into tokens and
38         // push each token into a Stack
39         StringTokenizer tok = new StringTokenizer(buf.toString());
40         Stack stack = new Stack();
41         while (tok.hasMoreTokens()) {
42             stack.push(tok.nextToken());
43         }
44
45         // Print out tokens in reverse order.
46         while (!stack.empty()) {
47             System.out.println((String) stack.pop());
48         }
49     }
50
</PRE>
<UL>
<LI>
<CODE>Stack</CODE> makes you ask <CODE>empty()</CODE> before
calling <CODE>pop()</CODE>
<LI>
If you call <CODE>pop()</CODE> after <CODE>empty()</CODE>
returns (or would return) <CODE>true</CODE>, you get an (unchecked)
<CODE>EmptyStackException</CODE>
<LI>
Says: hitting "empty stack" is an abnormal condition to encounter when
using the <CODE>pop()</CODE> method, because you are supposed to
check with <CODE>empty()</CODE> first
</UL>

<HR align="left" width="100%" size="4" noshade>
<H2>Why Just Abnormal Conditions?</H2>
<UL>
<LI>
Exceptions are free unless thrown...
<LI>
But if thrown, they are very expensive.
<LI>
Separating error handling code that almost never happens from code that
represents the normal path of execution can make code more readable
<LI>
But if the normal path of execution has to go through lots of catch
clauses, the code is harder to read
<LI>
Abnormal condition is what an exception <EM>means</EM>, because broken contracts should be relatively rare
</UL>

</TD>
</TR>

</DIV>
<HR width="100%">
<TABLE width="100%">
<TR>
<TD align="left">
<DIV class="sp">
Last Updated: Sunday, March 3, 2002<BR>
<A href="http://www.artima.com/copyright.html">Copyright</A> &copy; 1996-2002 Artima Software, Inc. All Rights Reserved.
</DIV>
</TD>
<TD align="right">
<DIV class="sp">
URL: http://www.artima.com/interfacedesign/AbnormalConditions.html<BR>
Artima.com is created by <A href="http://www.artima.com/consulting.html">Bill Venners</A>
</DIV>
</TD>
</TR>
</TABLE>
</BODY>
</HTML>
