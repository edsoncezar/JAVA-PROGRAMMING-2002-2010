<HTML>
<HEAD>


<TITLE>Inside Java:Networking with Java:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0479-0485.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0493-0498.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-486"><P>Page 486</P></A>



<P>Listing 12.1, Continued
</P>

<PRE>
167             return;
168
169         }  // end try
170
171         int msgLen = clientMsg.length();
172         pos.println(&quot;Client message had &quot;+msgLen+&quot; characters.&quot;);
173
174         // Thread terminates at this point.
175
176     }  // end run
177
178 }  // end ServerLogic
</PRE>

<H4><A NAME="ch12_ 9">
Writing a Client Application in Java
</A></H4>

<P>Writing a client application in Java is simpler than writing a server application. There
are usually no threads to create because the client is dedicated to making requests only
and dealing with the response.
</P>

<P>Listing 12.2 shows a sample client program (file
MyClient.java on the CD-ROM) that could be used with the MyServer program of listing 12.1. The client program expects
to be invoked as follows:
</P>

<PRE>
java MyClient host [port]
</PRE>

<P>If a port number is not specified, a default port number is used to make the connection
to the host. The client program reads input from the user from the console, sends it to
the server, reads the output from the server, and prints the output on the console. If the
user enters an empty line, or an error occurs in the input/output operations, the
client terminates.
<P>
<P>

<CENTER>
<TABLE BGCOLOR="#FFFF99">
<TR><TD><B>
NOTE
</B></TD></TR>
<TR><TD>
<BLOCKQUOTE>
If the MyClient.java program after compiling with javac goes into a loop when
an IOException is raised, your version of javac is generating incorrect bytecode. You
can verify this by compiling the program with a competing vendor's Java compiler.
The CD-ROM that is included with this book contains a version of MyClass.class that
was compiled by using the Symantec Cafe compiler, and works correctly when
exceptions are raised.
</BLOCKQUOTE></TD></TR>
</TABLE></CENTER>
</P>
<A NAME="PAGENUM-487"><P>Page 487</P></A>



<P>Listing 12.2
</P>

<PRE>
Line==================Java Source=================
001 /**
002  * MyClient: Demonstrates how a client can
003  * be written in Java.
004  *
005  * Author: Karanjit S. G. S. Siyan
006  *
007  */
008
009 import java.net.*;
010 import java.io.*;
011
012 public class MyClient extends Object
013 {
014     private int     port;
015     private final static int DEFAULT_PORT = 4000;
016     private ServerSocket srvSock;
017     private static String promptStr = &quot;#&quot;;
018
019     // main method to start the program.
020     public static void main(String[] args)
021     {
022         int port = 0;
023
024         if (args.length != 1 &amp;&amp; args.length != 2)
025         {
026             printUsage();
027             System.exit(0);
028
029         }  // end if
030
031         if (args.length == 1)
032         {
033             // Port not specified
034             port = DEFAULT_PORT;
035
</PRE>
<PRE>
                                                  <I>continues</I>
</PRE>

<A NAME="PAGENUM-488"><P>Page 488</P></A>



<P>Listing 12.2, Continued
</P>

<PRE>
036         }
037         else
038         {
039             try
040             {
041                 port = Integer.parseInt(args[1]);
042
043             }
044             catch (NumberFormatException e)
045             {
046                 System.out.println(&quot;Must use a number for the port value&quot;);
047                 printUsage();
048                 System.exit(1);
049
050             } // end try
051
052         }  // end if
053
054         // Invoke the client
055         client(args[0], port);
056
057     }  // end main
058
059     // printUsage: Inform user on correct syntax
060     private static void printUsage()
061     {
062         System.out.println(&quot;Usage:\n\tjava MyClient host [port]&quot;);
063
064     } // end printUsage
065
066     // client logic
067     private static void client(String host, int port)
068     {
069         Socket clientSock;
070
071         try
072         {
073             clientSock = new Socket(host, port);
</PRE>

<A NAME="PAGENUM-489"><P>Page 489</P></A>



<PRE>
074         }
075         catch (UnknownHostException e) {
076            System.out.println(e);
077            System.exit(1);
078         } catch (ConnectException e) {
079            System.out.println(e);
080            System.exit(1);
081         } catch (NoRouteToHostException e) {
082            System.out.println(e);
083            System.exit(1);
084         } catch IOException e) {
085            System.out.println(e);
086            System.exit(1);
087         } // end try
088
089
090         // Connection created at this point.
091         System.out.println(&quot;Connected to the host &quot;+
092             host+&quot;(&quot;+clientSock.getInetAddress()+&quot;)&quot;+
093             &quot; at port &quot;+clientSock.getPort());
094
095
096
097         // Create streams for performing I/O.
098         InputStream is = null;
099         OutputStream os = null;
100         DataInputStream dis;
101         PrintStream ps;
102
103         try
104         {
105             is = clientSock.getInputStream();
106         }
107         catch (IOException e)
108         {
109             System.out.println(&quot;IOException on getting input stream&quot;);
110
</PRE>
<PRE>
                                                  <I>continues</I>
</PRE>

<A NAME="PAGENUM-490"><P>Page 490</P></A>



<P>Listing 12.2, Continued
</P>

<PRE>
111         }  // end try
112
113
114         try
115         {
116             os = clientSock.getOutputStream();
117         }
118         catch (IOException e)
119         {
120             System.out.println(&quot;IOException on getting output stream&quot;);
121
122         }  // end try
123
124         dis = new DataInputStream(is);
125         ps = new PrintStream(os);
126
127         // Now encapsulate System.in so
128         // you can read lines from the console
129
130         DataInputStream cis = new DataInputStream(System.in);
131
132         // Prompt for input
133         // Send it through the socket
134         // Read input and display it
135         // Terminate on an empty line.
136         String buff;
137         for(;;)
138         {
139             System.out.print(promptStr);
140             System.out.flush();
141
142             // Read a line from console
143             try
144             {
145                 buff = cis.readLine();
146             }
147             catch (IOException e)
148             {
</PRE>

<A NAME="PAGENUM-491"><P>Page 491</P></A>


<PRE>
149                 System.out.println(&quot;IOException reading from console&quot;);
150                 break;
151
152             }  // end try
153
154             // If input is null exit loop
155             if (buff == null)
156             {
157                 break;
158
159             }  // end if
160
161             // Send the line read to the server
162             ps.println(buff);
163
164             // Now read the server output.
165             try
166             {
167                 buff = dis.readLine();
168             }
169             catch (IOException e)
170             {
171                 System.out.println(&quot;IOException reading from socket&quot;);
172                 break;
173
174             }  // end try
175
176             if (buff == null)
177             {
178                 // Nothing read. Server connection
179                 // probably closed, so exit loop.
180                 break;
181
182
183             }  // end if
184
185             // Display the result from the server on console
186             System.out.println(buff);
</PRE>
<PRE>
                                                  <I>continues</I>
</PRE>

<A NAME="PAGENUM-492"><P>Page 492</P></A>



<P>Listing 12.2, Continued
</P>

<PRE>
187
188         }  // end for
189
190     }  // end client
191
192 } // end MyClient
</PRE>

<H3><A NAME="ch12_ 10">
Using Datagram Services
</A></H3>

<P>The example of the client/server application that was given in listings 12.1 and 12.2
used the TCP/IP connection-oriented protocol. The TCP/IP protocol provides a
reliable guaranteed delivery, but has additional overhead in terms of the connection
being maintained for the duration of the session. Where the underlying network is
reliable enough, such as in a local area network, you may use the UDP protocol that does
not guarantee delivery. Because you expect the underlying network to be reliable enough,
it is sufficient to use UDP for some applications. UDP is called a connectionless
transport protocol because there are no connections preestablished prior to sending data.
UDP, although less reliable than TCP, has the advantage of being a faster protocol.
</P>

<P>JDK 1.1 now provides a type safe way to set Socket options. Each socket class has
a get/set method for each option it supports, taking and returning the appropriate type.
</P>

<P>For the DatagramSocket class there is one new option:
</P>

<UL>
<LI> SO_TIMEOUT&#151;Specify a timeout on blocking socket operations. (Caution:
Never block forever!!!)
</UL>

<H4><A NAME="ch12_ 11">
Using the DatagramPacket and <BR>DatagramSocket Classes
</A></H4>

<P>To write programs that use UDP datagrams, you can use the Java
classes DatagramPacket and DatagramSocket. The DatagramPacket class is used to create
the data packet that is to be sent, or a datagram packet that is to be received.
The DatagramSocket class contains the methods
send() and receive() to send and receive packets. You use this class to send and receive the data.
</P>

<P>The following shows the declarations for the DatagramPacket and
DatagramSocket:
</P>

<PRE>
public final class DatagramPacket
</PRE>

<P><CENTER>
<a href="0479-0485.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0493-0498.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

