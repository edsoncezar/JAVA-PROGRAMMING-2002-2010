<HTML>
<HEAD>


<TITLE>Inside Java:Networking with Java:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0486-0492.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0499-0504.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-493"><P>Page 493</P></A>

<PRE>
{

    //
    // This constructor is used to create a DatagramPacket object used
    // for receiving datagrams.
    // ibuf = where packet data is to be received.
    // ilength = the number of bytes to be received.
    public DatagramPacket(byte ibuf[], int ilength);

    //
    // This constructor is used construct the DatagramPacket to be sent.
    // ibuf = contains the packet data.
    // ilength = contains the packet length
    // iaddr and iport = destination ip addr and port number.
    public DatagramPacket(byte ibuf[], int ilength,
    InetAddress iaddr, int iport);

    //
    // Returns the address specified in the send constructor
    public InetAddress getAddress();

    //
    // Returns the port number specified in the send constructor
    public int getPort();

    //
    // Returns the byte array where the packet is stored.
    public byte[] getData();

    //
    // Returns the length of the packet
    public int getLength();


} // end DatagramPacket

public class DatagramSocket
{

</PRE>


<A NAME="PAGENUM-494"><P>Page 494</P></A>


<PRE>

    //
    // Creates a datagram socket.
    // Binds the udp socket to any local available port.
    public DatagramSocket() throws SocketException;


    //
    // Creates a datagram socket
    // port = local port to use
    public DatagramSocket(int port) throws SocketException;


    //
    // Sends datagram packet to the destination address
    // p = DatagramPacket to be sent. The DatagramPacket
    // contains the buffer of bytes, length,
    // destination InetAddress and port.
    public void send(DatagramPacket p) throws IOException;


    //
    // Receives datagram packet.
    // p = DatagramPacket to be received.
    // On return, the DatagramPacket contains the buffer in
    // which the data is received, packet length,
    // sender's address and sender's port
    // number. This method blocks until some input is available.
    public synchronized void receive(DatagramPacket p) throws IOException;


    //
    // Returns the local port to which this socket is bound.
    public int getLocalPort();

    //
    // Close the datagram socket.
    public synchronized void close();

  //
    // Ensures that the datagram socket gets closed.
    protected synchronized void finalize();


</PRE>

<A NAME="PAGENUM-495"><P>Page 495</P></A>



<PRE>

} // end DatagramSocket
</PRE>

<H4><A NAME="ch12_ 12">
Sending a Datagram Packet
</A></H4>

<P>Listing 12.3 contains a program (file SendDatagram.java on the CD-ROM) that sends
a datagram to a specified host and port number. The following is the syntax for
invoking this program:
</P>


<PRE>
java SendDatagram hostname port message
</PRE>

<P>
or
</P>
<PRE>
java SendDatagram hostname message
</PRE>

<P>In the second form, a default port number of 4000 is used to send the datagram.
The message for this sample program is restricted to not containing blanks.
</P>

<P>Most of the logic in the main() method (lines
16_74) is for parsing the arguments. The actual sending of the datagram is performed by the method
sendPacket() on lines 86_113.
</P>

<P>The DatagramPacket object is created on line 88, and the DatagramSocket object
is created on line 93. On line 104, the send() method on the DatagramSocket object sends
the packet.
</P>

<P>Listing 12.3
</P>



Line==================Java Source=================
001 /**
002  * SendDatagram: Demonstrates how to send
003  * datagrams.
004  *
005  * Author: Karanjit S. G. S. Siyan
006  */
007
008 import java.net.*;
009 import java.io.*;
010
011 class SendDatagram extends Object
012 {
013     private static final int DEFAULT_PORT = 4000;


<PRE>
                                                  <I>continues</I>
</PRE>

<A NAME="PAGENUM-496"><P>Page 496</P></A>



<P>Listing 12.3, Continued
</P>

<PRE>
014
015     // main method
016      public static void main(String[] args)
017     {
018         InetAddress host = null;
019         int port = 0;
020         String msgStr = null;
021
022         if (args.length != 2 &amp;&amp; args.length != 3)
023         {
024             printUsage();
025             System.exit(0);
026
027         }  // end if
028
029         if (args.length == 2)
030         {
031             // Port not specified
032             port = DEFAULT_PORT;
033             msgStr = args[1];
034
035         }
036         else
037         {
038             try
039             {
040                 port = Integer.parseInt(args[1]);
041
042             }
043             catch (NumberFormatException e)
044             {
045                 System.out.println(&quot;Must use a number for the port value&quot;);
046                 printUsage();
047                 System.exit(1);
048
049             } // end try
050

</PRE>

<A NAME="PAGENUM-497"><P>Page 497</P></A>




051             msgStr = args[2];
052
053         }  // end if
054
055         // Convert message to byte array
056         int msgLen = msgStr.length();
057         byte[] msg = new byte[msgLen];
058         msgStr.getBytes(0, msgLen, msg, 0);
059
060         // Get the host address
061         try
062         {
063             host = InetAddress.getByName(args[0]);
064         }
065         catch (UnknownHostException e)
066         {
067             System.out.println(&quot;Host &quot;+args[0]+&quot; unknown.&quot;);
068             System.exit(1);
069
070         }  // end try
071
072         sendPacket(host, port, msg);
073
074     }  // end main
075
076     // printUsage: prints the usage command.
077     public static void printUsage()
078     {
079         System.out.println(&quot;Usage:\n\tjava SendDatagram hostname port
&Acirc;message\nor\n\t&quot;+
080             &quot;java SendDatagram hostname message&quot;);
081
082
083     }  // end printUsage
084
085     // sends the packet
086     public static void sendPacket(InetAddress host, int port, byte[] msg)
087     {


<PRE>
                                                  <I>continues</I>
</PRE>
<A NAME="PAGENUM-498"><P>Page 498</P></A>




<P>Listing 12.3, Continued
</P>
<PRE>
088         DatagramPacket packet = new DatagramPacket(msg, msg.length, host,
&Acirc;port);
089         DatagramSocket socket = null;
090
091         try
092         {
093             socket = new DatagramSocket();
094         }
095         catch (SocketException e)
096         {
097             System.out.println(&quot;SocketException thrown:\n&quot;+e);
098             System.exit(1);
099
100         }  // end try
101
102         try
103         {
104             socket.send(packet);
105         }
106         catch (IOException e)
107         {
108             System.out.println(&quot;IOException thrown:\n&quot;+e);
109             System.exit(1);
110
111         } // end try
112
113     }  // end sendPacket
114
115 }  // end SendDatagram
</PRE>

<H4><A NAME="ch12_ 13">
Receiving a Datagram Packet
</A></H4>

<P>Listing 12.4 contains a program (file ReceiveDatagram.java on the CD-ROM)
that receives datagrams on a specified port number on the host on which the program is
run. The following is the syntax for invoking this program:
</P>
<PRE>
java ReceiveDatagram port
</PRE>

<P>      or
</P>

<P><CENTER>
<a href="0486-0492.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0499-0504.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

