<HTML>
<HEAD>


<TITLE>Inside Java:Networking with Java:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0493-0498.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0505-0509.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-499"><P>Page 499</P></A>


<PRE>
java SendDatagram hostname
</PRE>

<P>In the second form, a default port number of 4000 is used to receive datagrams.
</P>

<P>Most of the logic in the main() method (lines 16_53) is for parsing the arguments.
The actual sending of the datagram is performed by the method
receivePacket() on lines 65_113.
</P>

<P>The DatagramPacket object is created on line 70. Because the DatagramSocket is
a receive socket, no host address and port number are specified. The
DatagramSocket object is created on line 77 with the port number to listen to specified as an argument
to the constructor.
</P>

<P>An infinite for loop is set up to receive datagrams. On line 94, the
receive() method on the DatagramSocket object receives the packet. Assuming that the contents of the
packet are displayable, they are converted to a string and printed out on the console (lines
105_108).
</P>

<P>Listing 12.4
</P>
<PRE>
Line==================Java Source=================
001 /**
002  * ReceiveDatagram: Demonstrates how to receive
003  * datagrams.
004  *
005  * Author: Karanjit S. G. S. Siyan
006  */
007
008 import java.net.*;
009 import java.io.*;
010
011 class ReceiveDatagram extends Object
012 {
013     private static final int DEFAULT_PORT = 4000;
014
015     // main method
016      public static void main(String[] args)
017     {
018         int port = 0;
019
020         if (args.length != 0 &amp;&amp; args.length != 1)
021         {
</PRE>
<PRE>
                                                  <I>continues</I>
</PRE>

<A NAME="PAGENUM-500"><P>Page 500</P></A>




<P>Listing 12.4, Continued
</P>
<PRE>
022             printUsage();
023             System.exit(0);
024
025         }  // end if
026
027         if (args.length == 0)
028         {
029             // Port not specified
030             port = DEFAULT_PORT;
031
032         }
033         else
034         {
035             try
036             {
037                 port = Integer.parseInt(args[0]);
038
039             }
040             catch (NumberFormatException e)
041             {
042                 System.out.println(&quot;Must use a number for the port value&quot;);
043                 printUsage();
044                 System.exit(1);
045
046             } // end try
047
048         }  // end if
049
050
051         receivePacket(port);
052
053     }  // end main
054
055     // printUsage: prints the usage command.
056     public static void printUsage()
057     {
058         System.out.println(&quot;Usage:\n\tjava ReceiveDatagram port\nor\n\t&quot;+
</PRE>

<A NAME="PAGENUM-501"><P>Page 501</P></A>


<PRE>
059             &quot;java ReceiveDatagram&quot;);
060
061
062     }  // end printUsage
063
064     // sends the packet
065     public static void receivePacket(int port)
066     {
067         byte[] buff = new byte[16384];
068
069         // Received datagram packet
070         DatagramPacket packet = new DatagramPacket(buff, buff.length);
071
072         // Listen datagram socket.
073         DatagramSocket socket = null;
074
075         try
076         {
077             socket = new DatagramSocket(port);
078         }
079         catch (SocketException e)
080         {
081             System.out.println(&quot;SocketException thrown in creating
&Acirc;DatagramSocket:\n&quot;+e);
082             System.exit(1);
083
084         }  // end try
085
086         System.out.println(&quot;Listening for UDP datagrams on port &quot;+port);
087
088         for(;;)
089         {
090             String msg;
091
092             try
093             {
094                 socket.receive(packet);
095
</PRE>
<PRE>
                                                  <I>continues</I>
</PRE>

<A NAME="PAGENUM-502"><P>Page 502</P></A>



<P>Listing 12.4, Continued
</P>
<PRE>
096             }
097             catch (IOException e)
098             {
099                 System.out.println(&quot;IOException thrown on receive:\n&quot;+e);
100                 System.exit(1);
101
102             } // end try
103
104             // Assume data is displayable
105             msg = new String(buff, 0, 0, packet.getLength());
106             System.out.println(&quot;Received packet from &quot;+
107                 packet.getAddress()+&quot;, port = &quot;+packet.getPort());
108             System.out.println(msg);
109
110
111         }  // end for
112
113     }  // end sendPacket
114
115 }  // end ReceiveDatagram
</PRE>

<H3><A NAME="ch12_ 14">
Accessing WWW Resources
</A></H3>

<P>Java provides a flexible URL and URLConnection class to obtain information
from resources on the network that have a URL address. You can create a URL class
instance for a WWW address and then use the
getContent() method for the URL<BR>
class to download the content. The getContent() relies on content handlers that
understand the format of the downloaded content and can convert it to an appropriate
object. Currently, Java supports only the &quot;text/plain,&quot; &quot;image/gif,&quot; and &quot;image/jpeg&quot; data
types. You can define your own content handler to understand other data types. This is
done by many commercial Web browsers. It is not always necessary to define your
own content handler. Instead, you can write your own application-specific program to
parse the downloaded data.
</P>

<H4><A NAME="ch12_ 15">
Using URL and URLConnection
</A></H4>

<P>You can create URLs by specifying a single string value for the entire URL address,
or
</P>

<A NAME="PAGENUM-503"><P>Page 503</P></A>



<P>separate values for the protocol (http, ftp, and so on), host name, port number, and
file path. You can also create a URL by specifying a string value and a URL address
relative to the string value. Creating a URL class instance can throw
the MalformedURLException, so you must write code to handle this exception.
</P>

<P>Here is a code fragment for getting the content of a URL:
</P>
<PRE>
// Create the URL instance. Enclosing
// code must handle MalformedURLException
String urlStr = 
&quot;http://www.tsl.org&quot;;
URL url  = new URL(urlStr);

// Get the content of the URL
Object content = url.getContent();
String text;
Image img;

if (content instanceof String)
{
      text = (String)content;
}
else if (content instanceof Image)
{
      img = (Image)content;

} // end if
</PRE>

<P>Besides using getContent(), you can also obtain the content of a URL address by using
the URLConnection class. The URLConnection class is created by calling the
getConnection() method of the URL class:
</P>
<PRE>
// Create the URL instance. Enclosing
// code must handle MalformedURLException
String urlStr = 
&quot;http://www.tsl.org&quot;;
URL url  = new URL(urlStr);

URLConnection urlConn = url.openConnection();

// Gets MIME content type
String contType = urlConn.getContentType();
</PRE>


<A NAME="PAGENUM-504"><P>Page 504</P></A>


<PRE>
// Gets content length in bytes
int contLen = urlConn.getContentLength();
// Gets time last modified
// Milliseconds since epoch (Jan 1, 1970, midnight)
long lastMod = urlConn.getLastModified();

// Expiration time of the URL resource
// Milliseconds since epoch (Jan 1, 1970, midnight)
long expiration = urlConn.getExpiration();

// Get the content encoding of the URL
String contEncode = urlConn.getContentEncoding();

// Print out messages about the URL type
System.out.println(&quot;Content Type: &quot;+contType);
System.out.println(&quot;Content Length: &quot;+contLen);
System.out.println(&quot;Last Modified: &quot;+ new Date(lastMod));
System.out.println(&quot;Expiration: &quot;+ new Date(lastMod));
System.out.println(&quot;Content Encoding: &quot;+ new Date(lastMod));
</PRE>

<P>Alternatively, you can use the openStream() method of a URL class and get an instance
of the InputStream class, which you can then read as an ordinary input stream:
</P>

<PRE>
// Create the URL instance. Enclosing
// code must handle MalformedURLException
String urlStr = 
&quot;http://www.tsl.org&quot;;
URL url  = new URL(urlStr);

// Get the InputStream instance
InputStream is = url.openStream();

// Filter the input stream using DataInputStream
DataInputStream dis = new DataInputStream(is);

// Read the first 7 lines.
String line;
for (int x = 0; x &lt; 7; x++)
{

      line = dis.getLine();
</PRE>

<P><CENTER>
<a href="0493-0498.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0505-0509.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

