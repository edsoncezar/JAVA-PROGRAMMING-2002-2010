<HTML>
<HEAD>


<TITLE>Inside Java:Remote Method Invocation and Object Serialization:EarthWeb Inc.-</TITLE>







<P><CENTER>
<a href="0738-0741.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0746-0751.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-742"><P>Page 742</P></A>


<P>
implementation class (in this case GreetingGenImpl), as the object reference type.
</P>

<PRE>
20       GreetingGen obj;
</PRE>

<P>Lines 46_55 (listing 16.2) contain a call to the method in the remote object, as well as
the exception handling code:
</P>

<PRE>
46           try {
47               greetingLabel.setText(
48                      obj.makeGreeting(greetingLabel.getText()));
49               // Take next line out when bug in JDK 1.1 beta is fixed
50               greetingLabel.repaint();
51           }
52           catch (java.rmi.RemoteException e) {
53               System.out.println(&quot;Error calling remote method&quot;);
54               e.printStackTrace();
55           }
</PRE>

<P>Because the object is remote, many more ways exist in which method invocations
can fail. As a result, the client must add some extra code in the form of exception handlers
for remote exceptions. In this example, exception handlers simply report that an
exception occurred, but in a real application, they should be tied to recovery procedures.
</P>

<P>The following sections describe how to compile and run this example. When
platform-specific instructions exist, they will be given from a Windows 95/NT perspective,
so translate them into instructions specific to your platform.
</P>

<P><b>Compile the Java Files</b>
</P>

<P>Follow these steps to compile the Java files:
</P>

<OL>
<LI>          The three Java files (HelloApplet2.java, GreetingGen.java,
and GreetingGenImpl.java) should be placed in a directory whose path ends
in \chapter16\code\hello_remote2. The CLASSPATH should be set to include
the directory within which this path is rooted. This is because the package name for
the classes to be created is chapter16.code.hello_remote2. (This step is explained from
a Windows 95/NT perspective.)
<LI>          Make sure that your PATH includes the java\bin directory, because this
directory contains the utilities (javac, rmic, rmiregistry, and appletviewer) used in these
steps. (This step is explained from a Windows 95/NT perspective.)
<LI>          Using the javac compiler in the JDK (1.1 beta or later), execute the
following
</OL>


<A NAME="PAGENUM-743"><P>Page 743</P></A>



<OL>
command:
<PRE>
          javac *.java
</PRE>
</OL>

<P>This will produce the associated .class files for the three classes just described.
</P>

<P><b>Generate the Stub and Skeleton Classes</b>
</P>

<P>The utility named rmic, included with JDK 1.1, creates the stub and skeleton classes for
a given implementation class. The rmic utility operates upon the .class file, not the
.java file. Execute the following command:
</P>

<PRE>
rmic chapter16.code.hello_remote2.GreetingGenImpl
</PRE>

<P>This will create the GreetingGenImpl_Stub.class and GreetingGenImpl_Skel.class files.
</P>

<P><b>Start the RMI Registry</b>
</P>

<P>To start the RMI registry on Windows 95/NT, use the
rmiregistry utility by executing the following command:
</P>

<PRE>
start rmiregistry
</PRE>

<P>On UNIX, you would execute the following:
</P>

<PRE>
rmiregistry &amp;
</PRE>

<P>This starts the RMI registry on the default port, which is 1099. The RMI registry
services any number of applications that request remote object references on the assigned port.
</P>

<P><b>Start the Remote Object Server
</b></P>

<P>To start the remote object server that registers
the remote object, execute the following command, replacing
yourhost with the hostname of your http server, and
yourcodebase with the codebase in which the stub class can be found. In this case,
yourcodebase must equate with the directory in which \chapter16\code\hello_remote2 is rooted. The
trailing forward slash on the URL is required.
</P>

<PRE>
start java -Djava.rmi.server.codebase= 
http://yourhost/yourcodebase/

&Acirc;chapter16.code. hello_remote2.GreetingGenImpl
</PRE>

<P>Setting the java.rmi.server.codebase property is essential because when the server
starts up, it checks to see if the appropriate stub class exists where this property indicates
that it does. References to the remote server then can include the URL of the stub class
so
</P>
<A NAME="PAGENUM-744"><P>Page 744</P></A>


<P>
that it can be downloaded, in case it is not available in the client's CLASSPATH.
</P>

<P><b>Run the Applet
</b></P>

<P>After the remote object server successfully starts and binds to the RMI registry,
the message generated in line 48 of GreetingGenImpl.java will be displayed in the
system output. This indicates that GreetingGenImpl was successfully bound to the RMI registry.
</P>

<P>Now you can start the Applet Viewer with the URL of the HelloRemote2.html file.
</P>

<H4><A NAME="ch16_ 9">
Passing Objects in Remote Methods
</A></H4>

<P>The HelloApplet1 and HelloApplet2 examples provide a simple demonstration of
how you can create distributed Java applications with RMI. The RMI system does most
of the work for you, including passing objects in remote methods. In lines 47 and 48
of HelloApplet2.java (listing 16.2), the call to
makeGreeting() returns a String object that
greetingLabel.setText() uses to cause the greeting to be displayed.
</P>

<PRE>
47               greetingLabel.setText(

48                      obj.makeGreeting(greetingLabel.getText()));
</PRE>

<P>Because makeGreeting() is a method of a remote object, the String object had to be
serialized by the RMI system. Many Java classes included in JDK 1.1 can be serialized, so in
the above example, nothing special had to be done to enable the String object to be
passed as a return value.
</P>

<P>To make sure that a class can be serialized, you must implement the
java.io.Serializable interface. The Planets application in the next section demonstrates how you can create
a serializable class and pass objects of that class as the return value of a remote object.
</P>

<H4><A NAME="ch16_ 10">
The Planets Application
</A></H4>

<P>Listings 16.5, 16.6, 16.7, and 16.8 contain the code for the Planets application.
This application consists of:
</P>

<UL>
<LI>          A client applet named PlanetsApplet2 (listing 16.5). This applet demonstrates
how to pass serialized objects.
<LI>          A remote object interface class named PlanetsInfo (listing 16.6). This is
the interface for the remote PlanetsImpl object.
<LI>          A remote server class named PlanetsImpl (listing 16.7). This remote object
manages the Planet objects and returns them to the client applet upon request.
<LI>          A class named Planet, which will be returned from the remote object to the
client
</UL>


<A NAME="PAGENUM-745"><P>Page 745</P></A>




<UL>
(listing 16.8). Instances of the Planet class represent each of the nine planets in
our solar system.
</UL>

<P>Listing 16.5
</P>

<PRE>
Line==================Java Source=================
01 //////////
02 // PlanetsApplet2.java  Applet that demonstrates passing
03 // serialized objects.
04 //
05 // Author: James L. Weaver   JDK version: 1.1 beta
06 //////////
07 package chapter16.code.planets_rmi;
08
09 import java.awt.*;
10 import java.applet.*;
11 import java.rmi.*;
12 import java.awt.event.*;
13
14 public class PlanetsApplet2 extends Applet
15                         implements ActionListener{
16
17  TextField planetNum;
18  Button infoButton;
19  TextArea stats;
20
21  int numPlanets = 0;
22  String planetName = new String();
23  int numMoons = 0;
24  boolean rings = false;
25
26  PlanetsInfo obj;
27
28  public void init() {
29      try {
30          obj = (PlanetsInfo)Naming.lookup(&quot;//&quot; +
31              getCodeBase().getHost() + &quot;/PlanetServer&quot;);
32      } catch (Exception e) {
33          System.out.println(&quot;PlanetsApplet2: an exception occurred:&quot;);
</PRE>
<PRE>
                                  						<I>continues</I>
</PRE>
<P><CENTER>
<a href="0738-0741.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0746-0751.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

