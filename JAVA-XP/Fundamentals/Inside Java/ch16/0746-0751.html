<HTML>
<HEAD>


<TITLE>Inside Java:Remote Method Invocation and Object Serialization:EarthWeb Inc.-</TITLE>







<P><CENTER>
<a href="0742-0745.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0752-0755.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-746"><P>Page 746</P></A>




<P>Listing 16.5, Continued
</P>

<PRE>
34               e.printStackTrace();
35           }
36           try {
37               numPlanets = obj.getNumPlanets();
38           }
39           catch (java.rmi.RemoteException e) {
40               System.out.println(&quot;Error calling remote method&quot;);
41               e.printStackTrace();
42           }
43
44           setLayout(new BorderLayout());
45           Panel p = new Panel();
46
47           p.add(new Label(&quot;Planet Number 1_&quot; + numPlanets + &quot;:&quot;));
48           planetNum = new TextField(null, 3);
49           infoButton = new Button(&quot;Info&quot;);
50      p.add(planetNum);
51      p.add(infoButton);
52      add(&quot;North&quot;, p);
53
54      stats = new TextArea();
55      add(&quot;Center&quot;, stats);
56
57      infoButton.addActionListener(this);
58  }
59
60  // This method is called when the Button is clicked.
61  public void actionPerformed(ActionEvent evt) {
62      String text = new String();
63      Planet planet = null;
64      int pnum = 0;
65      try {
66          pnum = Integer.parseInt(planetNum.getText());
67      }
68          catch (Exception e) {
69      }
70      if (pnum &gt; numPlanets || pnum &lt; 1 ) {
71          stats.setText(planetNum.getText() + &quot; is not a valid planet #&quot;);
</PRE>


<A NAME="PAGENUM-747"><P>Page 747</P></A>


<PRE>
72   return;
73 }
74 try {
75   planet = obj.getPlanet(pnum_1);
76    }
77    catch (java.rmi.RemoteException e) {
78        System.out.println(&quot;Error calling remote method&quot;);
79        e.printStackTrace();
80    }
81    stats.setText(&quot;Planet Name:     &quot; + planet.getName() + &quot;\r\n&quot;);
82 stats.appendText(&quot;Number of Moons: &quot; + planet.getMoons() + &quot;\r\n&quot;);
83      if (planet.hasRings())
84               stats.appendText(&quot;Has Rings:        Yes&quot;);
85           else
86               stats.appendText(&quot;Has Rings:        No&quot;);
87       }
88   }
</PRE>

<P>Listing 16.6
</P>

<PRE>
Line==================Java Source=================
01   //////////
02   // PlanetsInfo.java  Interface for an RMI
03   // remote object.
04   //
05   // Author: James L. Weaver   JDK version: 1.1 beta
06   //////////
07   package chapter16.code.planets_rmi;
08
09   public interface PlanetsInfo extends java.rmi.Remote {
10       int getNumPlanets() throws java.rmi.RemoteException;
11       Planet getPlanet(int num) throws java.rmi.RemoteException;
12   }
</PRE>

<P>Listing 16.7
</P>
<PRE>
Line==================Java Source=================
01   //////////
02   // PlanetsImpl.java  Implementation of an RMI
03   // remote object.
04   //
</PRE>

<A NAME="PAGENUM-748"><P>Page 748</P></A>



<PRE>
05   // Author: James L. Weaver   JDK version: 1.1 beta
06   //////////
07   package chapter16.code.planets_rmi;
08
09   import java.rmi.*;
10   import java.rmi.server.UnicastRemoteObject;
11
12   class PlanetsImpl
13           extends UnicastRemoteObject
14           implements PlanetsInfo
15   {
16       Planet planets[] = new Planet[9];
17
18       public PlanetsImpl() throws RemoteException {
19           super();
20
21           // Populate the planets array
22           planets[0] = new Planet(&quot;Mercury&quot;,0, false);
23           planets[1] = new Planet(&quot;Venus&quot;,0, false);
24           planets[2] = new Planet(&quot;Earth&quot;,1, false);
25           planets[3] = new Planet(&quot;Mars&quot;,2, false);
26           planets[4] = new Planet(&quot;Jupiter&quot;,16, true);
27           planets[5] = new Planet(&quot;Saturn&quot;,18, true);
28           planets[6] = new Planet(&quot;Uranus&quot;,15, true);
29           planets[7] = new Planet(&quot;Neptune&quot;,8, true);
30           planets[8] = new Planet(&quot;Pluto&quot;,1, false);
31       }
32
33
34       public int getNumPlanets() throws RemoteException
35       {
36           return planets.length;
37       }
38
39       public Planet getPlanet(int num) throws RemoteException
40       {
41           return planets[num];
42       }
43
</PRE>


<A NAME="PAGENUM-749"><P>Page 749</P></A>


<PRE>
44       public static void main(String args[])
45       {
46           // Create and install the security manager
47           System.setSecurityManager(new RMISecurityManager());
48
49           try {
50               PlanetsImpl obj = new PlanetsImpl();
51               System.out.println(&quot;Binding to PlanetServer&quot;);
52               Naming.rebind(&quot;PlanetServer&quot;, obj);
53               System.out.println(&quot;PlanetsImpl created and bound&quot;);
54           } catch (Exception e) {
55               System.out.println(&quot;PlanetsImpl.main exception&quot;);
56               e.printStackTrace();
57           }
58       }
59   }
</PRE>

<P>Listing 16.8
</P>

<PRE>
Line==================Java Source=================
01   //////////
02   // Planet.java  A class that represents a planet
03   // in the RMI demonstration.
04   //
05   // Author: James L. Weaver   JDK version: 1.1 beta
06   //////////
07   package chapter16.code.planets_rmi;
08
09   class Planet implements java.io.Serializable
10   {
11       private String name;
12       private int moons;
13       private boolean hasRings;
14
15       public Planet(String name, int moons, boolean hasRings) {
16           this.name = name;
17           this.moons = moons;
18           this.hasRings = hasRings;
19       }
</PRE>
<PRE>
                                   						<I>continues</I>
</PRE>
<A NAME="PAGENUM-750"><P>Page 750</P></A>




<P>Listing 16.8, Continued
</P>

<PRE>
20
21       public String getName() {
22           return name;
23       }
24
25       public int getMoons() {
26           return moons;
27       }
28
29       public boolean hasRings() {
30           return hasRings;
31       }
32   }
</PRE>

<P>This is the associated HTML:
</P>

<PRE>
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;TITLE&gt; Planets Applet 2 &lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;APPLET CODEBASE=&quot;../../..&quot;
        CODE=&quot;chapter16.code.planets_rmi.PlanetsApplet2.class&quot;
        WIDTH=300 HEIGHT=300&gt;
&lt;/applet&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;
</PRE>

<P>As shown in figure 16.6, which follows this code walkthrough, the applet asks the <BR>
user to enter a number associated with a planet in our solar system, with 1
representing Mercury and 9 representing Pluto. When the user clicks the Info button, the
information associated with the desired planet is displayed in the text area. To accomplish this,
an object that represents the desired planet is passed as a return value from the
remote object to the client. The client calls a method of the planet object, which is now local,
to get information about that planet.
</P>

<P>To see how this works, first look at the PlanetsInfo interface, which is shown in
listing 16.6. This is the remote interface class for the PlanetsImpl class. Two methods can
be called by the client, as shown in lines 10 and 11 (listing 16.6):
</P>

<A NAME="PAGENUM-751"><P>Page 751</P></A>


<PRE>
10       int getNumPlanets() throws java.rmi.RemoteException;
11       Planet getPlanet(int num) throws java.rmi.RemoteException;
</PRE>

<P>The getNumPlanets() method returns the number of planets in our solar system. The
getPlanet() method returns a Planet object that corresponds to the num argument.
</P>

<P>Listing 16.7 shows the PlanetsImpl class, which is the implementation of the
remote object. Line 16 creates an array that refers to nine instances of the Planet class,
which represents each of the planets.
</P>

<PRE>
16       Planet planets[] = new Planet[9];
</PRE>

<P>Lines 22_30 (listing 16.7) populate the array with Planet objects that know their
name, number of moons, and whether or not they have rings encircling them.
</P>

<PRE>
22           planets[0] = new Planet(&quot;Mercury&quot;,0, false);
23           planets[1] = new Planet(&quot;Venus&quot;,0, false);
24           planets[2] = new Planet(&quot;Earth&quot;,1, false);
25           planets[3] = new Planet(&quot;Mars&quot;,2, false);
26           planets[4] = new Planet(&quot;Jupiter&quot;,16, true);
27           planets[5] = new Planet(&quot;Saturn&quot;,18, true);
28           planets[6] = new Planet(&quot;Uranus&quot;,15, true);
29           planets[7] = new Planet(&quot;Neptune&quot;,8, true);
30           planets[8] = new Planet(&quot;Pluto&quot;,1, false);
</PRE>

<P>When the getNumPlanets() method is called, it returns the length of the planets array.
</P>

<PRE>
34       public int getNumPlanets() throws RemoteException
35       {
36           return planets.length;
37       }
</PRE>

<P>When the getPlanet() method is called, it returns the specified array element, which is
a reference to the desired Planet instance.
</P>

<PRE>
39       public Planet getPlanet(int num) throws RemoteException
40       {
41           return planets[num];
42       }
</PRE>

<P>Listing 16.8 shows the Planet class. For a class to be passed as a parameter or a
return value, it must implement the java.io.Serializable interface, as shown in line 9.
</P>

<P><CENTER>
<a href="0742-0745.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0752-0755.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

