<HTML>
<HEAD>


<TITLE>Inside Java:Remote Method Invocation and Object Serialization:EarthWeb Inc.-</TITLE>







<P><CENTER>
<a href="0727-0731.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0738-0741.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-732"><P>Page 732</P></A>


<UL>
<LI>          GreetingGenImpl_Stub is the stub, or proxy, class that the applet calls.
<LI>          GreetingGenImpl_Skel is the skeleton class with which the stub communicates
to make the call to the remote object.
</UL>

<P><a href="images\ch16fg04.jpg"><img src="images\tn_ch16fg04.jpg"></a><BR>
Figure 16.4
<I>HelloApplet2 classes.</I>
</P>

<P>The following steps transform and execute the applet:
</P>

<OL>
<LI>          Code the GreetingGen interface, based upon the existing GreetingGen class.
<LI>          Code the GreetingGenImpl class, based upon the existing GreetingGen class.
<LI>          Modify the applet by making it invoke methods of the remote GreetinGenImpl
class instead of invoking methods of the GreetingGen class.
<LI>          Compile the files with javac.
<LI>          Using the rmic compiler, generate the GreetingGenImpl_Stub
and GreetingGenImpl_Skel classes.
<LI>          Start the RMI registry.
<LI>          Start the remote server and register the remote object.
<LI>          Run the applet.
</OL>

<P>This example, HelloApplet2, can be found on the accompanying CD.
</P>

<P>Listings 16.2, 16.3, and 16.4 illustrate the HelloApplet2 applet and server
components described in this section&#151;the GreetingGen interface and the GreetingGenImpl class.
The
</P>

<A NAME="PAGENUM-733"><P>Page 733</P></A>


<p>
sections following the listings demonstrate each of the above steps to transform
the HelloApplet1 applet into the HelloApplet2 applet and server components.
</p>

<P>Listing 16.2
</P>
<PRE>
Line==================Java Source=================
01   //////////
02   // HelloApplet2.java Example of transforming an applet
03   // into the RMI model.
04   //
05   // Author: James L. Weaver
06   //////////
07   package chapter16.code.hello_remote2;
08
09   import java.awt.*;
10   import java.applet.*;
11   import java.rmi.*;
12   import java.awt.event.*;
13
14   public class HelloApplet2 extends Applet
15                              implements ActionListener{
16
17       Button pushButton;
18       Label greetingLabel;
19
20       GreetingGen obj;
21
22       public void init() {
23           pushButton = new Button(&quot;Push&quot;);
24           add(pushButton);
25
26           // Add an event &quot;listener&quot; for when an action
27           // event happens to this button. The
28           // actionPerformed method of the listener will
29           // be called.
30           pushButton.addActionListener(this);
31
32           greetingLabel = new Label(&quot;Hello Remote World!&quot;);
33           add(greetingLabel);
34
</PRE>
<PRE>
                                        						<I>continues</I>
</PRE>


<A NAME="PAGENUM-734"><P>Page 734</P></A>



<P>Listing 16.2, Continued
</P>

<PRE>
35      try {
36          obj = (GreetingGen)Naming.lookup(&quot;//&quot; +
37              getCodeBase().getHost() + &quot;/GreetingServer&quot;);
38      } catch (Exception e) {
39          System.out.println(&quot;HelloApplet2: an exception occurred:&quot;);
40          e.printStackTrace();
41      }
42  }
43
44  // This method is called when the Button is clicked.
45  public void actionPerformed(ActionEvent evt) {
46      try {
47          greetingLabel.setText(
48                  obj.makeGreeting(greetingLabel.getText()));
49          // Take next line out when bug in JDK 1.1 beta is fixed
50          greetingLabel.repaint();
51      }
52      catch (java.rmi.RemoteException e) {
53          System.out.println(&quot;Error calling remote method&quot;);
54          e.printStackTrace();
55      }
56    }
57  }
</PRE>

<P>Listing 16.3
</P>
<PRE>
Line==================Java Source=================
01   //////////
02   // GreetingGen.java  Interface for an RMI
03   // remote object.
04   //
05   // Author: James L. Weaver   JDK version: 1.1
06   //////////
07   package chapter16.code.hello_remote2;
08
09   public interface GreetingGen extends java.rmi.Remote {
10       String makeGreeting(String lastGreeting)
11               throws java.rmi.RemoteException;
12   }
</PRE>

<A NAME="PAGENUM-735"><P>Page 735</P></A>



<P>Listing 16.4
</P>
<PRE>
Line==================Java Source=================
01   //////////
02   // GreetingGenImpl.java  Implementation of an RMI
03   // remote object.
04   //
05   // Author: James L. Weaver   JDK version: 1.1
06   //////////
07   package chapter16.code.hello_remote2;
08
09   import java.rmi.*;
10   import java.rmi.server.UnicastRemoteObject;
11
12   class GreetingGenImpl
13           extends UnicastRemoteObject
14           implements GreetingGen
15   {
16       String helloString;
17       String goodbyeString;
18
19       public GreetingGenImpl() throws RemoteException {
20           super();
21
22           // Set up the two greeting possibilities
23           helloString = new String(&quot;Hello Remote World!&quot;);
24           goodbyeString = new String(&quot;Goodbye!&quot;);
25       }
26
27       public String makeGreeting(String lastGreeting)
28                       throws RemoteException {
29           String newGreeting;
30
31           // Toggle between the two greetings
32           if (lastGreeting.equals(helloString))
33               newGreeting = goodbyeString;
34           else
35               newGreeting = helloString;
36           return newGreeting;
</PRE>
<PRE>
                                    							<I>continues</I>
</PRE>


<A NAME="PAGENUM-736"><P>Page 736</P></A>


<P>Listing 16.4, Continued
</P>
<PRE>
37       }
38
39       public static void main(String args[])
40       {
41           // Create and install the security manager
42           System.setSecurityManager(new RMISecurityManager());
43
44           try {
45               GreetingGenImpl obj = new GreetingGenImpl();
46               System.out.println(&quot;Binding to GreetingServer&quot;);
47               Naming.rebind(&quot;GreetingServer&quot;, obj);
48               System.out.println(&quot;GreetingGenImpl bound&quot;);
49           } catch (Exception e) {
50               System.out.println(&quot;GreetingGenImpl.main exception&quot;);
51               e.printStackTrace();
52           }
53       }
54   }
</PRE>

<P>This is the associated HTML:
</P>

<PRE>
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;TITLE&gt; Hello Remote World &lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;APPLET CODEBASE=&quot;../../..&quot;
        CODE=&quot;chapter16.code.hello_remote2.HelloApplet2.class&quot;
        WIDTH=300 HEIGHT=100&gt;
&lt;/applet&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;
</PRE>

<A NAME="PAGENUM-737"><P>Page 737</P></A>



<P><b>Code the GreetingGen Interface</b>
</P>

<P>Each remote object must have a remote interface, which declares the methods that can
be called by the client application. Listing 16.3 is the GreetingGen interface, which is
the interface for the GreetingGenImpl remote object. The next section examines this interface.
</P>

<P>Line 9 extends the GreetingGen interface from the Remote interface in the
java.rmi package. All remote object interfaces must extend the java.rmi. Remote interface:
</P>

<PRE>
09   public interface GreetingGen extends java.rmi.Remote {
</PRE>

<P>The remote interface also must be public, so that the client can access it.
</P>

<P>Lines 10 and 11 specify the method in the remote object that can be called by a client:
</P>

<PRE>
10       String makeGreeting(String lastGreeting)
11               throws java.rmi.RemoteException;
</PRE>

<P>In this simple example, only one method exists, but a remote object can have as
many methods as required. The remote object also can contain methods that aren't
specified by the remote object interface, but these cannot be invoked by a client. Each method
in the interface must declare that it throws java.rmi.RemoteException for the client to
handle remote exceptions or pass them on.
</P>

<P>In addition to RemoteException and Remote, the RMI examples in this chapter use a
few other classes and interfaces in the java.rmi and java.rmi.server packages. The
additional classes are:
</P>

<UL>
<LI>          RemoteObject&#151;The superclass for all remote objects.
<LI>          RemoteServer&#151;The superclass for all remote servers.
<LI>          UnicastRemoteObject&#151;A specific type of remote server.
<LI>          Naming&#151;A mechanism for obtaining references to remote objects.
<LI>          RMISecurityManager&#151;Defines the RMI stub security policy for applications.
</UL>

<P>Figure 16.5 illustrates these classes, which will be covered shortly.
</P>

<P>Now that the remote object interface has been coded, let's create the
implementation class for the remote object.
</P>
<P><CENTER>
<a href="0727-0731.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0738-0741.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

