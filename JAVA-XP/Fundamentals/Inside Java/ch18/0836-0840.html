<HTML>
<HEAD>


<TITLE>Inside Java:Servlets and the Java Web Server:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0832-0835.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0841-0845.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-836"><P>Page 836</P></A>



<P>Listing 18.1, Continued</P>
<PRE>
44    tbl.addHeader(&quot;Value&quot;);
45    int index = 0;
46    String fieldname;
47    while ((fieldname = req.getHeaderName(index)) != null) {
48      nextRow(tbl, fieldname, req.getHeader(index));
49      index++;
50      }
51    page.add(tbl);
52    page.write(out);
53    }
54
55    void nextRow(HtmlTable tbl, String name, String value) {
56    tbl.newRow();
57    tbl.addData(&quot;&lt;strong&gt;&quot; + name + &quot;:&lt;/strong&gt;&quot;);
58    if (value != null)
59      tbl.addData(&quot;&lt;em&gt;&quot; + value + &quot;&lt;/em&gt;&quot;);
60    }
61
62    void nextRow(HtmlTable tbl, String name, int value) {
63    nextRow(tbl, name, Integer.toString(value));
64    }
65  }
</PRE>

<P>Lines 6_13 in listing 18.1 indicate that the servlet is using HTTP and define a
servlet information method. Regular servlets subclass HttpServlet, but
server-side-includes servlets subclass GenericServlet.
The actual work of the servlet is performed in lines
14_53 in the service() method where you output a hello message and information from
the HTTP request. The processing steps are described next:
</P>

<OL>
<LI>          Prepare the response header.

<BR>         The first step is setting the response header information. The servlet can create
its response by using the HttpServletResponse passed to the
service() method. Alternatively, to have complete control of the response contents, you can reset
the HttpServletResponse and write the response header directly to
the ServletOutputStream. Before calling service(), the server sets the
HttpServletResponse status to 200 or &quot;OK,&quot; the &quot;Date:&quot; header field is set to the current date and
time, and the &quot;Server:&quot; header field is set to identify the server. If there is an error or
OK is not the correct status, the servlet can specify both an error code and
some descriptive text. If only an error code is given, the code is translated into a
standard
</OL>
<A NAME="PAGENUM-837"><P>Page 837</P></A>


<OL START="2">
status text string. Normally, you would not change these values. Because
the default values are appropriate for this response, you just use
the HttpServletResponse object.

<BR>          As shown on line 17, you need to identify the type of data contained in the
response by specifying the MIME type as follows:

<PRE>
17    res.setContentType(&quot;text/html&quot;);
</PRE>


          This declares the response should be interpretted by the browser as text
formatted as HTML. Along with specifying the content type, you may optionally specify
the content length.

<LI>          Get the output stream.

<BR>          In line 16, to write the content, the servlet calls
getOutputStream() to get a ServletOutputStream as follows:

<PRE>
16    ServletOutputStream out = res.getOutputStream();
</PRE>

<LI>         Create the HTML page object, title, and header.
<BR>          You can create your HTML either manually by using
print() statements, or by using any HTML support package, such as the one provided as part of the Servlet
API. For this example, you use the HTML generation classes from java.servlet.html
and on lines 18 and 19 create a new HtmlPage with an H1 header.</P>

<LI>         Display the request information as a table.

<BR>          Lines 21_40 display the information available from the HTTP request as a table.
You allocate an HtmlTable object and add column headers and rows of data.
Finally, write the contents of the table to the output stream.</P>


<LI>       Display the HTTP header fields as a table.

<BR>          Lines 42_50 display the HTTP request header fields as a table. Again, you
allocate an HtmlPage object and add column headers and rows of data. Note how you
iterate the request headers using an index. You can also get field contents by using
the name of the header field.</P>


<LI>        Transmit the response.

<BR>          Finally, write the HTML for the page to the ServletOutputStream. The
response header that you created in step 1 is automatically written to the
ServletOutputStream before your first write is handled.
<BR>          Lines 55_64 define methods to help create the table. A sample of the output of
the
</OL>

<A NAME="PAGENUM-838"><P>Page 838</P></A>


<OL>
servlet is shown in figure 18.2.
</OL>

<H4><A NAME="ch18_ 12">
Handling HTML Forms
</A></H4>

<P>When using HTML forms, the browser extracts the information entered into the form
by the user and sends it to the server as either a GET or POST request. Because
form processing is such a common servlet activity, the Servlet API includes a built-in
Servlet class specific for forms handling the FormServlet class.
</P>

<P>In the following example, the PlanetsApplet remote method invocation example
in Chapter 16, &quot;Remote Method Invocation and Object Serialization,&quot; is rewritten as
a servlet. This servlet implements a simple form that supports querying of planet
informa
</P>

<P>
<a href="images\ch18fg02.jpg"><img src="images\tn_ch18fg02.jpg"></a><BR>
Figure 18.2 <i>Sample HelloWorldServlet output.</i><BR>
</P>

<P>tion and incrementing the number of moons; the planet information is stored as
a serialized object. To run this example servlet on the Java Web Server, you must
specify the following:
</P>

<UL>
<LI>          A rule that translates the URL in the generated HTML (/planets) to the name of
the servlet (planets).
</UL>

<A NAME="PAGENUM-839"><P>Page 839</P></A>


<UL>
<LI>          The class name for the servlet code (PlanetsServlet).
<LI>          The initialization parameter that identifies the file containing planetary information.
<LI>          The addition of the servlet to the list of servlets loaded at startup.
</UL>

<P>You can reconfigure the server by using the administration servlet or by editing
the configuration files as described in table 18.16. After compiling the servlet, copy the
.class files into the /servlet directory, which is the default location of servlet code.
</P>

<P><B> Table 18.16</B><BR>
Configuration Changes Necessary for Running
PlanetsServlet Example on 
Java Web Server
</P>


<TABLE>

<TR><TD>
File
</TD><TD>
Change
</TD><TD>
Additions
</TD></TR><TR><TD>
rules.properties
</TD><TD>
add
</TD><TD>
/planets=planets
</TD></TR><TR><TD>
servlet.properties
</TD><TD>
edit
</TD><TD>
servlets.startup= file cgi invoker
imagemap admin proxy error planets
</TD></TR><TR><TD>
</TD><TD>
add
</TD><TD>
planets.code=PlanetsServlet
planets.initArgs=\
file=servlets/planetlist
</TD></TR></TABLE>

<P>The code in listing 18.2 ( PlanetsServlet.java on the CD-ROM accompanying this
book) subclasses FormServlet, overrides the
sendResponse() method, and uses the HTML support classes to generate the response.
</P>

<P>Listing 18.2
</P>

<PRE>
Line==================Java Source=================
001  import java.io.*;
002  import java.servlet.*;
003  import java.servlet.html.*;
004  import java.servlet.http.*;
005  import java.util.*;
</PRE>


<A NAME="PAGENUM-840"><P>Page 840</P></A>


<PRE>
006
007  // the Planet object holds the information about a given planet
008  class Planet implements Serializable {
009    private String name;
010    private int moons;
011    private boolean hasRings;
012
013    public Planet(String name, int moons, boolean hasRings) {
014      this.name = name;
015      this.moons = moons;
016      this.hasRings = hasRings;
017    }
018
019    public String getName() {
020      return name;
021    }
022
023    public int getMoons() {
024      return moons;
025    }
026
027    public boolean hasRings() {
028      return hasRings;
029    }
030
031    public synchronized void bumpMoons() {
032      moons++;
033    }
034  }
035
036  public class PlanetsServlet extends FormServlet {
037    Vector planets;
038    String file;
039
040    public void PlanetsServlet() {
041    }
042
043    public String getServletInfo() {
044      return &quot;This servlet displays information about the planets.&quot;;
</PRE>

<P><CENTER>
<a href="0832-0835.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0841-0845.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

