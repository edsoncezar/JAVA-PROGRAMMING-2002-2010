<HTML>
<HEAD>


<TITLE>Inside Java:Servlets and the Java Web Server:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0846-0849.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0855-0858.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-850"><P>Page 850</P></A>


<H4><A NAME="ch18_ 15">
Processing HTTP Requests
</A></H4>

<P>The Java Web Server is built by using the Java Server Development Toolkit and has
a main thread that accepts incoming connections on a ServerSocket as defined by
the server.port configuration parameter, deploys the actual service processing to a
handler thread, and loops back to accept additional connections. The handler threads
are allocated from a pool of service threads to reduce the overhead of thread allocation
for each request. By using a different thread to handle each connection, the server
can service several clients concurrently. Server connection processing and request
handling is shown in figure 18.4.
</P>

<P>To handle a request, the HTTP server carries out the following tasks:
</P>

<P>
<a href="images\ch18fg04.jpg"><img src="images\tn_ch18fg04.jpg"></a><BR>
Figure 18.4 <i>Server request handling.</i><BR>
</P>

<OL>
<LI>          Creates an HttpServletRequest object from the information in the HTTP
request header. This object performs the same functions as the environment variables
used to communicate request information to CGI programs.
<LI>          Applies the path translation rules found in the rules.properties file to convert
the URL into the name of the appropriate servlet. All URLs are converted into a
servlet name; the longest matching rule is used to perform the translation.
<LI>          Verifies access permission to the resource according to the information in
the acl.properties file. If your file service and invocation servlets do not use
the standard names &quot;file&quot; and &quot;invoker&quot; they will need to implement their own
access checking.
<LI>          Translates the servlet name according to the information in the servlet.properties
file
</OL>
<A NAME="PAGENUM-851"><P>Page 851</P></A>


<OL START="5">
into a full pathname, such as URL, codebase, or class name information
that specifies how to load the servlet.<BR>

<LI>          Loads and, if necessary, initializes the servlet. Every HTTP request either invokes
a servlet or returns an error. Initialization parameters for each servlet can be
specified in the servlet.properties file; these parameters are passed to the
init() method after the servlet is loaded but before the
service() method is called.
<LI>          Creates an HttpServletResponse object with basic response information, such
as the server identification and current time.
<LI>          Calls the servlet's service() method passing the request and response objects
as arguments.
<LI>          Completes the transaction by ensuring the response is sent and, if appropriate,
the connection is closed.
</OL>

<P>This process is shown in figure 18.5.
</P>

<P>Because servlets can be identified by a full URL, servlets can be downloaded from
the <BR>

<P>
<a href="images\ch18fg05.jpg"><img src="images\tn_ch18fg05.jpg"></a><BR>
Figure 18.5 <i>The servlet loading process.</i>
</P>

<P>network, in a way similar to applets, and executed on the server. The upcoming
section &quot;Untrusted Servlet Security Sandbox&quot; describes how such servlets are handled.
</P>
<A NAME="PAGENUM-852"><P>Page 852</P></A>



<H4><A NAME="ch18_ 16">
Providing Security
</A></H4>

<P>As Web servers expand their roles from simply providing users with access to
publicly available documents to becoming the center of workgroup and enterprise
computing, security becomes increasingly important. Not all files, directories, or servlets should
be accessible to anyone who knows the URL. The Java Web Server, for example, has
a built-in administration applet/servlet pair that enables an administrator to reconfigure
the server; obviously access to this servlet must be controlled. You may want to
control access to Web pages in the same manner that file servers provide read-access
controls for files. The security model of Web servers resembles the security measures found
on traditional file servers and shared computers.
</P>

<P><B>Security Features</B>
</P>

<P>The Java Web Server offers a variety of security and protection mechanisms for
your server. These are based on HTTP's security features, the Secure Sockets Layer
(SSL), and the security mechanisms inherent in Java's protected Virtual Machine
environment. The server's authentication modes are specified on an individual file or servlet basis.
</P>

<P>The Java Web Server supports the following security mechanisms:
</P>

<UL>
<LI>          Basic HTTP username/password authentication
<LI>          Digest authentication
<LI>          Secure sockets layer
<LI>          Access control lists
</UL>

<P><B>Untrusted Servlet Security Sandbox</B>
</P>

<P>For running untrusted servlets, the Java Web Server provides a secured
environment that isolates the untrusted servlet from the rest of the HTTP server. Trusted
servlets execute on a thread in the main server's thread group. Untrusted servlets execute in
a thread group separate from the server's group. The use of a separate thread
group prevents a servlet from trying to interfere with the main processing task. The
untrusted servlet environment limits access to network resources, files, and server
configuration information by adding a servlet security manager that checks for risky operations
and blocks them. Execution of untrusted servlets is shown in figure 18.6.
</P>
<A NAME="PAGENUM-853"><P>Page 853</P></A>



<P>
<a href="images\ch18fg06.jpg"><img src="images\tn_ch18fg06.jpg"></a><BR>
Figure 18.6 <i>Untrusted servlet handling.</i>
</P>

<H4><A NAME="ch18_ 17">
Built-In Servlets
</A></H4>

<P>Because the Servlet API is efficient and powerful, many of the features often
coded directly into an HTTP server are implemented as servlets in the Java Web Server.
This use of servlets simplifies the base server code and enables server administrators
and users to customize server features by providing additional servlets. Because of
the object-oriented nature of the Servlet API, you can subclass existing servlets to
create new servlets customized for your application. The Java Web Server includes
several standard servlets to provide the functions commonly available in HTTP servers.
These core servlets are as follows:
</P>

<UL>
<LI>          File servlet (FileServlet) accesses files and directories
<LI>          Server-side include servlet (SSIncludeServlet) processes server-side include files
<LI>          Error servlet (ErrorServlet) creates custom error responses
<LI>          Invoker servlet (InvokerServlet) invokes an arbitrary servlet
<LI>          Imagemap servlet (ImagemapServlet) handles image maps on the server
<LI>          CGI invoker servlet (CGIServlet) runs CGI programs
<LI>          Administration servlet (AdminServlet) performs administrative tasks
</UL>

<P>Generally, the standard servlets are not really designed to be subclassed; in the
interest of efficiency, most provide only public
service() and sendResponse() methods. The FormServlet, however (part of the Servlet API and discussed in detail in the section
at the beginning of this chapter), and the ErrorServlet are designed to be modified
to perform custom forms processing and to provide custom error messages.
</P>
<A NAME="PAGENUM-854"><P>Page 854</P></A>



<P><B>FileServlet</B>
</P>

<P>The FileServlet provides you with the normal static content file serving
functions expected of an HTTP server. The URL path translation rules are set to default
requests not<B> </B>handled by other servlets<B>
</B>to the FileServlet. The FileServlet only supports GET
and HEAD requests; an error is returned for any other HTTP method. If the requested file is
a directory, the servlet returns the contents of a Welcome file residing in the
requested directory. The default name of the Welcome file is index.html. If the Welcome file is
not found, the servlet returns a formatted directory listing. You can change the name of
the Welcome file by adding a welcome=&quot;pagename.html&quot; entry to httpd.properties.
</P>

<P>If a file is requested, the servlet determines the correct content type by matching the
file extension against those in the mime.properties file. The FileServlet has an internal
cache to hold the contents of frequently requested documents. If the file size is less than
a configured value, the file is read into an internal buffer and cached. The file caching
size is specified by the ramcache.entry.size entry in the httpd.properties file; the default
value is 8,000 bytes.
</P>

<P>If the MIME type of the file is &quot;java-internal/parsed-HTML,&quot; the content type is set <BR>
to &quot;text/html&quot; and the FileServlet calls the server-side include servlet for
additional processing of the file. By default, the extension of files that contain server-side
includes is .shtml, as specified in the mime.properties file.
</P>

<P><B>Server-Side-Include Servlet</B>
</P>

<P>If the MIME type of the file is &quot;java-internal/parsed-html,&quot;
the SSIncludeServlet further processes the file to resolve any references to servlets embedded in the document.
By default, these files have extensions of .shtml. As the document is written to the
client, the SSIncludeServlet scans for the newly defined &lt;servlet&gt; HTML tag. When this tag
is encountered, the servlet identified in the attributes of the tag is invoked and its output
is sent to the client in place of the &lt;servlet&gt; &lt;/servlet&gt; HTML element. You can invoke
any servlet as a server-side include and you can invoke any server-side include servlet as
a regular HTTP servlet by using the InvokerServlet. Of course, whether or not the
output is meaningful depends on the exact servlet combination.
</P>

<P>The server-side includes supported by SSIncludeServlet are not the same as
that supported by many other HTTP servers, such as NCSA and Netscape, that
embed server-side include commands inside HTML comments. The Java Web
Server-supported server-side includes can only be used to invoke servlets and to insert the output into
the current document. The syntax for invoking servlets follows:
</P>

<PRE>
&lt;servlet name=Name code=Code.class codebase=CodeBase
initParam1=initArg1 initParam2=initArg2&#133;&gt;
&lt;param name=param1 value=val1&gt;
&lt;param name=param2 value=val2&gt;
</PRE>


<P><CENTER>
<a href="0846-0849.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0855-0858.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

