<HTML>
<HEAD>


<TITLE>Inside Java:The New, Improved AWT: Menus, Events, and More New Features:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0633-0638.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="..\ch15\0645-0648.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-639"><P>Page 639</P></A>


<P>Listing 14.5
</P>
<PRE>
Line==================Java Source=================
001   //////////
002   // ClipboardDemo.java  Demonstrates how to
003   // use the clipboard from a Java program.
004   //
005   // Author: James L. Weaver  JDK 1.1 beta1
006   //////////
007   package chapter14.code.clipboarddemo;
008
009   import java.awt.*;
010   import java.awt.event.*;
011   import java.util.*;
012   import java.awt.datatransfer.*;
013
014   public class ClipboardDemo extends Frame
015                       implements ActionListener {
016
017       TextField tf1, tf2;
018       Menu editMenu;
019       MenuItem miCut;
020       MenuItem miCopy;
021       MenuItem miPaste;
022       Clipboard clip;
023
024       public ClipboardDemo() {
025           super(&quot;Java Clipboard Demonstration&quot;);
026
027           // Get a reference to the native clipboard
028           clip = getToolkit().getSystemClipboard();
029
030           addWindowListener(new Wadapt());
031           setSize(300, 200);
032           setLayout(new FlowLayout());
033
034           // Create two text fields to cut, copy, and paste in
035           tf1 = new TextField(null, 10);
036           tf2 = new TextField(null, 10);
</PRE>
<PRE>
                                                                 <I>continues</I>
</PRE>

<A NAME="PAGENUM-640"><P>Page 640</P></A>




<P>Listing 14.5, Continued
</P>
<PRE>
037           add(tf1);
038           add(tf2);
039
040           buildMenu();
041           setVisible(true);
042           tf1.requestFocus();
043       }
044
045       private void buildMenu() {
046           // Create a menu bar and set in in the frame
047           MenuBar mb = new MenuBar();
048           setMenuBar(mb);
049
050           // Create and populate an Edit menu
051           editMenu = new Menu(&quot;Edit&quot;);
052           mb.add(editMenu);
053
054           miCut = new MenuItem(&quot;Cut&quot;);
055           miCut.setActionCommand(&quot;Cut&quot;);
056           miCut.addActionListener(this);
057           editMenu.add(miCut);
058
059           miCopy = new MenuItem(&quot;Copy&quot;);
060           miCopy.setActionCommand(&quot;Copy&quot;);
061           miCopy.addActionListener(this);
062           editMenu.add(miCopy);
063
064           miPaste = new MenuItem(&quot;Paste&quot;);
065           miPaste.setActionCommand(&quot;Paste&quot;);
066           miPaste.addActionListener(this);
067           editMenu.add(miPaste);
068       }
069
070       public void actionPerformed(ActionEvent evt) {
071           TextField tf;
072           String str;
073           int caret;
074
</PRE>

<A NAME="PAGENUM-641"><P>Page 641</P></A>


<PRE>
075           // If Cut or Copy is chosen, get the selected text of the
076           // text field that has focus and put it on the clipboard.
077           if (evt.getActionCommand().startsWith(&quot;C&quot;)) {
078               if (getFocusOwner() instanceof TextField) {
079                   tf = (TextField)getFocusOwner();
080                   str = tf.getText();
081                   StringSelection cbdata =
082                           new StringSelection(tf.getSelectedText());
083                   clip.setContents(cbdata, cbdata);
084
085                   // If Cut is chosen, cut out the selected text by
086                   // concatenating what was before the selection with
087                   // what was after the selection, and placing it in
088                   // the text field.
089                   if (evt.getActionCommand().equals(&quot;Cut&quot;)) {
090                       caret = tf.getSelectionStart();
091                       str = str.substring(0, tf.getSelectionStart())
092                           + str.substring(tf.getSelectionEnd());
093                       tf.setText(str);
094                       tf.setCaretPosition(caret);
095                   }
096               }
097           }
098           else if (evt.getActionCommand().equals(&quot;Paste&quot;)) {
099               // Get the contents of the clipboard and verify that
100               // the component that has focus is a text field.
101               Transferable cbdata = clip.getContents(this);
102               if (getFocusOwner() instanceof TextField) {
103                   tf = (TextField)getFocusOwner();
104                   if (cbdata != null) {
105                       try {
106                           // Try to get data from the clipboard as
107                           // a String.
108                           String data = (String)cbdata.
&Acirc;getTransferData(
109                                   DataFlavor.stringFlavor);
110                           // Insert the string at the cursor, deleting
111                           // any selected text.
112                           caret = tf.getSelectionStart();
</PRE>
<PRE>
                                                                  <I>continues</I>
</PRE>

<A NAME="PAGENUM-642"><P>Page 642</P></A>

<P>Listing 14.5, Continued
</P>


<PRE>
113                           str = tf.getText();
114                           str = str.substring(0, tf.
&Acirc;getSelectionStart())
115                               + data
116                               + str.substring(tf.getSelectionEnd());
117                           tf.setText(str);
118                           tf.setCaretPosition(caret + data.length());
119                       }
120                       catch (Exception e) {
121                           System.out.println(&quot;Data not string flavor&quot;);
122                       }
123                   }
124               }
125           }
126       }
127
128       public static void main(String args[]) {
129           ClipboardDemo cdFrame = new ClipboardDemo();
130           return;
131       }
132   }
133
134   class Wadapt extends WindowAdapter
135   {
136       public void windowClosing(WindowEvent evt) {
137           Frame frm = (Frame)evt.getSource();
138           frm.setVisible(false);
139           frm.dispose();
140           System.exit(0);
141       }
142   }
</PRE>
<P>The steps that you can take to put a String on the clipboard are as follows:
</P>

<OL>
<LI>       Get a reference to the native system clipboard.
<BR>
          Line 28 calls the
getSystemClipboard() method of the Toolkit class to get the
necessary reference.
</OL>

<A NAME="PAGENUM-643"><P>Page 643</P></A>



<OL START="2">
<LI>       Create a StringSelection object that contains the String to be placed on the
clipboard.<BR>
<BR>          In lines 81 and 82 a StringSelection object is created using the selected text in
the active text field as the constructor. Line 79 returned the active text field by
calling the getFocusOwner() method of the frame.<BR>
<BR>          The StringSelection class is a convenience class for transferring strings to and
from the clipboard. This class implements the two interfaces listed previously;
Transferable and ClipboardOwner.<BR><BR>
<LI>         Place the String on the clipboard.
<BR>          Line 83 calls the setContents() method of the Clipboard class to accomplish this.
The parameters of the setContents() method are:
<UL>
<LI>                  A Transferable object that contains the data being placed on the clip-
                    board. The Transferable object in this case is cbdata, an instance of
               StringSelection.
<LI>                   A ClipboardOwner object, which has a method named
lostOwnership()                     that is called when the object no longer owns the data on the clipboard.
</UL>
          This is usually a result of another object placing data on the clipboard.
</OL>

<P>The object that implements the Transferable interface must contain the data
being transferred. The object that implements the ClipboardOwner interface, however, can
be any object, not always the one that contains the data as is the case here.
The StringSelection class implements the ClipboardOwner interface out of
convenience, because you will not usually care when the clipboard changes ownership.
</P>

<P>The steps that you can take to retrieve a String from the clipboard are as follows:
</P>

<OL>
<LI>         Get a reference to the native system clipboard.
         As pointed out before, this is taken care of in line 28.
<LI>        Get the Transferable object from the clipboard (if one exists).
         Line 101 calls the getContents() method of the Clipboard class that returns a
reference to the Transferable object on the clipboard. The argument to this method is
a reference to the requesting object.<BR>
<LI>        Get the data from the Transferable object in the desired format or &quot;data flavor.&quot;
</OL>


<A NAME="PAGENUM-644"><P>Page 644</P></A>



<P>Lines 108 and 109 call the getTransferData() method of the Transferable object with
an argument that describes the desired &quot;data flavor,&quot; in this case String. The
getTransferData() method returns an Object that must be cast into the desired type. This method throws
an UnsupportedFlavorException if the data is not available in the requested flavor.
</P>

<P>In addition to the getTransferData() method, the Transferable interface defines two
methods that enable you to find out which data flavors are available:
</P>

<UL>
<LI>        DataFlavor[]
getTransferDataFlavors()&#151;Returns an array of available data flavors.
<LI>         Boolean isDataFlavorSupported(DataFlavor)&#151;Returns true if the given data
flavor is supported.
</UL>

<P>Finally, lines 112_118 update the text field that is the target of the paste operation.
</P>

<H3><A NAME="ch14_ 22">
Summary
</A></H3>

<P>In this chapter, you learned how to create menu bar menus, pop-up menus, and how
to assign shortcut keys to them. You also learned about the new JDK 1.1 Delegation
Event Model, the associated event listeners, and the new event class hierarchy. The
chapter
</P>


<P>
<a href="images\ch14fg12.jpg"><img src="images\tn_ch14fg12.jpg"></a><BR>
Figure 14.12 <I>ClipboardDemo application display.</I>
</P>


<P>also presented the Extended Component Event Model as a way to make use of
the Delegation Event Model mechanisms in sub-classed components by overriding
the event processing methods. Lastly, this chapter covered focus traversal,
accessing desktop colors, printing, and clipboard programming.
</P>

<P>The next chapter focuses on the Java component architecture known as Java Beans.
You also learn about two more AWT features new to JDK 1.1: printing from a Java
program and using the clipboard.
</P>
<BR>
<P><CENTER>
<a href="0633-0638.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="..\ch15\0645-0648.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

