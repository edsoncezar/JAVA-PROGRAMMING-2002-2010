<HTML>
<HEAD>


<TITLE>Inside Java:Java Beans: Java's Component Architecture:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0659-0662.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0667-0671.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-663"><P>Page 663</P></A>


<PRE>
099           for (int i=0; i&lt;day; i++) {
100               body.add(new Label());
101           }
102
103           // Put the date buttons in
104           Button dayBtn;
105           for (int i=1; i&lt;=32; i++) {
106               // Convert integers to strings
107               dayBtn = new Button(new Integer(i).toString());
108               dayBtn.addActionListener(this);
109               body.add(dayBtn);
110
111               // Increment the date
112               calendar.add(Calendar.DATE, 1);
113
114               // Make the currently selected date receive focus
115               if (i == dayNum)
116                   dayBtn.requestFocus();
117
118               // Stop adding buttons when a new month is reached
119               if (calendar.get(Calendar.DATE) &lt;= 1)
120                   break;
121           }
122           // Restore the current values
123           calendar.set(yearNum, monthNum, dayNum);
124           body.validate();
125       }
126
127       public synchronized void actionPerformed(ActionEvent e) {
128           if (e.getSource() == prevMonth || e.getSource() == nextMonth) {
129               // The previous or next month button was clicked, so
130               // set the day of the month to 1, and go to the
131               // proper month
132               calendar.set(Calendar.DATE, 1);
133               calendar.add(Calendar.MONTH,
134                            e.getSource() == prevMonth ? _1 : 1);
135               displayCalendar();
136            }
137            else {
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>



<A NAME="PAGENUM-664"><P>Page 664</P></A>


<P>
Listing 15.3, Continued
</P>
<PRE>
138                // One of the day buttons was clicked, so set the
139                // calendar object to that date
140                calendar.set(Calendar.DATE, Integer.parseInt(
141                            ((Button)e.getSource()).getLabel()));
142           }
143           // Create and post a mouse event that simulates a mouse
144           // click directly on the top of the containment hierarchy.
145           // By doing this, the instance of the Bean can be
146           // accessed by the mouse listener.
147           EventQueue.getEventQueue().postEvent(new MouseEvent(this,
148                              MouseEvent.MOUSE_CLICKED, 0,0,0,0,1));
149       }
150   }
</PRE>

<P>In listing 15.3, lines 15 and 16 extend the Calendar1 Bean from the Panel class. Most
of the functionality of the Bean happens when the date buttons or previous
month/next month buttons are pressed, so all that these buttons require is a container in which
to live. For this reason, the Panel&#151;the simplest of all container subclasses&#151;is chosen.
</P>

<PRE>
015   public class Calendar1 extends Panel
016                implements Serializable, ActionListener
</PRE>

<P>Line 31 uses the new GregorianCalendar class, which is a subclass of the new,
very powerful Calendar class (not to be confused with the Calendar1 class that you are
now reviewing). This version of the GregorianCalendar constructor creates an instance
with the current date and time.
</P>
<PRE>
031           calendar = new GregorianCalendar();
</PRE>

<P>Many Date class methods have been replaced by Calendar class methods because
of internationalization issues.
</P>

<P>The Calendar1 constructor in lines 29_62 sets the layout to
BorderLayout. Buttons 
for displaying the previous and next month, as well as a label that will contain
the selected month and year, are placed in the
&quot;North&quot; (top) area. Both of these
buttons have an action listener registered. A GridLayout-controlled
panel seven columns 
wide fills the &quot;Center&quot; (middle) area of the Bean and contains day labels. As soon
as displayCalendar() is called, the panel also contains one button for each day of the month.
</P>

<P>The last line of the constructor calls the protected method named
displayCalendar(), which is contained in lines 74_125. This method contains the logic necessary to accomplish
the following actions:
</P>

<A NAME="PAGENUM-665"><P>Page 665</P></A>

<UL>
<LI>          Places the correct month and year in the label
<LI>          Removes all existing buttons that represent days of the month
<LI>          Ascertains which day of the week begins the month
<LI>          Adds a button for each day of the selected month
</UL>

<P>Lines 76_78 in the displayCalendar() method store the currently held year, month, and
day values because this calendar instance will be altered later in the method. The
Calendar get() method takes an integer argument that represents the attribute of the calendar to
be returned. This replaces the corresponding
getYear(), getMonth(), and getDate() methods in
the Date class. Note that the method in line 76 returns a four-digit year, not a two-digit
year as returned by getDate().
</P>

<PRE>
076           int yearNum = calendar.get(Calendar.YEAR);
077           int monthNum = calendar.get(Calendar.MON);
078           int dayNum = calendar.get(Calendar.DATE);
</PRE>

<P>Lines 88 and 89 remove all the components in the GridLayout-controlled panel, except
for the seven day labels.
</P>
<PRE>
088           while (body.getComponentCount() &gt; 7)
089               body.remove(7);
</PRE>

<P>To set an element of the date or time in a Calendar or GregorianCalendar instance,
use the set method shown in line 94:
</P>
<PRE>
094           calendar.set(Calendar.DATE, 1);
095           date = calendar.getTime();
096           int day = date.getDay();
</PRE>

<P>Instead of using the Date class in lines 95 and 96 to obtain the day of the week, use
a method of the Calendar class:
</P>
<PRE>
int day = calendar.get(Calendar.DAY_OF_WEEK);
</PRE>

<P>The JDK 1.1 beta 1 implementation, however, didn't always return the correct result
(as beta software is prone to do).
</P>
	
<P>Lines 104_121 contain the loop that populates the GridLayout-controlled panel with
&quot;day of the month&quot; buttons. Each button has an action listener registered to it. In
each iteration, line 112 advances the date by using the
add() method of the Calendar class. In
</P>

<A NAME="PAGENUM-666"><P>Page 666</P></A>

<P>
this case, one day is added, but any number of days, months, years, hours, minutes,
or seconds can be added or subtracted.
</P>

<PRE>
112               calendar.add(Calendar.DATE, 1);
</PRE>

<P>To indicate the currently selected day, keyboard focus is requested for the
corresponding button when that day is reached in the loop.
</P>

<PRE>
115               if (i == dayNum)
116                   dayBtn.requestFocus();
</PRE>

<P>To determine when to stop adding date buttons, the Calendar class
get() method is called. The day of the month rolling over to 1 indicates that the next month has been
reached. When the iterations are complete, the current year, month, and date values are
restored by using a form of the Calendar set() method. The Panel is then validated so that
the buttons will be laid out again:
</P>
<PRE>
123           calendar.set(yearNum, monthNum, dayNum);
124           body.validate();
</PRE>

<P>Lines 127_149 contain the action event listener for all the buttons in the Calendar1 Bean.
</P>

<P>If the next or previous buttons were chosen, the day of the month is first set to 1,
a month is then added or subtracted, and the calendar is updated:
</P>


<PRE>
132               calendar.set(Calendar.DATE, 1);
133               calendar.add(Calendar.MONTH,
134                            e.getSource() == prevMonth ? _1 : 1);
135               displayCalendar();
</PRE>

<P>If a day of the month button is clicked, then the date is set to the selected date, which
is ascertained by reading the button's label:
</P>
<PRE>
140             calendar.set(Calendar.DATE, Integer.parseInt(
141                            ((Button)e.getSource()).getLabel()));
</PRE>

<P>Then, in lines 147 and 148 a MouseEvent is created with the following arguments:
</P>

<UL>
<LI>          This instance of the Bean as the source
<LI>     	  The MOUSE_CLICKED event type
<LI>          A value of zero for the time-date stamp argument, key modifiers argument, and x,
y coordinate arguments, because the listener doesn't need any of this information
<LI>          A single click, as opposed to a double-click
</UL>

<P><CENTER>
<a href="0659-0662.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0667-0671.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

