<HTML>
<HEAD>


<TITLE>Inside Java:Java Beans: Java's Component Architecture:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0684-0687.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0694-0699.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-688"><P>Page 688</P></A>





<H4><A NAME="ch15_ 10">
Bound and Constrained Properties
</A></H4>

<P>Earlier in the chapter, the types of properties were introduced. This section
discusses two special kinds of properties:
</P>

<UL>
<LI>          A <I>bound property</I> notifies a set of listeners whenever the value of the
property changes. This is very useful when implementing a
<I>data-view</I> architecture: When the data changes, each view of the data is notified so that each view can make
the corresponding change.
<LI>          A <I>constrained property</I> asks permission from a set of listeners to make a
value change. If any of the listeners object, an exception is thrown that informs
the constrained property that permission to make the change was denied.
</UL>

<P>The Scope Bean examined earlier in the chapter has been modified to demonstrate how
to create and use a bound property.
</P>

<P><B>
A Bound Property Example: Scope2, Coords, and Bar
</B></P>

<P>Listing 15.11 depicts a Java Bean named Scope2, which contains a bound
property named &quot;coordString.&quot; When the user moves the mouse over the Bean, the Scope2
Bean exhibits the same behavior as the Scope Bean did. The Scope2 Bean also notifies
any registered property change listeners of the change. The registered property
change listeners in this case are:
</P>

<UL>
<LI>          The Coords Bean in listing 15.12. This Bean displays a string that represents
the coordinates at which the mouse cursor is positioned.
<LI>          The Bar Bean in listing 15.13. This Bean is a bar graph that displays either the
x or y coordinate of the mouse cursor. The coordinate displayed depends
on whether the Bar Bean's &quot;horizontal&quot; property is true.
</UL>

<P>Listing 15.14 depicts the ScopeFrame2 application, which displays the Scope2 Bean,
the Coords Bean, a horizontal Bar Bean, and a vertical Bar Bean.
</P>

<P>Listing 15.11
</P>
<PRE>
Line==================Java Source=================
001   //////////
002   // Scope2.java  A Java Bean that has bound properties
003   //
004   // Author: James L. Weaver  JDK 1.1 beta1
005   //////////
</PRE>

<A NAME="PAGENUM-689"><P>Page 689</P></A>

<PRE>
006   package chapter15.code.scope2;
007
008   import java.awt.*;
009   import java.awt.event.*;
010   import java.beans.*;
011   import java.io.Serializable;
012
013   public class Scope2 extends Canvas implements Serializable
014   {
015       protected int xCoord = 0,
016                     yCoord = 0,
017                     ticks = 8;
018       protected String coordString = &quot;0,0&quot;;
019
020       // Enlist the help of a class that registers and notifies
021       // PropertyChangeListener objects of changes.
022       protected PropertyChangeSupport changes =
023                 new PropertyChangeSupport(this);
024
025       public Scope2() {
026           // Enable mouse and mouse motion events to be processed.
027           enableEvents(AWTEvent.MOUSE_MOTION_EVENT_MASK |
028                        AWTEvent.MOUSE_EVENT_MASK |
029                        AWTEvent.COMPONENT_EVENT_MASK);
030           setSize(200, 200);
031       }
032
033       // The presence of both a setTick and a getTick cause the
034       // Introspector to assume there is a read/write &quot;tick&quot; property.
035       public void setTicks(int ticks) {
036           this.ticks = ticks;
037       }
038
039       public int getTicks() {
040           return ticks;
041       }
042
043       // The presence of both a setCoordString and
044       // setCoordString cause the Introspector to assume there
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>

<A NAME="PAGENUM-690"><P>Page 690</P></A>


<P>
Listing 15.11, Continued
</P>	

<PRE>
045       // is a read/write &quot;coordString&quot; property.
046       public void setCoordString(String newCoordString) {
047
048           // Save the old value &amp; update the current value.
049           String oldCoordString = coordString;
050           coordString = newCoordString;
051
052           // Notify listeners that the bound property changed.
053           changes.firePropertyChange(&quot;coordString&quot;,
054                                        oldCoordString,
055                                        newCoordString);
056       }
057
058       public String getCoordString() {
059           return coordString;
060       }
061
062       public void addPropertyChangeListener(PropertyChangeListener l)
063       {
064           // Offload the task to the PropertyChangeSupport class.
065           changes.addPropertyChangeListener(l);
066       }
067
068       public void removePropertyChangeListener(PropertyChangeListener l)
069       {
070           // Offload the task to the PropertyChangeSupport class.
071           changes.removePropertyChangeListener(l);
072       }
073
074       public void paint(Graphics g) {
075           int tickSize = 5;
076           int xMax = getSize().width _1;
077           int yMax = getSize().height _1;
078           int xRes = xMax/ticks;
079           int yRes = yMax/ticks;
080
081           // Draw the crosshairs
082           g.setColor(Color.red);
</PRE>

<A NAME="PAGENUM-691"><P>Page 691</P></A>


<PRE>
083           g.drawRect(0, 0, xMax, yMax);
084           g.drawLine(xCoord, 0, xCoord, yMax);
085           g.drawLine(0, yCoord, xMax, yCoord);
086
087           // Build and draw the coordinate string.
088           setCoordString(new Integer(xCoord) + &quot;,&quot; +
089                          new Integer(yCoord));
090           g.drawString(getCoordString(), tickSize, yMax _ tickSize);
091
092           // Draw the tick marks.
093           for (int i=0,x=0; i&lt;ticks; i++,x+=xRes) {
094               g.drawLine(x, 0, x, tickSize);
095               g.drawLine(x, yMax _ tickSize, x, yMax);
096           }
097           for (int i=0,y=0; i&lt;ticks; i++,y+=yRes) {
098               g.drawLine(0, y, tickSize, y);
099               g.drawLine(xMax _ tickSize, y, xMax, y);
100           }
101       }
102
103       // When the mouse moves, update the display.
104       protected boolean processMouseMotionEvent(MouseEvent e) {
105           if (e.getId() == MouseEvent.MOUSE_MOVED) {
106               xCoord = e.getX();
107               yCoord = e.getY();
108               repaint();
109           }
110           super.processMouseMotionEvent(e);
111           return false;
112       }
113
114       // When the mouse exits the Scope2 Bean area,
115       // set coordinates to 0,0.
116       protected boolean processMouseEvent(MouseEvent e) {
117           if (e.getId() == MouseEvent.MOUSE_EXITED) {
118               xCoord = 0;
119               yCoord = 0;
120               repaint();
121           }
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>


<A NAME="PAGENUM-692"><P>Page 692</P></A>


<P>
Listing 15.11, Continued
</P>

<PRE>
122           super.processMouseEvent(e);
123           return false;
124       }
125   }
</PRE>


<P>Lines 22 and 23 of listing 15.11 (Scope2.java) create an instance of
the PropertyChangeSupport class:
</P>



<PRE>
022       protected PropertyChangeSupport changes =
023                 new PropertyChangeSupport(this);
</PRE>

<P>PropertyChangeSupport is a convenience class that handles the details associated
with maintaining a registry of property change listeners and notifying the listeners of
a property change. PropertyChangeSupport, which is a class in the java.beans
package, has three methods:
</P>

<UL>
<LI>          void addPropertyChangeListener(PropertyChangeListener)
<LI>          void removePropertyChangeListener(PropertyChangeListener)
<LI>          void firePropertyChange(String, Object, Object)
</UL>



<P>
<a href="images\ch15fg05.jpg"><img src="images\tn_ch15fg05.jpg"></a><BR>
Figure 15.5 <I>Bound Properties and supporting PropertyChange-
Support methods.</I>
</P>


<A NAME="PAGENUM-693"><P>Page 693</P></A>


<P>Figure 15.5 depicts how bound properties work and how
PropertyChangeSupport methods support bound properties.
</P>


<P>The addPropertyChangeListener() method adds a PropertyChangeListener to <BR>
the registry. The removePropertyChangeListener() method removes a
Property-ChangeListener from the registry. The
firePropertyChange() method calls the
propertyChange() method of each registered PropertyChangeListener, passing a PropertyChangeEvent instance
that contains the following:
</P>

<UL>
<LI>          The name of the property that has changed. To access this, call the
getPropertyName() method of the PropertyChangeEvent instance.
<LI>          The property's old value. To access this, call the
getOldValue() method of the PropertyChangeEvent instance.
<LI>          The property's new value. To access this, call the
getNewValue() method of the PropertyChangeEvent instance.
</UL>

<P>To use PropertyChangeSupport, you can either derive a class from it or make an
instance of it. The Scope2 Bean uses an instance of PropertyChangeSupport, because Scope2
is already derived from Canvas. The constructor argument is a reference to the Bean
that contains the bound property or properties.
</P>

<P>Lines 46_56 contain the setCoordString() accessor method. In lines 53_55,
the firePropertyChanges() method of the PropertyChangeSupport class is called, which notifies
all the listeners of the property change. If the last two arguments are the same, this
method is smart enough not to notify the listeners.
</P>

<P>Lines 62_72 provide an
addPropertyChangeListener() method and a remove
PropertyChangeListener() method that registers and deregisters property change listeners. Within each of
these methods, the corresponding
PropertyChangeSupport method is called, which maintains
the registry.
</P>

<P>The Coords Bean in listing 15.12 is a PropertyChangeListener that displays the
current coordinates of the Scope2 Bean.
</P>

<P>Listing 15.12
</P>
<PRE>
Line==================Java Source=================
01   //////////
02   // Coords.java  Demonstrates a Java Bean
03   // that is also a PropertyChangeListener.
04   //
05   // Author: James L. Weaver  JDK 1.1 beta1
06   //////////
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>


<P><CENTER>
<a href="0684-0687.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0694-0699.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

