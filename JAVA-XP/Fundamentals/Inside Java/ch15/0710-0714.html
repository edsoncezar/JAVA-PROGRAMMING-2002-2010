<HTML>
<HEAD>


<TITLE>Inside Java:Java Beans: Java's Component Architecture:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0705-0709.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0715-0719.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-710"><P>Page 710</P></A>


<P>
identifies. This is because the Introspector checks the superclasses for the
design patterns as well. The minimumSize property, for example, shows up in the Calendar2
Bean because of the presence of the
getMinimumSize() method in the Component class.
</P>

<P>This section covered Java Bean introspection. The next advanced topic to cover
is property editors.
</P>

<H4><A NAME="ch15_ 12">
Property Editors
</A></H4>

<P>You may have noticed the difference between the number of properties that appear in
the BDK BeanBox property sheets and the number identified by the xmnbean utility for
a given Bean. One reason for this discrepancy is that the BDK doesn't know how to
edit certain properties. This will be the case for any builder tool, because any Bean
developer can create a new property type.
</P>

<P>To solve this problem, you can create a <I>property
editor</I> that knows how to edit a given property type.
</P>

<P>Listing 15.17 (DateEditor.java) is a property editor for the date property of the
Calendar2 Bean. This property is of type
java.util.Date. The standard naming convention is to take
the property type and add Editor to it, hence the name DateEditor. When the property
sheet is displayed for the Calendar2 Bean, the presence of this DateEditor class enables
the date property to be displayed and edited on the property sheet.
</P>

<P>Listing 15.17
</P>
<PRE>
Line==================Java Source=================
01   //////////
02   // DateEditor.java  A property editor for date fields
03   //
04   // Author: James L. Weaver  JDK 1.1 beta1, BDK 1.1 beta 2
05   //////////
06   //package chapter15.code.calendar2;
07
08   // Put this DateEditor in the same directory as the
09   // other BeanBox property editors so that the BeanBox
10   // can find it.
11   package sun.beans.editors;
12
13   import java.util.*;
14   import java.beans.*;
15
</PRE>

<A NAME="PAGENUM-711"><P>Page 711</P></A>

<PRE>
16   public class DateEditor extends PropertyEditorSupport {
17
18       // This method returns a Java code fragment to initialize
19       // the property.
20       public String getJavaInitializationString() {
21           int month, day, year;
22           Date dt = (Date)getValue();
23           month = dt.getMonth();
24           day = dt.getDay();
25           year = dt.getYear();
26
27           String str = &quot;new Date(&quot; +
28                        year + &quot;,&quot; +
29                        month + &quot;,&quot; +
30                        day + &quot;)&quot;;
31           return str;
32       }
33
34       // This is called when the builder tool wants to display the
35       // current property value on the property sheet. It builds and
36       // returns a human editable string to be displayed.
37       public String getAsText() {
38           int month, day, year;
39           GregorianCalendar greg = new GregorianCalendar();
40           greg.setTime((Date)getValue());
41           month = greg.get(Calendar.MONTH);
42           day = greg.get(Calendar.DATE);
43           year = greg.get(Calendar.YEAR);
44
45           String str = (month + 1) + &quot;/&quot; +
46                        day + &quot;/&quot; +
47                        year;
48           return str;
49       }
50
51       // This is called whenever the builder tool wants to retrieve
52       // the property value from the property sheet. It parses the
53       // displayed string and calls setValue() with an object of
54       // the property type.
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>

<A NAME="PAGENUM-712"><P>Page 712</P></A>

<P>
Listing 15.17, Continued
</P>	
<PRE>
55       public void setAsText(String text)
56                       throws java.lang.IllegalArgumentException {
57           int month, day, year;
58
59           try {
60               month = Integer.parseInt(text.substring(
61                                    0, text.indexOf(`/'))) _1;
62               day = Integer.parseInt(text.substring(
63                                    text.indexOf(`/') + 1,
64                                    text.lastIndexOf(`/')));
65               year = Integer.parseInt(text.substring(
66                                    text.lastIndexOf(`/') + 1));
67               GregorianCalendar greg = new GregorianCalendar();
68               greg.set(Calendar.MONTH, month);
69               greg.set(Calendar.DATE, day);
70               greg.set(Calendar.YEAR, year);
71
72               // getTime() returns Date, which is the property type
73               setValue(greg.getTime());
74           }
75           catch (Exception e) {
76               throw new java.lang.IllegalArgumentException(text);
77           }
78       }
79   }
</PRE>

<P>In line 11, this class is put into the sun.beans.editors package, the same location of
the other property editors for the BDK beanbox. Two other
possibilities exist for ensuring that a builder tool can locate a property editor:
</P>

<UL>
<LI>          Register the property editor class by using the static
registerEditor() method of the java.beans.PropertyManager class. To use this method, supply two Class
objects: one that represents the Java type to be edited, and one that represents
the property editor class. When using this registry mechanism, it is not necessary
to follow the standard property editor naming convention&#151;still, this is recommended.
<LI>          Use the standard property editor naming mechanism, and put the property
editor class in the same package as the Bean class.
</UL>



<P>
In line 16, the DateEditor class is derived from the PropertyEditorSupport class.
The
</P>

<A NAME="PAGENUM-713"><P>Page 713</P></A>

<P>
PropertyEditorSupport class provides methods that the property editor class
can override. Three of these methods are overridden in the DateEditor class:
</P>

<UL>
<LI>          String getJavaInitializationString()
<LI>          String getAsText()
<LI>          setAsText(String)
</UL>

<P>Lines 20_32 override the
getJavaInitializationString() method. This method is called if
the builder tool needs to generate code to initialize the value of this property.
</P>

<P>Lines 37_49 override the getAsText() method. This method is called when the builder
tool wants to display the current property value as a String on the property sheet.
The method builds and returns a string that the user can edit.
</P>

<P>Lines 55_78 override the setAsText() method. This method is called when the builder
tool wants to take the String entered in the property sheet and update the property
value. The method parses the displayed string and calls
setValue() with an object of the property type.
</P>

<P>Figure 15.10 shows the BDK BeanBox PropertySheet for Calendar2.
</P>

<P>
<a href="images\ch15fg10.jpg"><img src="images\tn_ch15fg10.jpg"></a><BR>
Figure 15.10 <I>The Calendar2 Bean and Property Sheet in the BDK BeanBox.</I>
</P>

<A NAME="PAGENUM-714"><P>Page 714</P></A>



<H3><A NAME="ch15_ 13">
Creating JAR Files
</A></H3>

<P>JAR file stands for Java Archive file, a feature new to JDK 1.1. JAR files were
introduced mainly to speed up the downloading of class files associated with applets.
Applets frequently contain many class files, image files, and so on. Before JAR files existed
each of these files were downloaded separately with the Web browser initiating a
time consuming HTTP connection request for each file. With JAR files you can compress
all the files associated with an applet and put them all in one file. This reduces the
number of HTTP requests to one, and the total size of the download is substantially reduced.
To take advantage of this feature, use the ARCHIVES attribute of the HTML APPLET tag
as shown in Chapter 8, &quot;Creating Java Applets.&quot;
</P>

<P>Another reason that JavaSoft introduced JAR files is to provide a standard,
convenient way to package Java Beans. A JAR file can contain all the files that make up a Bean,
and a JAR file may contain more than one Bean. This way, Java Bean developers
can distribute their Beans via JAR files, and builder tools can extract the Beans from a
JAR file at development time. A complex Bean may have a default state saved in the JAR
file as well so that a developer who uses the Bean may start out with those defaults.
</P>

<P>JAR files use the same format as ZIP files and have a
<I>manifest file</I> that describes the contents of the JAR file. Each entry in a JAR file may be digitally signed so that
their origin can be authenticated.
</P>

<H4><A NAME="ch15_ 14">
Jar Archive Tool
</A></H4>

<P>JavaSoft has provided a utility called the <I>Java Archive
Tool</I> that enables you to package files into a JAR file and extract files from a JAR file. The Java Archive Tool
(commonly referred to as the <I>jar tool</I>) is a Java application that uses classes from the
new java.util.zip package. To invoke the jar tool, enter
jar at the command line followed by one or more parameters. The first parameter is one or more of the options in table 15.2.
</P>

<P>
Table 15.2
</P>
<P>
Jar Archive Tool Command-Line Parameters
</P>

<TABLE>

<TR><TD>
Parameter
</TD><TD>
Description
</TD></TR><TR><TD>
t (for table)
</TD><TD>
Lists the contents of a JAR file from standard input or a JAR
file specified by the &quot;f&quot; option.
</TD></TR><TR><TD>
f (for file)
</TD><TD>
Specifies that the second parameter contains the JAR file to
be processed. To list the contents of my.jar, for example, the
command would be: jar tf my.jar
</TD></TR></TABLE>




<P><CENTER>
<a href="0705-0709.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0715-0719.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

