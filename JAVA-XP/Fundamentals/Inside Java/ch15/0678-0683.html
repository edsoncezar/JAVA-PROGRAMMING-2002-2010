<HTML>
<HEAD>


<TITLE>Inside Java:Java Beans: Java's Component Architecture:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0672-0677.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0684-0687.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-678"><P>Page 678</P></A>


<P>
Listing 15.7, Continued
</P>
<PRE>

12   {
13       protected Date date;
14
15       public DateEvent(Object obj, Date date) {
16           super(obj);
17           this.date = date;
18       }
19
20       public Date getDate() {
21           return date;
22       }
23   }
</PRE>

<P>As noted earlier, listing 15.8 creates the DateEventListener interface implemented
by listeners of the DateEvent class.
</P>

<P>Listing 15.8
</P>
<PRE>
Line==================Java Source=================
01   //////////
02   // DateEventListener.java  Listener interface created
03   // for the DateEvent class
04   //
05   // Author: James L. Weaver  JDK 1.1 beta1
06   //////////
07   package chapter15.code.calendar2;
08
09   import java.util.*;
10
11   public interface DateListener extends EventListener
12   {
13       public void dateChanged(DateEvent evt);
14   }
</PRE>



<P>In listing 15.9, a Bean named Listener2 is created that implements the
DateEventListener interface.
</P>

<P>Listing 15.9
</P>


<A NAME="PAGENUM-679"><P>Page 679</P></A>


<PRE>
Line==================Java Source=================
01   //////////
02   // Listener2.java  Listens for date changes
03   // on the Calendar2 Bean.
04   //
05   // Author: James L. Weaver  JDK 1.1 beta1
06   //////////
07   package chapter15.code.calendar2;
08
09   import java.awt.*;
10   import java.awt.event.*;
11   import java.text.*;
12   import java.util.*;
13   import java.io.Serializable;
14
15   public class Listener2 extends TextField
16                          implements Serializable, DateListener
17   {
18       public Listener2() {
19           super(&quot;?????????&quot;, 15);
20           setEditable(false);
21       }
22
23       public synchronized void dateChanged(DateEvent evt) {
24           // Get the &quot;date&quot; property of the DateEvent
25           // and display it in the text field
26           Date date = evt.getDate();
27           SimpleDateFormat df = new SimpleDateFormat(&quot;MM/dd/yyyy&quot;);
28           setText(df.format(date));
29       }
30   }
</PRE>

<P>In listing 15.10, the CalendarFrame2 application creates, displays, and wires the Beans
to each other by registering the Listener2 Bean as a DateEventListener.
</P>


<P>Listing 15.10
</P>
<PRE>Line==================Java Source=================
01   //////////
</PRE>

<A NAME="PAGENUM-680"><P>Page 680</P></A>

<PRE>
02   // CalendarFrame2.java  Frame in which to run the Calendar2
03   // Java Bean.
04   //
05   // Author: James L. Weaver  JDK 1.1 beta1
06   //////////
07   package chapter15.code.calendar2;
08
09   import java.awt.*;
10   import java.awt.event.*;
11   import java.util.*;
12
13   public class CalendarFrame2 extends Frame {
14
15       Calendar2 cal;
16       Listener2 listener;
17
18       public CalendarFrame2() {
19           super(&quot;Calendar2 Java Bean Demo&quot;);
20
21           setLayout(new BorderLayout());
22           addWindowListener(new Wadapt());
23           setSize(300, 300);
24
25           cal = new Calendar2();
26           add(&quot;Center&quot;, cal);
27
28           Panel p = new Panel();
29           add(&quot;North&quot;, p);
30           listener = new Listener2();
31           p.add(listener);
32
33           // Wire the Beans together by adding the Listener2 Bean
34           // as a mouse event listener to the Calendar2 Bean.
35           cal.addDateListener(listener);
36           setVisible(true);
37
38           // Set the &quot;date&quot; property of the Scope Bean to today.
39           cal.setDate(new Date());
40       }
</PRE>


<A NAME="PAGENUM-681"><P>Page 681</P></A>


<PRE>

41
42       public static void main(String args[]) {
43           CalendarFrame2 calFrame = new CalendarFrame2();
44           return;
45       }
46   }
47
48   class Wadapt extends WindowAdapter
49   {
50       public void windowClosing(WindowEvent evt) {
51           evt.getWindow().setVisible(false);
52           evt.getWindow().dispose();
53           System.exit(0);
54       }
55   }
</PRE>

<P><B>
Steps for Creating and Using New Events in a Bean
</B></P>

<P>You can use the following steps to create your own event class and listener
interface, and incorporate them into your Bean:
</P>

<OL>
<LI>     	  Design the new event.
<BR>
Examine the DateEvent class in listing 15.7. Line 11 derives this class from
the EventObject class, which is a typical case.

<PRE>
11   public class DateEvent extends EventObject
</PRE>
<PRE>
15       public DateEvent(Object obj, Date date) {
16           super(obj);
17           this.date = date;
18       }
</PRE>

For the listener to obtain the Date value that is stored in the event instance,
the DateEvent class supplies a method named
getDate(), which is defined in lines 20_22.

</OL>

<A NAME="PAGENUM-682"><P>Page 682</P></A>

<OL START="2">

<PRE>
20       public Date getDate() {
21           return date;
22       }
</PRE>

The DateEvent class is associated with only one event type, &quot;date
changed.&quot; Therefore, it is not necessary to embed the type within the event. If more than
one event type existed, then it would be necessary to implement a scheme similar to
the getId() method in the AWTEvent class, which provides a way to retrieve the
event type.<BR>
<BR>          For more ideas regarding event class design, revisit some of the
EventObject subclasses covered in Chapter 14.

<LI>          Design a listener interface for the event.<BR>
<BR>          Now take a look at the DateEventListener interface in listing 15.8. This
interface extends the EventListener interface, which is also a typical case. One method
is defined and serves as the one and only event type associated with this event
class. You can define as many listener methods as needed. Notice that the
DateEvent instance is the only argument passed to the listener&#151;this is consistent with all
the JDK 1.1 event listeners.

<PRE>
11   public interface DateListener extends EventListener
12   {
13       public void dateChanged(DateEvent evt);
14   }
</PRE>


<LI>          Create the event listener registry and associated methods in the Bean.<BR>
<BR>          In the Calendar2 Bean in listing 15.6, lines 155_157 define the
addDateListener() method, and lines 161_163 define the removeDateListener method.

<PRE>
155       public synchronized void addDateListener(DateListener dl) {
156           dateListeners.addElement(dl);
157       }
</PRE>
<PRE>
161       public synchronized void removeDateListener
&Acirc;(DateListener dl) {
162           dateListeners.removeElement(dl);
163       }
</PRE>


These methods add and remove references to listeners that implement
the DateListener interface. These references are held in a Vector defined in line
29, which serves as the DateListener registry.

</OL>

<A NAME="PAGENUM-683"><P>Page 683</P></A>


<OL START="4">

<PRE>
29       protected Vector dateListeners = new Vector();
</PRE>


              Following are the design patterns for events:

<BR>
<UL>
<LI>                         public void add&lt;EventListenerType&gt;(EventListenerType)
<LI>                         public void remove&lt;EventListenerType&gt;(EventListenerType)
</UL>

<BR>
          When the introspection process discovers these patterns, it assumes that
an &lt;EventListenerType&gt; interface exists in which listener methods can be discovered. It
is important to either stay consistent with this design pattern or explicitly define
these methods using the BeanInfo interface.

<LI>     Create an event processor method for the new event listener type.<BR>
<BR>          As explained in Chapter 14, an associated
process&lt;ListenerType&gt;Event method exists for each event listener in JDK 1.1. The MouseListener, for example, has an
associated processMouseEvent() method. This method is responsible for delivering the event to
the correct method in the registered event listeners.<BR>
<BR>          For consistency, the Calendar2 Bean contains a method named
processDateEvent() that is responsible for delivering DateEvent instances to registered DateListener
event listeners. Lines 167_178 of the Calendar2 Bean (listing 15.6) contain
the processDateEvent() method.
<BR>

<PRE>
167       protected void processDateEvent(DateEvent evt) {
168           Vector list;
169
170           // Make a copy of the listeners vector, in case
&Acirc;listeners are
171           // added or removed while events are being delivered.
172           synchronized(this) {
173               list = (Vector)dateListeners.clone();
174           }
175           for (int i=0; i&lt;list.size(); i++) {
176               ((DateListener)list.elementAt(i)).dateChanged(evt);
177           }
178       }
</PRE>


Lines 172_174 create a copy of the Vector (which was created in step 3) that
stores the listener references. The reason for copying this Vector is so that it can't
change while the events are being delivered in lines 175_177. This also could have
been
</OL>

<P><CENTER>
<a href="0672-0677.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0684-0687.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

