<HTML>
<HEAD>


<TITLE>Inside Java:Java Beans: Java's Component Architecture:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0688-0693.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0700-0704.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-694"><P>Page 694</P></A>


<P>
Listing 15.12, Continued
</P>
<PRE>
07   package chapter15.code.scope2;
08
09   import java.awt.*;
10   import java.awt.event.*;
11   import java.beans.*;
12   import java.io.Serializable;
13
14   public class Coords extends TextField implements Serializable,
15                                       PropertyChangeListener
16   {
17       public Coords() {
18           super(&quot;??????&quot;, 10);
19           setEditable(false);
20       }
21
22       public void propertyChange(PropertyChangeEvent e) {
23           setText((String)e.getNewValue());
24       }
25   }
</PRE>

<P>Lines 14 and 15 of listing 15.12 (Coords.java) indicate that the Coords Bean is
a PropertyChangeListener.
</P>

<P>Lines 22_24 are called whenever a property change event is fired on a Bean with
which this instance is registered. In line 23, the new property value is retrieved from
the PropertyChangeEvent instance and displayed.
</P>

<P>The Bar Bean in listing 15.13 is a PropertyChangeListener that displays a bar graph of
a dimension of the Scope2 Bean.
</P>

<P>Listing 15.13
</P>
<PRE>
Line==================Java Source=================
01   //////////
02   // Bar.java  Demonstrates a Java Bean
03   // that is also a PropertyChangeListener.
04   //
05   // Author: James L. Weaver  JDK 1.1 beta1
06   //////////
07   package chapter15.code.scope2;
</PRE>


<A NAME="PAGENUM-695"><P>Page 695</P></A>


<PRE>
08
09   import java.awt.*;
10   import java.awt.event.*;
11   import java.beans.*;
12   import java.io.Serializable;
13
14   public class Bar extends Canvas implements Serializable,
15                                       PropertyChangeListener
16   {
17       Dimension totalSize;
18       boolean horiz;
19       int barLength;
20
21       public Bar() {
22           totalSize = new Dimension(0,0);
23
24           // Default to horizontal bar.
25           this.horiz = true;
26           barLength = 0;
27
28           setSize(100, 25);
29       }
30
31       // Bar can either be horizontal or vertical. The presence of
32       // a setHorizontal() and an isHorizontal() defines a
33       // read/write boolean &quot;horizontal&quot; property.
34       public void setHorizontal(boolean horiz) {
35           this.horiz = horiz;
36       }
37
38       public boolean isHorizontal() {
39           return horiz;
40       }
41
42       public void propertyChange(PropertyChangeEvent e) {
43           if (e.getPropertyName().equals(&quot;coordString&quot;)) {
44               // Find out the dimensions of the source component
45               totalSize = ((Component)e.getSource()).getSize();
46
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>


<A NAME="PAGENUM-696"><P>Page 696</P></A>


<P>
Listing 15.13, Continued
</P>

<PRE>
47               // Retrieve and parse the coordinate of interest.
48               String coords = (String)e.getNewValue();
49               if (horiz) {
50                   barLength = Integer.parseInt(coords.substring(0,
51                                           coords.indexOf(`,')));
52               }
53               else {
54                   barLength = Integer.parseInt(coords.substring(
55                                           coords.indexOf(`,') + 1));
56               }
57           }
58           repaint();
59       }
60
61       public void paint(Graphics g) {
62           int scaledBar;
63           setForeground(Color.blue);
64           g.drawRect(0, 0, getSize().width _1,
65                            getSize().height _1);
66           try {
67               // The &quot;try&quot; block is to protect against
68               // divide by zero error. Calculate length that the
69               // filled in bar should be.
70               if (horiz) {
71                   scaledBar = barLength * getSize().width
72                                               / totalSize.width;
73                   g.fillRect(0, 0, scaledBar, getSize().height _1);
74               }
75               else {
76                   scaledBar = barLength * getSize().height
77                                               / totalSize.height;
78                   g.fillRect(0, 0, getSize().width _1, scaledBar );
79               }
80           }
81           catch (Exception e) {
82           }
83       }
84   }
</PRE>

<A NAME="PAGENUM-697"><P>Page 697</P></A>

<P>Lines 14 and 15 of listing 15.13 (Bar.java) indicate that the Bar Bean is
a PropertyChangeListener as well.
</P>





<P>Lines 34_36 contain the setHorizontal() accessor method for the horizontal property. If
this is set to true, the Bar Bean is a horizontal bar graph that displays the relative value of
the Scope2 Bean's x-axis. If the horizontal property is false, the Bar Bean is a vertical
bar graph that displays the relative value of the Scope2 Bean's y-axis. Lines 38_40
contain the other horizontal property accessor method.
</P>

<P>Lines 42_59 contain the propertyChange() method. In line 43, the event's
getPropertyName() method is called to determine which property was changed. If 
the coordString property changed, the String is parsed to obtain the coordinate
of interest, based upon the Bar Bean's orientation. After calculating and updating
drawing-related values, the repaint() method is called to update the Bar Bean's display.
</P>

<P>The ScopeFrame2 application in listing 15.14 creates, displays, and wires together
a Scope2 bean, a Coords Bean, and two Bar Beans:
</P>

<P>Listing 15.14
</P>
<PRE>
Line==================Java Source=================
01   //////////
02   // ScopeFrame2.java  Frame in which to run the Scope
03   // Java Bean.
04   //
05   // Author: James L. Weaver  JDK 1.1 beta1
06   //////////
07   package chapter15.code.scope2;
08
09   import java.awt.*;
10   import java.awt.event.*;
11   import java.beans.*;
12
13   public class ScopeFrame2 extends Frame {
14
15       Scope2 scope;
16       Coords coords;
17       Bar hBar, vBar;
18
19       public ScopeFrame2() {
20           super(&quot;Scope2 Java Bean Demo&quot;);
21
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>

<A NAME="PAGENUM-698"><P>Page 698</P></A>

<P>
Listing 15.14, Continued
</P>
<PRE>
22           setLayout(new BorderLayout());
23           addWindowListener(new Wadapt());
24           setSize(300, 300);
25
26           scope = new Scope2();
27
28           // Set the &quot;ticks&quot; property of the Scope Bean.
29           scope.setTicks(8);
30
31           // The Scope2 Bean will fill most of the Frame.
32           add(&quot;Center&quot;, scope);
33
34           // Create and add the Coords Bean.
35           Panel pn = new Panel();
36           add(&quot;North&quot;, pn);
37           coords = new Coords();
38           pn.add(coords);
39
40           // Create and add a horizontal Bar Bean.
41           Panel ps = new Panel();
42           add(&quot;South&quot;, ps);
43           hBar = new Bar();
44           hBar.setSize(100, 25);
45           hBar.setHorizontal(true);
46           ps.add(hBar);
47
48           // Create and add a vertical Bar Bean.
49           Panel pe = new Panel();
50           add(&quot;East&quot;, pe);
51           vBar = new Bar();
52           vBar.setSize(25, 100);
53           vBar.setHorizontal(false);
54           pe.add(vBar);
55
56           // Wire the Beans together by adding the Coords Bean
57           // as a property change listener to the Scope2 Bean
58           // and the Bar Beans.
59           scope.addPropertyChangeListener(coords);
</PRE>


<A NAME="PAGENUM-699"><P>Page 699</P></A>


<PRE>
60           scope.addPropertyChangeListener(hBar);
61           scope.addPropertyChangeListener(vBar);
62
63           setVisible(true);
64       }
65
66       public static void main(String args[]) {
67           ScopeFrame2 menuFrame = new ScopeFrame2();
68           return;
69       }
70   }
71
72   class Wadapt extends WindowAdapter
73   {
74       public void windowClosing(WindowEvent evt) {
75           evt.getWindow().setVisible(false);
76           evt.getWindow().dispose();
77           System.exit(0);
78       }
79   }
</PRE>

<P>The ScopeFrame2 application in listing 15.14 creates an instance of and displays
a Scope2 Bean, a Coords Bean, and two Bar Beans (one of each orientation). In
addition, the application sets some initial properties in each.
</P>

<P>Lines 59_61 register the Coords and Bar Beans as property change listeners of
the Scope2 Bean. As a result, when the mouse cursor moves over the Scope2 Bean,
the coordinates are displayed and graphed by the Coords and Bar Beans.
</P>

<P>
<a href="images\ch15fg06.jpg"><img src="images\tn_ch15fg06.jpg"></a><BR>
<P>Figure 15.6 <I>The ScopeFrame2 application.</I>
</P>


<P><CENTER>
<a href="0688-0693.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0700-0704.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

