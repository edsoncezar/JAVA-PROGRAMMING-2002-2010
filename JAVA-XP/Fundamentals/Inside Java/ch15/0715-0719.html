<HTML>
<HEAD>


<TITLE>Inside Java:Java Beans: Java's Component Architecture:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0710-0714.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0720-0722.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-715"><P>Page 715</P></A>


<TABLE>

<TR><TD>
Parameter
</TD><TD>
Description
</TD></TR><TR><TD>
v (for verbose)
</TD><TD>
Specifies that verbose output be generated to
stderr.
</TD></TR><TR><TD>
c (for create)
</TD><TD>
Creates a new JAR file on standard output, or in a file specified
by the &quot;f&quot; parameter. The files and directories to be archived
are specified as command line parameters. Directories are
processed recursively. To archive all the files, for example, in the
current directory and subdirectories to my.jar with verbose output,
the command would be: jar cvf my.jar *
</TD></TR><TR><TD>
m (for manifest)
</TD><TD>
By default, a manifest file is made when creating a JAR file. You
can use the &quot;m&quot; option to add to the contents of the manifest file
by supplying a file that contains the desired content. This is useful
for indicating which class files are Java Beans.
</TD></TR><TR><TD>
x (for extract)
</TD><TD>
Extracts files from the JAR file from standard input or a JAR
file specified by the &quot;f&quot; option. Files extracted are specified as
command line parameters. By default, all files are extracted. To extract all
files from my.jar, for example, the command would be:
jar xf my.jar
</TD></TR></TABLE>

<P>For more information on the jar tool, see the following Web page:
</P>

<PRE>

http://java.sun.com/products/JDK/1.1/docs/guide/jar/index.html
</PRE>

<H4><A NAME="ch15_ 15">
An Example of Using JAR Files with Beans
</A></H4>

<P>
In this section, a JAR file is created (using the jar tool) that contains the Scope
Bean from earlier in the chapter, as well as the state of the Scope Bean. The state will be
saved through a mechanism called
<I>serialization,</I> which is explained in Chapter 16,
&quot;Remote Method Invocation and Object Serialization.&quot;
</P>

<P>Listing 15.18 (program ScopeJar.java) is an example how you can save the state of,
or serialize, a Bean to a file. It also shows how you can restore the state of the Bean
from that serialized object file. This application displays the Scope Bean and presents the
user with three buttons:
</P>

<A NAME="PAGENUM-716"><P>Page 716</P></A>

<UL>
<LI>          The &quot;Serialize&quot; button saves the state of the Bean to a serialized object file.

<LI>          The &quot;Instantiate&quot; button removes the Scope Bean from the display. It then
creates another Scope Bean instance from the serialized object file.
<LI>          The &quot;Set&quot; button enables you to set the &quot;ticks&quot; property of the Scope Bean.
The change is reflected immediately in the Bean.
</UL>

<P>To demonstrate saving and restoring state:
</P>

<OL>
<LI>          Note the value of the &quot;ticks&quot; property.
<LI>          Click the Serialize button, which saves the Bean to the Scope.ser file.
<LI>          Enter a new number for the &quot;ticks&quot; property (say 12) and click the Set button.
<LI>          Click the Instantiate button. The state of the serialized Bean is restored, as
indicated by the &quot;ticks&quot; property.
</OL>

<P>The Scope.java listing is not repeated here. It is the same as in listing 15.1 except for
the package statement in line 6 that has been changed to:
</P>
<PRE>
06   package chapter15.code.scopejar;
</PRE>

<P>Figure 15.18 shows the ScopeJar application's display.
</P>

<P>Listing 15.18
</P>
<PRE>
Line==================Java Source=================
001   //////////
002   // ScopeJar.java  Serialize/instantiate a Scope
003   // Java Bean.
004   //
005   // Author: James L. Weaver  JDK 1.1 beta1
006   //////////
007   package chapter15.code.scopejar;
008
009   import java.awt.*;
010   import java.awt.event.*;
011   import java.io.*;
012   import java.beans.*;
013
014   public class ScopeJar extends Frame implements ActionListener {
015
</PRE>

<A NAME="PAGENUM-717"><P>Page 717</P></A>


<PRE>
016       Scope scope;
017       Button cerealEyes,
018              instantiate,
019              btnTicks;
020       TextField txtTicks;
021
022       public ScopeJar() {
023           super(&quot;Scope Java Bean Serialization&quot;);
024
025           setLayout(new BorderLayout());
026           addWindowListener(new Wadapt());
027           setSize(300, 300);
028
029           scope = new Scope();
030           scope.setTicks(8);
031           add(&quot;Center&quot;, scope);
032
033           Panel ps = new Panel();
034           add(&quot;South&quot;, ps);
035
036           cerealEyes = new Button(&quot;Serialize&quot;);
037           cerealEyes.addActionListener(this);
038           ps.add(cerealEyes);
039
040           instantiate = new Button(&quot;Instantiate&quot;);
041           instantiate.addActionListener(this);
042           ps.add(instantiate);
043
044           txtTicks = new TextField(&quot;8&quot;, 5);
045           ps.add(txtTicks);
046
047           btnTicks = new Button(&quot;Set&quot;);
048           btnTicks.addActionListener(this);
049           ps.add(btnTicks);
050
051           setVisible(true);
052       }
053
054       public static void main(String args[]) {
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>

<A NAME="PAGENUM-718"><P>Page 718</P></A>


<P>
Listing 15.18, Continued
</P>
<PRE>
055           ScopeJar menuFrame = new ScopeJar();
056           return;
057       }
058
059       public void actionPerformed(ActionEvent e) {
060           if (e.getSource() == cerealEyes) {
061               write(&quot;Scope.ser&quot;);
062           }
063           else if (e.getSource() == instantiate) {
064               remove(scope);
065               read(&quot;Scope.ser&quot;);
066               add(&quot;Center&quot;, scope);
067               txtTicks.setText(new Integer(scope.getTicks()).toString());
068               validate();
069           }
070           else if (e.getSource() == btnTicks) {
071               scope.setTicks(Integer.parseInt(txtTicks.getText()));
072               scope.repaint();
073           }
074       }
075
076       public void write(String filename){
077           try {
078               FileOutputStream   f = new FileOutputStream(filename);
079               ObjectOutputStream s = new ObjectOutputStream(f);
080               s.writeObject(scope);
081               s.flush();
082           }
083           catch (IOException e){
084               System.out.println(&quot;Exception while Writing&quot;);
085               return;
086           }
087       }
088
089       public void read(String filename)
090       {
091           try {
</PRE>

<A NAME="PAGENUM-719"><P>Page 719</P></A>



<PRE>
092               ClassLoader cl = Class.forName(
093                   &quot;chapter15.code.scopejar.Scope&quot;).getClassLoader();
094               scope = (Scope)Beans.instantiate(cl, filename);
095           }
096           catch (Exception e){
097               System.out.println(&quot;Problem instantiating Scope&quot;);
098           }
099       }
100   }
101
102   class Wadapt extends WindowAdapter
103   {
104       public void windowClosing(WindowEvent evt) {
105           evt.getWindow().setVisible(false);
106           evt.getWindow().dispose();
107           System.exit(0);
108       }
109   }
</PRE>

<P>Lines 29_31 create an instance of the Scope Bean, set the &quot;ticks&quot; property to 8, and
add the Bean to the &quot;Center&quot; of the BorderLayout controlled frame.
</P>

<P>When the Serialize button is clicked, line 61 calls the
write() method contained in lines 76_87 which serializes the Bean to a file.
</P>
<P>

<CENTER>
<TABLE BGCOLOR="#FFFF99">
<TR><TD><B>
NOTE
</B></TD></TR>
<TR><TD>
<BLOCKQUOTE>
Object Serialization is explained in Chapter 16, &quot;Remote Method Invocation and
Object Serialization.&quot;
</BLOCKQUOTE></TD></TR>
</TABLE></CENTER>
</P>
<P>When the Instantiate button is clicked:
</P>

<P>Line 64 removes the current Scope Bean instance from the frame.
</P>

<P>Line 65 calls the read() method contained in lines 89_99 to create an instance of a
Scope Bean from the serialized object file. These lines will be covered in a moment.
</P>

<P>Line 66 adds the new Scope Bean instance to the frame.
</P>

<P>Line 67 uses the getTicks() accessor method to get the ticks property of the new
Scope Bean. It then displays this value in the text field.
</P>

<P>In the read() method:
</P>

<P>Lines 92 and 93 identify the class loader that loaded the Scope class.
</P>

<P><CENTER>
<a href="0710-0714.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0720-0722.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

