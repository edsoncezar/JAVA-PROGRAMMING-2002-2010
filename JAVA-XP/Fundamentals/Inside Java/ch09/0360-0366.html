<HTML>
<HEAD>


<TITLE>Inside Java:Animating Applets with Java Graphics, Images, Colors, and Sound:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0357-0359.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0367-0370.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-360"><P>Page 360</P></A>



<P>Listing 9.5, Continued
</P>

<PRE>
021         degrees += 360;
022         }
023
024         return degrees ;
025
026         }  // end normalize
027
028
029         // Converts degrees to radians
030          public static double radians(int degrees)
031         {
032            return ((double) degrees)* Math.PI/180.0;
033
034         }  // end radians
035
036
037   }  // end Angle
038
039   class Line
040 {
041      // Line center
042      int xc;
043      int yc;
044
045      double r; // Line radius from center
046
047      // Initial coordinates
048      int x[] = new int[2];
049      int y[] = new int[2];
050
051      // Rotated coordinates
052      int rotX[] = new int[2];
053      int rotY[] = new int[2];
054
055  doublerotTheta;  // Last rotated angle
056
057      int  maxsize; // Max size indicator
</PRE>

<A NAME="PAGENUM-361"><P>Page 361</P></A>



<PRE>
058
059      // Constructor for creating Line
060      public Line(int xc, int yc, int maxsize)
061      {
062         this.xc = xc;
063         this.yc = yc;
064         this.maxsize = maxsize;
065
066         r = Math.random()*(double)(maxsize/2);
067         rotTheta = 0.0F;
068         x[0] = xc + (int)r;
069         y[0] = yc;
070
071      }  // end Line
072
073      // Rotates the line by the specified degrees
074      public void rotate(int degrees)
075      {
076         int projX;// Projection on Xaxis
077         int projY;// Projection on Yaxis
078
079         degrees = Angle.normalize(degrees);
080
081         rotTheta += Angle.radians(degrees);
082
083         projX = (int)(r*Math.cos(rotTheta));
084         projY = (int)(r*Math.sin(rotTheta));
085
086         rotX[0] = xc _ projX;
087         rotX[1] = xc + projX;
088
089         rotY[0] = yc + projY;
090         rotY[1] = yc _ projY;
091
092      }  // end rotate
093
094   }  // end Line
095
096   public class LineDraw extends Applet
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>

<A NAME="PAGENUM-362"><P>Page 362</P></A>


<P>Listing 9.5, Continued
</P>
<PRE>
097   implements Runnable
098   {
099
100      Label label; // Label for text
101
102      // Resize values
103      int dimX = 300;
104      int dimY = 300;
105
106      Line rotLine = new Line(dimX/2, dimY/2, 200);
107      int rotDelta = 5;// rotation delta
108
109      Thread paintThread = null;
110
111      static Color[] ac =
112      {
113         Color.white,
114         Color.black,
115         Color.gray,
116         Color.darkGray,
117         Color.red,
118         Color.green,
119         Color.blue,
120         Color.yellow,
121         Color.magenta,
122         Color.cyan,
123         Color.pink,
124         Color.orange
125
126      }; // end ac
127
128
129      // start method overrides method in Applet
130      public void start()
131      {
132         if (paintThread == null)
133         {
134         paintThread = new Thread(this);
</PRE>


<A NAME="PAGENUM-363"><P>Page 363</P></A>



<PRE>
135          paintThread.start();
136
137         }  // end if
138
139
140      }  // end start
141
142      // stop method overrides method in Applet
143      public void stop()
144      {
145         if (paintThread != null)
146         {
147             paintThread.stop();
148             paintThread = null;
149         }  // end if
150
151      }  // end stop
152
153      // run method implement the Runnable interface.
154      public void run()
155         throws InterruptedException
156      {
157         for(;;)
158         {
159             repaint();
160             Thread.sleep(50);
161
162         } // end for
163
164      } // end run
165
166      // init method overrides method in Applet
167      public void init()
168      {
169
170         super.init();
171         resize(dimX,dimY);
172
173         setLayout(null);
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>

<A NAME="PAGENUM-364"><P>Page 364</P></A>



<P>Listing 9.5, Continued
</P>
<PRE>
174
175         label=new Label(&quot;A Simple Applet&quot;);
176         add(label);
177         label.reshape(1,1,100,15);
178
179      }  // end init
180
181
182      // gets random color, except the
183      // background color lightGray
184      private Color getColor()
185      {
186         int index;
187
188         index = (int) (Math.random()*((double)ac.length));
189         if (index == ac.length)
190         {
191             index;
192
193         }  // end if
194
195         return ac[index];
196
197      }  // end getColor
198
199      // paint method overrides method in Component
200      public void paint(Graphics g)
201      {
202
203         // Erase the previous line
204         g.setColor(Color.lightGray);
205         g.drawLine(rotLine.rotX[0], rotLine.rotY[0],
206            rotLine.rotX[1], rotLine.rotY[1]);
207
208         // Rotate the line
</PRE>


<A NAME="PAGENUM-365"><P>Page 365</P></A>


<PRE>
209         rotLine.rotate(rotDelta);
210
211         // Draw the rotated line
212         g.setColor(getColor());
213         g.drawLine(rotLine.rotX[0], rotLine.rotY[0],
214            rotLine.rotX[1], rotLine.rotY[1]);
215
216      }  // end paint
217
218   }  // end LineDraw
</PRE>

<H4><A NAME="ch09_ 22">
Reducing Animation Flicker
</A></H4>

<P>You may have noticed that the animation of Java applets creates an annoying
flicker. The flicker is caused when each frame of the Java applet is repainted by a call to
repaint(). In the discussion of the example in listing 9.5, it was explained that the call to
repaint() results in a call to paint(). Actually, the sequence of actions that occur are the following:
</P>

<OL>
<LI>          The call to repaint() results in a call to
update(), also inherited from the Component class:
</OL>


<PRE>
     public void update(Graphics g);
</PRE>

<OL START="2">
<LI>          The update() method first clears the screen by filling it with the current
background color, and then calls paint():
</OL>

<PRE>
     public void paint(Graphics g);
</PRE>

<OL START="3">
<LI>          The paint() method in your applet draws the frame.
</OL>

<P>The call to update() results in the animation flicker as it erases the previous contents of
the frame. To prevent the animation flicker, you can use the following techniques:
</P>

<UL>
<LI>          Override update(). Clear only parts of the screen that need to be redrawn, or do
not clear the screen.
<LI>          Override update() and use double buffering:
</UL>

<P>The default version of update() defined in the Component class performs the
following actions:
</P>

<PRE>
public void update(Graphics g)
{
      g.setColor(getBackground());
</PRE>


<A NAME="PAGENUM-366"><P>Page 366</P></A>

<PRE>

      g.fillRect(0, 0, width, height);
      g.setColor(getForeground());
      paint(g);

} // end update
</PRE>

<P>From the preceding code, you can see that
update() clears the screen by calling fillRect()
with the width and height of the applet by using the background color. Next, it calls the
paint() method.
</P>

<P><B>
Overriding Update Method to Reduce Flickering
</B></P>

<P>You could fix the flicker of the LineDraw applet, in listing 9.5, by overriding the
update() method, and have it call only paint(). Note that the
paint() method in listing 9.5 already takes care of erasing the previous line:
</P>

<P>A modified form of the LineDraw program is in the file LineDraw1.java on the
</P>

<P>CD-ROM at the back of the book. The only difference between this and the
original LineDraw program is the inclusion of the following
update() method:
</P>

<PRE>
 // update method overrides method in Component
 public void update(Graphics g)
 {
  paint(g);

 }  // end update
</PRE>

<P>You can compile and test the LineDraw1 program by using javac and then compare
it with the original LineDraw program.
</P>

<P>You can also override update() and, rather than clearing the entire applet screen each
time update() is called, just modify the section of the screen that needs modification. You
can do this by using the clipRect() method of the Graphics class that was described earlier
in this chapter (lines 99_104 of listing 9.1). Here is an example of using this in an
update() method:
</P>

<PRE>
 // update method overrides method in Component
 public void update(Graphics g)
 {
      // x, y, width, height must be set
      // according to applet logic.
      g.clipRect(x, y, width, height);
  paint(g);
</PRE>


<P><CENTER>
<a href="0357-0359.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0367-0370.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

