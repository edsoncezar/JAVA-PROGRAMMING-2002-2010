<HTML>
<HEAD>


<TITLE>Inside Java:Animating Applets with Java Graphics, Images, Colors, and Sound:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0371-0375.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0380-0385.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-376"><P>Page 376</P></A>



<PRE>
         System.out.println(&quot;Right key&quot;);
         break;

         case Event.UP:
         System.out.println(&quot;Up key&quot;);
         break;

         case Event.DOWN:
         System.out.println(&quot;Down key&quot;);
         break;

         default:
         System.out.println(&quot;Non arrow key&quot;);
         break;

      } // end switch

      return true;

} // end keyDown
</PRE>

<P>The methods discussed in this section are called by the generic AWT event
handler handleEvent() that is inherited from the Component class:
</P>

<PRE>
public boolean handleEvent(Event event);
</PRE>

<P>To handle events other than the default events, you must override this handler
and supply your own logic. The following is an example of an event handler:
</P>

<PRE>
public boolean handleEvent(Event e)
{

      if (e.id == Event.MOUSE_DOWN)
      {
         // Perform logic. In this case
         // a counter is decremented.
         -- counter;

         return true; // event handled.
      } // end if

      return super.handleEvent(e);

} // end handleEvent
</PRE>

<P>In the last statement of this method, if the event is not a mouse down event,
the
</P>

<A NAME="PAGENUM-377"><P>Page 377</P></A>



<P>superclass's handlerEvent() is called. This line of code ensures that the default handling
for other types of events will be handled by the handler for the enclosing component.
</P>

<P>
<b>Code-Walk of the Animation Applet</b>
</P>

<P>Now that you understand how image, sound, and events are handled in an
applet, consider listing 9.6 (file ImageAnim.java on the CD-ROM that accompanies this
book) that contains an applet that does animation by using images, sound, and interacting
with the user.
</P>

<P>The init() method defined on lines 184_256 performs the applet initialization. Lines
187 and 188 invoke the superclass's init() method and resize the applet dimensions. Line
190 sets the flow layout for laying the button components defined on lines 192 and
193. These button objects are declared as class instance objects on lines 76 and 77. Lines
194 and 195 add the buttons to the applet. Lines 202_233 obtain parameter values passed
in the HTML file. A description of these parameter values is on lines 36_47. The
getParameter() value is used to obtain a string representation of the parameter value. If the
parameter value is not passed in the HTML file, a default value is assumed. Note the clever use
of the ternary operator &quot;?:&quot; to do a concise assignment of the parameter values (lines
203, 207, 211, 215, 221, 226, 231, 233). Line 237 instantiates the array of images based on
the nimgs parameter. Lines 239_243 load the file images into this array. Line 246 loads
the audio clip. Lines 252_254 set up code to perform double buffering to reduce
animation flicker.
</P>

<P>The start() method defined on lines 91_100 performs the standard logic of creating a
thread instance (line 95) and calling the start method for the thread (line 96).
</P>

<P>After the thread is started, the run() method is called (see lines 128_151). On line 132,
you can see a statement to reduce the thread's priority below the normal priority. This is
not essential for the logic of the applet, but it is a nice gesture toward the applet user,
to prevent this thread from impacting the user's computer system. Lines 134_138 start
the audio clip for the thread. The audio clip is played continuously because the
loop() method for the audio clip is called (see line 136). If the audio clip is not loaded, the
instance variable audio will be set to null, and the if statement on line 134 will ensure that
the audio.loop() will not be called. Lines 141_151 set up an infinite loop. Within this loop,
the next image is extracted from the array of images, and the
repaint() method is called. After the image is painted, the thread goes to sleep for
delay milliseconds, and then the sequence of actions in the loop repeat.
</P>

<P>The call to repaint() results in a call to
update() (see lines 173_177), which then calls the
paint() method (line 175). In the paint() method a check is made to see if the currImage that
holds the image frame to be painted is not null. In line 162, the image is first drawn on the
off-screen double buffer, and in line 163 this image is painted to the applet.
</P>

<A NAME="PAGENUM-378"><P>Page 378</P></A>

<P>The stop() method on lines 107_119 stops the animation and the sound. If the thread
is alive, it stops the audio (see lines 111_115), terminates the thread (line 116), and sets
the thread object reference to null so it can be reclaimed by Java's automatic
garbage collector.
</P>


<P>The handleEvent() method on lines 258_281 checks whether the button labeled &quot;Fast&quot;
or &quot;Slow&quot; is pressed by the user. If the Fast button is pressed, the delay interval
between successive calls to repaint() is reduced by 10 milliseconds (line 263); and if the Slow
button is pressed, this delay interval is increased by 10 milliseconds (line 274). The
if-statement on lines 265_269 ensures that the delay does not drop below 0 seconds. The
current delay value is displayed for the applet in the Web browsers status area by
calling showStatus(). The showStatus() method is inherited from the Applet class. On line 279
the superclass's handler is called to handle all other events not handled by the
overriding handleEvent() method.
</P>

<P>Listing 9.6
</P>
<PRE>
Line==================Java Source=================
001 /**
002  *
003  *  Animator applet: Shows how to animate applets
004  *  using images.
005  *
006  *  Author: Karanjit S. G. S. Siyan
007  *
008  *
009  *This class is a basic extension of the Applet class.  It would generally be
010  *used as the main class with a Java browser or the AppletViewer.  But an
     instance
011  *can be added to a subclass of Container.  To use this applet with a
     browser or
012  *the AppletViewer, create an html file with the following code:
013  *
014  *&lt;HTML&gt;
015  *&lt;HEAD&gt;
016  *&lt;TITLE&gt; Three fold flame &lt;/TITLE&gt;
017  *&lt;/HEAD&gt;
018  *&lt;BODY&gt;
019  *
020  *&lt;APPLET CODE=&quot;ImageAnim.class&quot; WIDTH=332 HEIGHT=169&gt;
021  *&lt;param name=imgdir value=&quot;images/flame&quot;&gt;
</PRE>

<A NAME="PAGENUM-379"><P>Page 379</P></A>


<PRE>
022  *&lt;param name=imgfile value=&quot;flame&quot;&gt;
023  *&lt;param name=imgtype value=&quot;gif&quot;&gt;
024  *&lt;param name=audiopath value=&quot;audio/bgsound.au&quot;&gt;
025  *&lt;param name=nimgs value=2&gt;
026  *&lt;param name=delay value=250&gt;
027  *&lt;param name=xpos value=20&gt;
028  *&lt;param name=ypos value=20&gt;
029  *&lt;/APPLET&gt;
030  *
031  *&lt;/BODY&gt;
032  *
033  *&lt;/HTML&gt;
034  *
035  *
036  *LEGEND OF PARAMETERS USED FOR APPLET CLASS
037  *imgdir  = Image directory
038  *imgfile = Image file
039  *imgtype = Image type (gif)
040  *audiopath = Audio file path
041  *nimgs= Number of image files.
042  * Each file has the following template: flameX.gif
043  * where X = 1, 2, 3, ...
044  *
045  *delay= Delay between each display of image in milliseconds
046  *xpos = Xcoordinate of applet
047  *ypos = Ycoordinate of applet
048  *
049  *
050  */
051
052 import java.awt.*;
053 import java.applet.*;
054
055 public class ImageAnim extends Applet implements Runnable
056 {
057
058      String  imgDir;// Image directory.
059      String  imgFile;  // Image file.
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>

<P><CENTER>
<a href="0371-0375.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0380-0385.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

