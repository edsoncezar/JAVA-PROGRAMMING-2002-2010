<HTML>
<HEAD>


<TITLE>Inside Java:Animating Applets with Java Graphics, Images, Colors, and Sound:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0360-0366.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0371-0375.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-367"><P>Page 367</P></A>



<PRE>
 }  // end update
</PRE>

<P><B>Using Double Buffering to Reduce Flicker
</B></P>

<P>In double buffering, an off-screen image is first drawn, and then this image is sent to
the screen to be displayed. Here is an outline of the steps to be performed.
</P>

<OL>
<LI>          Create an off-screen image and a graphics context:
</OL>

<PRE>
Image offScreenImage;
Graphics offScreenGraphics;
         Make these class instance variables in your applet class.
</PRE>

<OL START="2">
<LI>          In the init() method of the applet, create object instances for the class
instance variables of step 1.
</OL>

<PRE>
public void init()
{
      super.init();
      Dimension d = this.size();

      offScreenImage = createImage(d.width, d.height);
      offScreenGraphics =
         offScreenImage.getGraphics();

      // Other logic
} // end init
</PRE>

<OL START="3">
<LI>           Do all drawing of graphics in the
paint() method to the off-screen graphics context.
If, for example, you need to draw the image flash, do the following:
</OL>


<PRE>
offScreenGraphics.drawImage(flash, x, y, this);
</PRE>

<OL>
<DL>
          Here are examples of calling other methods for the off-screen graphics:
</DL>
</OL>

<PRE>
offScreenGraphics.setColor(Color.magenta);
offScreenGraphic.drawRect(10, 10, 50, 50);
offScreenGraphic.fillRect(80, 10, 50, 50);
</PRE>


<OL START="4">
<LI>          Restore the off-screen graphic image to the real display screen by using
the following:
</OL>

<PRE>
g.drawImage(offScreenImage, 0, 0, this);
</PRE>

<A NAME="PAGENUM-368"><P>Page 368</P></A>


<OL START="5">
<LI>          Override the update() method and include the following code:
</OL>

<PRE>
public void update(Graphics g)
 {
  paint(g);

 }  // end update
</PRE>

<H4><A NAME="ch09_ 23">
Animating with Sound and Images
</A></H4>

<P>Java enables you to write applets that you can animate with images. Each image
provides a frame of animation. By rapidly displaying the frames in succession, the illusion
of continuous motion is maintained. The interval of time between successive frames can
be controlled by delaying the thread that performs the animation for a period of time.
The following sections present the classes that Java provides for dealing with images,
sound, and interacting with the applet. Toward the end of the chapter, a complete listing of
an applet that implements these features is discussed.
</P>

<P><B>
Using the Image Class
</B></P>

<P>The Image class represents a displayable image and is defined in the java.awt
package. You cannot instantiate the Image class by using a constructor. You must use either
</P>

<P>the Applet.getImage() or
Component.createImage() methods. Within an applet, the most
convenient way of creating an instance of this Image class is to call the
Applet.     getImage() method, which you inherit when you extend the
Applet class.
</P>

<P>The Applet.getImage()method has the following two forms:
</P>

<PRE>
public Image getImage(URL url);
public Image getImage(URL url, String pathname)
</PRE>

<P>The first argument is the URL class. URL stands for
Uniform Resource Locator, and it refers to the location of the server applet. The second form of
getImage() has an additional argument for the pathname of the image file. The pathname of the file can also
be combined as part of the URL&#151;in fact, this is what needs to be done in the first form of getImage()&#151;but by separating the hostname on which the applet
resides with the pathname you'll have additional flexibility. In the second form of
getImage(), for instance, if you have image files named
flame1.gif, flame2.gif, flame3.gif, you can easily
build the file names of the images in Java without having to modify the URL argument.
</P>

<P>To build the URL argument, you can use the following two methods, also defined in
the Applet class:
</P>

<PRE>
public URL getCodeBase();
</PRE>


<A NAME="PAGENUM-369"><P>Page 369</P></A>

<PRE>
public URL getDocumentBase();
</PRE>

<P>The getCodeBase() gets an instance of the URL class that refers to the URL location of
the directory in which the applet code resides. If, for example, the URL for your applet is
<a href="http://www.tsl.org/applet/flame.class">
http://www.tsl.org/applet/flame.class</A>, then the call to
getCodeBase() will return a URL containing the reference to
<a href="http://www.tsl.org/applet.">
http://www.tsl.org/applet.</A>
</P>

<P>Similarly, the getDocumentBase() gets an instance of the URL class that refers to the
URL location of the directory in which the HTML file for the applet resides. If, for example,
the URL for your applet's HTML file is
<a href="http://www.tsl.org/html/flame.html">
http://www.tsl.org/html/flame.html</A>, then the call
to getCodeBase() will return a URL containing the reference to
<a href="http://www.tsl.org/html.">
http://www.tsl.org/html.</A>
</P>

<P>You can use either getDocumentBase() or
getCodeBase() to obtain the URL to be used in the
getImage() method. Your choice will depend on whether your images are stored relative
to your applet code directory or the HTML documents directory.
</P>

<P>The following are some examples of calling
getImage() within your applet to create an instance of the image:
</P>

<PRE>
// Uses first form of getImage()
Image img1 = getImage(
new 
URL(&quot;http://www.tsl.org/images/flame.gif&quot;));

// Uses second form of getImage()
Image img2 = getImage(getCodeBase(), &quot;flame.gif&quot;);
Image img3 = getImage(getDocumentBase(), &quot;flame.gif&quot;);
</PRE>

<P>If the images are stored in subdirectories relative to the applet code or HTML
directory, you can enter the relative pathname to the file as the second argument:
</P>

<PRE>
// Uses second form of getImage() with pathname
Image img4 = getImage(getCodeBase(), &quot;images/flame.gif&quot;);
Image img5 = getImage(getDocumentBase(), &quot;images/flame.gif&quot;);
After you obtain the image, you can draw it within the applet's display
area using the drawImage() method defined in the Graphics class:
 //
 // Draws the specified image at the specified coordinate (x, y).
 // If the image is incomplete the image observer will be
 // notified later.
 // x = X-coordinate for drawing the image
 // y = Y-coordinate for drawing the image
 // img = the specified image to be drawn
</PRE>


<A NAME="PAGENUM-370"><P>Page 370</P></A>



<PRE>
 // observer = notifies if the image is complete or not
 public abstract boolean drawImage(Image img, int x, int y,
            ImageObserver observer);
</PRE>

<P>The <I>ImageObserver</I> is an interface class, and refers to any class that implements
the ImageObserver interface. One of the superclasses for the Applet class is the
Component class and this implements the ImageObserver interface. So for the Image-
Observer argument you will pass this, the instance of your applet class. Your applet can
now receive information, asynchronously, about the status of loading the image.
</P>

<P>You will typically use drawImage() in the paint() method, as shown next:
</P>

<PRE>
public void paint(Graphics g)
{
      // x and y should be set
      // before calling this method.
      g.drawImage(img, x, y, this);

} // end paint
</PRE>

<P><B>Using the AudioClip Class
</B></P>

<P>To play sound, you must first create an instance of the AudioClip class. This
class contains a representation of the sound clip to be played. You create an instance of
this class by calling the getAudioClip() method defined in the Applet class:
</P>

<PRE>
public AudioClip getAudioClip(URL url);
public AudioClip getAudioClip(URL url, String pathname)
</PRE>

<P>Notice that the arguments to these methods are similar to the arguments for the
getImage() method discussed in the previous section, so the same discussion applies to them.
The following are examples of how to use these methods:
</P>

<PRE>
// Uses first form of getAudioClip()
AudioClip audio1 = getAudioClip(
new 
URL(&quot;http://www.tsl.org/audio/vflame.au&quot;));
// Uses second form of getAudioClip()
AudioClip audio2 = getAudioClip(getCodeBase(), &quot;bflame.au&quot;);
AudioClip audio3 = getAudioClip(getDocumentBase(), &quot;bflame.gif&quot;);
</PRE>


<P><CENTER>
<a href="0360-0366.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0371-0375.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

