<HTML>
<HEAD>


<TITLE>Inside Java:Animating Applets with Java Graphics, Images, Colors, and Sound:EarthWeb Inc.-</TITLE>






<P><CENTER>
<a href="0376-0379.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0386-0386.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-380"><P>Page 380</P></A>



<P>Listing 9.6, Continued
</P>
<PRE>
060      String  imgType;  // Image type.
061      String  audioPath;// Audio file path.
062
063      int  nimgs; // Number of images.
064      int  delay; // Delay between consecutive images.
065      int  xpos;  // Xcoordinate to display the image.
066      int  ypos;  // Ycoordinate to display the image.
067      Imageimages[]; // Define the array that holds the images.
068      ImagecurrImage;// Current image to be displayed.
069      int  currIndex;// Current index into images array.
070
071      AudioClipaudio;// Audio clip.
072
073      Imageoimg;  // Off-screen image
074      Graphics og;// Off-screen graphics context.
075
076      Button  slow;  // Slow button
077      Button  fast;  // Fast button
078
079      /**
080      * Initially, we are designing a single thread
081      * to display all the images. So only a single
082      * thread is being constructed.
083      */
084      Thread threadact = null;
085
086     /**
087      * start(): Called when the applet is visible.
088      * It's primary function is to start the
089      * threadact thread
090      */
091      public void start()
092      {
093         if (threadact == null)
094         {
095            threadact = new Thread(this, &quot;threadact&quot;);
096            threadact.start();
097
</PRE>


<A NAME="PAGENUM-381"><P>Page 381</P></A>



<PRE>
098         }  // end if
099
100      }  // end start
101
102      /**
103      * stop(): Called when the applet is no longer visible.
104      * This stops the current thread by calling the thread's
105      * stop method.
106      */
107      public void stop()
108      {
109         if (threadact != null &amp;&amp; threadact.isAlive())
110         {
111            if (audio != null)
112            {
113            audio.stop();
114
115         }  // end if
116         threadact.stop();
117         threadact = null;
118
119      }  // end if
120
121
122      }  // end stop
123
124
125     /**
126      * run(): This implements the run method for the Runnable interface.
127      */
128      public void run()
129      throws InterruptedException
130      {
131      // Diminish the thread's priority.
132      Thread.currentThread().setPriority(Thread.NORM_PRIORITY_1);
133
134      if (audio != null)
135      {
136         audio.loop();
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>

<A NAME="PAGENUM-382"><P>Page 382</P></A>



<P>Listing 9.6, Continued
</P>
<PRE>
137
138      }  // end if
139
140      // Set up the classical infinite loop for daemons.
141      for (;;)
142      {
143         currImage = images[currIndex];
144         currIndex = (++currIndex) % nimgs;
145
146         repaint();
147         Thread.sleep(delay);
148
149      }  // end for
150
151     }  // end run
152
153
154      /**
155      * paint(): Overrides the paint method defined in the
156      * component class.
157      */
158      public void paint(Graphics g)
159      {
160         if (currImage != null)
161         {
162            og.drawImage(currImage, xpos, ypos, this);
163            g.drawImage(oimg, 0, 0, this);
164
165      }  // end if
166
167      }  // end paint
168
169      /**
170      * update(): Overrides the update method defined in the
171      * component class.
172      */
173      public void update(Graphics g)
</PRE>

<A NAME="PAGENUM-383"><P>Page 383</P></A>


<PRE>
174      {
175         paint(g);
176
177      } // end update
178
179
180      /**
181      * init(): Standard init method that needs to be overriden
182      * for the applet class.
183      */
184      public void init()
185      {
186
187         super.init();
188         resize(230,190);
189
190         setLayout(new FlowLayout(FlowLayout.RIGHT));
191
192         slow = new Button(&quot;Slow&quot;);
193         fast = new Button(&quot;Fast&quot;);
194         add(slow);
195         add(fast);
196
197         // Initialize parameters passed through
198         // the param values in the HTML file
199         //
200
201         // Define the image directory
202         String param = getParameter(&quot;imgdir&quot;);
203         imgDir = (param != null) ? param : &quot;images/flame&quot;;
204
205         // Define the image file name
206         param = getParameter(&quot;imgfile&quot;);
207         imgFile = (param != null) ? param : &quot;flame&quot;;
208
209         // Define the image type
210         param = getParameter(&quot;imgtype&quot;);
211         imgType = (param != null) ? param : &quot;gif&quot;;
212
</PRE>
<PRE>
                                                       <I>continues</I>
</PRE>

<A NAME="PAGENUM-384"><P>Page 384</P></A>



<P>Listing 9.6, Continued
</P>
<PRE>
213         // Define the audio path
214         param = getParameter(&quot;audiopath&quot;);
215         audioPath = (param != null) ? param : &quot;audio/bgsound.au&quot;;
216
217
218         // Define the number of images.
219         // Note, modify the default value of number of images.
220         param = getParameter(&quot;nimgs&quot;);
221         nimgs = (param != null) ? Integer.valueOf(param).intValue() : 2;
222
223         // Define the time delay between image displays.
224         // Unit is in milliseconds.
225         param = getParameter(&quot;delay&quot;);
226         delay = (param != null) ? Integer.valueOf(param).intValue() : 333;
227
228         // Define the coordinates (xpos, ypos) at which to
229         // display the image.
230         param = getParameter(&quot;xpos&quot;);
231         xpos = (param != null) ? Integer.valueOf(param).intValue() : 10;
232         param = getParameter(&quot;ypos&quot;);
233         ypos = (param != null) ? Integer.valueOf(param).intValue() : 10;
234
235
236         // Next, load the images in the image array.
237         images = new Image[nimgs];
238         int  i, j; // Loop indexes
239         for (i = 0, j = 1; i &lt; nimgs; i++, j++)
240         {
241            images[i] = getImage(getCodeBase(), imgDir+&quot;/
&Acirc;&quot;+imgFile+j+&quot;.&quot;+imgType);
242
243         }  // end for
244
245         // Get the audio clip.
246         audio = getAudioClip(getCodeBase(), audioPath);
247
248         // Set the current image index to 0.
249         currIndex = 0;
</PRE>


<A NAME="PAGENUM-385"><P>Page 385</P></A>



<PRE>
250
251         // Set up double buffering.
252         Dimensioned = this.size();
253         oimg = createImage(d.width, d.height);
254         og = oimg.getGraphics();
255
256      }  // end init
257
258      public boolean handleEvent(Event event)
259      {
260
261         if (event.target == fast)
262         {
263            delay _ = 10;
264
265         if (delay &lt; 0)
266         {
267            delay = 0;
268
269         }  // end if
270
271         }
272         else if (event.target == slow)
273         {
274         delay += 10;
275
276         }  // end if
277
278         showStatus(&quot;delay = &quot;+delay+&quot; ms&quot;);
279         return super.handleEvent(event);
280
281      } // end handleEvent
282
283 }  // end ImageAnim
</PRE>

<H3><A NAME="ch09_ 24">
Summary
</A></H3>

<P>In this chapter, you learned the basics of using Java's built-in graphics primitives to
</P>


<P><CENTER>
<a href="0376-0379.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0386-0386.html">Next</A>
</CENTER></P>







</BODY>
</HTML>

