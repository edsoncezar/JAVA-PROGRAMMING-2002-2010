<HTML>

<HEAD>



<TITLE>Industrial Strength Java:Introducing Networking:EarthWeb Inc.-</TITLE>



















<P><CENTER>

<a href="0327-0330.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0336-0339.html">Next</A>

</CENTER></P>



<A NAME="PAGENUM-331"><P>Page 331</P></A>







<B>

URLConnection

</B>



<P>The URL class is limited in what information can be downloaded. You have access

to much more information by using java.net.URLConnection. Data such as size,

content type, and when the file was last modified are accessible. The details of the class are

listed below.

</P>



<P>Listing 10.4 java.net.URLConnection

</P>


<PRE>

public abstract class java.net.URLConnection extends Object{

//Constructors

protected URLConnection(URL url);

//Variables

protected boolean allowUserInteraction;

protected boolean connected;

protected boolean doInput;

protected boolean doOutput;

protected long ifModifiedSince;

protected URL url;

protected boolean useCaches;

//Methods

public static boolean getDefaultAllowUSerInteraction();

public static String getDefaultRequestProperty(String key);

protected static String guessContentTypeFromName(String fname);

protected static String guessContentTypeFromStream

  (InputStream is) throws IOException;

public static synchronized void setContentHandlerFactory

  (ContentHandlerFactory fac) throws Error;

public static void setDefaultAllowUserInteraction

  (boolean defaultallowuserinteraction);

public static void setDefaultRequestProperty

  (String key, String value);

public abstract void connect() throws IOException;

public boolean getAllowUserInteraction();

public Object getContent()

  throws IOException, UnknownServiceException;

public String getContentEncoding();

public int getContentLength();

public long getData();

public boolean getDefaultUseCaches();

public boolean getDoInput();

public boolean getDoOutput();

public long getExpiration();

public String getHeaderField(String name);

public String getHeaderField(int n);

public long getHeaderFieldDate(String name, long Default);

</PRE>


<PRE>
continues
</PRE>




<A NAME="PAGENUM-332"><P>Page 332</P></A>







<P>Listing 10.4 Continued

</P>


<PRE>

public int getHeaderFieldInt(String name, int Default);

public String getHeaderFieldKey(int n);

public long getIfModifiedSince();

public InputStream getInputStream()

  throws IOException, UnknownServiceException;

public long getLastModified();

public OutputStream getOutputStream

  throws IOException, UnknownServiceException;

public String getRequestProperty(String key);

public URL getURL();

public boolean getUseCaches();

public void setAllowUserInteraction(boolean allowuserinteraction);

public void setDefaultUseCaches(boolean defaultusecaches);

public void setDoInput(boolean doinput);

public void setDoOutput(boolean doouput);

public void setIfModifiedSince(long ifmodifiedsince);

public void setRequestProperty(String key, String value);

public void setUseCaches(boolean usecaches);

public String toString();

}

</PRE>




<P>URLConnection provides an assortment of methods. Some of them are rarely

used; however, you will want to be familiar with several key methods.

</P>



<P>The connect() method performs the actual network connection; it is called by methods

that depend on being connected.

</P>



<P>The getContent() method is similar to the method of the same name in URL, but it

returns an Object instead of an URL.

</P>



<P>The getContentLength(), getContentType(), getContentEncoding(),

getDate(), getLastModified(), and getExpiration() methods return information about the

object specified by the URL, if it can be determined. If you are using HTTP, you can access

more data by using the getHeaderField(), getHeaderFieldInt(), and

getHeaderFieldDate() methods.

</P>



<P>Finally, you can use different methods to specify how the instance behaves. You can

find the current status by using the get methods and change the current status with the

set methods; getDoInput() and getDoOutput() determine whether the connection is

read/write or read-only; getUseCaches() specifies whether the URL can be loaded from memory,

if available, or whether the Object should be reread from the disk;

getIfModifiedSince() can

</P>





<A NAME="PAGENUM-333"><P>Page 333</P></A>







<P>be used to prevent an URL from being accessed if it has not been recently changed;

and getAllowUserInteraction() is used to determine whether the data transfer depends on

user-interaction. An example of such a transfer is typing a password.

</P>



<P>Table 10.5 shows the default values of the most commonly used URLConnection <BR>

variables.

</P>









<P>Table 10.5<BR>

Default values of URLConnection properties

</P>



<TABLE>



<TR><TD>

Property

</TD><TD>

Default Value

</TD></TR><TR><TD>

DoInput

</TD><TD>

True

</TD></TR><TR><TD>

DoOutput

</TD><TD>

False

</TD></TR><TR><TD>

UseCaches

</TD><TD>

True

</TD></TR><TR><TD>

IfModifiedSince

</TD><TD>

True

</TD></TR><TR><TD>

AllowUserInteraction

</TD><TD>

False

</TD></TR></TABLE>



<P>Listing 10.5 shows you how to access the wealth of information that

getURLConnection() provides. The getsetData() method displays and modifies some of that information.

</P>



<P>For simplicitiy's sake, exceptions are not caught in this example. In larger

programs, especially any program written and tested by more than one person, handling exceptions

is very important. Your attention here, however, should be focused on the networking

aspects of this example. Exception handling is dealt with in Chapter 12, &quot;Distributed

Computing with Java.&quot;

</P>



<P>Listing 10.5 getsetData.java

</P>




<PRE>

package industrial;



import java.net.*;

import java.io.*;



//  This class is designed to print out a variety of

//  information about a given URLConnection. It also

//  changes some of the properties.



public class getsetData

{



  public static void main(String[] args)

  throws MalformedURLException, IOException

  {

</PRE>


<PRE>
continues
</PRE>




<A NAME="PAGENUM-334"><P>Page 334</P></A>







<P>Listing 10.5 Continued

</P>




<PRE>

    //  first we need to create the URLConnection

    URL u = new URL(args[0]);

    URLConnection uc = u.openConnection();



    //  now we can access the information

    System.out.println(args[0]);

    System.out.println(&quot;Content Type: &quot; + uc.getContentType());

    System.out.println(&quot;Was last modified: &quot; + uc.getLastModified());

    System.out.println(&quot;Size: &quot; + uc.getContentLength());

    System.out.println(&quot;Can we use cache? &quot; + uc.getUseCaches());



    //  now alter UseCaches property

    uc.setUseCaches(true);



    //  now show change

    System.out.println(&quot;Now can we use cache? &quot; + uc.getUseCaches());

  }

}

</PRE>




<P>Listing 10.6 displays the output from executing this program. In the first example, the

user does not have permsission to change the UseCaches property because it is a remote file.

In the second, the property can be changed. However, because you are looking at a text

file on your hard drive, much of the data is unknown.

</P>



<P>Listing 10.6 getsetData sample run

</P>




<PRE>

%java getsetData <a href="http://studsys.mscs.mu.edu/~brumbaug">

http://studsys.mscs.mu.edu/~brumbaug</A>

<a href="http://studsys.mscs.mu.edu/~brumbaug">

http://studsys.mscs.mu.edu/~brumbaug</A>

Content Type: text/html

Was last modified:

Size:

Can we use cache? Yes

java.lang.IllegalAccessError:

    at java.net.URLConnection.setUseCaches(URLConnection.java 279)

    at getsetData.main(getsetData.java:26)

%



c:&gt;java getsetData file://autoexec.bat

file://autoexec.bat

Content Type: text/plain

Was last modifed: 0

Size: -1

</PRE>




<A NAME="PAGENUM-335"><P>Page 335</P></A>






<PRE>

Can we use cache? Yes

Now can we use cache? No

c:&gt;

</PRE>


<P>

<B>

URLEncoder

</B>

</P>



<P>A final class deserves mention during a discussion about

URLs&#151;java.net.URLEncoder. URLs are not transmitted as ASCII or Unicode strings. The spaces in an URL are

converted to plus signs, and non-alphanumeric characters are transmitted with their hex

codes. URLs are thus enabled to use only characters from a portable subset of ASCII, so

that computers using a variety of character sets can use identical URLs. The API

specification for URLEncoder is shown in listing 10.7.

</P>



<P>Listing 10.7 java.net.URLEncoder

</P>


<PRE>

public class URLEncoder extends Object {

  //no constructors

  //methods

  public static String encode(String s);

}

</PRE>




<P>Listing 10.8 is a sample program that prints an URL before and after encoding. The

goal is to demonstrate how URL data is actually transmitted. It is easier to show with a

sample program than with description.

</P>



<P>Listing 10.8 encode.java

</P>


<PRE>

package industrial;



import java.net.*;

import java.io.*;



//This class will print a URL before and after

//it is encoded by java.net.URLEncoder



public class encode

{

  public static void main(String[] args)

  {

     String s = new String(args[0]);

     // s = args[0]

</PRE>


<PRE>
continues
</PRE>




<P><CENTER>

<a href="0327-0330.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0336-0339.html">Next</A>

</CENTER></P>











</BODY>
</HTML>







