<HTML>
<HEAD>


<TITLE>Industrial Strength Java:Jeeves and Java Servlets:EarthWeb Inc.-</TITLE>





<P><CENTER>
<a href="0727-0730.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0735-0738.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-731"><P>Page 731</P></A>


<PRE>
/admin=admin/html
/doc=doc
/applet=servlets
/icons=icons
/~user=/home/$user/public_html
</PRE>

<P>The string to the left of the = is matched against the requested URL; the longest
match, starting from the left of the requested URL, is used in the translation. The string to
the right of the = is the file name of the file. The last line defines the familiar shorthand for
a user's directory, &quot;~user,&quot; which actually refers to &quot;/home/user/public_html.&quot;
</P>

<H4><A NAME="ch16_ 15">
Servlet Control Parameters
</A></H4>

<P>The servlet.properties files contains all the information needed to load and initialize
any named servlet. You can specify three different parameters for each servlet: these are
a codebase, code class name, and initialization parameters. They take the form of
the following entries, respectively:
</P>

<UL>
<LI>     &lt;servletname&gt;.codebase=URL
<LI>     &lt;servletname&gt;.code=classname
<LI>     &lt;servletname&gt;.initArgs=name/value pairs
</UL>

<P>You need to specify the codebase if the class is not in the current CLASSPATH.
The name/value pairs from initArgs can be accessed by the servlet by calling
the getInitParameter() method to get the value of a specific parameter or getInitParameters() to get a hashtable of all arguments.
</P>

<P>A special entry, servlets.startup, lists the servlets to be automatically loaded at server
start-up time. An example of a servlet.properties file is as follows:
</P>

<PRE>
servlets.startup= file cgi invoker imagemap admin proxy error
file.code=sun.server.http.FileServlet
cgi.code=sun.server.http.CgiServlet
invoker.code=sun.server.http.InvokerServlet
imagemap.code=sun.server.http.ImagemapServlet
error.code=sun.server.http.ErrorServlet
myservlet.code=specialsyservlet.class
myservlet.initArgs=param1=value1, param2=value2,\
  param3=value3
</PRE>

<P>You use the backslash (\) character to indicate a
line continuation.
</P>


<A NAME="PAGENUM-732"><P>Page 732</P></A>


<H4><A NAME="ch16_ 16">
File Suffix to MIME Type Translation
</A></H4>

<P>Most servlets know the type of content that they are producing and can correctly set
the contentType attribute of the response. However, the
FileServlet has no such knowledge and thus needs a means to determine the likely content type from the file name.
The convention is to use a consistent set of file name suffixes that can be mapped to
MIME types. This mapping is stored in the mime.properties file. A small portion of this table is
as follows:
</P>

<PRE>
*=text/plain
java=text/plain
html=text/html
htm=text/html
gif=image/gif
jpeg=image/jpeg
mpeg=video/mpeg
qt=video/quicktime
shtml=java-internal/parsed-html
</PRE>

<P>Each line in the file indicates a given file name suffix representing a particular
MIME type. The first line (*=text/plain) is the default rule that is applied when all other rules <BR>
fail to match. The order of entries in this file is not important; the * character indicates
the default content type if the file matches none of the suffixes. Note that the last line of
the sample file defines a mapping of file names with suffixes of .shtml to the private
MIME type java-internal/parsed-html. The File Servlet invokes the server-side include servlet
to process any file with a content type of &quot;java-internal/parsed-html&quot; (which is converted <BR>
to MIME-type text/plain when the file is sent). You only need to add entries to this table
to reflect new applications or file types.
</P>

<H3><A NAME="ch16_ 17">
The Servlet API
</A></H3>

<P>The Servlet API is defined by the classes in the java.servlet, java.servlet.http,
and java.servlet.html packages. Figure 16.4 shows the
packages, classes, and their relationships. Together, these packages specify the following:
</P>

<UL>
<LI>     The generic behavior of servlets independent from the web transport protocol
<LI>     Additional facilities available to HTTP-specific servlets
<LI>     Support for programmatic creation of HTML pages as a hierarchical structure
of HTML elements
</UL>


<A NAME="PAGENUM-733"><P>Page 733</P></A>


<P><a href="images\ch16fg04.jpg"><img src="images\tn_ch16fg04.jpg"></a><BR>
Figure 16.4 The servlet API classes.
</P>


<P>The following sections cover the methods that comprise the Servlet API. Where
appropriate, the equivalent CGI variable is indicated. In addition to the Servlet API's
availability on any server platform that supports servlets, developers may have access to
vendor-specific classes and servlets that are proprietary to a given server and not part of
the Servlet API. Any such extensions would be covered by server-specific documentation.
</P>

<H4><A NAME="ch16_ 18">
The java.servlet Package
</A></H4>

<P>The java.servlet package defines the operation of servlets from a
protocol-independent perspective. At this level, the protocol used to access the servlets could be HTTP,
a network file system protocol, or other transport protocol. Servlets that are designed
to operate as a server-side include use the classes in this package. The four interfaces
and three implementation classes in this package are described in more detail in the
following sections.
</P>

<P><B>
Servlet Interface Class
</B></P>

<P>Servlet is the highest level, generic interface class. It defines only four basic methods
to accomplish the following: initialize the servlet, destroy the servlet, service a request,
and return an information string:
</P>


<A NAME="PAGENUM-734"><P>Page 734</P></A>

<UL>
<LI>     init(ServletStub). Automatically called by the system to initialize a
servlet. Subclass this method if your servlet needs to perform any initialization after it
is loaded. Access the initialization parameters specified for your servlet in
the servlet.properties file by calling getInitParameter() or
getInitParameters().
<LI>     destroy(). Called by the system to free allocated resources when the servlet
class is unloaded.
<LI>     service(ServletRequest,
ServletResponse). Called to process the incoming request and create the outgoing response. You must code your service() method
in a thread-safe manner because concurrent requests for the same servlet result
in multiple threads executing your service() method. The easiest way to be
thread-safe is to not modify any object instance variables and only use parameters of
the service() call. Alternatively, you can add the &quot;synchronized&quot; modifier to
your declaration of service() to restrict access to one thread at a time.
<LI>     getServletInfo().
Called to get an information string that describes the servlet.
</UL>

<P>A subclass of Servlet uses a ServletContext object, described in the next section, to
obtain information about the server's environment and to call various server utility routines.
</P>

<P><B>
ServletContext Interface Class
</B></P>

<P>The ServletContext interface defines methods that the servlet can use to interact with
its operating environment. The relationship between a servlet and the ServletContext
is similar to how an applet is related to an AppletContext. The facilities provided to a
servlet is limited to getting MIME types, translating path names, finding other servlets,
and logging information. These methods are as follows:
</P>

<UL>
<LI>     getMimeType(String
filename). Returns the MIME type of the specified file
by matching the file name suffix against entries in the mime.properties file.
<LI>     getRealPath(String
path). Applies the alias rules in the alias.properties file to
the specified virtual path and returns the corresponding real path; null is returned if
the translation fails.
<LI>     getServerInfo(). Returns a string identifying the name, version, and platform
of the server software and is equivalent to the CGI variable SERVER_SOFTWARE.
<LI>     getServlet(String). Returns a servlet of the given name.
<LI>     getServlets(). Returns an enumeration of all the servlets currently loaded in
the server. This enumeration includes the calling servlet.
<LI>     log(Servlet,
String). Writes a message to the servlet log for a given servlet.
</UL>


<P><CENTER>
<a href="0727-0730.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0735-0738.html">Next</A>
</CENTER></P>






</BODY>
</HTML>



