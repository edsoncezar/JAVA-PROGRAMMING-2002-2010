<HTML>
<HEAD>


<TITLE>Industrial Strength Java:Interfacing C/C++ and Java:EarthWeb Inc.-</TITLE>





<P><CENTER>
<a href="0634-0638.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0642-0645.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-639"><P>Page 639</P></A>


<TABLE>

<TR><TD>
Function
</TD><TD>
Purpose
</TD></TR><TR><TD>
makeCString()
</TD><TD>
Creates a C string buffer that is garbage
collected by Java.
</TD></TR><TR><TD>
makeJavaString()
</TD><TD>
Create a Java String object.
</TD></TR><TR><TD>
javaString2unicode()
</TD><TD>
Copies Java Sting to a unicode buffer.
</TD></TR></TABLE>

<H4><A NAME="ch14_ 24">
Length of a Java String: javaStringLength()
</A></H4>

<P>The javaStringLength() function, defined in listing 14.33b, simply returns the length of
a Java String. This length is the actual size, not including any terminating character.
This function is used in conjunction with many other of the String functions.
</P>

<P>Listing 14.33b Definition of javaStringLength() Function
</P>

<PRE>
int javaStringLength(Hjava_lang_String *string);
</PRE>

<P>The javaStringLength() function is used whenever the length of a Java string is
required. When, for example, a copy of a Java string is needed, the javaStringLength() function
is called to determine the buffer size.
</P>

<H4><A NAME="ch14_ 25">
Java to C with alloc(): allocCString()
</A></H4>

<P>This function, defined in listing 14.34, automates the copy of a Java string into
a preallocated C string. The pointer returned from
allocCString() must be freed with C's free() function. The disadvantage of this function is that the C string is exactly the
same size as the Java string. The only copied parameter is the Java string object. The
function returns a pointer to a newly allocated buffer with the contents of the Java string. The
size of the buffer is equal to the size of the Java string plus one.
</P>

<P>Listing 14.34 Definition of the allocCString() Function
</P>

<PRE>
char *allocCString(Hjava_lang_String *string);
</PRE>

<P>The return value of allocCString() is a pointer to the buffer that has been
allocated. Remember to free this pointer when it is no longer needed.
</P>

<P>The reason to use allocCString() is to create C strings that are allocated on the C heap.
The C heap is memory that will not disappear after a function terminates. The persistence of
a string is important when the string is meant to survive longer than the lifetime of
the 
</P>

<A NAME="PAGENUM-640"><P>Page 640</P></A>


<P>function. Another reason to use allocCString() is when passing strings to other C or
C++ functions. Some functions may not be aware of Java types, so converting from Java
String to C string bridges the gap and makes them compatible.
</P>

<H4><A NAME="ch14_ 26">
Java String to C Character Buffer: <BR>javaString2Cstring()
</A></H4>

<P>The function javaString2Cstring(), defined in listing 14.35, is the equivalent
of allocCString() except that there must be a preallocated C string buffer. Controlling the
size of the buffer may be preferable to allocCString() controlling allocation because the size
of the buffer might be larger than the Java string, making it possible to later append
more characters. The parameters sent to this function are the Java string object to copy, a
pointer to the C character buffer, and the number of bytes to copy. The size of C string must
be one larger than the amount being copied. This function returns the original address of
the C buffer.
</P>

<P>Listing 14.35 Definition of the javaString2CString() Function
</P>

<PRE>
char *javaString2CString(Hjava_lang_String *string, char *cString, int
&Acirc;amountToCopy);
</PRE>

<P>As was mentioned previously, the specific purpose of javaString2Cstring() is to
separate the memory allocation from the conversion of the Java String to the C string. This
would be useful, for example, when the C string is to be modified by appending extra text to
the original. First, a buffer is created by preallocating a buffer that is large enough to hold
the original Java sting, plus the length of the appended text. The javaString2Cstring()
function is then used to copy the Java String to the C string buffer. From this point, normal C
string functions can be used to manipulate the string.
</P>

<H4><A NAME="ch14_ 27">
Java String to a Garbage Collected C String: <BR>makeCString()
</A></H4>

<P>In contrast to allocCString(), makeCString(), defined in listing 14.36, creates the
C character buffer in Java memory space. This means that the buffer is garbage
collected when there is no longer any reference to it.
The makeCString() method returns an allocated array of characters containing a copy of the Java string, plus a null
terminating character.
</P>

<A NAME="PAGENUM-641"><P>Page 641</P></A>



<P>Listing 14.36 Definition of the makeCString() Function
</P>

<PRE>
char *makeCString(Hjava_lang_String *s);
</PRE>

<P>The makeCString() function is useful when a C string is required that will be allocated
on the local stack, and thus garbage collected when the variable on the stack goes out
of scope. By using the makeCString() function, there is no reason to deallocate the C
string buffer.
</P>

<H4><A NAME="ch14_ 28">
C String to Garbage Collected Java String: <BR>makeJavaString()
</A></H4>

<P>The function makeJavaString(), defined in listing 14.37, is the only way to create a
new Java String object. Memory is allocated in the Java memory space and is garbage
collected when no more references to it are found. This function takes an array of characters and
the number of characters to copy. The number of characters to copy does not include the
null terminator. This function returns a Java string object that is the length that was to
be copied. This object is garbage collected when there are no more references to it.
</P>

<P>Listing 14.37 Definition of the makeJavaString() Function
</P>

<PRE>
Hjava_lang_String *makeJavaString(char *cString, int amountToCopy);
</PRE>

<P>The makeJavaString() function is only used to create a Java String to be used in a
Java method or to set a String field in a Java object. A good example of when a String
object must be created is when a text message needs to be sent from a native C function and
back to Java.
</P>

<H4><A NAME="ch14_ 29">
Java String to Unicode: javaString2unicode()
</A></H4>

<P>The function javaString2unicode(), defined in listing 14.38, copies a Java string to
an array of Unicodes. No allocation occurs. The C definition of a Unicode is an
unsigned short. The function assumes the amount to copy is less than or equal to the length of
the string, and that the buffer size is at least equal to the length to copy plus one Unicode.
In other words, the amount to copy must never be larger than the Java string and the
buffer must be large enough to hold the length to copy plus a null character. The
original Unicode buffer's address is returned.
</P>

<P><CENTER>
<a href="0634-0638.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0642-0645.html">Next</A>
</CENTER></P>






</BODY>
</HTML>



