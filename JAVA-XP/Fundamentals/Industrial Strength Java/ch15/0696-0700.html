<HTML>
<HEAD>


<TITLE>Industrial Strength Java:Java Beans:EarthWeb Inc.-</TITLE>





<P><CENTER>
<a href="0691-0695.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0701-0705.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-696"><P>Page 696</P></A>


<P>was generated by the framework or by another object. However, this requires managing
a multitude of unique situations. It becomes difficult to track all objects in the
framework, especially as the size of the framework grows.
</P>

<P>The last option is a very practical solution. An event object that is unique to the
framework is reused by each GUI component. The obvious concern is that that it is not possible
to determine the source of the event because the event object sent by each event
source would be an instantiation of one class. Decision objects and Question objects, for
example, send instances of the same class as an event. There is, however, a simple
solution to this problem. First look at listing 15.8, which contains a class called FrameWorkEvent.
</P>

<P>Listing 15.8An Instance of the FrameWorkEvent Class is Passed from Event
Source to Each Listener
</P>

<PRE>
public class FrameWorkEvent extends java.awt.EventObject {
      private      String      information;

      public FrameWorkEvent(java.awt.Component source, String
 theInformation) {
         super(source);
         information = theInformation;
      }

      public String getInformation() {
            return information;
      }
}
</PRE>

<P>Note in listing 15.8 the parameters passed to the
constructor. The first is a reference to the object that created the event (the event source), and the second is an instance of a
String object. By taking advantage of the getSource() method in java.awt.EventObject it
is possible to retrieve a reference to the object that created the event. Additionally, use
the getInformation() method in the FrameWorkEvent class to retrieve the value of
the parameter string. This string can be used to pass data between the event source
and listener; for example, use it to determine whether the user dismissed a dialog box
by pressing OK or Cancel.
</P>

<P><B>
Tracking Listeners
</B></P>

<P>The first example of a Java Bean in the beginning of this chapter illustrates the
necessity for the source object to track an infinite number of listeners. This project uses an
imple-
</P>


<A NAME="PAGENUM-697"><P>Page 697</P></A>


<P>mentation similar to the first example.
</P>

<P>Unlike the first example, which only processes the event generated by one button,
this application considers a few situations. For example, users operating the Decision
class may click either the OK or Cancel buttons to exit the dialog box. The following
sections explain how to convert the Decision class to a Java Bean.
</P>

<P>First define a class called OkCancel. OkCancel tracks each listener and is responsible
for
</P>

<P><a href="images\ch15fg04.jpg"><img src="images\tn_ch15fg04.jpg"></a><BR>
Figure 15.4 Event propagation in the Decision class.
</P>

<P>broadcasting an event to all listeners. OkCancel is registered as a listener of an instance
of java.awt.Button; thus, when the button is clicked, the event travels from the button
to OkCancel to all listeners. Figure 15.4 shows an event propagating from the user to the
OK button to the OkCancel object, and finally to each of Decision's listeners.<BR>
</P>

<P>In windows that display two buttons (for example an OK and Cancel buttons),
OkCancel is instantiated twice; one instance &quot;listens&quot; to the OK button, and one instance &quot;listens&quot;
to the Cancel button. Listings 15.9a through 15.9n cover this class.
</P>

<P>Listing 15.9a includes the constructor for the class. These perform two important actions:
</P>

<UL>
<LI>     A Vector object is instantiated to hold references to all listeners.
<LI>     An ID field is set to either OK or Cancel to indicate the type of button &quot;listened&quot;
to by the constructor.
</UL>

<P>Listing 15.9a OKCancel Class Constructors
</P>

<PRE>
                                                           continues
</PRE>

<A NAME="PAGENUM-698"><P>Page 698</P></A>



<P>Listing 15.9a Continued
</P>

<PRE>
import java.awt.*;
import java.util.*;

public class OkCancel implements ActionListener {
      private static final int OK = 0;
      private static final int CANCEL = 1;

      private int         myID;
      private Vector      listeners;

      public OkCancel(int theID) {
            //create the listener object
            listeners = new Vector();

            //assign the id
            myID = theID;
      }
</PRE>

<P>Listing 15.9b contains the methods that register and unregister a listener. By making
these methods synchronized, survival in a multithreaded environment is ensured. References
to all current listeners are contained in a Vector object called &quot;listeners.&quot;
</P>

<P>Listing 15.9bMethods that Register and Unregister a Listener
</P>

<PRE>
      //add an event listener
      public synchronized void addFWEListener(FWEListener fwe) {
            listeners.addElement(fwe);
      }


      //remove an event listener
      public synchronized void removeFWEListener(FWEListener fwe) {
            listeners.removeElement(fwe);
      }
</PRE>

<P>Listing 15.9c contains the actionPerformed() method. This method, which is called when
a button is clicked, notifies all listeners of the Decision class that the dialog box has
been dismissed.
</P>

<P>Notice how the variable myID is used when creating the event. When the object
is instantiated, myID is set to either OK or Cancel. In creating the FrameWorkEvent
object, 
</P>


<A NAME="PAGENUM-699"><P>Page 699</P></A>


<P>the extra information field in that object is set to either OK or Cancel (depending on
the value of myID). This gives recipients of the event the necessary information to
determine which button was clicked by the user.
</P>

<P>Listing 15.9cThe actionPerformed() Method Dispenses an Event
to All Listeners
</P>

<PRE>
      //dispatch the events
      public void actionPerformed(ActionEvent evt) {
            Vector              l;
            FrameWorkEvent      myEvent;

            if(myID == OK) {
                  new FrameWorkEvent(this, &quot;OK&quot;);
            }
            else {
                  new FrameWorkEvent(this, &quot;Cancel&quot;);
            }

            synchronized(this) {
                  l = (Vector)listeners.clone();
            }

            for(int i=0; i&lt;l.size(); i++) {
                  FWEListner newFWE = (FWEListener)l.elementAt(i);
                  newFWE.dialogDismissed(myEvent);
            }
      }
}
</PRE>

<P>At this point you have written two classes:
</P>

<UL>
<LI>     FrameWorkEvent. This is the actual event class.
<LI>     OkCancel. This class monitors the instances of java.awt.Button.
</UL>

<P>These classes provide the proper functionality to track and notify listeners of the
event. The event itself has also been defined. The Bean still requires code to perform
the following functions:
</P>

<UL>
<LI>     Building the screen
<LI>     Linking all code together
</UL>


<A NAME="PAGENUM-700"><P>Page 700</P></A>


<P><B>
Building the GUI
</B></P>

<P>OkCancel and FrameWorkEvent are sufficiently generic to function with all the
GUI Beans developed in this chapter. Each Bean provides a unique class that manages
the building of the screen. This class also ensures that proper instances of OkCancel
are created and that all listener objects are tracked.
</P>

<P>Due to space constraints, this section is limited to converting the
Decision class to a Java Beans and does not convert all of the GUI classes created for the framework classes.
As you will learn during this conversion, however, the process used for the Decision class
can be applied to any class developed in the Chapter 6 application framework.
</P>

<P>When instantiated, the Decision class draws a user-defined string in a new modal
dialog box and presents two buttons, OK and Cancel. The dialog box dismisses itself when
either of these buttons is clicked.
</P>

<P>The FWEListener interface is defined to be implemented by the Decision class.
This interface is implemented by all listeners of the Bean and defines the method to be
called when the dialog box is dismissed. This method accepts a FrameWorkEvent object
generated by the OkCancel class as a parameter. Listing 15.10 includes the
FWEListener interface.
</P>

<P>Listing 15.10The FWEListener Interface is Implemented by all Listeners
</P>

<PRE>
public interface FWEListener extends java.awt.event.ActionListener {

      //defines a method to be called when the
      //associated GUI Bean needs to send an event

       public void dialogDismissed(FrameWorkEvent evt);

}
</PRE>

<P>The only remaining issue is to define the Decision class itself. This class offers
the following functionality:
</P>

<UL>
<LI>     Draws on-screen the user defined string (passed as a parameter to the constructor)
<LI>     Draws on-screen a button labeled &quot;OK&quot;
<LI>     Draws on-screen a button labeled &quot;Cancel&quot;
<LI>     Creates two instances of OkCancel (one to monitor each button)
</UL>

<P><CENTER>
<a href="0691-0695.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0701-0705.html">Next</A>
</CENTER></P>






</BODY>
</HTML>



