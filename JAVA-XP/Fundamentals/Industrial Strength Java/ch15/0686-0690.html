<HTML>
<HEAD>


<TITLE>Industrial Strength Java:Java Beans:EarthWeb Inc.-</TITLE>





<P><CENTER>
<a href="0681-0685.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0691-0695.html">Next</A>
</CENTER></P>

<A NAME="PAGENUM-686"><P>Page 686</P></A>


<P>Listings 15.3a through 15.3d define processEvent(). The processEvent() method is
similar to handleEvent() in the Java 1.0 event model; they distribute an event sent to a
component. However, unlike Java 1.0, processEvent() does not pass an unused event up a hierarchy.
</P>

<P>Perhaps the most important piece of the processEvent() method is seen in listing 15.3a.
It creates a clone of Vector containing the listener objects. This clone is referenced for
the duration of the method. Unexpected results can occur if a clone is not used because it
sets a boundary on when objects wishing to be event listeners must register. Without a clone,
it is possible that the contents of Vector could change while the processEvent()
method executes.
</P>

<P>Listing 15.3aCreating a Clone of Vector Containing the Listener Objects
</P>

<PRE>
protected void processEvent(AWTEvent evt) {
      Vector           l;
      DigitEvent       e = new DigitEvent(this);

      //create a copy of the listener vector
      synchronized(this) {
          l = (Vector)listeners.clone();
   }
</PRE>

<P>Listing 15.3b calls the getNextRandom() method, which generates a new random
number and then sets the value of the private member variable, randomInt, equal to the
new random number.
</P>

<P>Listing 15.3bCalling the getNextRandom() Method
</P>

<PRE>
      getNewRandom(); //create a new random int
</PRE>

<P>Listing 15.3c contains the logic that examines the randomInt variable and calls the
method in each listener object that is associated with the variable.
</P>

<P>Listing 15.3cExamining the randomInt Variable
</P>

<PRE>
      if(randomInt == 0) {
          for (int i = 0; i &lt; l.size(); i++) {
                DigitListener dl = (DigitListener)l.elementAt(i);
                  dl.showZero(e);
              }
      }
</PRE>


<A NAME="PAGENUM-687"><P>Page 687</P></A>


<PRE>
      else if(randomInt == 1) {
          for (int i = 0; i &lt; l.size(); i++) {
                DigitListener dl = (DigitListener)l.elementAt(i);
                  dl.showOne(e);
              }
      }
      else if(randomInt == 2) {
          for (int i = 0; i &lt; l.size(); i++) {
                DigitListener dl = (DigitListener)l.elementAt(i);
                  dl.showTwo(e);
              }
      }
      else if(randomInt == 3) {
          for (int i = 0; i &lt; l.size(); i++) {
                DigitListener dl = (DigitListener)l.elementAt(i);
                  dl.showThree(e);
              }
      }
      else if(randomInt == 4) {
          for (int i = 0; i &lt; l.size(); i++) {
                DigitListener dl = (DigitListener)l.elementAt(i);
                  dl.showFour(e);
              }
      }
      else if(randomInt == 5) {
          for (int i = 0; i &lt; l.size(); i++) {
                DigitListener dl = (DigitListener)l.elementAt(i);
                  dl.showFive(e);
              }
      }
</PRE>

<P>When subclassing a GUI component, always pass the event up to its parent. This
ensures critical processing associated with the event occurs. In the subclass of button, for
example, you do take action on the button press; however, you do not draw the button in
different states&#151;that is managed in the Button class itself.
</P>

<P>Listing 15.3dsuper.processEvent
</P>

<PRE>
      return super.processEvent(evt);
}
</PRE>

<P>Listing 15.4 contains the complete Java code for the DigitSender class. Other than
the processEvent() method discussed in listing 15.3, the following is quite trivial and
straightforward.
</P>


<A NAME="PAGENUM-688"><P>Page 688</P></A>


<P>Listing 15.4The DigitSender Bean
</P>

<PRE>
import java.util.*;
import java.awt.*;

//The DigitSender class is a Java Bean which will send a random int
//between 0 and 5 (inclusive) to each of its listeners each time its
//GUI (a button) is clicked.
public class DigitSender extends Button implements ActionListener{
      private Random       myRandom;             //used to generate the
                                                 //random int
      private int          randomInt;            //the current random
                                                 //int
      private Vector       listeners;            //listener pool


      //constructor, creates GUI and instantiates member data
      public DigitSender() {
            super(&quot;Create New Random&quot;);
            myRandom = new Random();
            listeners = new Vector();
            myButton.addActionListener(this);
            resize(50, 50);
            setLayout(new FlowLayout());
            add(myButton);
      }


      // Register an Event Listener.
      public synchronized void addDigitListener(DigitListener dl) {
           listeners.addElement(dl);
      }


       // Remove an Event Listener.
       public synchronized void removeDigitListener(DigitListener dl) {
           listeners.removeElement(dl);
       }


      //generate a new random int
      private synchronized void getNewRandom() {
            randomInt = myRandom.nextInt()%6;
            randomInt = (int)Math.abs(randomInt);
      }
</PRE>

<A NAME="PAGENUM-689"><P>Page 689</P></A>


<PRE>
     //processEvent method will call the proper method in each listener
      protected void processEvent(AWTEvent evt) {
            Vector              l;
            DigitEvent          e = new DigitEvent(this);

            //create a copy of the listener vector
               synchronized(this) {
                l = (Vector)listeners.clone();
            }

            getNewRandom(); //create a new random int

            if(randomInt == 0) {
                for (int i = 0; i &lt; l.size(); i++) {
                      DigitListener dl = (DigitListener)l.elementAt(i);
                      dl.showZero(e);
                    }
            }
            else if(randomInt == 1) {
                for (int i = 0; i &lt; l.size(); i++) {
                      DigitListener dl = (DigitListener)l.elementAt(i);
                      dl.showOne(e);
                    }
            }
            else if(randomInt == 2) {
                for (int i = 0; i &lt; l.size(); i++) {
                      DigitListener dl = (DigitListener)l.elementAt(i);
                      dl.showTwo(e);
                    }
            }
            else if(randomInt == 3) {
                for (int i = 0; i &lt; l.size(); i++) {
                      DigitListener dl = (DigitListener)l.elementAt(i);
                      dl.showThree(e);
                    }
            }
            else if(randomInt == 4) {
                for (int i = 0; i &lt; l.size(); i++) {
                      DigitListener dl = (DigitListener)l.elementAt(i);
                      dl.showFour(e);
                    }
            }
            else if(randomInt == 5) {
                for (int i = 0; i &lt; l.size(); i++) {
                      DigitListener dl = (DigitListener)l.elementAt(i);
                      dl.showFive(e);

</PRE>
<PRE>
                                                           continues
</PRE>


<A NAME="PAGENUM-690"><P>Page 690</P></A>


<P>Listing 15.4Continued
</P>

<PRE>
                    }
            }

            //always send the event to the parent of an extended GUI
            //component.
            return super.processEvent(evt);
      }
}
</PRE>

<P>The DigitEvent class in listing 15.4 (specifically in the
processEvent() method) has not yet been covered. This class represents the actual event
that travels from the event source to each of its listeners. It is possible to simply transfer the event that is passed to
processEvent(); however code becomes much more readable if a specific event class
is used.
</P>

<P>Our example of the DigitEvent class extends java.awt.EventSource. DigitEvent offers
a constructor that accepts a reference to a Component object, and then passes that
reference up to its parent. No additional functionality is added to this class because none is
needed. The DigitEvent class is demonstrated in listing 15.5.
</P>

<P>Listing 15.5The DigitEvent class
</P>

<PRE>
public class DigitEvent extends java.awt.EventObject {
    public DigitEvent(java.awt.Component source) {
        super(source);
    }
}
</PRE>

<P><B>
The Event Listener
</B></P>

<P>When you designed the event source class (DigitSender) and the interface
DigitListener, you laid out many of the methods the event source class implements. In fact, in addition
to implementing all method in the DigitListener interface, all the event listener class
does is implement a few methods, which work on the class's GUI.
It is important to note that this section contains only one possible implementation of
</P>

<P>the listener: the DigitReceiver class designed in this section implements DigitListener <BR>
and uses the drawString() method to draw the requested number in a Panel.
Another implementation could implement DigitListener and display the number the
System.out.println() method. The DigitSender class does not care how the methods are
actually implemented, it only requires that they exist.
</P>


<P><CENTER>
<a href="0681-0685.html">Previous</A> | <a href="..\ewtoc.html">Table of Contents</A> | <a href="0691-0695.html">Next</A>
</CENTER></P>






</BODY>
</HTML>



