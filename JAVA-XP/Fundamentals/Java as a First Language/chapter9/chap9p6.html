<html>

<head><meta http-equiv="pragma" content="no-cache">

<meta NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.0z">
<title>9.6 The OutputFormatter class formatDouble action</title>

</head>

<body BGCOLOR="WHITE">

<h2>9.6 The <i>OutputFormatter</i> class <i>formatDouble</i> action
<br>
</h2>

<p>
The design of the <i>formatDouble</i> action is as follows. <br>

<p>
<center><img SRC="c9p6i1.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/c9p6i1.gif" WIDTH="719" HEIGHT="464">
</center>
<p>
The basis of the design is to divide the floating point number
into two parts: the whole number part before the decimal point
and the decimal part after the decimal point. Each part can then
be processed separately. In the design, after the <i>aftWidth</i>
and the value has been checked to make sure that the <i>aftWidth</i>
is at least 1 and that the value is within the limits of a long,
the whole number part is formatted using a suitable call of the
<i>formatLong</i> action. <br>

<p>
The formatting of the decimal part is in some respects very similar
to the formatting of a long as described above. But instead of
adding padding characters to the front of the string until it
is the correct length; zeros are added to the end of the string
or, if the string it too long in the first place, it is truncated.
The implementation of this design is as follows. <br>

<pre>
<font>0049    <b>public static</b> String <i>formatFloat</i>( <b>float</b>   <i>toFormat</i>,
0050                                      <b>int</b>     <i>foreWidth</i>,
0051                                      <b>int</b>     <i>aftWidth</i>,
0052                                      <b>boolean</b> <i>withZeros</i>){ 
0053    String <i>foreString</i>;
0054    StringBuffer <i>aftString</i>;
0055    <b>double</b> <i>wholePart</i>   = Math.floor( <i>toFormat</i>);
0056    <b>double</b> <i>decimalPart</i> = <i>toFormat</i> - <i>wholePart</i>;
0057    
0058        <b>if</b> ( ( ((<b>long</b>) <i>toFormat</i>) &lt; Float.MIN_VALUE) ||
0059             ( ((<b>long</b>) <i>toFormat</i>) &gt; Float.MAX_VALUE) ){ 
0060           <b>throw new</b> OutputFormatException(.<i>FP_TOO_LARGE</i>);  
0061        } // End if.        
0062
0063        <b>if</b> ( <i>aftWidth</i> &lt; 1) { 
0064           <i>aftWidth</i> =1;
0065        } // End if. 
0066   
0067        <i>foreString</i> = <i>formatLong</i>( (<b>long</b>) <i>wholePart</i>, <i>foreWidth</i>, <i>withZeros</i>, DECIMAL); 
0068    
0069        <i>decimalPart</i> *= Math.pow( 10,aftWidth);
0070        <i>decimalPart</i> =  Math.round( <i>decimalPart</i>);
0071        
0072        <i>aftString</i> = <b>new</b> StringBuffer( Long.toString( (<b>long</b>) <i>decimalPart</i>));
0073        <b>if</b> ( <i>aftString</i>.length() &gt; <i>aftWidth</i>) { 
0074           <i>aftString</i>.setLength( <i>aftWidth</i>);
0075        } <b>else</b> { 
0076           <b>while</b> ( <i>aftString</i>.length() &lt;  <i>aftWidth</i>) { 
0077             <i>aftString</i>.append( ZERO);
0078           } // End while.
0079        } // End if.
0080                            
0081       <b>return</b> <i>foreString.</i>toString() + &quot;.&quot; + <i>aftString.</i>toString();                          
0082    } // End <i>formatDouble</i>.       
0083 } // End <i>NumberFormatter</i>.<br>
</font>
</pre>

<p>
On lines 0055 and 0056 the floating point number is split into
its whole number and decimal parts. This is accomplished by setting
the <i><font FACE="Arial">wholePart</font></i> variable
to the floored part of the <i><font FACE="Arial">toFormat</font></i>
value. The floor of a floating point value is the largest whole
number which is smaller than or equal to the floating point value.
So the floor of the value 123.456 would be 123.0 and the floor
of the value 789.0 would be 789.0. Having obtained the <i><font FACE="Arial">wholePart</font></i>
of the number to format the <i><font FACE="Arial">decimalPart</font></i>
can be obtained by subtraction. As the floor of 123.456 is 123.0,
subtracting the floor from the original value leaves 0.456. <br>

<p>
The implementation continues with lines 0058 to 0061 which implement
the design component <i>check value</i> and which throws a <i><font FACE="Arial">OutputFormatException</font></i>
with the reason set to <i><font FACE="Arial">FP_TOO_LARGE</font></i>
if the value is not acceptable. The design component <i>check
aftWidth</i> is implemented on lines 0063 to 0065 ensuring that
the aftWidth argument is at least 1. <br>

<p>
On line 0067 the fore part of the formatted string is prepared
by calling the <i>formatLong</i>() action to prepare a suitable
<font FACE="Arial">String</font>. As a part of this the
<i><font FACE="Arial">wholePart</font></i> is cast to a
long value which is the primary reason for the restriction upon
the range of values which this action can accept. <br>

<p>
Having processed the fore part of the floating point value the
remmaing parts of the action are largely concerned with the aft
part of the value. The first action is to process correctly round
the value. For example the value 0.456 formatted to 2 decimal
places should be 0.46 not 0.45. To accomplish this the value is
first multiplied by 10 to the power of however many decimal places
are requested. In the example being considered this would be 10
to the power 2, which is 100: when the value 0.456 is multiplied
by 100 the result is 45.6. The <font FACE="Arial">Math.round</font>()
action can then be used to obtain the correctly rounded whole
number, in this case 46.0. This is accomplished by the two calls
of class-wide <font FACE="Arial">Math</font> actions on
lines 0069 to 0070. <br>

<p>
The resulting value is then cast to a <b><font FACE="Arial">long</font></b>
value and obtained in a <font FACE="Arial">StringBuffer</font>
in an essentially identical manner to how the <b><font FACE="Arial">long</font></b>
value was obtained in <i><font FACE="Arial">formatLong</font></i>().
Continuing the example, the value 46.0 would be cast to 46 and
obtained in a <font FACE="Arial">StringBuffer</font> as
&quot;46&quot;. The next part of the implementation either trims
the length of this string to the number of characters required
or pads it with trailing zeros up to the required length.<br>

<p>
Having formatted the fore and the aft parts they are both converted
to <font FACE="Arial">String</font>s using their <font FACE="Arial">toString</font>()
actions and catenated together with a decimal point in the middle.

<p>
A fragment of a demonstration harness client for this action is
as follows. <br>

<pre>
<font>0026   // Assuming that <b>float</b> <i>demoFloat</i> = 123.456 has been declared. 
0027   System.out.println( &quot;\nOutputting &quot; + demoFloat + &quot; with leading zeros, &quot; );
0028   System.out.println( &quot;12 characters before and 2 after the decimal point ... &quot;);
0029   System.out.println( OutputFormatter.formatFloat( <i>demoFloat</i>, 
0030                                                     12, 2, <b>true</b>));
0031   System.out.println( &quot;\nOutputting &quot; + demoFloat + &quot; with leading spaces, &quot;);
0032   System.out.println( &quot;12 characters before and 4 after the decimal point ... &quot;);
0033   System.out.println( OutputFormatter.formatFloat( <i>demoFloat</i>, 
0034                                                     12, 4, <b>false</b>)); 
0035   System.out.println( &quot;\nOutputting &quot; + demoFloat + &quot; with leading spaces, &quot;);
0036   System.out.println( &quot;12 characters before and 0 after the decimal point ... &quot;);
0037   System.out.println( OutputFormatter.formatFloat( <i>demoFloat</i>, 
0038                                                        12, 0, <b>false</b>));
<br>
</font>
</pre>

<hr>

<ul><pre>
<font>Outputting 123.456 with leading zeros, 
12 characters before and 2 after the decimal point ...
000000000123.46

Outputting 123.456 with leading spaces, 
12 characters before and 4 after the decimal point ...
         123.4560

Outputting 123.456 with leading spaces, 
12 characters before and 0 after the decimal point ...
         123.5</font>
</pre></ul>

<hr>

<p>
Which again appears to demonstrate the action is working correctly
<br>
<br>
<p>
<hr>
<h2>
<ul>
<a HREF="chap9p7.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/chap9p7.html"><img SRC="..\next.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/next.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
9.7 Exceptions in Java</a>.
<p>
<a HREF="chap9p5.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/chap9p5.html"><img SRC="..\last.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/last.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
9.5 The <i>OutputFormatter</i> class <i>formatLong</i> action</a>.
</ul>
</h2>
<hr>
</body>

</html>
&#26;