<html>

<head><meta http-equiv="pragma" content="no-cache">

<meta NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.0z">
<title>9.2 The design and implementation of the <i>SimpleInput</i> class</title>

</head>

<body BGCOLOR="WHITE">

<h2>9.2 The design and implementation of the <i>SimpleInput</i> class
</h2>

<p>
The class diagram for the <i>SimpleInput</i> class is given in
Figure 9.2.<br>

<p>
<center><img SRC="c9p2i1.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/c9p2i1.gif" WIDTH="354" HEIGHT="309"></center>
<p>
<center><font>Figure 9.2 The <i>SimpleInput</i> class diagram
<br>
</font></center>
<p>
The purpose of this class is to provide the <i>readLong</i> and
<i>readDouble</i> actions to the <i>ValidatedInput</i> class,
hiding the complexity of interacting directly with the input stream
within itself. Consequently it is declared as an abstract class
and its actions are semi-public, in order to prevent clients of
the <i>ValidatedInput</i> class making any use of it. The diagram
also indicates that the actions are class-wide, for reasons which
will be explained when the <i>ValidatedInput</i> class is described.
<br>

<p>
The implementation of this class as far as the start of the <i>getLong</i>
action is as follows. <br>

<pre>
<font>0001 // Filename <i>SimpleInput.java</i>.
0002 // Provides simple input routines for primitive values.
0003 //
0004 // Produced for JFL book Chapter 9.
0005 // Fintan Culwin, v0.1, Jan 1997.
0006 
0007 <b>import</b> java.io.DataInputStream;
0008 <b>import</b> java.io.IOException;
0009 
0010 <b>abstract class</b> <i>SimpleInput</i> <b>extends</b> Object {
0011  
0012 <b>private static </b> java.io.DataInputStream <i>keyboard
</i>0013                         = <b>new</b> java.io.DataInputStream( System.in);
0014<br>
</font>
</pre>

<p>
A static encapsulated instance of the <font FACE="Arial">DataInputStream</font>
class, called <i><font FACE="Arial">keyboard</font></i>,
is instantaited upon declaration. As this class contains only
class-wide actions it is unlikely that a constructor will ever
be used, so the static variables have to be initialised into a
useable state upon declaration. Java will ensure that the initialisation
takes place, preparing the keyboard instance, before it is required.
The design of the <i><font FACE="Arial">getLong</font></i>()
action is as follows. <br>

<p>
<center><img SRC="c9p2i2.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/c9p2i2.gif" WIDTH="600" HEIGHT="349">
</center>
<p>
The first action shown on the design is required to ensure that
any character waiting to be output to the screen are definitely
visible to the user. The main part of the design is a posit/&nbsp;admit
design; whose posit part assumes that the user's input will be
obtained and converted without an <i><b>implicit</b></i> exception
being thrown. The admit part recognises that an error did occur
and re-throws it as an <i><b>explicit</b></i> exception. The difference
between an implicit and an explicit exception is that an implicit
exception is thrown by a called action and thus is outside the
control of the developer; whilst an explicit exception is thrown
by the developer's code. The implementation of this design is
as follows. <br>

<pre>
<font>0015    <b>protected static long</b> <i>readLong</i>() <b>throws</b> IOException { 
0016    
0017    <b>long</b><i>   localLong</i> =0;
0018      
0019       System.out.flush();
0020       <b>try</b> {  
0021          <i>localLong</i> =  Long.valueOf( <i>keyboard</i>.readLine().trim()
0022                                                  ).longValue(); 
0023       } <b>catch</b> ( java.lang.Exception <i>exception</i>){ 
0024          <b>throw new</b> java.io.IOException();
0025       } // End try/ catch;
0026       <b>return</b> <i>localLong</i>;
0027    } // End <i>readLong</i>.<br>
</font>
</pre>

<p>
The central part of this action is the complex statement on lines
0021 and 0022 which can be understood by explaining the operation
of its component phrases. The most central phrase, decided by
the number of enclosing brackets, is <i><font FACE="Arial">keyboard</font></i><font FACE="Arial">.readLine</font>().<font FACE="Arial">trim</font>().
The <font FACE="Arial">readLine</font>() action is supplied
by the <font FACE="Arial">DataInputStream</font> class
and it accepts input from the <i><font FACE="Arial">keyboard</font></i>
until an <font>&lt;ENTER&gt;</font> key press is provided.
This input is used to create an anonymous <font FACE="Arial">String</font>
object, whose <font FACE="Arial">trim</font>() action is
immediately called. The <font FACE="Arial">trim</font>()
action removes any leading and trailing spaces from the <font FACE="Arial">String</font>
before it is passed to the class-wide <font FACE="Arial">Long.valueOf</font>
action to be interpreted as an integer value and an anonymous
instance of the <font FACE="Arial">Long</font> class constructed
from it. Finally, on line 0022, the <font FACE="Arial">longValue</font>()
action of the <font FACE="Arial">Long</font> class is used
to provide a long value which is assigned to the primitive variable
<i><font FACE="Arial">localLong</font></i>. <br>

<p>
The two class instances constructed by this statement are described
as anonymous as they are created by Java in order to execute,
but are not otherwise required. The same effect could be obtained
by performing each of the actions in a sequence of steps, using
non-anonymous instances. <br>
<p>
<pre>
        // Assuming <i>tempString</i> of class String &amp;
	//<i> tempLong</i> of class Long are declared.
	
	<i>tempString</i> = <i>keyboard</i>.readLine();
	<i>tempString</i>.trim();
	<i>tempLong</i> = Long.valueOf( <i>tempString</i>);
	<i>localLong</i> = <i>tempLong</i>.longValue();
</pre>

<p>
The differences between the primitive <b><font FACE="Arial">long</font></b>
data type and the <font FACE="Arial">Long</font> class,
and the reasons for the difference are explained in Appendix A1.
Should all of this seem too complex, all that needs to be understood
is that lines 0021 to 0022 will input a line supplied by the user
from the keyboard and if it can be interpreted as an integer value
the value of <i><font FACE="Arial">localLong</font></i>
will be set to the value. <br>

<p>
If it cannot be interpreted as an integer value a <font FACE="Arial">java.lang.NumberFormatException</font>
will be raised by the <font FACE="Arial">valueOf</font>()
action. In the unlikely event that an end of file is indicated
from the keyboard a <font FACE="Arial">java.lang.io.Exception</font>
will be raised by the <font FACE="Arial">readLine</font>()
action. For reasons which will be explained shortly it is not
possible to ignore these exceptions and the <b><font FACE="Arial">try/&nbsp;catch</font></b>
structure which encloses this action is not optional. The <b><font FACE="Arial">catch</font></b>
clause on line 0023 states that it will handle exceptions of the
<font FACE="Arial">java.lang.Exception</font> class which,
as it is the parent class of both possible exceptions, will allow
the exception to be handled. The intention of the design is that
the handler should propagate the exception from this action and
to accomplish this it has to construct and throw a new exception.
This is implemented on line 0024 where a <font FACE="Arial">java.io.IOException</font>
is created and thrown.<br>

<p>
The declaration of the <i><font FACE="Arial">readLine</font></i>()
action on line 0015 indicates that a <font FACE="Arial">java.io.IOException</font>
may be thrown when this action is called. Any client which makes
use of this action must indicate that it is aware of this by enclosing
the call of the action within a <b><font FACE="Arial">try/&nbsp;catch</font></b>
structure. The declaration of the <font FACE="Arial">readLine</font>()
and <font FACE="Arial">valueOf</font>() actions in the
Java standard classes indicated in a similar manner that they
might also throw an exception and so the use of these actions
had to be guarded by a <b><font FACE="Arial">try/&nbsp;catch</font></b>
structure. <br>

<p>
The implementation of the <font FACE="Arial"><i>readDouble</i></font>()
action is essentially identical and is presented here for the
sake of completeness. <br>

<pre>
<font>0030    <b>protected double</b> <i>readDouble</i>() <b>throws</b> IOException { 
0031    
0032    <b>double</b> <i>localDouble</i> = 0.0;
0033      
0034       System.out.flush();
0035       <b>try</b> {  
0036          <i>localDouble</i> =  Double.valueOf( keyboard.readLine().trim()
0037                                                    ).doubleValue(); 
0038       } <b>catch</b> ( java.lang.Exception <i>exception</i>){ 
0039          <b>throw new</b> java.io.IOException();
0040       } // End try/ catch;
0041       <b>return</b> <i>localDouble</i>;
0042    } // end <i>readDouble</i>.                                 
0043 
0044 } // End <i>SimpleInput</i>.<br>
</font>
</pre>

<p>
It is not necessary to provide equivalent <i><font FACE="Arial">readInt</font></i>()
or <i><font FACE="Arial">readFloat</font></i>() actions
in this class as the <b><font FACE="Arial">long</font></b>
value returned from the <i><font FACE="Arial">readlong</font></i>()
action can be cast into an <b><font FACE="Arial">int</font></b>
(or <b><font FACE="Arial">short</font></b> or <b><font FACE="Arial">byte</font></b>
value) and the value from <i><font FACE="Arial">readDouble</font></i>()
cast into a <b><font FACE="Arial">float</font></b>. The
possibility that the <i><font FACE="Arial">readLong</font></i>()
action might return a value which is outside the limits of the
<b><font FACE="Arial">int</font></b> type will be addressed
when the <i><font FACE="Arial">ValidatedInputDemonstration</font></i>
client is described below. <br>

<p>
In order to subject this class to demonstration it will have to
be temporarily implemented as a non-<b><font FACE="Arial">abstract</font></b>
class with public <b><font FACE="Arial">actions</font></b>,
this will be left as an end of chapter exercise. <br>
<br>


<p>
<hr>
<h2>
<ul>
<a HREF="simpleinput.java" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/SimpleInput.java"><img SRC="..\list.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/list.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="40" HEIGHT="35">
<i>SimpleInput.java</i> source code</a>.
<p>

<a HREF="chap9p3.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/chap9p3.html"><img SRC="..\next.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/next.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
9.3 The design and implementation of the <i>ValidatedInput</i> class</a>.
<p>
<a HREF="chap9p1.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/chap9p1.html"><img SRC="..\last.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/last.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
9.1 The <i>SimpleInput</i> and <i>ValidatedInput</i> class hierarchy</a>.
</ul>
</h2>
<hr>
</body>

</html>
&#26;