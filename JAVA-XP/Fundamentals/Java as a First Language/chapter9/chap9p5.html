<html>

<head><meta http-equiv="pragma" content="no-cache">

<meta NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.0z">
<title>9.5 The OutputFormatter class formatLong action</title>

</head>

<body BGCOLOR="WHITE">

<h2>9.5 The <i>OutputFormatter</i> class <i>formatLong</i> action
<br>
</h2>

<p>
The second part of this chapter will introduce a class called
<i>OutputFormatter</i> which also contains only class-wide actions,
its class diagram is given in Figure 9.4. <br>

<p>
<center><img SRC="c9p5i1.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/c9p5i1.gif" WIDTH="458" HEIGHT="261"></center>
<p>
<center><font>Figure 9.4 The <i>OutputFormatter</i> class
diagram<br>
</font></center>
<p>
The <i>formatLong</i> action will format a long value, supplied
in <i>toFormat</i>, to use as many characters as are expressed
in <i>toWidth</i>, with leading zeros or blanks in a number base
specified in <i>inBase</i>. For example if it were asked to format
the value 42 in base 16 with leading zeros to a width of 8, the
string returned would be &quot;0000002a&quot;. If the width requested
is less than the minimum number of characters required to express
the value, it will be ignored and the minimum number of characters
will be used. For example if it were asked to format the value
12345 in decimal to a width of 4 it would return &quot;12345&quot;.
<br>

<p>
The <i>formatDouble</i> action is similar formatting the floating
point value <i>toFormat</i> with <i>foreWidth</i> characters before
the decimal point and <i>toWidth</i> characters after the decimal
point, using leading zeros or spaces before the decimal point
and rounding the value after the decimal point as appropriate.
For example if it were asked to format the value 123.456 with
leading zeros, 5 spaces before the decimal point and 2 after it
would return &quot;00123.46&quot;. At least one character will
be used after the decimal point even though the call may ask for
zero.<br>

<p>
This version of the <i>formatDouble</i> action is limited to formatting
floating point values within the range of values which can be
represented by the <b><font FACE="Arial">long</font></b>
data type. If it is asked to format a value outside this range
it will throw an <i><font FACE="Arial">OutputFormatException</font></i>.
This exception will also be thrown if the number base requested
is not possible. The OutputFormatException class is provided for
use by this class and its class diagram is given in Figure 9.5.
<br>

<p>
<center><img SRC="c9p5i2.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/c9p5i2.gif" WIDTH="393" HEIGHT="281"></center>
<p>
<center><font>Figure 9.5 The <i>OutputFormatter</i> class
diagram<br>
</font></center>
<p>
The constructor for this exception requires a reason to be supplied
which can subsequently be obtained using the <i>obtainReason</i>
action. The <i>toString</i> action will provide a different <i>explanation</i>
depending upon the reason supplied when the exception instance
is created. The implementation of this class is as follows. <br>

<pre>
<font>0001 // Filename OutputFormatException.java.
0002 // Providing specific exception for the
0003 // OutputFormatter class.
0004 //
0005 // Written for JFL book Chapter 9 see text.
0006 // Fintan Culwin, v0.1, January 1997
0007  
0008  
0009  <b>class</b> OutputFormatException <b>extends</b> RuntimeException { 
0010  
0011  <b>public static final int</b> UNKNOWN_REASON   = 0; 
0012  <b>public static final int</b> INVALID_BASE     = 1;
0013  <b>public static final int</b> FP_TOO_LARGE     = 2; 
0014  
0015  <b>private int</b> theReason = UNKNOWN_REASON;
0016  
0017     <b>public</b> OutputFormatException( <b>int</b> reason){
0018       <b>super</b>();
0019       theReason = reason;
0020     } // End default constructor
0021 
0022 
0023     <b>public int</b> obtainReason(){ 
0024        <b>return</b> theReason;
0025     } // End obtainReason.
0026     
0027 
0028     <b>public</b> String toString() {
0029     
0030     String toReturn;
0031     
0032        <b>switch</b> ( theReason) {  
0033        <b>case</b> INVALID_BASE: 
0034           toReturn = <b>new</b> String( &quot;Output format exception : Invalid base.&quot;);
0035           <b>break</b>;
0036        <b>case</b> FP_TOO_LARGE: 
0037           toReturn = <b>new</b> String( &quot;Output format exception : Value too large.&quot;);
0038           <b>break</b>;          
0039        <b>default</b>: 
0040           toReturn = <b>new</b> String( &quot;Output format exception : Unknown reason.&quot;);
0041        } // End switch. 
0042        <b>return</b> toReturn;    
0043     } // End toString.
0044     
0045  } // End OutputFormatException.<br>
</font>
</pre>

<p>
The possible reasons why the exception may be thrown are publicly
enumerated on lines 0011 to 0013, and when the instance variable
<i><font FACE="Arial">theReason</font></i> is declared
on line 0015 it is given the value <i><font FACE="Arial">UNKNOWN_REASON</font></i>.
The reaminder of the implementation should be comprehensible from
the previous classes presented. <br>

<p>
The design of the <i>OutputFormatter formatLong</i> action is
as follows. <br>

<p>
<center><img SRC="c9p5i3.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/c9p5i3.gif" WIDTH="749" HEIGHT="356">
</center>
<p>
The maximal base which will be allowed is base 36, this is based
upon the consideration that an additional alphabetic character
has to be used for every base beyond 10 and as there are only
26 alphabetic characters this gives 36. The minimal base is base
2, and both of these values are supplied as manifest values in
the <font FACE="Arial">Character</font> class. The implementation
of the <i>OutputFormatter</i> class as far as the end of the <i>formatLong</i>
action is as follows. <br>

<pre>
<font>0001 // Filename ValidatedInputDemonstration.java
0002 // Provides facilities for the formatting of numbers.
0003 //
0004 // Produced for JFL book Chapter 9.
0005 // Fintan Culwin, v0.1, January 1997.
0006 
0007 <b>import</b> OutputFormatException;
0008 
0009 <b>public class</b> OutputFormatter { 
0010 
0011 <b>public static final</b> <b>int</b>  BINARY  = 2;
0012 <b>public static final</b> <b>int</b>  OCTAL   = 8;
0013 <b>public static final</b> <b>int</b>  DECIMAL = 10;
0014 <b>public static final</b> <b>int</b>  HEX     = 16;
0015 
0016 <b>private static final char</b> SPACE = ' ';
0017 <b>private static final char</b> ZERO  = '0';
0018 
0019    <b>public static</b> String formatLong( <b>long</b>    toFormat,
0020                                     <b>int</b>     toWidth,
0021                                     <b>boolean</b> withZeros,
0022                                     <b>int</b>     inBase) { 
0023    
0024    StringBuffer formatString;
0025    <b>char</b>         padding;
0026    
0027       <b>if</b> ( (inBase &lt; Character.MIN_RADIX) ||
0028            (inBase &gt; Character.MAX_RADIX) ){ 
0029         <b>throw new</b> OutputFormatException( OutputFormatException.INVALID_BASE);   
0030       } // End if.     
0031    
0032       <b>if</b> ( withZeros) { 
0033          padding = ZERO;
0034       } <b>else</b> { 
0035          padding = SPACE;
0036       } // End if.                                
0037        
0038       formatString = <b>new</b> StringBuffer( Long.toString( toFormat, inBase));
0039       
0040       <b>while</b> ( formatString.length() &lt;  toWidth) { 
0041          formatString.insert( 0, padding);
0042       } // End while.
0043     
0044       <b>return</b> formatString.toString();                          
0045    } // End formatLong.                             <br>
</font>
</pre>

<p>
The public manifest values on lines 0011 to 0014 are supplied
to assist clients in specifying a base for the <i><font FACE="Arial">formatLong</font></i>()
action. The private manifest values on lines 0016 and 0017 are
supplied to make the implementation of <i><font FACE="Arial">formatLong</font></i>()
a little more readable.<br>

<p>
The first action of the <i><font FACE="Arial">formatLong</font></i>()
action is to throw an <i><font FACE="Arial">OutputFormatException</font>
</i>with the reason set to<i> <font FACE="Arial">INVALID_BASE</font></i>
if the base requested is not within the limits supplied by the
<font FACE="Arial">Character</font> class. Following this
a local character variable, called <i><font FACE="Arial">padding</font></i>,
is set as appropriate depending upon the value of the argument
<i><font FACE="Arial">withZeros</font></i>. The design
component <i>obtain as String Buffer</i> is implemented on line
0038 where the class-wide <font FACE="Arial">Long toString</font>
action is used to obtain an anonymous <font FACE="Arial">String</font>
containing the value <i><font FACE="Arial">toFormat</font></i>
expressed in <i><font FACE="Arial">inBase</font></i>. This
<font FACE="Arial">String</font> is immediately used to
construct a <font FACE="Arial">StringBuffer</font> called
<font FACE="Arial">formatString</font>. A <font FACE="Arial">StringBuffer</font>
is required instead of a String as a <font FACE="Arial">StringBuffer</font>
can be easily changed while a String is relatively unchangable.
<br>

<p>
Having obtained the value in a <font FACE="Arial">StringBuffer</font>
the padding character is inserted at the front until it is as
wide as requested in <i><font FACE="Arial">toWide</font></i>.
Should the <font FACE="Arial">StringBuffer </font>already
be as long, or longer, than <i><font FACE="Arial">toWide</font></i>
the loop will not iterate and no characters will be inserted.
The final action of the <i><font FACE="Arial">formatLong</font></i>()
action is to convert the <font FACE="Arial">StringBuffer</font>
back into a <font FACE="Arial">String</font>, using the
<font FACE="Arial">StringBuffer toString</font>() action,
and return this as the result of the function. <br>

<p>
A fragment of a demonstration harness client for this action is
as follows. <br>

<pre>
<font>0012  // Assuming <b>int</b> <i>demoInt</i> = 255 has been declared.
0013  System.out.println( &quot;\nOutputting &quot; + <i>demoInt</i> + &quot; in decimal with &quot;  +
0014                      &quot;leading zeros and width 12 ... &quot;);
0015  System.out.println( OutputFormatter.formatLong( (<b>long</b>) <i>demoInt</i>, 
0016                                                 12, <b>true</b>, 
0017                                                 <i>OutputFormatter</i>.<i>DECIMAL</i>)); 
0018         
0019  System.out.println( &quot;\nOutputting &quot; + demoInt + &quot; in hex with &quot;  +
0020                      &quot;leading spaces and width 12 ... &quot;);
0021  System.out.println( OutputFormatter.formatLong( (long) <b>demoInt</b>, 
0022                                                 12, <b>false</b>, 
0023                                                 <i>OutputFormatter.HEX</i>));
<br>
</font>
</pre>

<p>
The output, which seems to indicate that the class is working
correctly, from this fragment was as follows. 
<hr>

<ul><pre>
Outputting 255 in decimal with leading zeros and width 12 ...
000000000255

Outputting 255 in hex with leading spaces and width 12 ...
          ff<br>
<br>

</pre></ul>

<p>
<hr>
<h2>
<ul>
<a HREF="outputformatterexception.java" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/OutputFormatterException.java"><img SRC="..\list.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/list.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="40" HEIGHT="35">
<i>OutputFormatterException.java</i> source code</a>.
<p>
<a HREF="outputformatter.java" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/OutputFormatter.java"><img SRC="..\list.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/list.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="40" HEIGHT="35">
<i>OutputFormatter.java</i> source code</a>.
<p>
<a HREF="outputformatterdemonstration.java" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/OutputFormatterDemonstration.java"><img SRC="..\list.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/list.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="40" HEIGHT="35">
<i>OutputFormatterDemonstration.java</i> source code</a>.
<p>
<a HREF="chap9p6.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/chap9p6.html"><img SRC="..\next.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/next.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
9.6 The <i>OutputFormatter</i> class <i>formatDouble</i> action</a>.
<p>
<a HREF="chap9p4.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter9/chap9p4.html"><img SRC="..\last.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/last.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
9.4 The <i>ValidatedInputDemonstration</i> client</a>.
</ul>
</h2>
<hr>
</body>

</html>
&#26;
