<html>

<head><meta http-equiv="pragma" content="no-cache">

<meta NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.0z">
<title>5.6 The MultipleRegister design and implementation</title>

</head>

<body BGCOLOR="WHITE">

<h2>5.6 The <i>MultipleRegister</i> design and implementation
<br>
</h2>

<p>
The <i>MultipleRegister</i> extends the <i>MoneyRegister</i> to
allow it to record both the total amount in the register and the
separate amounts deposited by cash, by cheque, by debit card and
by credit card. The class diagram is shown in Figure 5.5.<br>

<p>
<center>
<img SRC="c5p6i1.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/c5p6i1.gif" WIDTH="390" HEIGHT="445">
</center>
<p>
<center><font>Figure 5.5 The <i>MultipleRegister </i>class
diagram.<br>
</font></center>
<p>
This diagram indicates that the <i>MultipleRegister </i>class
is a subclass of the <i>MoneyRegister</i> class. The first thing
shown as being exported are DEPOSIT&nbsp;METHODS which will define
the names four methods which can be used to deposit into an instance
of this class. The capitalisation of the exported component suggests
that these will be implemented as class wide constants and they
can be regarded as a selection between four possibilities. This
can be shown on a JSP schematic as follows. <br>

<p>
<center>
<img SRC="c5p6i2.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/c5p6i2.gif" WIDTH="578" HEIGHT="116">
</center>
<p>
This diagram differs from the previous JSP schematics as it is
describing the structure of a data object not the structure of
an action. Thus it contains nouns rather than verbs and the selections
do not have to be keyed. The diagram states that a DEPOSIT&nbsp;METHOD
has to be one of BY&nbsp;CASH, BY&nbsp;CHEQUE, BY&nbsp;DEBIT(card)
or BY&nbsp;CREDIT(card).<br>

<p>
The single constructor requires an <i>initial&nbsp;float</i> for
the same reasons as were given for the <i>MoneyRegister</i> constructor
above. The <i>deposit</i> action in this class requires both the
amount to deposit and also the method of deposit. Two enquiry
actions, <i>depositedByCashIs</i> and <i>numberOfCashTransactionsIs</i>,
which will return the total amount of cash deposited and the number
of cash transactions, are shown. The dotted lines below these
actions indicate that other methods, equivalent to these two enquiry
methods but relating to the other deposit methods, have been omitted
from the diagram. The final action shown is a <i>toString</i>
action. <br>

<p>
The inside of the class diagram suggests that there are four totally
private data attributes, each of which is a <i>MoneyRegister</i>.
In order for this class to implement its specification it will
have to count the total amount of money deposited in cash and
the number of cash transactions. This is exactly the specification
that the <i>MoneyRegister</i> class was implemented to satisfy
and so the most elegant way of implementing this class is to provide
it with <i>MoneyRegister</i> data attribute for the amount of
cash deposited; and one for each of the other methods also. This
can be illustrated on an instance diagram, as shown in Figure
5.6.<br>

<p>
<center><img SRC="img00001.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/IMG00001.GIF" WIDTH="603" HEIGHT="483"></center>
<p>
<center><font>Figure 5.6 The <i>MultipleRegister </i>instance
diagram.<br>
</font></center>
<p>
The diagram shows that the <i>MultipleRegister</i> class <i><b>is&nbsp;a</b></i>
<i>MoneyRegister</i> (and so <i><b><font COLOR="#808080">is&nbsp;a</font></b></i>
<i>WarningCounter</i> etc.), and that it also <i><b>has&nbsp;a</b></i>
number of <i>MoneyRegisters</i>. The intention is that the total
amount of money recorded in all of the four <i><b>has&nbsp;a</b></i>
registers will always be equal to the amount of money recorded
in the data attributes inherited by the <i>MultipleRegister</i>
from the <i>MoneyRegister</i> class. The implementation of this
design as far as the end of the constructor is as follows. <br>

<pre>
<font>0001 // Filename <i>Counters/MultipleRegister.java</i>.
0002 // Providing a <i>MoneyRegister </i>able to take cash,
0003 // cheque, debit card and credit card deposits.
0004 //
0005 // Written for JFL book Chapter 5 see text.
0006 // Fintan Culwin, v0.1, January 1997
0007  
0008 <b>package</b> <i>Counters</i>;
0009  
0010 <b>public class</b> <i>MultipleRegister </i><b>extends</b> <i>MoneyRegister </i>{ 
0011 
0012 <b>public static final int</b> <i>BYCASH   </i>= 1;
0013 <b>public static final int</b> <i>BYCHEQUE </i>= 2;
0014 <b>public static final int</b> <i>BYDEBIT  </i>= 3;
0015 <b>public static final int</b> <i>BYCREDIT </i>= 4;
0016 
0017 <b>private</b> <i>MoneyRegister cashRegister   </i>= <b>new</b> <i>MoneyRegister</i>( 0.0);
0018 <b>private</b> <i>MoneyRegister chequeRegister </i>= <b>new</b> <i>MoneyRegister</i>( 0.0);
0019 <b>private</b> <i>MoneyRegister debitRegister  </i>= <b>new</b> <i>MoneyRegister</i>( 0.0);
0020 <b>private</b> <i>MoneyRegister creditRegister </i>= <b>new</b> <i>MoneyRegister</i>( 0.0);
0021  
0022    <b>public</b> <i>MultipleMoneyRegister</i>( <b>double</b> <i>initialCashFloat</i>) {  
0023         <b>super</b>(  <i>initialCashFloat</i>);
0024     }  // End Constructor.<br>
</font>
</pre>

<p>
The four manifest values are declared as public class wide constants
on lines 0012 to 0015. The four encapsulated <i><font FACE="Arial">MoneyRegister</font></i>
instances are declared and constructed, with an initial cash float
of nothing, on lines 0017 to 0020. The only required action of
the constructor is to call its parent <i><font FACE="Arial">MoneyRegister</font></i>
constructor passing on the value of its argument. The design of
the <i><font FACE="Arial">deposit()</font></i> action is
as follows. <br>

<p>
<center>
<img SRC="c5p6i3.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/c5p6i3.gif" WIDTH="629" HEIGHT="333">
</center>
<p>
The design indicates the first step is to make a deposit into
one of the encapsulated <i>MoneyRegister</i>s depending upon what
method of payment is indicated. This is a five way selection with
the fifth option indicating that an invalid method of payment
has been specified and throwing an exception to indicate this.
Only if the exception is not thrown is the second step of the
design, depositing into the actual <i>MultipleRegister </i>instance,
performed. If these two steps were reversed then an invalid deposit
might be made into the <i>MultipleRegister </i>instance which
would have to subsequently be undone in some way in order for
the amounts to tally. The implementation of this design is as
follows. <br>

<pre>
<font>0027    <b>public void</b> <i>deposit</i>( <b>double</b> <i>amount</i>,
0028                         <b>int</b>    <i>method</i>) { 
0029 
0030       <b>switch</b> ( <i>method</i> ) { 
0031          <b>case</b> BYCASH:
0032             <i>moneyRegister.deposit</i>( <i>amount</i>);
0033             <b>break</b>;
0034          <b>case</b> BYCHEQUE:
0035             <i>chequeRegister.deposit</i>( <i>amount</i>);
0036             <b>break</b>;
0037          <b>case</b> BYDEBIT:
0038             <i>debitRegister.deposit</i>( <i>amount</i>);
0039             <b>break</b>;         
0040          <b>case</b> BYCREDIT:
0041             <i>creditRegister.deposit</i>( <i>amount</i>);
0042             <b>break</b>;
0043          <b>default</b>:
0044             // Unknown deposit method - throw exception!            
0045       } // End switch. 
0046       <b>this</b>.<i>deposit</i>( <i>amount</i>);
0047    } // End deposit. <br>
</font>
</pre>

<p>
The five way selection has been implemented using a <font FACE="Arial">switch</font>
structure whose general form is as follows. 

<pre>
<font>		<b>switch</b> ( <i>selector</i>) 
		   <b>case</b> <i>value1</i>:
		      first actions
		      {<b>break</b>}
		   <b>case</b> <i>value2</i>:
		   <b>case</b> <i>value3</i>:
		      second actions
		      {<b>break</b>}
		{  <b>default</b>:
		      default actions}
		} // End switch</font>
</pre>

<p>
 
<p>
The decision is controlled by the value of the <font FACE="Arial">selector</font>,
if it matches one of the <b><font FACE="Arial">case</font></b>
<i><font FACE="Arial">values</font></i> then the actions
associated with that <b><font FACE="Arial">case</font></b>
section are executed. As soon as one <b><font FACE="Arial">case</font></b>
<i><font FACE="Arial">value</font></i> is matched than
all actions in all the following sections are also executed. To
avoid this and cause all remaining actions to be ignored the <font FACE="Arial">break</font>
keyword can be used at the end of a section. The last section
can be a <b><font FACE="Arial">default</font></b> section
which will be performed if none of the other sections are performed.
 <br>

<p>
In the general example above, if the <i><font FACE="Arial">selector</font></i>
matches <i><font FACE="Arial">value1</font></i> then the
<i><font FACE="Arial">first&nbsp;actions</font></i> will
be performed and, if the <b><font FACE="Arial">break</font></b>
is not included, the <i><font FACE="Arial">second actions</font></i>
and the <i><font FACE="Arial">default actions</font></i>.
If the <b><font FACE="Arial">break</font></b> keyword is
used then only the <i><font FACE="Arial">first&nbsp;actions</font></i>
will be performed. If the <i><font FACE="Arial">selector</font></i>
matches either <font FACE="Arial">value2</font> or <i><font FACE="Arial">value3</font></i>
then the <i><font FACE="Arial">second actions</font></i>,
and possibly the <i><font FACE="Arial">default actions</font></i>
depending upon the inclusion of a <b><font FACE="Arial">break</font></b>,
will be performed. If the <i><font FACE="Arial">selector</font></i>
does not match any of <i><font FACE="Arial">value1</font></i>,
<i><font FACE="Arial">value2</font></i> or <i><font FACE="Arial">value3</font></i>
then the default actions will be performed. <br>

<p>
In the deposit action above the following complex <b><font FACE="Arial">if/&nbsp;else&nbsp;if</font></b>
structure could have been used.<br>

<pre>
<font>0030       <b>if </b>( <i>method</i> = BYCASH) { 
0031          <i>moneyRegister.deposit</i>( <i>amount</i>);
0032       } <b>else</b> <b>if </b>( <i>method</i> = BYCHEQUE) { 
0033          <i>chequeRegister.deposit</i>( <i>amount</i>);
0034       } <b>else</b> <b>if </b>( <i>method</i> = BYDEBIT) { 
0035          <i>debitRegister.deposit</i>( <i>amount</i>);
0036       } <b>else</b> <b>if </b>( <i>method</i> = BYCREDIT) { 
0037          <i>creditRegister.deposit</i>( <i>amount</i>);
0038       } <b>else</b> { 
0039          // Unknown deposit method - throw exception!            
0040       } // End if. <br>
</font>
</pre>

<p>
It should be apparent that the <b><font FACE="Arial">switch</font></b>
structure is clearer in its intention and easier to maintain and
debug than the equivalent <b><font FACE="Arial">if/&nbsp;else&nbsp;if</font></b>
structure and should be favoured for multiway decisions when it
is possible to use it. The major restriction on the use of a switch
statement is that the selector must be a simple value, for example
an integer, and not a complex value, for example a double. The
<b><font FACE="Arial">throw</font></b>ing of the exception
will be left as an end of chapter exercise.<br>

<p>
The implementation of the two enquiry actions shown on the class
diagram is relatively straightforward, making use of the <i><font FACE="Arial">MoneyRegister</font></i>
actions of the appropriate instance. <br>

<pre>
<font>0050    <b>public double</b> <i>depositedByCashIs</i>(){ 
0051        <b>return</b> <i>moneyRegister.takingsAre</i>();
0052    } // End <i>depositedByCashIs</i>.                       
0053 
0054    <b>public int</b> <i>numberOfCashTransactionsIs</i>() { 
0055        <b>return</b> <i>moneyRegister</i>.<i>numberOfDepositsIs</i>();
0056    } // End <i>numberOfCashTransactionsIs</i>.<br>
</font>
</pre>

<p>
The implementation of the six other enquiry actions is directly
comparable to these two. Finally the <i><font FACE="Arial">toString()</font></i>
action constructs its string by adding the output from all eight
enquiry actions to the string returned by the <i><font FACE="Arial">MoneyRegister</font></i>
<i><font FACE="Arial">toString()</font></i> action.<br>

<pre>
<font>0059    <b>public</b> String <i>toString</i>(){ 
0060       <b>return</b> <b>super</b>.<i>toString</i>() + &quot;\n&quot; +
0061                    <b>this</b>.<i>numberOfCashTransactionsIs</i>()      + 
0062                    &quot; cash        transactions totalling &quot; + 
0063                    <b>this</b>.<i>depositedByCashIs</i>() + &quot;.\n&quot;       +
0064                    <b>this</b>.<i>numberOfChequeTransactionsIs</i>()    + 
0065                    &quot; cheque      transactions totalling &quot; + 
0066                    <b>this</b>.<i>depositedByChequeIs</i>() + &quot;.\n&quot;     + 
0067                    <b>this</b>.<i>numberOfDebitTransactionsIs</i>()     + 
0068                    &quot; debit card  transactions totalling &quot; + 
0069                    <b>this</b>.<i>depositedByDebitIs</i>() + &quot;.\n&quot;      + 
0070                    <b>this</b>.<i>numberOfCreditTransactionsIs</i>()    + 
0071                    &quot; credit card transactions totalling &quot; + 
0072                    <b>this</b>.<i>depositedByCreditIs</i>() + &quot;.&quot;; 
0073    
0074    } // End <i>toString.
</i>0075 
0076 } // End MultipleRegister.<br>
</font>
</pre>

<p>
The output produced by this action will be illustrated in the
demonstration client below.<br>
<br>


<p>
<hr>
<h2>
<ul>
<a HREF="multipleregister.java" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/MultipleRegister.java"><img SRC="..\list.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/list.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="40" HEIGHT="35">
<i>MultipleRegister.java</i> Source code</a>.
<p>
<a HREF="chap5p7.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/chap5p7.html"><img SRC="..\next.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/next.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
5.7 The <i>MultipleRegisterDemonstration</i> program client</a>.
<p>
<a HREF="chap5p5.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/chap5p5.html"><img SRC="..\last.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/last.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
5.5 The <i>MoneyRegisterDemonstration</i> program client</a>.

</ul>
</h2>
<hr>
</body>

</html>
&#26;