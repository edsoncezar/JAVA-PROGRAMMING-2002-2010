<html>

<head><meta http-equiv="pragma" content="no-cache">

<meta NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.0z">
<title>5.3 A second implementation of the RoomMonitor class</title>

</head>

<body BGCOLOR="WHITE">

<h2>5.3 A second implementation of the <i>RoomMonitor</i> class.
<br>
</h2>

<p>
The first implementation of the <i>RoomMonitors</i> class has
been demonstrated to appear to work correctly. However it does
have a problem, because a <i>RoomMonitor</i> is&nbsp;an extended
<i>WarningCounter</i> it inherits publicly all <i>WarningCounter</i>
public actions. This means that in addition to the <i>enterRoom</i>
and <i>exitRoom</i> actions it also inherits the <i>count</i>
and <i>unCount</i> actions, as well as the <i>numberCountedIs</i>
is action. <br>

<p>
This means that there is a danger that a client can use the <i>count</i>
action of the <i>RoomMonitors </i>class and bypass the <i>enterRoom</i>
action. This would mean that the <i>numberCurrentlyInRoom</i>
action would report one too many people in the room and the <i>maximumInRoom</i>
action might not report an accurate figure. <br>

<p>
Thus there is a potential insecurity in the implementation of
the <i>RoomMonitors </i>class which cannot be corrected by removing
the <i>count</i> action as an extension to a class can add new
actions or change an action by overriding it; but cannot remove
an action. There are a number of possible solutions to this, one
might be to override the <i>count</i> action in the <i>RoomMonitors
</i>class and have it either do nothing or raise an exception.
Or the <i>RoomMonitors</i> class might be introduced into the
hierarchy as a child of the <i>LimitedCounter</i> class. Neither
of these solutions is particularly elegant; overriding the <i>count</i>
action is making the best of a bad job and implementing it as
a child of the <i>LimitedCounter</i> class would imply that the
warning behaviour would have to be re-implemented. <br>

<p>
The problem is caused by the <i>RoomMonitor</i> being considered
as an extended <i>WarningCounter, </i>that is a with extra bits
added. One other way of thinking about the relationship between
the two classes is that a <i>RoomMonitor</i> <i><b>has&nbsp;a</b></i>
<i>WarningCounter</i> contained within itself. The only change
which this would make to the class diagram is that the <i>RoomMonitor</i>
class would be considered an extension of the Java pre-supplied
Object class. The revised class diagram is shown in Figure 5.2.
<br>

<p>
<center>
<img SRC="c5p3i1.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/c5p3i1.gif" WIDTH="369" HEIGHT="488">
</center>
<p>
<center><font>Figure 5.2 The revised <i>RoomMonitor</i>
class diagram.<br>
</font></center>
<p>
The first part of the implementation of this revised implementation,
as far as the end of the constructor, is as follows. <br>

<pre>
<font>0001  // Filename <i>Counters/RoomMonitor.java</i>.
0002  // Providing a non-abstract class which monitors 
0003  // entry and exit occurrences, second implementation.
0004  //
0005  // Written for JFL book Chapter 5 see text.
0006  // Fintan Culwin, v0.1, January 1997
0007  
0008  <b>package</b> <i>Counters</i>;
0009  
0010  <b>import</b> <i>Counters.WarningCounter</i>;
0011  
0012  <b>public class</b> <i>RoomMonitor </i><b>extends</b> Object { 
0013  
0014  
0015  // Largest positive int value, 2147483647 in decimal.
0016  <b>private static final int</b> <i>MAXINTEGER </i>= 0x7FFFFFFF;
0017  
0018  <b>private</b> <i>WarningCounter theCounter</i>;
0019   
0020  <b>private int</b> <i>maxEverInRoom         </i>= 0;
0021  <b>private int</b> <i>totalNumberEntered    </i>= 0;
0022 
0023  
0024     <b>public</b> <i>RoomMonitor</i>() {
0025       <i>theCounter </i>= <b>new</b> <i>WarningCounter</i>( 0, <i>MAXINTEGER</i>); 
0026       <i>maxEverInRoom         </i>= 0;
0027       <i>totalNumberEntered    </i>= 0;
0028     } // End default constructor.<br>
</font>
</pre>

<p>
This implementation differs by importing the <i><font FACE="Arial">Counters.WarningCounters</font></i>
class and by the declaration of a private data attribute which
is an instance of the <i><font FACE="Arial">WarningCounters</font></i>
class called <i><font FACE="Arial">theCounter</font></i>.
The remaining parts of the file should replace any references
to the <i><font FACE="Arial">count()</font></i>, <i>unCount()</i>
and <i><font FACE="Arial">numberCounterIs()</font></i>
actions which were accessed via <b><font FACE="Arial">this</font></b>
to be accessed via <i><font FACE="Arial">theCounter</font></i>.
Any references to <i><font FACE="Arial">RoomMonitor</font></i>
actions should remain being accessed via <b><font FACE="Arial">this</font></b>.
The revised implementation is as follows. <br>

<pre>
<font>0030     <b>public void</b> <i>enterRoom</i>() {
0031        <i>theCounter.count</i>();
0032        <i>totalNumberEntered</i>++;
0033        <b>if</b> ( <b>this</b>.<i>numberCurrentlyInRoomIs</i>() &gt; <i>maxEverInRoom</i> ) { 
0034           <i>maxEverInRoom</i> = <i>numberCurrentlyInRoomIs</i>();
0035        } 
0036     } // End <i>enterRoom</i>.
0037  
0038  
0039     <b>public</b> <b>void</b> <i>exitRoom</i>() { 
0040        <i>theCounter.unCount</i>(); 
0041     } // End <i>exitRoom</i>.
0042  
0043  
0044     <b>public int</b> <i>numberCurrentlyInRoomIs</i>(){ 
0045        <b>return</b>  <i>theCounter.numberCountedIs</i>();
0046     } // End <b>numberCurrentlyInRoomIs</b>.
0047  
0048  
0049     <b>public int</b> <i>maxEverInRoomIs</i>(){ 
0050        <b>return</b> <i>maxEverInRoom</i>;
0051     } // End <i>maxEverInRoomIs</i>.
0052  
0053  
0054     <b>public int</b> <i>totalNumberEnteredIs</i>(){ 
0055        <b>return</b> <i>totalNumberEntered</i>;
0056     } // End <i>totalNumberEnteredIs</i>.
0057  
0058  
0059     <b>public</b> String <i>toString</i>(){
0060        return &quot;Now in room : &quot;    + <b>this</b>.<i>numberCurrentlyInRoomIs</i>() + 
0061               &quot; Max in Room : &quot;   + <b>this</b>.<i>maxEverInRoomIs</i>()         +
0062               &quot; Total entered : &quot; + <b>this</b>.<i>totalNumberEnteredIs</i>();
0063     } // End <i>toString.
</i>0064  
0065  } // End <i>RoomMonitor</i>.<br>
</font>
</pre>

<p>
The <i>RoomMonitorDemonstration</i> client will require no changes
and can be simply re-executed after the revised version of the
<i>RoomMonitor</i> class has been compiled. It should indicate
that the behaviour of the two implementations is identical.<br>
<br>


<p>
<hr>
<h2>
<ul>
<a HREF="roommonitor.java" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/RoomMonitor.java"><img SRC="..\list.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/list.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="40" HEIGHT="35">
<i>RoomMonitor.java</i> Source code</a>.
<p>
<a HREF="chap5p4.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/chap5p4.html"><img SRC="..\next.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/next.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
5.4 The <i>MoneyRegister</i> hierarchy &amp; the <i>MoneyRegister</i> implementation </a>.
<p>
<a HREF="chap5p2.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/chap5p2.html"><img SRC="..\last.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/last.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
5.2 The <i>RoomMonitorDemonstration</i> client</a>.

</ul>
</h2>
<hr>
</body>

</html>
&#26;