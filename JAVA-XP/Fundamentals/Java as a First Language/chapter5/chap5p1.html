<html>

<head><meta http-equiv="pragma" content="no-cache">

<title>5.1 The RoomMonitor design and first implementation</title>

<meta NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.0z">
</head>

<body BGCOLOR="WHITE">

<h1>5.1 The <i>RoomMonitor</i> design and first implementation
<br>
</h1>

<p>
The <i>RoomMonitor</i> class is intended to provide facilities
to monitor the number of people entering and leaving a room. To
accomplish this it will need to be able to report to its clients
the total number of people currently in the room, the total number
of people who have entered the room and the maximum number of
people ever in the room; and in order to do this will have to
provide actions for entering and leaving a room. The class diagram
for the <i>RoomMonitor</i> class is given in Figure 5.1.
<p>
<center>
<img SRC="c5p1i1.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/c5p1i1.gif" WIDTH="370" HEIGHT="494">
</center>
<p>
<center><font>Figure 5.1 The <i>RoomMonitor</i> class diagram.
<br>
</font></center>
<p>
The fundamental nature of this class is concerned with counting
entry and exit occurrences and as such it has much in common with
the <i>Counters</i> classes which have already been introduced.
As the diagram shows it is implemented as an extension to the
<i>WarningCounters</i> class. <br>

<p>
The diagram indicates that the class will supply a default constructor,
<i>enterRoom</i> and <i>exitRoom</i> actions and three enquiry
actions: <i>numberCurrentlyInRoomIs</i>, <i>maximumEverInRoom</i>
and <i>totalNumberEnteredIs</i>. The <i>enterRoom</i> and <i>exitRoom</i>
actions may throw exceptions and this is noted on the diagram.
The meaning and use of the final public action, <i>toString</i>,
will be explained below. The class diagram also suggests that
there are three data attributes corresponding to the three enquiry
functions. However, as has been mentioned before, this information
is provided only to assist a developer using the client with their
understanding, and the class need not actually be implemented
in this manner. <br>

<p>
The basis of the first implementation is to extend the <i>WarningCounters</i>
class mapping the <i>enterRoom</i> action onto the <i>count</i>
action and the <i>exitRoom</i> onto the <i>unCount</i> action.
Thus the current value returned by the <i>BasicCounter numberCountedIs</i>
action will indicate the number of people currently in the room.
The remaining two data attributes, <i>maximumEverInRoom</i> and
<i>totalNumberEntered</i> will have to be provided as data attributes.
The first part of this implementation, as far as the end of the
constructor is as follows. <br>

<pre>
<font>0001  // <i>Filename Counters/RoomMonitor.java</i>.
0002  // Providing a non-abstract class which monitors 
0003  // entry and exit occurrences, first implementation.
0004  //
0005  // Written for JFL book Chapter 3 see text.
0006  // Fintan Culwin, v0.1, January 1997
0007  
0008  <b>package</b> <i>Counters</i>;
0009  
0010  <b>public class</b> <i>RoomMonitor</i> <b>extends</b> <i>WarningCounter</i> { 
0011  
0012  // Largest possible positive int value, 2147483647 in decimal.
0013  <b>private static final int</b> MAXINTEGER = 0x7FFFFFFF; 
0014
0015 
0016  <b>private int</b> <i>maxEverInRoom</i>         = 0;
0017  <b>private int</b> <i>totalNumberEntered</i>    = 0;
0018 
0019  
0020  <b>public</b> <i>RoomMonitor</i>() { 
0021    <b>super</b>(0, MAXINTEGER);
0022    <i>maxEverInRoom</i>       = 0;
0023    <i>totalNumberEntered</i>  = 0;
0024  } // End default constructor.
</font>
</pre>

<p>
The class declaration file starts with the expected header comments.
The detailed design considerations decided that the counter should
be able to count from zero to the largest possible positive integer
value. In order to assist with this a private class constant called
<font FACE="Arial">MAXINTEGER</font> has been declared
on line 0013. As is explained in Appendix A, Java <b><font FACE="Arial">int</font></b>
values are always 32 bits long and signed. The value specified
for the constant is the hexadecimal representation of a 32 bit
integer with all but the first bit set, which is the pattern required
for the maximum 32 bit positive integer value. Just in case a
reader of this file is not totally familiar with hexadecimal representations,
line 0012 is a comment which states the value in decimal.<br>

<p>
The implementation continues with the declaration of the two data
attributes on lines 0016 and 0017. The declaration of the constructor
is on lines 0020 to 0024. It starts with a call of the <i><font FACE="Arial">WarningCounters</font></i>
constructor specifying a range of 0 to <font FACE="Arial">MAXINTEGER</font>
and concludes by explicitly specifying the values of the two data
attributes. The explicit values for the data attributes in the
constructor do not differ from their default values, but it is
regarded as good style to explicitly set all values in a constructor.
<br>

<p>
The design of the <i>enterRoom</i> action has to consider counting
the occurrence as a <i>Counter</i> object and of updating the
values of the two data attributes. The design of this action is
as follows. <br>

<p>
<center>
<img SRC="c5p1i2.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/c5p1i2.gif" WIDTH="569" HEIGHT="273">
</center>
<p>
The design indicates that the first step is to count the entry
as an occurrence, possibly throwing an exception, and then to
increment the number of people recorded as having ever entered
the room. The final step is to increment the maximum number of
people ever in the room only if the current value of the number
of people in the room is greater than the maximum ever recorded
in the room so far. The implementation of this design is as follows.
<br>

<pre>
<font>0026  <b>public void</b> <i>enterRoom</i>() {
0027     <b>this</b>.<i>count</i>();
0028     <i>totalNumberEntered</i>++;
0029     <b>if</b> ( <b>this</b>.<i>numberCurrentlyInRoomIs</i>() &gt; <i>maxEverInRoom</i> ) { 
0030        <i>maxEverInRoom</i>++;
0031     } 
0032  } // End <i>enterRoom</i>.
</font>
</pre>

<p>
The implementation follows directly from the design with the first
step, a call of the inherited count action on line 0027 which
might raise the <i><font FACE="Arial">CounterException</font></i>,
as explained in the previous chapter. The second step, on line
0028 is the incrementing of the data attribute <i><font FACE="Arial">totalNumberEntered</font></i>.
The final step is implemented as an <b><font FACE="Arial">if</font></b>
structure on lines 0029 to 0031. The condition makes use of the
<i><font FACE="Arial">numberCurrentlyInRoom()</font></i>
action whose implementation will be described below. The value
returned from this enquiry action is then tested against the value
of the <i><font FACE="Arial">maxEverInRoom</font></i> data
attribute using the <i><b>is&nbsp;greater&nbsp;than</b></i> (&nbsp;&gt;&nbsp;)
relational operator. This will evaluate <font FACE="Arial">true</font>
if the value on its left is greater than the value on its right
and <font FACE="Arial">false</font> otherwise. If this
condition does evaluate <font FACE="Arial">true</font>
it indicates that there are more people currently in the room
than is indicated by the value of the <i><font FACE="Arial">maxEverInRoom</font></i>
data attribute and so the value of this data attribute is incremented
to allow for this. <br>

<p>
The design and implementation of the <i>exitRoom</i> action is
much simpler.<br>

<p>
<center>
<img SRC="c5p1i3.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/c5p1i3.gif" WIDTH="291" HEIGHT="156">
</center>
<pre>
<font>0035  <b>public</b> <b>void</b> <i>exitRoom</i>() { 
0036     <b>this</b>.<i>unCount</i>(); 
0037  } // End <i>exitRoom</i>.
</font>
</pre>

<p>
Just as entering a room is regarded as counting an occurrence,
leaving a room is regarded as uncounting an occurrence and may
result in an exception being thrown. The three enquiry functions
have equally straightforward implementations. <br>

<p>
<center>
<img SRC="c5p1i4.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/c5p1i4.gif" WIDTH="636" HEIGHT="130">
</center>
<pre>
<font>0040  <b>public int</b> numberCurrentlyInRoomIs(){ 
0041     <b>return</b>  <b>this</b>.numberCountedIs();
0042  } // End numberCurrentlyInRoomIs.
0043  
0044  
0045  <b>public int</b> maxEverInRoomIs(){ 
0046     <b>return</b> maxEverInRoom;
0047  } // End maxEverInRoomIs.
0048  
0049  
0050  <b>public int</b> totalNumberEnteredIs(){ 
0051     <b>return</b> totalNumberEntered;
0051  } // End totalNumberEnteredIs.
</font>
</pre>

<p>
The implementation of these three actions is straightforward and
requires minimal explanation. The <i><font FACE="Arial">totalNumberEnteredIs()</font></i>
action and <i><font FACE="Arial">maxEverInRoom()</font></i>
action return the value of their respective data attributes and
the <i><font FACE="Arial">numberCurrentlyInRoom()</font></i>
action indirects to the <i><font FACE="Arial">numberCounterdIs()</font></i>
action.<br>

<p>
The final action of this implementation, <i><font FACE="Arial">toString()</font></i>,
constructs and returns a string which contains details of the
current status of the class instance. Its implementation is as
follows, and an example of the string which would be returned
might be &quot;Now&nbsp;in&nbsp;room&nbsp;:&nbsp;3&nbsp;Max&nbsp;in&nbsp;room&nbsp;4&nbsp;:&nbsp;Total&nbsp;entered&nbsp;5&quot;.
This string is constructed by adding together (&nbsp;+&nbsp;)
a series of messages and values returned from enquiry actions,
a process known as the <i><b>catenation</b></i> of strings. <br>

<pre>
<font>0053  <b>public</b> String <i>toString</i>(){
0054     <b>return</b> &quot;Now in room : &quot;    + <b>this</b>.numberCurrentlyInRoomIs() + 
0055            &quot; Max in room : &quot;   + <b>this</b>.maxEverInRoomIs()         +
0056            &quot; Total entered : &quot; + <b>this</b>.totalNumberEnteredIs();
0057  } // End <i>toString.
</i>0058  
0059  } // End RoomMonitor.
</font>
</pre>

<p>
The use to which this action is put will be described in the demonstration
client below. <br>
<br>

<p>
<hr>
<h2>
<ul>
<a HREF="roommonitor.java" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/RoomMonitor.java"><img SRC="..\list.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/list.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="40" HEIGHT="35">
<i>RoomMonitor.java</i> Source code</a>.
<p>
<a HREF="chap5p2.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/chap5p2.html"><img SRC="..\next.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/next.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
5.2 The <i>RoomMonitorDemonstration</i> client</a>.
<p>
<a HREF="chap5.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter5/chap5.html"><img SRC="..\last.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/last.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
Chapter 5 The <i>RoomMonitor</i> class and <i>MoneyRegister</i> hierarchy</a>.
</ul>
</h2>
<hr>
</body>

</html>
&#26;