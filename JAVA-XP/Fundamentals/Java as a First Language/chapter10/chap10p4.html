<html>

<head><meta http-equiv="pragma" content="no-cache">

<meta NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.0z">
<title>10.4 The JulianDate class</title>

</head>

<body bgcolor="white">

<h2>10.4 The <i>JulianDate</i> class<br>
</h2>

<p>
<font SIZE="2">The non-abstract <i>JulianDate</i> class adds input
and output actions to the <i>ArithmeticJulianDate</i> class making
the type suitable for general purpose interactive use. The </font><i><font SIZE="2" FACE="Arial">BasicJulianDate
toString</font></i><font SIZE="2">() action provided a fundamental
output operation which would output dates in the format &quot;ddd
nn mmm yyyy&quot; for example &quot;Mon 1 Jan 1900&quot;. That
is an abbreviated day name, the month day number as either one
or two digits, an abbreviated name of the month and a four digit
year number. Assuming that the user can read English this output
format is always unambiguous. <br>
</font>
<p>
<font SIZE="2">This format can be a little verbose and there are
two conventions for a more compact and fixed size representation.
In most of Europe a date is conventionally expressed as dd/mm/yyyy
for example 01/01/1900 or 31/12/2199; however the American convention
is mm/dd/yyyy for example 01/01/1900 or 12/31/2199. This class
will provide additional output operations allowing this more sparse
format to be used and will provide a simple input routine which
allows for the input of dates in the appropriate national format.
The class diagram for the <i>JulianDate</i> class is given in
Figure 10.5.<br>
</font>
<p>
<center><img src="c10p4i1.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter10/c10p4i1.gif" WIDTH="371" HEIGHT="410"></center>
<p>
<center><font SIZE="2">Figure 10.5 The <i>JulianDate</i> class diagram.
<br>
</font></center>
<p>
<font SIZE="2">This implementation provides two manifest </font><i><font SIZE="2" FACE="Arial">LOCALE</font></i><font SIZE="2">s,
the default locale specifies a European convention with an alternative
for the American. The second constructor allows the locale to
be set explicitly without specifying as particular date and the
third allows a particular date be constructed with the specified
locale. The implementation of this design, as far as the end of
the constructors, is as follows. <br>
</font>
<pre>
0001 // Filename <i>JulianDate.java</i>.
0002 // Second extension of the <i>JulianDate</i> hierarchy 
0003 // to provide internationalised i/o operations.
0004 //
0005 // Written for JFL Book Chapter 10.
0006 // Fintan Culwin, V 0.1, Jan 1997. 
0007 
0008 <b>package</b> <i>JulianDates</i>;
0009 
0010 <b>import</b> java.io.DataInputStream;
0011 <b>import</b> java.io.IOException;
0012 <b>import</b> <i>JulianDates.JulianDateException</i>;
0013 <b>import</b> <i>OutputFormatter</i>;
0014 <b>import</b> <i>OutputFormatException</i>;
0015 
0016 
0017 <b>public class</b> <i>JulianDate</i> <b>extends</b> <i>ArithmeticJulianDate</i> { 
0018 
0019 <b>public static final int</b> <i>EUROPEAN</i>  = 0;
0020 <b>public static final int</b> <i>AMERICAN</i> = 1;
0021 
0022 <b>private int</b> <i>theLocale</i> =<i> EUROPEAN</i>;
0023 
0024 <b>private static</b> java.io.DataInputStream <i>keyboard</i> = 
0025                        <b>new</b> java.io.DataInputStream( System.in);
0026                        
0027    <b>public</b> <i>JulianDate</i>(){ 
0028       <b>super</b>();
0029    } // End <i>JulianDate</i> default constructor.
0030    
0031    <b>public</b> <i>JulianDate</i>( <b>int</b> <i>locale</i>){ 
0032       <b>super</b>();
0033       <i>theLocale</i> = <i>locale</i>;
0034    } // End <i>JulianDate</i> default constructor.   
0035 
0036    <b>public</b> <i>JulianDate</i>( <b>int</b> <i>year</i>, <b>int</b> <i>month</i>, <b>int</b> <i>day</i>, 
0037                       <b>int</b> <i>locale</i>) <b>throws</b> <i>JulianDateException</i> {
0038        <b>super</b>( <i>year</i>, <i>month</i>, <i>day</i>);
0039        <i>theLocale</i> = <i>locale</i>;
0040    } // End <i>JulianDate</i> alternative default constructor
</pre>

<p>
<font SIZE="2">The context clause imports a number of other classes
whose use will be explained as they are used. The design and implementation
of the <i>sparseString</i> action is as follows. <br>
</font>
<p>
<center><img src="c10p4i2.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter10/c10p4i2.gif" WIDTH="662" HEIGHT="273"></center>
<pre>
0095    <b>public</b> String sparseString() { 
0096    
0097    String <i>theYear</i>  = <i>OutputFormatter.formatLong</i>( 
0098                                 <b>this</b>.<i>yearIs</i>(), 4, <b>true</b>,
0099                                 <i>OutputFormatter</i>.DECIMAL );
0100    String <i>theMonth</i> = <i>OutputFormatter</i>.<i>formatLong</i>( 
0101                                 <b>this</b>.<i>monthIs</i>(), 2, <b>true</b>,
0102                                 <i>OutputFormatter</i>.DECIMAL );
0103    String <i>theDay</i>   = OutputFormatter.<i>formatLong</i>( 
0104                                 <b>this</b>.<i>dayIs</i>(), 2, <b>true</b>,
0105                                 <i>OutputFormatter</i>.DECIMAL ); 
0106      
0107       <b>if</b> ( <i>theLocale</i> == <i>EUROPEAN</i>){
0108          <b>return</b> <i>theDay</i> + &quot;/&quot; + <i>theMonth</i>  + &quot;/&quot; +  <i>theYear</i>;
0109       } <b>else</b> { 
0110          <b>return</b> <i>theMonth</i> + &quot;/&quot; + <i>theDay</i>  + &quot;/&quot; +  <i>theYear</i>;
0111       } // End if.
0112    } // End <i>sparseString</i>.
</pre>

<p>
<font SIZE="2">Each component of the string, the year, the month
and the day, is obtained using the appropriate </font><i><font SIZE="2" FACE="Arial">BasicJulianDate</font></i><font SIZE="2">
enquiry action and formatted with leading zeros using the </font><i><font SIZE="2" FACE="Arial">OutputFormatter
formatLong</font></i><font SIZE="2">() action. These strings are
then catenated together in the sequence appropriate to the locale
and the resulting string returned from the action. <br>
</font>
<p>
<font SIZE="2">The input action, <i>readDate</i> is much more complicated;
its design and implementation are as follows. <br>
</font>
<p>
<center><img SRC="c10p4i3.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter10/c10p4i3.gif" WIDTH="726" HEIGHT="348"></center>
<pre>
0043    <b>public void</b> <i>readDate</i>() <b>throws</b> <i>JulianDateException</i> { 
0044    
0045    String <i>fromKeyboard</i>;
0046    <b>int</b>    <i>firstField</i>;
0047    <b>int</b>    <i>secondField</i>;
0048    <b>int</b>    <i>yearField</i>;
0049    <b>int</b>    <i>startOfField</i>;
0050    <b>int</b>    <i>endOfField</i>;
0051    <b>char</b>   <i>separator</i> = '/';
0052    
0053    
0054       System.out.flush();
0055       <b>try</b> { 
0056          <i>fromKeyboard</i> = <i>keyboard</i>.readLine().trim();
0057          <i>endOfField</i> = <i>fromKeyboard</i>.indexOf( <i>separator</i>);
0058          <b>if</b> ( <i>endOfField</i> != -1) { 
0059            <i>firstField</i> = Integer.valueOf( <i>fromKeyboard</i>.
0060                                   substring( 0, <i>endOfField</i>)).intValue(); 
0061          } <b>else</b> { 
0062            <b>throw new</b> java.lang.Exception();
0063          } // End if.
0064           
0065          <i>startOfField</i> = <i>endOfField</i> + 1;
0066          <i>endOfField</i>   = fromKeyboard.lastIndexOf( <i>separator</i>);
0067          <b>if</b> ( <i>endOfField</i> != -1) { 
0068            <i>secondField</i> = Integer.valueOf( <i>fromKeyboard</i>.
0069                                   substring( <i>startOfField</i>, 
0070                                              <i>endOfField</i>)).intValue(); 
0071          } <b>else</b> { 
0072            <b>throw new</b> java.lang.Exception();
0073          } // End if.
0074          
0075          <i>startOfField</i> = <i>endOfField</i> + 1;
0076          <i>yearField</i>   = Integer.valueOf( <i>fromKeyboard</i>.
0077                                   substring( <i>startOfField</i>, 
0078                                              <i>fromKeyboard</i>.length())).intValue(); 
0079 
0080          <b>if</b> ( <i>theLocale</i> == <i>EUROPEAN</i>) { 
0081             <i>makeJulianDate</i>( <i>yearField</i>, <i>secondField</i>, <i>firstField</i>);
0082          } <b>else</b> { 
0083             <i>makeJulianDate</i>( <i>yearField</i>, <i>firstField</i>, <i>secondField</i>);
0084          } // End if. 
0085       } <b>catch</b> ( java.lang.Exception exception ) { 
0086           <b>throw new</b>  <i>JulianDateException</i>( 
0087                         <i>JulianDateException</i>.<i>DATE_INPUT_ERROR</i>);      
0088       } // End try/ catch.
0089       
0090    } // End <i>readDate</i>.   
</pre>

<p>
<font SIZE="2">The implementation commences by flushing any waiting
output to the screen and then obtaining a line of input from the
user in a string via an instantiation of the </font><font SIZE="2" FACE="Arial">java.io.DataInputStream
</font><font SIZE="2">called</font><font SIZE="2" FACE="Arial"> <i>keyboard</i></font><font SIZE="2">,
in a manner essentially identical to the </font><i><font SIZE="2" FACE="Arial">SimpleInput</font></i><font SIZE="2">
</font><i><font SIZE="2" FACE="Arial">getLong</font></i><font SIZE="2">()
action from the previous chapter. <br>
</font>
<p>
<font SIZE="2">Having obtained the user's input in a </font><font SIZE="2" FACE="Arial">String</font><font SIZE="2">,
called </font><i><font SIZE="2" FACE="Arial">fromKeyboard</font></i><font SIZE="2">,
it has to be divided into the three numeric fields hopefully contained
within it which are separated by slash (&nbsp;'/'&nbsp;) characters.
This is accomplished by using the </font><font SIZE="2" FACE="Arial">String</font><font SIZE="2">
</font><i><font SIZE="2" FACE="Arial">indexOf</font></i><font SIZE="2">(),
or </font><i><font SIZE="2" FACE="Arial">lastIndexOf</font></i><font SIZE="2">(),
action to locate the position of the slashes, if they can be found.
Having located the slashes the </font><font SIZE="2" FACE="Arial">String
<i>substring</i></font><font SIZE="2">() action can be used to isolate
the characters between the slashes and these are converted to
integer values using the same technique as was used in the </font><font SIZE="2" FACE="Arial">ValidatedInput</font><font SIZE="2">
</font><i><font SIZE="2" FACE="Arial">getLong</font></i><font SIZE="2">()
action in the previous chapter. <br>
</font>
<p>
<font SIZE="2">Having obtained the three integers supplied by the
user they are passed to the protected </font><i><font SIZE="2" FACE="Arial">BasicJulianDate
makeJulianDate</font></i><font SIZE="2">() action in a pattern appropriate
to the locale. Practically all of these actions may cause a variety
of different exceptions to be thrown and these are all caught
and processed in the same way, throwing a new instance of the
</font><i><font SIZE="2" FACE="Arial">JulianDateException</font></i><font SIZE="2">
with the reason set to </font><i><font SIZE="2" FACE="Arial">DATE_INPUT_ERROR</font></i><font SIZE="2">.
The design has avoided becoming too complex by indicating the
locations where exceptions might be thrown as the </font><font SIZE="2" FACE="Arial">String</font><font SIZE="2">
is parsed, with a single quit key. The demonstration of this class
will be considered in the next chapter.<br>
<br>
</font>

<p>
<hr>
<h2>
<ul>
<a HREF="juliandate.java" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter10/JulianDate.java"><img SRC="..\list.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/list.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="40" HEIGHT="35">
<i>JulianDate.java</i> source code</a>.
<p>


<a HREF="chap10sum.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter10/chap10sum.html"><img SRC="..\next.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/next.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
Summary of Chapter 10</a>.
<p>
<a HREF="chap10p3.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter10/chap10p3.html"><img SRC="..\last.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/last.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
10.3 The <i>ArithmeticJulianDates</i> class</a>.
</ul>
</h2>
<hr>


</body>

</html>
