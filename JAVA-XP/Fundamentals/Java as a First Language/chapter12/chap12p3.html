<html>

<head><meta http-equiv="pragma" content="no-cache">

<meta NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.0z">
<title>12.3 An output file stream</title>

</head>

<body BGCOLOR="WHITE">

<h2>12.3 An output file stream<br>
</h2>

<p>
In addition to input file streams, output file streams can also
be used to place the output from a program directly into a file.
In this section a developer supplied output stream class will
be introduced which can be used to place formatted line numbers
in front of every line. The demonstration client for this class
can be used to prepare line numbered program listings as used
in this book. The object diagram for this developer supplied class,
called <i><font FACE="Arial">NumberedPrintStream</font></i>,
is as follows. <br>

<p>
<center><img SRC="c12p3i1.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter12/c12p3i1.gif" WIDTH="389" HEIGHT="241">
</center>
<p>
The <i><font FACE="Arial">NumberedPrintStream</font></i>
is a extension of the standard <font FACE="Arial">PrintStream</font>
class which is the class which implments the <font FACE="Arial">System.out</font>
instance. Its constructor action requires an existing <font FACE="Arial">OutputStream</font>
instance from which it creates a <i><font FACE="Arial">NumberedPrintStream</font></i>
instance. It maintains an encapsulated <i>lineNumber</i> data
attribute which is initalised to 1 when the instance is created
and is incremented by 1 every time a line is output via the overloaded
<i><font FACE="Arial">println()</font></i> action. The
implementation of this design is as follows. <br>

<pre>
<font>0001  // Filename NumberedPrintStream.java.
0002  // Extension of the system PrintStream class to 
0003  // provide a class which outputs formatted numbers 
0004  // before every line.
0005  //
0006  // Written for JFL Book Chapter 12.
0007  // Fintan Culwin, V 0.1, Jan 1997. 
0008  
0009  <b>import</b> java.io.*;
0010  <b>import</b> OutputFormatter;
0011  
0012  <b>class</b> NumberedPrintStream <b>extends</b> java.io.PrintStream { 
0013  
0014  <b>private long</b> lineNumber = 1;
0015  
0016      <b>public</b> NumberedPrintStream( OutputStream out) { 
0017        <b>super</b>( out);
0018        lineNumber = 1;
0019      } // End constructor.   
0020  
0021      <b>public void</b> println( String anyString){                
0022         <b>super</b>.println( 
0023               OutputFormatter.formatLong( lineNumber, 4, <b>true</b>, 
0024                                        OutputFormatter.DECIMAL)
0025               + &quot;  &quot; + anyString);
0026         lineNumber++;
0027      } // End println.    
0028  
0029  } // end class NumberedPrintStream.<br>
</font>
</pre>

<p>
The constructor action on lines 0016 to 0019 first calls its parent,
<font FACE="Arial">PrintStream</font>, constructor passing
on its argument before ensuring that the <i><font FACE="Arial">lineNumber</font></i>
attribute is set to 1.<br>

<p>
The <i>NumberedPrintStream println()</i> action is implemented
as a call of the <font FACE="Arial">PrintStream</font>
<i><font FACE="Arial">println()</font></i> action passing
its <i><font FACE="Arial">anyString</font></i> parameter
preceded by the <font FACE="Arial">String</font> produced
by the <i><font FACE="Arial">OutputFormatter formatLong()</font></i>
action, containing the <i><font FACE="Arial">lineNumber</font></i>
formatted in decimal to four digits with leading zeros. As a line
has been output the <i><font FACE="Arial">lineNumber</font></i>
attribute is incremented so that the first call of <i><font FACE="Arial">println()</font></i>
will be labelled 0001, the second 0002 and so on. <br>

<p>
To demonstrate the use of this class a utility program called
<i><font FACE="Arial">NumberList</font></i> will be developed.
This program will take either one or two command line arguments.
If only one command line argument is specified the program will
attempt to open this file for input and output its contents on
to the screen with line numbers. If two arguments are supplied
the second argument will identify a file into which the output
is to be placed. The design of this program is as follows. <br>

<p>
<center><img SRC="c12p3i2.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter12/c12p3i2.gif" WIDTH="748" HEIGHT="549">
</center>
<p>
The design commences with an abend component ensuring that only
one or two command line arguments have been supplied. The posit
part of the <i>process&nbsp;streams</i> stage commences by attempting
to open the input stream. The output stream is then opened either
by opening an output file and constructing a stream from it or
by constructing a stream from the <font FACE="Arial">Standard.out</font>
stream. If this is accomplished without throwing an exception
the streams are processed and then both streams are closed. <br>

<p>
Should an exception be thrown as the streams are constructed a
flag indicates if the input stream was successfully opened. This
flag is used to determine if advice should be given to the user
concerning the input file or the output file. The implementation
of this design is as follows. <br>

<pre>
<font>0001  // Filename <i>NumberList.java</i>.
0002  // Illustrates how to read command line arguments 
0003  // and write to output files. 
0004  //
0005  // Written for JFL Book Chapter 12.
0006  // Fintan Culwin, V 0.1, Jan 1997. 
0007  
0008  
0009  <b>import</b> java.io.*;
0010  <b>import</b> <i>NumberedPrintStream</i>;
0011  
0012  <b>class</b> <i>NumberList</i> { 
0013   
0014      <b>public static void</b> <i>main</i>(String <i>args</i>[]) {
0015      
0016      DataInputStream      <i>inStream</i>;
0017      NumberedPrintStream  <i>outStream</i>;
0018      <b>boolean</b>              <i>inStreamOpen</i>  = <b>false</b>;
0019  
0020         <b>if</b> ( <i>args</i>.length == 0 || <i>args</i>.length &gt; 2) { 
0021            System.out.println( 
0022               &quot;\nTo use this utility you must either give the name of a\n&quot; + 
0023               &quot;single file which you want line numbers put into and \n&quot;    +  
0024               &quot;sent to the screen.\n\n&quot;                                    +
0025               &quot;Or give the names of two files and the contents of the \n&quot;  +
0026               &quot;first file will be sent with line numbers to the  \n&quot;       + 
0027               &quot;second file.\n\n&quot;                                           +
0028               &quot;You do not seem to have done this. \n\n&quot;);
0029               System.exit( -1);
0030         } // End if. 
0031      
0032         <b>try</b> { 
0033            <i>inStream</i>  = <b>new</b> DataInputStream( 
0034                            <b>new</b> FileInputStream( <i>args</i>[ 0]));
0035            <i>inStreamOpen</i> = true;
0036         
0037            <b>if</b> ( <i>args</i>.length == 2) { 
0038               <i>outStream</i> = <b>new</b> NumberedPrintStream(
0039                               <b>new</b> FileOutputStream( <i>args</i>[ 1])); 
0040            } <b>else</b> {                            
0041               <i>outStream</i> = <b>new</b> <i>NumberedPrintStream</i>( System.out);
0042            } // End if. 
0043            
0044            <b>while</b> ( <i>inStream</i>.available() &gt; 0 ) { 
0045               <i>outStream.println</i>( <i>inStream</i>.readLine());
0046            } // End while.
0047            
0048            <i>inStream</i>.close(); 
0049            <i>outStream</i>.close();
0050         } <b>catch</b> ( java.io.IOException <i>exception</i>)  { 
0051            <b>if</b> ( <i>exception</i> <b>instanceof</b> FileNotFoundException) { 
0052               <b>if</b> ( <i>inStreamOpen</i>) { 
0053                  System.out.println( 
0054                     &quot;The file &quot; + <i>args</i>[ 1] + &quot; could not be opened.\n&quot;);
0055               } <b>else</b> { 
0056                  System.out.println( 
0057                     &quot;The file &quot; + <i>args</i>[ 0] + &quot; could not be found,\n&quot; +
0058                     &quot;or could not be opened.\n&quot;);
0059               } // End if.       
0060            } // End if.
0061         } // End try/ catch block.
0062      } // End main.
0063      
0064   } // End class <i>NumberList</i>.<br>
</font>
</pre>

<p>
The implementation of the abend component, on lines 0020 to 0030,
is directly comparable with the abend component above. On lines
0033 to 0034 the <i><font FACE="Arial">inStream</font></i>
instance is created as described above. On lines 0037 to 0042
an instance of the <i><font FACE="Arial">NumberedPrintStream</font></i>
class, called <i><font FACE="Arial">outStream</font></i>,
is created, either from a file named in second command line argument
or from the <font FACE="Arial">System.out</font> stream.
Following this the processing of the streams involves inputting
lines from the <i><font FACE="Arial">inStream</font></i>
and outputting them using the <i><font FACE="Arial">outStream</font></i>
<i><font FACE="Arial">println()</font></i> action, before
both files are closed. As the <i><font FACE="Arial">outStream</font></i>
is an instance of the <i><font FACE="Arial">NumberedPrintStream</font></i>
class this will cause the output to be preceded by line numbers.
<br>

<p>
The admit component of the design, on lines 0050 to 0061, tests
the <i><font FACE="Arial">inStreamOpen</font></i> flag
which would have been set on line 0035 if the input stream had
been successfully opened. This decision causes it to give advice
to the user concerning which file could not be opened.<br>

<p>
This program can be demonstrated by using it with a single argument
identifying one file which does not exist and one which does exist.
To demonstrate it with two arguments the first should again identify
one file which does and one which does not, in combination with
a second argument which identifies a file which can be written
to and one which cannot. One way of specifying a file which cannot
be opened for output is to specify a file which has its operating
system read only attribute set. <br>

<p>
Examining the contents of the files after the program has executed
should show that, when an existing file which can be written to
is specified as the second argument, the existing contents of
the file are lost and replaced with the new output.<br>
<br>

<p>
<hr>
<h2>
<ul>
<a HREF="numberlist.java" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter12/NumberList.java"><img SRC="..\list.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/list.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="40" HEIGHT="35">
<i>NumberList.java</i> source code</a>.
<p>
<a HREF="chap12p4.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter12/chap12p4.html"><img SRC="..\next.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/next.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
12.4 Homogenous binary streams</a>.
<p>
<a HREF="chap12p2.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter12/chap12p2.html"><img SRC="..\last.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/last.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
12.2 The <i>type</i> application</a>.
</ul>
</h2>
<hr>
</body>

</html>
&#26;