<html>

<head><meta http-equiv="pragma" content="no-cache">

<meta NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.0z">
<title>6.6. The BasicMenu getValidatedMenuChoice() action</title>

</head>

<body BGCOLOR="WHITE">

<h2>6.6. The <i>BasicMenu</i> <i>getValidatedMenuChoice</i>() action
</h2>

<p>
The purpose of the <i>getValidatedMenuChoice</i>() action is to
engage the user in a dialogue, asking them to input a choice from
the menu and deciding if it is, or is not, an acceptable choice.
If the user does not supply an acceptable choice they should be
given advice concerning what responses are acceptable and invited
to try again. The action will not finish until the user has supplied
a validated choice from the menu.
<p>
<center><img SRC="c6p6i1.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter6/c6p6i1.gif" WIDTH="786" HEIGHT="657"></center>
<p>
Obtaining input from the keyboard is one of the most potentially
dangerous parts of a program, as it cannot be known exactly what
the user might actually do. Java recognises this and guards any
input actions with exceptions which the developer must handle.
This is shown on this design as the step <i>obtain&nbsp;char&nbsp;from&nbsp;keyboard</i>
and is implemented as a <i><b>posit/&nbsp;admit</b></i> design
structure. The <i><b>posit</b></i> part of the design assumes
that everything will occur without an exception being thrown while
the <i><b>admit</b></i> recognises that something did go wrong.
Both of these are shown on the design with a <b>?</b> in the top
right hand corner of their boxes, the posit is keyed with a <i><b>p</b></i>
and the admit with an <i><b>a</b></i>. Precise details of posit/&nbsp;admit
design structures will be introduced in Chapter 9. For the time
being the implementation of this action as far as the end of the
posit/&nbsp;admit structure is as follows. <br>

<pre>
0103   <b>protected char</b> <i>getValidatedMenuChoice</i>(){
0104 
0105   String  <i>fromKeyboard</i>      = <b>new</b> String( &quot;&quot;);
0106   <b>char</b>    <i>possibleResponse</i>  = ' ';
0107   <b>boolean</b> <i>isNotGoodResponse</i> = true;  
0108   
0109      System.out.print( &quot;\n&quot; + <i>thePrompt</i> + &quot; &quot;); 
0110      System.out.flush();
0111      
0112      <b>while</b> ( <i>isNotGoodResponse</i>) { 
0113         <b>try</b> { 
0114            <i>fromKeyboard</i> =  <b>new</b> String( <i>keyboard</i>.readLine());
0115            <b>if</b> ( <i>fromKeyboard</i>.length() &gt; 0 ) { 
0116               <i>possibleResponse</i>  = <i>fromKeyboard</i>.charAt( 0);
0117            } <b>else</b> { 
0118               <i>possibleResponse</i>  = ' ';
0119            } // End if.
0120         } <b>catch</b>( java.io.IOException <i>exception</i>) {
0121            // do something
0122         } // end try/catch.
0123
</pre>

<p>
The first part of the action is to output the prompt, accomplished
on lines 0109 to 0110. As the user interface design indicates
that the response is expected to be obtained from the same screen
line a <i><font SIZE="2" FACE="Arial">print()</font></i>, not a
<i><font SIZE="2" FACE="Arial">println()</font></i>, action has
been used to output the prompt. However this will not guarantee
that the prompt will actually be visible to the user at the end
of this action, as it is very common for lines of output not to
be <i><b>flushed</b></i> to the screen until a new line is required.
To ensure that the prompt is certainly visible a call to the <font SIZE="2" FACE="Arial">System.out
flush()</font> action is used. The effect of this call is to make
sure that all characters sent to the screen have definitely been
output.<br>

<p>
The posit/&nbsp;admit design structure is implemented in Java
as a <b><font SIZE="2" FACE="Arial">try/&nbsp;catch</font></b> structure.
The <b><font SIZE="2" FACE="Arial">try</font></b> part corresponds
to the posit and the <b><font SIZE="2" FACE="Arial">catch</font></b>
to the admit. The first action of the try part is to obtain whatever
the user types in at the keyboard using the <font SIZE="2" FACE="Arial">readline()</font>
action on line 0114. The <font SIZE="2" FACE="Arial">readline()</font>
action is in some ways the inverse of a <font SIZE="2" FACE="Arial">println()</font>
action, accepting characters typed at the keyboard until an &lt;ENTER&gt;
keypress is made. The user's response from<font SIZE="2" FACE="Arial">
readline()</font> is used as the argument of a <font SIZE="2" FACE="Arial">String</font>
constructor and the resulting string is referenced by the local
variable <i><font SIZE="2" FACE="Arial">fromKeyboard</font></i>.
<br>

<p>
Assuming that the <font SIZE="2" FACE="Arial">readline()</font>
action does not throw an exception, the next action is to examine
the input provided by the user. It is possible that the user has
just pressed the &lt;ENTER&gt; key without providing a response,
in which case <i><font SIZE="2" FACE="Arial">fromKeyboard</font></i>
will be empty and its length will be zero. If this is the case
the value of the local character variable <i><font SIZE="2" FACE="Arial">possibleResponse</font></i>
is set to a space on line 0118. If the user did supply a response
then the first character, at location 0, is extracted from it
using the <font SIZE="2" FACE="Arial">String charAt()</font> action
on line 0116 and stored in <i>possibleResponse</i>. If no exception
is thrown the <b><font SIZE="2" FACE="Arial">catch</font></b> part
of the <font SIZE="2" FACE="Arial">try/&nbsp;catch</font> structure
is skipped and execution of the action continues with the statements
following the <b><font SIZE="2" FACE="Arial">catch</font></b>, from
line 0123 onwards.<br>

<p>
However, the <font SIZE="2" FACE="Arial">readline()</font> action
may throw a <font SIZE="2" FACE="Arial">java.io.IOException</font>
at line 0114 in which case lines 0115 to 0119 are skipped and
the exception is caught by the <b><font SIZE="2" FACE="Arial">catch</font></b>
statement at line 0120. The statements in the <font SIZE="2" FACE="Arial">catch</font>
part of the structure should attempt to deal with the problem
which has been detected; the techniques for doing this will be
introduced in Chapter 9.  <br>

<p>
The remaining parts of the implementation of this action are as
follows. <br>

<pre>
0124         <i>possibleResponse</i> = Character.toUpperCase( <i>possibleResponse</i>);
0125            
0126         <i>isNotGoodResponse</i> = ( (<i>possibleResponse</i> &lt; <i>minimumValidOption</i>) ||
0127                               (<i>possibleResponse</i> &gt; <i>maximumValidOption</i>) );
0128 
0129         <b>if</b> ( <i>isNotGoodResponse</i> ) { 
0130            System.out.println( &quot;\n Please enter a response between &quot; + 
0131                                              <i>minimumOption</i> + &quot; and &quot; +  
0132                                                     <i>maximumOption</i> + &quot;.&quot;);
0133            System.out.print( &quot;\n&quot; + <i>thePrompt</i> + &quot; &quot;); 
0134            System.out.flush();                                 
0135         } // End if                 
0136      } // End while.
0137      <b>return</b> <i>possibleResponse</i>;    
0138   } // End <i>getValidatedMenuChoice</i>.
</pre>

<p>
The first step in the design is <i>convert&nbsp;to&nbsp;upper&nbsp;case</i>
and this is accomplished on line 0124 with a call to the class-wide
<font SIZE="2" FACE="Arial">Character</font> action <font SIZE="2" FACE="Arial">toUppercase</font>().
This action takes a character as an argument and returns the character
unchanged if it is already an upper case character or it does
not have an upper case equivalent; otherwise the uppercase equivalent
of the character is returned. The effect of line 0124 is to make
sure that, if an alphabetic character is obtained from the user,
it is an upper case character before it is validated. <br>

<p>
The character is validated on lines 0126 and 0127 where the result
of a complex boolean expression is assigned to the local <font SIZE="2" FACE="Arial">boolean</font>
variable <i><font SIZE="2" FACE="Arial">isNotGoodResponse</font></i>.
The expression can be read as &quot;(if) the value of <i>possibleResponse</i>
is less than (&nbsp;&lt;&nbsp;) the value of <i>minimumOption</i>
or (&nbsp;||&nbsp;) the value of <i>possibleResponse</i> is greater
than (&nbsp;&gt;&nbsp;) the value of <i>maximumOption</i>&quot;.
The evaluation of this expression makes use of the <i><b>boolean
or rule</b></i> which combines two boolean values to produce a
single boolean value as shown in Table 6.1.

<p>

<table BORDER="1">

<tr><td WIDTH="95"></td><td WIDTH="95"></td><td COLSPAN="3" WIDTH="284"><center><i><b><font SIZE="2">or</font></b></i></center>
</td><td WIDTH="95"></td><td WIDTH="95"></td><td WIDTH="95"></td><td WIDTH="95">
</td><td WIDTH="95"></td></tr>

<tr><td WIDTH="95"></td><td WIDTH="95"></td><td WIDTH="95"><center><font SIZE="2">left</font></center>
</td><td WIDTH="95"><center><font SIZE="2">right</font></center></td>
<td WIDTH="95"><center><font SIZE="2">result</font></center></td>
<td WIDTH="95"></td><td WIDTH="95"></td><td COLSPAN="3" WIDTH="284"></td>
</tr>

<tr><td WIDTH="95"></td><td WIDTH="95"></td><td WIDTH="95"><center><font SIZE="2">false</font></center>
</td><td WIDTH="95"><center><font SIZE="2">false</font></center></td>
<td WIDTH="95"><center><font SIZE="2">false</font></center></td><td WIDTH="95">
</td><td WIDTH="95"></td><td COLSPAN="3" WIDTH="284"></td></tr>

<tr><td WIDTH="95"></td><td WIDTH="95"></td><td WIDTH="95"><center><font SIZE="2">true</font></center>
</td><td WIDTH="95"><center><font SIZE="2">false</font></center></td>
<td WIDTH="95"><center><font SIZE="2">true</font></center></td><td WIDTH="95">
</td><td WIDTH="95"></td><td COLSPAN="3" WIDTH="284"></td></tr>

<tr><td WIDTH="95"></td><td WIDTH="95"></td><td WIDTH="95"><center><font SIZE="2">false</font></center>
</td><td WIDTH="95"><center><font SIZE="2">true</font></center></td>
<td WIDTH="95"><center><font SIZE="2">true</font></center></td><td WIDTH="95">
</td><td WIDTH="95"></td><td COLSPAN="3" WIDTH="284"></td></tr>

<tr><td WIDTH="95"></td><td WIDTH="95"></td><td WIDTH="95"><center><font SIZE="2">true</font></center>
</td><td WIDTH="95"><center><font SIZE="2">true</font></center></td>
<td WIDTH="95"><center><font SIZE="2">true</font></center></td><td WIDTH="95">
</td><td WIDTH="95"></td><td COLSPAN="3" WIDTH="284"></td></tr>

</table>

<p>
<center>Table 6.1. The boolean or rule. </center>
<p>
The or rule can be summarised by saying the resulting expression
is true if either or both the sub-expressions are true. This rule
can be investigated in the context of this action by considering
the effects when the user enters either '@', 'A', 'C' or 'D' when
<i>minimumOption</i> and <i>maximumOption</i> have the values
'A' and 'C' respectively. The value '@' was chosen as it is the
character whose value is immediately less than that of 'A', and
'D' as it is the character whose value is immediately greater
than that of 'C'. The evaluation of the combined expression is
shown in Table 6.2.

<p>

<table BORDER="1">

<tr>
<td WIDTH="97"></td>
<td WIDTH="95"><center><font SIZE="2">possibleResponse</font></center></td>
<td WIDTH="213"><center><font SIZE="2">possibleResponse &lt;minimumOption ('A')</font></center></td>
<td WIDTH="213"><center><font SIZE="2">possibleResponse &gt;maximumOption ('C')</font></center></td>
<td WIDTH="47"><center><font SIZE="2">result</font></center></td>
<td WIDTH="95"></td>
<td WIDTH="95"></td>
</tr>

<tr><td WIDTH="47"></td><td WIDTH="95"><center><font SIZE="2">'@'</font></center>
</td><td WIDTH="213"><center><font SIZE="2">true</font></center></td>
<td WIDTH="213"><center><font SIZE="2">false</font></center></td>
<td WIDTH="95"><center><font SIZE="2">true</font></center></td><td WIDTH="95">
</td><td WIDTH="95"></td><td WIDTH="95"></td></tr>

<tr><td WIDTH="47"></td><td WIDTH="95"><center><font SIZE="2">'A'</font></center>
</td><td WIDTH="213"><center><font SIZE="2">false</font></center>
</td><td WIDTH="213"><center><font SIZE="2">false</font></center>
</td><td WIDTH="95"><center><font SIZE="2">false</font></center></td>
<td WIDTH="95"></td><td WIDTH="95"></td><td WIDTH="95"></td></tr>

<tr><td WIDTH="47"></td><td WIDTH="95"><center><font SIZE="2">'C'</font></center>
</td><td WIDTH="213"><center><font SIZE="2">false</font></center>
</td><td WIDTH="213"><center><font SIZE="2">false</font></center>
</td><td WIDTH="95"><center><font SIZE="2">false</font></center></td>
<td WIDTH="95"></td><td WIDTH="95"></td><td WIDTH="95"></td></tr>

<tr><td WIDTH="47"></td><td WIDTH="95"><center><font SIZE="2">'D'</font></center>
</td><td WIDTH="213"><center><font SIZE="2">false</font></center>
</td><td WIDTH="213"><center><font SIZE="2">true</font></center></td>
<td WIDTH="95"><center><font SIZE="2">true</font></center></td><td WIDTH="95">
</td><td WIDTH="95"></td><td WIDTH="95"></td></tr>

</table>

<p>
<center>Table 6.2. The <b>or</b> rule in the <i>offerMenuAsChar</i> action.</center>
<p>
This table shows that the combined expression is false only when
the user enters 'A' or 'C', and by implication 'B'; the expression
is true in all other circumstances. The resulting boolean value
is assigned to the local boolean variable <i><font SIZE="2" FACE="Arial">isNotGoodResponse</font></i>
and is used in the next step of the design to decide if a helpful
message should be output. <br>

<p>
The implementation of the <i>possibly&nbsp;offer&nbsp;advice</i>
step is on lines 0129 to 0135 and uses the value of <i><font SIZE="2" FACE="Arial">isNotGoodResponse</font></i>
as the condition of an <b>if</b> structure. Thus if the user entered
an acceptable response the value of <i><font SIZE="2" FACE="Arial">isNotGoodResponse</font></i>
will be <b><font SIZE="2" FACE="Arial">false</font></b> and the
message will not be output. Otherwise <i><font SIZE="2" FACE="Arial">isNotGoodResponse</font></i>
will be <b><font SIZE="2" FACE="Arial">true</font></b> and the advice
will be given. The advice is constructed by catenating together
various messages with the values of <i><font SIZE="2" FACE="Arial">minimumOption</font></i>
and <i><font SIZE="2" FACE="Arial">maximumOption</font></i> to produce
an output something like this. 

<p>

<hr>
<pre>
        Please enter a response between A and C.</font>
</pre>
<hr>

<p>
Following the output of the advice the prompt is again issued
and flushed to the screen ready for the next response from the
user.<br>

<p>
Line 0136, immediately following the end if on line 0135, is commented
as the end of the <b><font SIZE="2" FACE="Arial">while</font></b>
loop structure which started on line 0112. When the menu options
were being output Java was able to decide from the array <font SIZE="2" FACE="Arial">length</font>
attribute how many times the loop would have to iterate. However
in this action there is no way that Java can know how many times
the loop is to iterate until an acceptable response is obtained
from the user. The difference between these two situations is
the difference between a definite (&nbsp;<b><font SIZE="2" FACE="Arial">for</font></b>&nbsp;)
loop and an indefinite (&nbsp;<b><font SIZE="2" FACE="Arial">while</font></b>&nbsp;)
loop. The general form of a <b><font SIZE="2" FACE="Arial">while</font></b>
loop is as follows. <br>

<pre>
		<b>while</b> ( Condition) { 
		   // Loop body.
		} // End loop.<br>

</pre>

<p>
The effect of this structure, when it is executed, is that the
<i>Condition</i> is first evaluated and if it is <b><font SIZE="2" FACE="Arial">true</font></b>
the loop terminates without the <i>Loop&nbsp;Body</i> actions
ever being executed. Otherwise the <i>Loop&nbsp;Body</i> actions
are executed and then the condition is evaluated again. Should
the condition again evaluate <b><font SIZE="2" FACE="Arial">true</font></b>
this pattern will repeat indefinitely until (hopefully) at some
stage the condition will evaluate <b><font SIZE="2" FACE="Arial">false</font></b>,
causing the loop to terminate. <br>

<p>
In the context of this action, the local boolean variable <i><font SIZE="2" FACE="Arial">isNotGoodResponse</font></i>
is declared with the initial value <b><font SIZE="2" FACE="Arial">true</font></b>,
which causes the <b><font SIZE="2" FACE="Arial">while</font></b>
condition on line 0112 to evaluate <b><font SIZE="2" FACE="Arial">true</font></b>
when it is encountered for the first time. This will ensure that
at least one response is obtained from the user and assuming that
it is not acceptable the value of <i><font SIZE="2" FACE="Arial">isNotGoodResponse</font></i>
will be set <b><font SIZE="2" FACE="Arial">true</font></b> again,
on lines 0126 and 0127, causing the advice to be output and the
<b><font SIZE="2" FACE="Arial">while</font></b> condition to be
re-evaluated. <br>

<p>
As the re-evaluation will still be <b><font SIZE="2" FACE="Arial">true</font></b>,
the loop will iterate for a second time obtaining another response
from the user. This could again be an unacceptable response which
will cause exactly the same pattern of events to occur, leading
to a third response being obtained from the user. This process
will continue indefinitely until the user eventually provides
an acceptable response. This will cause the value of <i><font SIZE="2" FACE="Arial">isNotGoodResponse</font></i>
to be set <b><font SIZE="2" FACE="Arial">false</font></b> on lines
0126 and 0127, causing the advice not to be output and the <b><font SIZE="2" FACE="Arial">while</font></b>
condition to evaluate <b><font SIZE="2" FACE="Arial">false</font></b>,
terminating the loop.<br>

<p>
When the <b><font SIZE="2" FACE="Arial">while</font></b> loop terminates
the final part of this action is, on line 0137, to <b><font SIZE="2" FACE="Arial">return</font></b>
the value of <i><font SIZE="2" FACE="Arial">possibleResponse</font></i>,
which is now known to be a valid choice from the menu, as the
result of the action. <br>
<br>

<p>
<hr>
<h2>
<ul>
<a HREF="chap6p7.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter6/chap6p7.html"><img SRC="..\next.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/next.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
6.7 The <i>BasicMenu</i> <i>offerMenuAsChar()</i> and<i> offerMenuAsInt()</i> actions</a>.
<p>
<a HREF="chap6p5.html" tppabs="http://www.scism.sbu.ac.uk/jfl/Chapter6/chap6p5.html"><img SRC="..\last.gif" tppabs="http://www.scism.sbu.ac.uk/jfl/last.gif" ALIGN="MIDDLE" BORDER="0" WIDTH="50" HEIGHT="40">
6.5 The <i>BasicMenu</i> <i>showMenu</i>() action, and its supporting actions</a>.
</ul>
</h2>
<hr></b>

</body>

</html>
&#26;