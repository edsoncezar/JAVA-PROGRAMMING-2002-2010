<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPad 2.0">
<title> 6.7 The ExitDialog class </title>
</head>

<body bgcolor="#FFFFFF">

<h1 align="center">6.7 The<font size="7"> </font><font size="5"
face="Arial"><i>ExitDialog</i></font><font size="6"> class </font></h1>

<p>The <font size="2" face="Arial"><i>exitDialog</i></font> used
by the <font size="2" face="Arial"><i>MenuBarTuttle</i></font>
class, attached to the <i>File</i> menu <i>Exit&nbsp;&#133;</i>
item, is an instance of the <font size="2" face="Arial"><i>ExitDialog</i></font>
class whose appearance and behaviour is shown in Figure 6.7.</p>

<p align="center"><b><img src="fig67.gif" width="519"
height="324"></b></p>

<p align="center"><b>Figure 6.7</b> The <font face="Arial"><i>ExitDialog</i></font>
appearance and behavior.</p>

<p>The dialog is posted in a modal manner, in response to the
user pressing the <i>Exit</i>&nbsp;&#133; item on the <i>File</i>
menu. It is appropriate for this dialog to be presented to the
user in a modal manner as the possibility of an application
terminating is sufficiently important for the user to be forced
to attend to it. Once posted pressing either of the buttons will
un-post the dialog causing a transition to the STD's terminal
state. If the <i>yes</i> button is pressed this transition will
generate an action event, allowing the <font size="2"
face="Arial"><i>MenuBarTuttle</i></font> class to be informed
that the user indicated that the application should be shut down.</p>

<p>The dialog is constructed with a <font size="2" face="Arial"><i>MessageCanvas</i></font>
instance, as described in Chapter 3, containing a two line
message mounted in its &quot;<i>Center</i><font size="2"
face="Arial">&quot;</font> location and a <font size="2"
face="Arial">Panel</font> containing the two <font size="2"
face="Arial">Button</font>s in its &quot;<i>South&quot;</i>
location. The <font size="2" face="Arial"><i>ExitDialog</i></font>
instance attribute declarations and constructor are as follows. </p>

<pre><font size="3">0018  <b>class</b> <i>ExitDialog</i> <b>extends</b>    Dialog 
0019                   <b>implements</b> ActionListener { 
0020  
0021  <b>private</b> Window          <i>itsParentWindow</i>;
0022  <b>private</b> ActionListener  <i>itsListener</i>;
0023  
0024  <b>private</b> Panel            <i>buttonPanel</i>;
0025  <b>private</b> MessageCanvas    <i>message</i>;                      
0026  <b>private</b> Button           <i>yesButton</i>;
0027  <b>private</b> Button           <i>noButton</i>; 
0028  
0029     <b>protected</b> ExitDialog( Frame          <i>itsParentFrame</i>,
0030                           ActionListener <i>listener</i>) { 
0031                                       
0032        <b>super</b>( <i>itsParentFrame</i>, &quot;Exit&quot;, <b>true</b>);
0033        <b>this</b>.setFont( <i>itsParentFrame</i>.getFont());
0034        <b>this</b>.setBackground( <i>itsParentFrame</i>.getBackground());
0035        <i>itsParentWindow</i> = (Window) <i>itsParentFrame</i>;
0036        <i>itsListener</i> = <i>listener</i>;
0037  
0038        <i>message</i> = <b>new</b> MessageCanvas( &quot;Are you sure\nyou want to exit?&quot;);
0039        <i>message</i>.setBackground( Color.white);
0040  
0041        <i>buttonPanel</i> = <b>new</b> Panel();
0042        <i>buttonPanel</i>.setBackground( Color.white);
0043        
0044        <i>yesButton</i> = <b>new</b> Button( &quot;yes&quot;);      
0045        <i>yesButton</i>.setActionCommand(&quot;yes&quot;); 
0046        <i>yesButton</i>.addActionListener( <b>this</b>); 
0047        <i>buttonPanel</i>.add( <i>yesButton</i>);
0048  
0049        <i>noButton</i> = <b>new</b> Button( &quot;no&quot;); 
0050        <i>noButton</i>.setActionCommand(&quot;no&quot;); 
0051        <i>noButton</i>.addActionListener( <b>this</b>);            
0052        <i>buttonPanel</i>.add( <i>noButton</i>);
0053  
0054        <b>this</b>.add( <i>message</i>,     &quot;Center&quot;);
0055        <b>this</b>.add( buttonPanel, &quot;South&quot;);
0056        <b>this</b>.pack();
0057     } // End <i>ExitDialog</i> constructor.</font></pre>

<p>The constructor commences, on line 0032, by calling its parent
(<font size="2" face="Arial"><b>super</b></font>) constructor,
specifying as the first argument the <font size="2" face="Arial">Frame</font>
instance which this dialog window is to be associated with. This
argument is received as the first argument of the <font size="2"
face="Arial"><i>ExitDialog</i></font> constructor. The remaining
two arguments of the <font size="2" face="Arial">Frame</font>
constructor call are the title to be used for the dialog window
and the modal state (<font size="2" face="Arial"><b>true</b></font>)
of the dialog. The constructor continues, on lines 0033 and 0034,
by configuring the appearance of the dialog and, on lines 0035
and 0036, storing the identities of the arguments to the
constructor in instance attributes. </p>

<p>Lines 0038 to 0056 then construct, configure and assemble the
components of the dialog: a <font size="2" face="Arial"><i>MessageCanvas</i></font>
instance in its &quot;<i>Center</i>&quot; location and a <font
size="2" face="Arial">Panel</font> containing two buttons in the
&quot;<i>South</i>&quot; location, producing the appearance shown
in Figure 6.7. The <font size="2" face="Arial">ActionListener</font>
of both buttons is specified as the <font size="2" face="Arial"><i>ExitDialog</i></font>
instance itself, which accordingly declares itself to implement
the <font size="2" face="Arial">ActionListener</font> interface.
The constructor creates the dialog ready for use but it does not
become visible to the user until its <font size="2" face="Arial"><i>setVisible()</i></font>
method, implemented as follows, is called with a <font size="2"
face="Arial"><b>true</b></font> argument. </p>

<pre><font size="3">0063     <b>protected void</b> <i>setVisible</i>( <b>boolean</b> <i>showIt</i>) { 
0064     
0065     Point      <i>itsParentsLocation</i>;
0066     Dimension  <i>itsParentsSize</i>;
0067     Point      <i>itsLocation</i>;
0068     Dimension  <i>itsSize</i>;
0069  
0070        <b>if</b> ( <i>showit</i>) { 
0071           <i>itsParentsLocation</i> = <i>itsParentWindow</i>.getLocationOnScreen();
0072           <i>itsParentsSize</i>     = <i>itsParentWindow</i>.getSize();
0073           <i>itsSize</i>            = <b>this</b>.getSize();
0074           <i>itsLocation</i>        = <b>new</b> Point();
0075        
0076           <i>itsLocation</i>.x = <i>itsParentsLocation</i>.x + 
0077                           <i>itsParentsSize</i>.width/2 - 
0078                           <i>itsSize</i>.width/2;
0079           <i>itsLocation</i>.y = <i>itsParentsLocation</i>.y + 
0080                           <i>itsParentsSize</i>.height/2 - 
0081                           <i>itsSize</i>.height/2;                          
0082           <b>this</b>.setLocation( <i>itsLocation</i>);             
0083        } // End if.
0084        <b>super</b>.setVisible( <i>showIt</i>);            
0085     } // End <i>show</i>.</font></pre>

<p>The <font size="2" face="Arial"><b>boolean</b> <i>showIt</i></font>
argument indicates if the dialog should be made visible to the
user or hidden from them. This method only need be concerned with
intervening when the dialog is to be shown and the <font size="2"
face="Arial"><b>if</b></font> structure between lines 0070 to
0083 effects this. The contents of this decision are identical
with a part of the implementation of the <font size="2"
face="Arial"><i>PostItNote setVisible()</i></font> method in
Chapter 3, and ensures that the dialog is always presented to the
user centered within its parent, <font size="2" face="Arial"><i>MenuBarTuttle</i></font>,
window. Following the <font size="2" face="Arial"><b>if</b></font>
structure, on line 0084, the parent, <font size="2" face="Arial">Dialog</font>,
<font size="2" face="Arial">setVisible()</font> method is
indirected to passing onward the <font size="2" face="Arial"><i>showIt</i></font>
argument to actually make the dialog visible, or hide it if <font
size="2" face="Arial"><i>showIt</i></font> is <font size="2"
face="Arial"><b>false</b></font>. </p>

<p>The only other method of the <font size="2" face="Arial"><i>ExitDialog</i></font>
class is the <font size="2" face="Arial"><i>actionPerformed()</i></font>
method, as follows. </p>

<pre><font size="3">0085     <b>public void</b> <i>actionPerformed</i>( ActionEvent <i>event</i>) {
0086        <b>this</b>.setVisible( <b>false</b>);
0087        <b>if</b> ( <i>event</i>.getActionCommand().equals( &quot;yes&quot;)) { 
0088           <i>itsListener</i>.<i>actionPerformed</i>( <b>new</b> ActionEvent( <b>this</b>, 
0089                                        ActionEvent.ACTION_PERFORMED,
0090                                        &quot;exit please&quot;));        
0091        } // End if.   
0092     } // End <i>actionPerformed</i>.       
0093  } // End <i>ExitDialog</i>.</font></pre>

<p>This method can only be called in response to a press of
either of the buttons on the <font size="2" face="Arial">ExitDialog</font>
and commences by calling the <font size="2" face="Arial"><i>ExitDialog</i></font>'s
<font size="2" face="Arial">setVisible()</font> method, with the
argument <font size="2" face="Arial"><b>false</b></font>, to
un-post it from the desktop. If this method was called as a
consequence of the &quot;<i>yes</i>&quot; button being pressed
the user has confirmed that the <font size="2" face="Arial">applet</font>
should terminate. This results, on lines 0088 to 0090, in the <font
size="2" face="Arial"><i>actionPerformed()</i></font> method of
the <font size="2" face="Arial">ActionListener</font> passed to
the constructor being called with an <font size="2" face="Arial">ActionEvent</font>
argument containing the <font size="2" face="Arial">commandString</font>
&quot;<i>exit&nbsp;please</i>&quot;.</p>

<p>The <font size="2" face="Arial"><i>MenuBarTuttle</i></font>
constructs its <font size="2" face="Arial"><i>exitDialog</i></font>
instance at the end of its <font size="2" face="Arial"><i>init()</i></font>
method as follows. </p>

<pre><font size="3">0065        <i>exitDialog</i> = <b>new</b> ExitDialog( <i>tuttleFrame</i>, <b>this</b>); 
</font></pre>

<p>Hence the identity of the <font size="2" face="Arial"><i>ActionListener</i></font>
to which the <font size="2" face="Arial"><i>ActionEvent</i></font>
is dispatched when the &quot;<i>yes</i>&quot; button is pressed
is the <font size="2" face="Arial"><i>MenuBarTuttle</i></font>
instance, whose processing of &quot;<i>exit</i>&quot; commands
within its <font size="2" face="Arial"><i>performAction()</i></font>
method, given in detail above, is as follows. </p>

<pre><font size="3">0083        <b>if</b> ( <i>theCommand</i>.equals( &quot;exit&quot;)) { 
0084           <b>if</b> ( <i>theArgument</i>.equals( &quot;show&quot;)) {          
0085              <i>exitDialog</i>.setVisible( <b>true</b>); 
0086           } <b>else if</b> ( <i>theArgument</i>.equals( &quot;please&quot;)) { 
0087              System.exit( 0);
0088           } // End if.      </font></pre>

<p>The <i>Exit</i>&nbsp;&#133; button on the <i>File</i> menu of
the interface will send the <font size="2" face="Arial"><i>commandString</i></font>
&quot;<i>exit&nbsp;show</i>&quot; to this method and this will
result, in line 0085, in the <font size="2" face="Arial"><i>exitDialog
setVisible()</i></font> method being called, with the argument <font
size="2" face="Arial"><b>true</b></font>, making the dialog
visible to the user in the middle of the applet's window. If the
user confirms that the applet should terminate this method will
be called again with the <font size="2" face="Arial"><i>commandString</i></font>
&quot;<i>exit&nbsp;please</i>&quot;, resulting in the <font
size="2" face="Arial">System.exit()</font> call, on line 0087,
terminating the applet. The argument 0 to the <font size="2"
face="Arial">exit()</font> method call indicating that the
application concluded normally.</p>

<p>A common novice's design error would be to call the <font
size="2" face="Arial">System.exit()</font> method within the <font
size="2" face="Arial"><i>ExitDialog</i></font>'s implementation.
With this approach the applet is not made aware that the user has
confirmed that the applet should conclude before it terminates
and so has no opportunity to tidy up, for example closing any
open streams, before the applet finishes. </p>

<hr>

<blockquote>
    <p><b><i>Design Advice</i></b> </p>
    <p>Only the applet, or application, class should be
    responsible for finishing and should conclude gracefully
    closing any streams and releasing any other resources as
    required. </p>
</blockquote>

<hr>

<p>As the applet stands at the moment the application can also be
immediately terminated by using the appletviewer's window frame
exit control. In the Windows '95 illustrations used in this book
this is the X button at the top right. To prevent this from
happening, or cause it to happen in some environments, the <font
size="2" face="Arial">WindowEvent</font>s dispatched to the <font
size="2" face="Arial">Frame</font> will have to be intercepted
and handled. To accomplish this, the declaration of the <font
size="2" face="Arial"><i>MenuBarTuttle</i></font> class will have
to be amended to indicate that it implements the <font size="2"
face="Arial">WindowListener</font> interface, as follows. </p>

<pre><font size="3">0022  <b>public class</b> <i>MenuBarTuttle</i> <b>extends</b>    Applet 
0023                             <b>implements</b> ActionListener, 
0024                                        WindowListener {</font></pre>

<p>The <font size="2" face="Arial"><i>tuttleFrame</i></font> will
have to be informed of the identity of its <font size="2"
face="Arial">WindowListener</font> object by calling its <font
size="2" face="Arial">addWindowListener()</font> method, as
follows. </p>

<pre><font size="3">0047      <i>tuttleFrame</i>.addWindowListener( <b>this</b>);</font></pre>

<p>Having done this the <font size="2" face="Arial"><i>MenuBarTuttle</i></font>
class will have to supply the seven methods required by the <font
size="2" face="Arial">WindowListener</font> interface of which
only one, the <font size="2" face="Arial"><i>windowClosing(),</i></font>
method need actually do anything. The implementation of these
method is as follows. </p>

<pre><font size="3">0168   <b>public void</b> <i>windowClosing</i>( WindowEvent <i>event</i>) {  
0169      <i>exitDialog</i>.setVisible( <b>true</b>);     
0170   } // End <i>windowClosing</i> .
0171   
0172   <b>public void</b> windowOpened( WindowEvent <i>event</i>)      {} // End <i>windowOpened</i>.    
0173   <b>public void</b> windowClosed( WindowEvent <i>event</i>)      {} // End <i>windowClosed.
</i>0174   <b>public void</b> windowIconified( WindowEvent <i>event</i>)   {} // End <i>windowIconified.
</i>0175   <b>public void</b> windowDeiconified(WindowEvent <i>event</i>)  {} // End <i>windowDeiconified</i>.  
0176   <b>public void</b> windowActivated( WindowEvent <i>event</i>)   {} // End <i>windowActivated.
</i>0177   <b>public void</b> windowDeactivated( WindowEvent <i>event</i>) {} // End <i>windowDeactivated.</i>   </font></pre>

<p>The <font size="2" face="Arial"><i>windowClosing()</i></font>
method calls the <font size="2" face="Arial"><i>exitDialog
setVisible()</i></font> method to post the dialog onto the
desktop and as it does not dispatch to its <font size="2"
face="Arial"><b>super</b></font> <font size="2" face="Arial"><i>windowClosing()</i></font>
method prevents the window from actually closing. The remaining
six methods are dummy methods which do nothing, but have to be
supplied in order to satisfy the <font size="2" face="Arial">WindowListener</font>
interface, and have been laid out in a manner which emphasizes
this to anyone reading the code. The consequence of these changes
is that when the exit control on the <font size="2" face="Arial">Frame</font>
is pressed the <font size="2" face="Arial"><i>exitDialog</i></font>
will be posted and only if the user confirms the exit by pressing
the &quot;<i>yes</i>&quot; button will the <font size="2"
face="Arial">applet</font> actually terminate. </p>

<p>In this implementation the only instance attributes which
strictly require visibility outside the scope of the constructor
are <font size="2" face="Arial"><i>itsParentWindow</i></font>,
required by the <font size="2" face="Arial"><i>setVisible()</i></font>
method, and <font size="2" face="Arial"><i>itsListener</i></font>,
required by the <font size="2" face="Arial"><i>actionPerformed()</i></font>
method. However Java has a rule that when a constructor calls its
parent (<font size="2" face="Arial"><b>super</b></font>)
constructor, this call has to be the very first statement in the
constructor. This rule prevents the remaining instance
declarations, on lines 0024 to 0027, from being declared as local
variables of the constructor. A more elegant solution would be to
include an additional private <font size="2" face="Arial"><i>constructDialog()</i></font>
method within the class, declaring the components as local
variables, and calling the method from the constructor; but in a
class a simple as this declaring them as private instance
attributes seems acceptable.</p>

<p>&nbsp;</p>

<hr>

<blockquote>
    <p><a href="..\tuttles\menubartuttle\exitdialog.java"><font
    size="5"><img src="list.gif" align="middle" border="0"
    width="40" height="35"> ExitDialog.java</font></a></p>
</blockquote>

<hr>

<blockquote>
    <p><a href="ch68.html"><img src="next.gif" align="middle"
    border="0" width="50" height="40"><font size="5">6.8 The </font><font
    size="4" face="Arial"><i>VersionDialog</i></font><font
    size="7"> </font><font size="5">class</font></a><font
    size="7"> </font></p>
    <p><a href="ch66.html"><font size="4"><img src="last.gif"
    align="middle" border="0" width="50" height="40"></font><font
    size="5">6.6 The</font><font size="7"> </font><font size="4"
    face="Arial">Dialog</font><font size="5"> class</font></a></p>
</blockquote>

<hr>
</body>
</html>
