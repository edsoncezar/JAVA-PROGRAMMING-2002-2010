<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPad 2.0">
<title> 3.12 The DatePanel class </title>
</head>

<body bgcolor="#FFFFFF">

<h1 align="center"><font size="6">3.12 The </font><font size="6"
face="Arial"><i>DatePanel</i></font><font size="6"> class</font></h1>

<p>The <font size="2" face="Arial"><i>DatePanel</i></font> class
has to implement the entire interface shown in Figure 3.7 and
designed in Figure 3.11, including an instance of the <font
size="2" face="Arial"><i>MonthPanel</i></font> class. It is
responsible for configuring the <font size="2" face="Arial"><i>MonthPanel</i></font>
when it is first constructed and for reconfiguring it whenever
the year or month is changed by user. It is also responsible for
generating an action event every time the user changes the date,
and for providing inquiry methods to allow a client to determine
what the date has been changed to. It also offers the set of
methods, <font size="2" face="Arial"><i>setCommandString()</i></font>,
<font size="2" face="Arial"><i>getCommandString()</i></font>, <font
size="2" face="Arial"><i>addActionListener()</i></font> and <font
size="2" face="Arial"><i>removeActionListener()</i></font> which
allow it to be used by a client in a manner essentially identical
to pre-supplied AWT components, such as <font size="2"
face="Arial">Button</font>, which also generate <font size="2"
face="Arial">ActionEvent</font>s for arbitrary components to
listen to. The <font size="2" face="Arial"><i>DatePanel</i></font>
class diagram is given in Figure 3.15.</p>

<p align="center"><b><img src="fig315.gif" width="497"
height="761"></b></p>

<p align="center"><b>Figure 3.15</b> The <font face="Arial"><i>DatePanel</i></font>
class diagram.</p>

<p>The first, default, constructor will create a <font size="2"
face="Arial"><i>DatePanel</i></font> showing the current date.
The second constructor allows a particular date to be specified
and the <font size="2" face="Arial"><i>setDate()</i></font>
method allows a particular date to be set once an instance has
been created. The <font size="2" face="Arial"><i>yearIs()</i></font>,
<font size="2" face="Arial"><i>monthIs()</i></font> and <font
size="2" face="Arial"><i>dayIs()</i></font> methods will return
the current settings of the interface. </p>

<p>The <font size="2" face="Arial"><i>actionPerformed()</i></font>
method and <font size="2" face="Arial"><i>itemStateChanged()</i></font>
methods are needed to satisfy the requirements of the <font
size="2" face="Arial"><i>ActionListener</i></font> and the <font
size="2" face="Arial"><i>ItermListener</i></font> interfaces
respectively. It has to implement these interfaces as it listens
to the <font size="2" face="Arial">ItemSelectedEvent</font>s
events generated by its own <font size="2" face="Arial">Choice</font>
components and also listens to the <font size="2" face="Arial">ActionEvent</font>s
generated by its own <font size="2" face="Arial"><i>MonthPanel</i></font>
component. The final four public methods are needed for this
component to interoperate with other AWT <font size="2"
face="Arial">Component</font>s as explained above. The
implementation of this class as far as the end of its first
constructor is as follows. </p>

<pre><font size="3">0001  // Filemake <i>DatePanel.java</i>.
0002  // Provides an interactive calendar panel allowing
0003  // safe an unambiguous input of a calendar date.
0004  //
0005  // Written for JI book, Chapter 3 see text.
0006  // Fintan Culwin, v 0.2, August 1997.
0007  
0008  <b>package</b> <i>DatePanel</i>;
0009  
0010  <b>import</b> java.awt.*;
0011  <b>import</b> java.awt.event.*;
0012  
0013  <b>import</b> <i>DatePanel.DateUtility</i>;
0014  <b>import</b> <i>DatePanel.MonthPanel</i>;
0015  
0016  <b>public class</b> <i>DatePanel</i> <b>extends</b>    Panel 
0017                         <b>implements</b> ActionListener, ItemListener { 
0018  
0019  <b>private</b> <i>MonthPanel</i> <i>monthPanel</i>;
0020  <b>private</b> Choice     <i>centuryChoice</i>;
0021  <b>private</b> Choice     <i>decadeChoice</i>;
0022  <b>private</b> Choice     <i>yearChoice</i>;
0023  <b>private</b> Choice     <i>monthChoice</i>;
0024
0025  <b>private</b> String         <i>actionCommand</i> = <b>null</b>;
0026  <b>private</b> ActionListener <i>itsListener</i>;
0027  
0028  <b>private static</b> String <i>monthNames</i>[] = { &quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;,
0029                                         &quot;May&quot;, &quot;Jne&quot;, &quot;Jly&quot;, &quot;Aug&quot;, 
0030                                         &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot; };
0031  
0032     <b>public</b> <i>DatePanel</i>() {
0033     
0034        <b>this</b>( <i>DateUtility</i>.<i>yearIs</i>(),
0035              <i>DateUtility.monthIs</i>(),
0036              <i>DateUtility.dayOfMonthIs</i>());
0037     } // End <i>DatePanel</i> default constructor.
0038  </font></pre>

<p>The default constructor, on lines 0032 to 0037, indirects to
the alternative constructor passing the current year, month and
day number, obtained from the <font size="2" face="Arial"><i>DateUtility</i></font>
class. In the alternative constructor the components indicated in
Figure 3.11 are constructed and assembled as follows. </p>

<pre><font size="3">0040     <b>public</b> <i>DatePanel</i>( <b>int</b> <i>year</i>, <b>int</b> <i>month</i>, <b>int</b> <i>day</i>) {
0041    
0042     <b>int</b>    <i>thisOne</i>;
0043     Panel  <i>topPanel</i>        = <b>new</b> Panel();
0044     Panel  <i>topLeftPanel</i>    = <b>new</b> Panel();
0045     Panel  <i>topRightPanel</i>   = <b>new</b> Panel();   
0046     
0047       <b>this</b>.setLayout(          <b>new</b> BorderLayout( 4, 4));
0048       <i>topPanel</i>.setLayout(      <b>new</b> GridLayout( 1, 2, 4, 4));
0049       <i>topLeftPanel</i>.setLayout(  <b>new</b> FlowLayout( FlowLayout.CENTER, 4, 4));
0050       <i>topRightPanel</i>.setLayout( <b>new</b> FlowLayout( FlowLayout.CENTER, 4, 4));
0051       
0052       <i>monthPanel</i> = <b>new</b> <i>MonthPanel</i>( <b>this</b>);
0053       
0054       <i>centuryChoice</i>  = <b>new</b> Choice();
0055       <i>centuryChoice</i>.addItemListener( <b>this</b>);
0056       <i>centuryChoice</i>.addItem( &quot;19&quot;);
0057       <i>centuryChoice</i>.addItem( &quot;20&quot;);
0058       <i>centuryChoice</i>.addItem( &quot;21&quot;);
0059       
0060       <i>decadeChoice</i> = <b>new</b> Choice();
0061       <i>decadeChoice</i>.addItemListener( <b>this</b>);
0062  
0063       <i>yearChoice</i>   = <b>new</b> Choice();
0064       <i>yearChoice</i>.addItemListener( <b>this</b>);
0065  
0066       <b>for</b> ( <i>thisOne</i> = 0; <i>thisOne</i> &lt; 10; <i>thisOne</i>++){ 
0067           <i>decadeChoice</i>.addItem( Integer.toString( <i>thisOne</i>));
0068           <i>yearChoice</i>.addItem( Integer.toString(   <i>thisOne</i>));
0069       } // End for.
0070  
0071       <i>monthChoice</i>   = <b>new</b> Choice();
0072       <i>monthChoice</i>.addItemListener( <b>this</b>);
0073       <b>for</b> ( <i>thisOne</i> = 0; <i>thisOne</i> &lt; 12; <i>thisOne</i>++){ 
0074           <i>monthChoice</i>.addItem( <i>monthNames</i>[ <i>thisOne</i>]);
0075       } // End for.
0076       
0077       <i>topLeftPanel</i>.add( <i>centuryChoice</i>);
0078       <i>topLeftPanel</i>.add( <i>decadeChoice</i>);
0079       <i>topLeftPanel</i>.add( <i>yearChoice</i>);
0080  
0081       <i>topRightPanel</i>.add( <i>monthChoice</i>);
0082  
0083       <i>topPanel</i>.add( <i>topLeftPanel</i>);
0084       <i>topPanel</i>.add( <i>topRightPanel</i>);    
0085       <b>this</b>.add( <i>topPanel</i>,   &quot;North&quot;);
0086       <b>this</b>.add( <i>monthPanel</i>, &quot;Center&quot;);
0087       
0088       <b>this</b>.<i>setDate</i>( <i>year</i>, <i>month</i>, <i>day</i>);
0089     } // End <i>DatePanel</i> constructor.</font></pre>

<p>The constructor commences by constructing the three <font
size="2" face="Arial">Panel</font>s indicated in Figure 3.11, on
lines 0043 to 0045 and, together with the <font size="2"
face="Arial">Applet Panel</font>, have appropriate layouts
specified on lines 0047 to 0050. The <font size="2" face="Arial"><i>monthPanel</i></font>
is constructed on line 0052 with its <font size="2" face="Arial">ActionListener</font>
specified as itself. The <font size="2" face="Arial"><i>centuryChoice</i>
Choice</font> component is constructed on lines 0054 to 0058 with
its <font size="2" face="Arial">ItemListener</font> specified as
itself and three <font size="2" face="Arial">Item</font>s
indicating the centuries added to it. The loop on lines 0066 to
0069 populates the <font size="2" face="Arial"><i>decadeChoice</i></font>
and <font size="2" face="Arial"><i>yearChoice</i></font> <font
size="2" face="Arial">Choice</font> components, which are
constructed on lines 0060 and 0063, with their <font size="2"
face="Arial">ItemListener</font>s also specified as the <font
size="2" face="Arial"><i>DatePanel</i></font> currently being
constructed. The <font size="2" face="Arial"><i>monthChoice</i></font>
is then constructed, has itself registered as its listener, and
is populated on lines 0071 to 0075 using <font size="2"
face="Arial">String</font>s obtained from the class wide <font
size="2" face="Arial"><i>monthNames[]</i></font> array which was
declared on lines 0028 to 0030.</p>

<p>Having constructed all the constituent <font size="2"
face="Arial">Component</font>s they are added to their
appropriate <font size="2" face="Arial">Panel</font>s and the <font
size="2" face="Arial">Panel</font>s then added together to
produce the required visual layout on lines 0077 to 0086. Finally
the <font size="2" face="Arial"><i>setDate()</i></font> method is
called on line 0088 passing on the arguments received by the
constructor. The implementation of the <font size="2"
face="Arial"><i>setDate()</i></font> method is as follows. </p>

<pre><font size="3">0092     <b>public void</b> <i>setDate</i>( <b>int</b> <i>year</i>, 
0093                          <b>int</b> <i>month</i>,
0094                          <b>int</b> <i>dayOfMonth</i>) { 
0095                                                             
0096         <i>centuryChoice</i>.select( (<i>year</i> / 100) - 19);
0097         <i>decadeChoice</i>.select(  (<i>year</i> % 100) / 10);
0098         <i>yearChoice</i>.select( <i>year</i> % 10);
0099         <i>monthChoice</i>.select( <i>month </i>-1);
0100         <i>monthPanel</i>.<i>reConfigure</i>( <i>year</i>, <i>month</i>, <i>dayOfMonth</i>);
0101         <i>dateSelected</i>();
0102     } // End <i>setDate</i>.</font></pre>

<p>In this method the <font size="2" face="Arial"><i>centuryChoice</i></font>,
<font size="2" face="Arial"><i>decadeChoice</i></font> and <font
size="2" face="Arial"><i>yearChoice</i></font> <font size="2"
face="Arial">select()</font> methods are called, on lines 0096 to
0098, passing as arguments a suitably arithmetically manipulated
value derived from the <font size="2" face="Arial"><i>year</i></font>
argument. On line 0099 the <font size="2" face="Arial"><i>monthChoice</i></font>
<font size="2" face="Arial">select()</font> method is called
passing on the <font size="2" face="Arial"><i>month</i></font>
argument. This argument is received in the conventional 1 to 12
range of values but the indexes of the <font size="2"
face="Arial">items</font> on the <font size="2" face="Arial">Choice</font>
menu are in the range 0 to 11 and so it's decremented value is
passed. The effect of these methods is to set the <font size="2"
face="Arial">Choice</font> menus at the top of the panel to
indicate the year and month required. On line 0100 the three
arguments are passed to a call of the <font size="2" face="Arial"><i>monthPanel
reConfigure()</i></font> method which, as explained above, will
cause it to lay itself out as appropriate to the <font size="2"
face="Arial"><i>year</i></font> and <font size="2" face="Arial"><i>month</i></font>
specified with the <font size="2" face="Arial"><i>day</i></font>
highlighted. The final step is to call <font size="2"
face="Arial"><i>dateSelected()</i></font> which, as will be
explained below, will cause an <font size="2" face="Arial">ActionEvent</font>
to be generated by the <font size="2" face="Arial"><i>DatePanel</i></font>.
</p>

<p>The three inquiry methods retrieve the appropriate value from
the appropriate components of the interface, as follows. </p>

<pre><font size="3">0104     <b>public int</b> <i>yearIs</i>() {    
0105        <b>return</b> Integer.valueOf( <i>centuryChoice</i>.getSelectedItem() +   
0106                                <i>decadeChoice</i>.getSelectedItem() +
0107                                <i>yearChoice</i>.getSelectedItem()
0108                              ).intValue();
0109     } // End <i>yearIs</i>.
0110  
0111  
0112     <b>public int</b> <i>monthIs</i>(){ 
0113        <b>return</b> <i>monthChoice</i>.<i>getSelectedIndex</i>() +1;
0114     } // End <i>monthIs</i>.
0115  
0116  
0117     <b>public int</b> <i>dayIs</i>(){ 
0118        <b>return</b> <i>monthPanel</i>.<i>dayIs</i>();
0119     } // End <i>dayIs</i>.</font></pre>

<p>The <font size="2" face="Arial"><i>yearIs()</i></font> method
returns the year indicated on the interface by catenating
together the <font size="2" face="Arial">String</font>s obtained
from the three <font size="2" face="Arial">Choice</font>
components <font size="2" face="Arial">getSelectedItem()</font>
methods and then converting the <font size="2" face="Arial">String</font>
to a primitive <font size="2" face="Arial"><b>int</b></font>. As
with the setting of an item on the <font size="2" face="Arial"><i>monthChoice</i></font>
menu, the range of values returned by <font size="2" face="Arial"><i>monthIs()</i></font>
is converted from the 0 to 11 range into the 1 to 12 range when
the index of the selected item is obtained using the <font
size="2" face="Arial">Choice getSelectedIndex() </font>method on
line 0113. The <font size="2" face="Arial"><i>dayIs()</i></font>
method determines which day of the month is currently indicated
by using the <font size="2" face="Arial"><i>dayIs()</i></font>
action of the encapsulated <font size="2" face="Arial"><i>monthPanel</i></font>.
</p>

<p>As explained above the <font size="2" face="Arial"><i>actionPerformed()</i></font>
method is called whenever a new date is selected on the <font
size="2" face="Arial"><i>monthPanel</i></font> and, as it does
not need to reconfigure the <font size="2" face="Arial"><i>monthPanel</i></font>,
indirects immediately to the <font size="2" face="Arial"><b>private</b></font><b>
</b><font size="2" face="Arial"><i>dateSelected()</i></font>
method in order to generate an <font size="2" face="Arial">ActionEvent</font>
to notify listeners that the date has changed. The <font size="2"
face="Arial"><i>itemStateChanged()</i></font> method will be
called whenever one of the <font size="2" face="Arial">Choice</font>
menus has a different item selected and, as this will cause the
pattern of days in the month now indicated to change, the <font
size="2" face="Arial"><i>monthPanel</i></font> <font size="2"
face="Arial"><i>reConfigure()</i></font> method is called before
it too indirects to the <font size="2" face="Arial"><i>dateSelected()</i></font>
method. The implementation of these two methods are as follows. </p>

<pre><font size="3">0122     <b>public void</b> <i>actionPerformed</i>( ActionEvent <i>event</i>) { 
0123        <i>dateSelected</i>();
0124     } // End <i>actionPerformed</i>.    
0125     
0126     
0127     <b>public void</b> <i>itemStateChanged</i>( ItemEvent <i>event</i>) { 
0128        <i>monthPanel</i>.<i>reConfigure</i>( <b>this</b>.<i>yearIs()</i>, <b>this</b><i>.monthIs()</i>,
0129                                <b>this</b>.<i>dayIs()</i>); 
0130        <i>dateSelected</i>();   
0131     } // End <i>itemStateChanged</i>.</font></pre>

<p>The implementation of the <font size="2" face="Arial"><i>dateSelected()</i></font>
method makes use of the <font size="2" face="Arial"><i>actionCommand</i></font>
and <font size="2" face="Arial"><i>itsListener</i></font>
attributes which have yet to be considered. Unlike the
dispatching of <font size="2" face="Arial">ActionEvents</font>
from a <font size="2" face="Arial"><i>dayBox</i></font> to a <font
size="2" face="Arial"><i>monthPanel</i></font>, or from a <font
size="2" face="Arial"><i>monthPanel</i></font> to a <font
size="2" face="Arial"><i>datePanel</i></font>, it is possible for
an <font size="2" face="Arial">ActionEvent</font> generated by
the <font size="2" face="Arial"><i>DatePanel</i></font> to be
sent to a number of registered listeners. This requires the <font
size="2" face="Arial"><i>addActionListener()</i></font> and <font
size="2" face="Arial"><i>removeActionListener()</i></font>
methods to be supplied. As there can be a number of <font
size="2" face="Arial"><i>DatePanels</i></font> in an interface
the <font size="2" face="Arial"><i>setCommandString()</i></font>
and <font size="2" face="Arial"><i>getCommandString()</i></font>
methods are supplied in order to allow the origin of the events
to be determined. The implementation of these methods, and of the
<font size="2" face="Arial"><b>private</b></font> <font size="2"
face="Arial"><i>dateSelected()</i></font> method which makes use
of them, is as follows. </p>

<pre><font size="3">0134      <b>public void</b> <i>setActionCommand</i>( String <i>command</i>) {
0135          <i>actionCommand</i> = <i>command</i>;
0136      } // End <i>setActionCommand</i>.
0137      
0138      <b>public</b> String <i>getActionCommand</i>() {
0139         <b>if</b> ( <i>actionCommand</i> == <b>null</b>) { 
0140            <b>return</b> &quot;Date Panel&quot;;
0141         } <b>else</b> { 
0142            <b>return</b> <i>actionCommand</i>;
0143         } // End if.   
0144      } // End <i>getActionCommand</i>.
0145  
0146  
0147      <b>public void</b> <i>addActionListener</i>( ActionListener <i>listener</i>) {
0148         <i>itsListener</i> = AWTEventMulticaster.add( <i>itsListener</i>, <i>listener</i>);
0149      } // End <i>addActionListener</i>.
0150  
0151  
0152      <b>public void</b> <i>removeActionListener</i>( ActionListener <i>listener</i>) {
0153         <i>itsListener</i> = AWTEventMulticaster.remove( <i>itsListener</i>, <i>listener</i>);
0154      } // End removeActionListener.
0155  
0156  
0157      <b>private void</b> <i>dateSelected</i>() { 
0158         <b>if</b> ( <i>itsListener</i> != <b>null</b>) {   
0159            <i>itsListener</i>.<i>actionPerformed</i>( <b>new</b> ActionEvent( <b>this</b>, 
0160                                             ActionEvent.ACTION_PERFORMED,
0161                                             <b>this</b>.<i>getActionCommand</i>())); 
0162        } // End if.                                              
0163     } // End <i>dateSelected</i>.  
0164  } // End class <i>DatePanel</i>.</font></pre>

<p>The <font size="2" face="Arial"><i>setActionCommand()</i></font>
stores the <font size="2" face="Arial"><i>command</i> String</font>
passed as an argument in the <font size="2" face="Arial"><i>actionCommand</i></font>
attribute and <font size="2" face="Arial"><i>getActionCommand()</i></font>
returns the attribute, or the literal &quot;<i>Date Panel</i>&quot;
if it has not been set. Adding and removing <font size="2"
face="Arial">ActionListener</font>s, or any other <font size="2"
face="Arial">Listener</font> classes, is facilitated by the
provision of the <font size="2" face="Arial">AWTEventMulticaster</font>
class which will automatically maintain the list of listener
objects to which events are to be dispatched to. Within <font
size="2" face="Arial"><i>addActionListener(),</i></font> on line
0148, the <font size="2" face="Arial">AWTEventMulticaster</font> <font
size="2" face="Arial">add()</font> method is used to add the new <font
size="2" face="Arial"><i>listener</i></font> passed as an
argument, to the list held in <font size="2" face="Arial"><i>itsListener</i></font>.
Likewise the <font size="2" face="Arial">AWTEventMulticaster</font>
<font size="2" face="Arial">remove()</font> method is used on
line 0153 within <font size="2" face="Arial"><i>removeActionListener()</i></font>
to remove a <font size="2" face="Arial"><i>listener</i></font>. </p>

<p>Having done this all the <font size="2" face="Arial">actionPerformed()</font>
methods of all the <font size="2" face="Arial">listener</font>
objects which have been added to the <font size="2" face="Arial"><i>itsListener</i></font>
attribute can be called with a single call, as on lines 0159 to
0161, passing as an argument to the called method a <font
size="2" face="Arial"><b>new</b> ActionEvent</font> containing
the identity of the <font size="2" face="Arial"><i>DatePanel</i></font>
which generated it and its <font size="2" face="Arial"><i>commandString</i></font>.
The <font size="2" face="Arial"><i>dateSelected()</i></font>
method which effects this will be called every time the date is
changed, either by clicking on a <font size="2" face="Arial"><i>dayBox</i></font>
in the <font size="2" face="Arial"><i>MonthPanel</i></font> or by
using one of the <font size="2" face="Arial">Choice</font> menus.
Any <font size="2" face="Arial">ActionListener</font> objects
which have been registered with the <font size="2" face="Arial"><i>DatePanel</i></font>
by its <font size="2" face="Arial"><i>addActionListener()</i></font>
method will be informed of this by having their <font size="2"
face="Arial"><i>performAction()</i></font> methods invoked. Each
will be sent an individual copy of the <font size="2"
face="Arial">ActionEvent</font> created on lines 0159 to 0161,
and the sequence in which they will be called is indeterminate. </p>

<p>This technique, making use of the class wide <font size="2"
face="Arial">AWTEventMulticaster</font> methods, can be used
whenever a specialized component has to allow a number of
listeners to be registered and dispatch events, of any type, to
each of them.</p>

<hr>

<blockquote>
    <p><a href="code3\datepanel\datepanel.java"><font size="5"><img
    src="list.gif" align="middle" border="0" width="40"
    height="35">DatePanel.java</font></a></p>
</blockquote>

<hr>

<blockquote>
    <p><a href="c313.html"><img src="next.gif" align="middle"
    border="0" width="50" height="40"><font size="5">3.13 The </font><font
    size="5" face="Arial"><i>DatePanelDemonstration</i></font><font
    size="5"> class</font></a></p>
    <p><a href="c311.html"><font size="4"><img src="last.gif"
    align="middle" border="0" width="50" height="40"></font><font
    size="5">3.11 The </font><font size="5" face="Arial"><i>MonthPanel</i></font><font
    size="5"> class</font></a></p>
</blockquote>

<hr>
</body>
</html>
