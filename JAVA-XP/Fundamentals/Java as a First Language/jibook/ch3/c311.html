<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPad 2.0">
<title> 3.11 The MonthPanel class </title>
</head>

<body bgcolor="#FFFFFF">

<h1 align="center">3.11 The <font size="5" face="Arial"><i>MonthPanel</i></font><font
size="5"> </font><font size="6">class</font></h1>

<p>The <font size="2" face="Arial"><i>MonthPanel</i></font> class
is responsible for laying out and configuring an iteration of <font
size="2" face="Arial"><i>DayBoxes</i></font> so as to reflect the
year and month required of it. It also has the responsibility to
maintain knowledge of the currently highlighted day number in
order that it can un-highlight it when required and to report the
currently highlighted day number when asked. The class diagram
for the <font size="2" face="Arial"><i>MonthPanel</i></font>
class is given in Figure 3.14.</p>

<p align="center"><font size="2"><b><img src="fig314.gif"
width="518" height="291"></b></font></p>

<p align="center"><font size="2"><b>Figure 3.14</b> The </font><font
size="2" face="Arial"><i>MonthPanel</i></font><font size="2">
class diagram.</font></p>

<p>The class indicates that an iteration of <font size="2"
face="Arial"><i>DayBox</i></font> instances, called <font
size="2" face="Arial"><i>dayBoxes</i></font>, is contained within
each instance of this class as well as a primitive <font size="2"
face="Arial"><b>int</b></font>eger indicating which one is <font
size="2" face="Arial"><i>highlighted</i></font>. The constructor
requires only the identity of a listener object which is stored
in the <font size="2" face="Arial"><i>passUpToHere</i></font>
attribute. The constructor creates the <font size="2"
face="Arial"><i>MonthPanel</i></font> without configuring it for
a particular month, which is the responsibility of the <font
size="2" face="Arial"><i>reConfigure() </i></font>method. This
method will lay out the day numbers as appropriate to its <font
size="2" face="Arial"><i>year</i></font> and <font size="2"
face="Arial"><i>month</i></font> arguments, and highlight the <font
size="2" face="Arial"><i>day</i></font> given. The <font size="2"
face="Arial"><i>actionPerformed()</i></font> method is required
to respond to the <font size="2" face="Arial"><i>ActionEvents</i></font>
which will propagate from the contained <font size="2"
face="Arial"><i>dayBox</i></font> instances, as described above.
The <font size="2" face="Arial"><i>dayIs()</i></font> method is
supplied to allow its instance parent, a <font size="2"
face="Arial"><i>DatePanel</i></font>, to find out which date is
currently highlighted. The implementation of this class, as far
as the end of its constructor, is as follows. </p>

<pre><font size="3">0001  // Filename <i>MonthPanel.java</i>.
0002  // Provides an Panel which can be configured to show
0003  // the pattern of days in any particular month.
0004  //
0005  // Written for JI book, Chapter 3 see text.
0006  // Fintan Culwin, v0.2, August 1997.
0007  
0008  <b>package</b> <i>DatePanel</i>;
0009  
0010  <b>import</b> java.awt.*;
0011  <b>import</b> java.awt.event.*;
0012  
0013  <b>import</b> <i>DatePanel.DateUtility</i>;
0014  <b>import</b> <i>DatePanel.DayBox</i>;
0015  
0016  
0017  <b>class</b> <i>MonthPanel</i> <b>extends</b>    Panel 
0018                   <b>implements</b> ActionListener {
0019  
0020  <b>private static final</b> <b>int</b> <i>MAX_BOXES</i> = 37;
0021  
0022  <b>private</b> <i>DayBox</i>           <i>dayBoxes</i>[]  = <b>new</b> <i>DayBox</i>[ <i>MAX_BOXES</i>];
0023  <b>private</b> <b>int</b>              <i>highlighted</i>;
0024  <b>private</b> <b>int</b>              <i>theFirstBox</i>;
0025  <b>private</b> ActionListener   <i>passUpToHere</i>;
0026  
0027  <b>private static</b> String <i>dayNames</i>[] = { &quot;Sun&quot;, &quot;Mon&quot;, &quot;Tue&quot;, &quot;Wed&quot;, 
0028                                       &quot;Thu&quot;, &quot;Fri&quot;, &quot;Sat&quot;  };
0029  
0030  
0031     <b>protected</b> <i>MonthPanel</i>( ActionListener <i>listener</i>) {
0032  
0033     <b>int</b>   <i>thisOne</i>; 
0034     Label <i>dayLabels</i>[]  = <b>new</b> Label[ 7];
0035     
0036        <b>this</b>.setLayout( <b>new</b> GridLayout( 7, 7, 0, 0));
0037        <b>for</b> ( <i>thisOne</i> = 0; <i>thisOne</i> &lt; 7; <i>thisOne</i>++) { 
0038           <i>dayLabels</i>[ <i>thisOne</i>] = <b>new</b> Label( <i>dayNames</i>[ <i>thisOne</i>],
0039                                            Label.CENTER);
0040           <b>this</b>.add( <i>dayLabels</i>[ <i>thisOne</i>]);                                 
0041        } // End for.       
0042  
0043        <b>for</b> ( <i>thisOne</i> = 0; <i>thisOne</i> &lt; <i>MAX_BOXES</i>; <i>thisOne</i>++) { 
0044           <i>dayBoxes</i>[ <i>thisOne</i>] = <b>new</b> <i>DayBox</i>( <i>thisOne</i>, <b>this</b>);
0045           <b>this</b>.add( <i>dayBoxes</i>[ <i>thisOne</i>]);
0046        } // End for.
0047         
0048        <i>passUpToHere</i> = <i>listener</i>;
0049     } // End <i>MonthPanel</i> constructor.</font></pre>

<p>The constructor can be divided into a sequence of actions. It
starts by establishing its' layout policy and then installs the
day name <font size="2" face="Arial">Label</font>s at the top of
its area before creating all of the <font size="2" face="Arial">DayBox</font>
instances below the <font size="2" face="Arial">Label</font>s. </p>

<p>The <font size="2" face="Arial"><i>dayBoxes</i></font> are
laid out in rows of 7 and the longest month contains 31 days. The
worst case scenario is illustrated in Figure 3.7 and occurs where
the first day of the month falls on a Saturday. In this situation
the first six boxes on the first row are inactive requiring a
further 31 active boxes requiring a total of 37 <font size="2"
face="Arial">DayBox</font> instances. The <font size="2"
face="Arial">DayBox</font>es are contained within the array <font
size="2" face="Arial"><i>dayBoxes</i></font> which is declared
and has its size established on line 0022. The private <font
size="2" face="Arial"><i>highlighted</i></font> attribute is then
declared on line 0023. The <font size="2" face="Arial"><i>theFirstBox</i></font>
attribute, declared on line 0024, is used to record which is the
first active box in the panel and as it is not a logical
component of the class it is not shown on the class diagram. The
value of this attribute will be set as the boxes are laid out in
the <font size="2" face="Arial"><i>reConfigure()</i></font>
method. The remaining attribute, <font size="2" face="Arial"><i>passUpToHere</i></font>,
declared on line 0025, stores the identity of the listener object
to which <font size="2" face="Arial">ActionEvent</font>s are to
be dispatched when a date is selected. </p>

<p>In the constructor the layout policy of the <font size="2"
face="Arial"><i>DayPanel</i></font> is specified as a 7 by 7 grid
layout. The first row of this grid is used for the names of the
days and, on lines 0037 to 0041, these are created as instances
of the <font size="2" face="Arial">Label</font> class. The text
which each Label will display is supplied from a class wide array
of <font size="2" face="Arial">String</font>s called <font
size="2" face="Arial"><i>dayNames</i></font> which is declared
and initialized on lines 0027 and 0028.</p>

<p>On lines 0043 to 0046 the 37 <font size="2" face="Arial"><i>dayBoxes</i></font>
are created and added to the grid with each being informed of its
ordinal position and its listener, as it is constructed. As a <font
size="2" face="Arial">GridLayout</font> policy is used all of the
components on the <font size="2" face="Arial">Panel</font> have
to be the same size. As any day number, when rendered, will take
up less width than the widest of the day names it can be
guaranteed that the <font size="2" face="Arial"><i>DayBox</i></font>es
will be large enough to accommodate the day number string.
Likewise as the day names and the day numbers are using the same <font
size="2" face="Arial">Font</font> they will also be high enough.
This implies that there is a close coupling between the <font
size="2" face="Arial">MonthPanel</font> and the <font size="2"
face="Arial">DayBox</font> classes which is acceptable as they
are not intended to be (re)used separately. </p>

<p>Before concluding, the <font size="2" face="Arial"><i>MonthPanel</i></font>
constructor stores the identity of the listener object, passed in
its <font size="2" face="Arial">listener</font> argument, in the <font
size="2" face="Arial"><i>passUpToHere</i></font> attribute. The <font
size="2" face="Arial"><i>DayPanel</i></font> is constructed in an
unconfigured state and has to be configured by a call of the <font
size="2" face="Arial"><i>reConfigure()</i></font> method whose
implementation is as follows. </p>

<pre><font size="3">0052     <b>protected void</b> <i>reConfigure</i>( <b>int</b> <i>year</i>, <b>int</b> <i>month</i>, <b>int</b> <i>day</i>) { 
0053     
0054     <b>int</b> <i>maxDay</i>   = <i>DateUtility</i>.<i>daysThisMonthIs</i>(   <i>year</i>, <i>month</i>);
0055     <b>int</b> <i>startDay</i> = <i>DateUtility.firstDayOfMonthIs</i>( <i>year</i>, <i>month</i>);
0056  
0057     <b>int</b> <i>thisOne</i>;
0058  
0059        <i>theFirstBox</i> = <i>startDay</i>;
0060        <b>if</b> ( <i>day</i> &gt; <i>maxDay</i>) { 
0061           <i>day</i> = <i>maxDay</i>;
0062        } //End if.
0063  
0064        <i>dayBoxes</i>[ <i>highlighted</i>].<i>clearHighlight</i>();
0065  
0066        <b>for</b> ( <i>thisOne</i> = 0; <i>thisOne</i> &lt; <i>MAX_BOXES</i>; <i>thisOne</i>++) { 
0067           <b>if</b> ( (<i>thisOne</i> &lt;  <i>startDay</i>) ||
0068                (<i>thisOne</i> &gt;= (<i>startDay</i> + <i>maxDay</i>)) ){     
0069              <i>dayBoxes</i>[ <i>thisOne</i>].<i>setDayNumber</i>( 0);  
0070           } <b>else</b> {      
0071              <i>dayBoxes</i>[ <i>thisOne</i>].<i>setDayNumber</i>( <i>thisOne</i> - <i>startDay</i> +1);
0072           } // End if.    
0073           <i>dayBoxes</i>[ <i>thisOne</i>].repaint();
0074        } // End for.
0075        
0076        <i>dayBoxes</i>[ <i>theFirstBox</i> + <i>day</i> -1].<i>setHighlight</i>();
0077        <i>highlighted</i> = <i>theFirstBox</i> + <i>day</i> -1;       
0078     } // End <i>reConfigure</i>. </font></pre>

<p>The <font size="2" face="Arial"><i>reConfigure()</i></font>
method is responsible for setting the <font size="2" face="Arial"><i>dayBoxes</i></font>
to indicate the year and month specified in its arguments. Its
first step is to obtain the number of days in the month requested
and the day of the week which <font size="2" face="Arial"><i>theFirstDay</i></font>
falls on, using the appropriate <font size="2" face="Arial"><i>DateUtility</i></font>
methods. The <font size="2" face="Arial"><i>day</i></font>
argument indicates which day is to be highlighted and it is
possible that this might specify a day number which is larger
than the maximum day of the month; for example requesting the 31<sup>st</sup>
day of February. To prevent this lines 0060 to 0062 limit the
value of <font size="2" face="Arial"><i>day</i></font> to the
maximum day of the required month. </p>

<p>On line 0064 any existing highlight is cleared by calling the <font
size="2" face="Arial"><i>clearHighlight()</i></font> method of
the <font size="2" face="Arial"><i>dayBox[]</i></font> array
element indicated by the <font size="2" face="Arial"><i>highlighed</i></font>
attribute. When the <font size="2" face="Arial"><i>MonthPanel</i></font>
is configured for the first time none of the <font size="2"
face="Arial"><i>DayBox</i></font>es will be highlighted and so
this step will clear the highlight of a box which is not
currently highlighted, however as this has no adverse effects it
need not be circumvented.</p>

<p>The loop between 0066 and 0074 sets all the <font size="2"
face="Arial"><i>dayBoxes</i></font> to their appropriate state.
The <font size="2" face="Arial"><b>if</b></font> condition on
lines 0067 and 0068 will be <font size="2" face="Arial"><b>true</b></font>
for all inactive boxes at the start and end of the array and
these will have their <font size="2" face="Arial"><i>dayNumber</i></font>
attribute set to zero to indicate this. All other boxes will have
the appropriate <font size="2" face="Arial"><i>dayNumber</i></font>
as specified on line 0071. The final steps, on lines 0076 and
0077, are concerned with highlighting the <font size="2"
face="Arial"><i>day</i></font> specified and recording it in <font
size="2" face="Arial"><i>highlighted</i></font>. </p>

<p>The <font size="2" face="Arial"><i>dayIs()</i></font> method
uses the <font size="2" face="Arial"><i>highlighted</i></font>
attribute and the offset to the first active box, <font size="2"
face="Arial"><i>theFirstBox</i></font>, to determine the day
number which the <font size="2" face="Arial"><i>MonthPanel</i></font>
currently indicates, as follows. </p>

<pre><font size="3">0081     <b>protected int</b> <i>dayIs</i>(){ 
0082        <b>return</b> <i>highlighted</i> - <i>theFirstBox</i> +1;
0083     } // End <i>dayIs</i>;</font></pre>

<p>The remaining method, <font size="2" face="Arial"><i>actionPerformed()</i></font>,
is needed in order for the <font size="2" face="Arial"><i>MonthPanel</i></font>
class to satisfy the requirement of the <font size="2"
face="Arial">ActionListener</font> interface. As explained above,
it is called whenever a mouse release event occurs in a primed <font
size="2" face="Arial"><i>dayBox</i></font>. It has to move the
highlight to the <font size="2" face="Arial"><i>dayBox</i></font>
indicated by the user, and propagate the event up to its
listener. Its implementation is as follows.</p>

<pre><font size="3">0086     <b>public void</b> <i>actionPerformed</i>( ActionEvent <i>event</i>)  { 
0087        <i>dayBoxes</i>[ <i>highlighted</i>].<i>clearHighlight</i>();
0088        ((<i>DayBox</i>) <i>event</i>.getSource()).<i>setHighlight</i>();
0089        <i>highlighted</i> = ((DayBox) <i>event</i>.getSource()).<i>getOrdinal</i>(); 
0090        <i>passUpToHere</i>.<i>actionPerformed</i>( <i>event</i>);  
0091     } // End <i>actionPerformed</i>.    </font></pre>

<p>On line 0087 the existing highlight is cleared and on lines
0088 and 0089 the highlight of the <font size="2" face="Arial"><i>dayBox</i></font>
which generated the <font size="2" face="Arial"><i>event</i></font>
is set and its <font size="2" face="Arial"><i>ordinal</i></font>
location stored in <font size="2" face="Arial"><i>highlighted</i></font>.
Finally, on line 0090, the <font size="2" face="Arial"><i>event</i></font>
passed to this method in its argument is passed onwards to its
stored <font size="2" face="Arial"><i>passUpToHere</i></font> <font
size="2" face="Arial">ActionListener</font> attribute. The <font
size="2" face="Arial">ActionListener</font> of a <font size="2"
face="Arial"><i>MonthPanel</i></font> is always the <font
size="2" face="Arial"><i>DatePanel</i></font> upon which it is
mounted and whose implementation is as follows. </p>

<hr>

<blockquote>
    <p><a href="code3\datepanel\monthpanel.java"><font size="5"><img
    src="list.gif" align="middle" border="0" width="40"
    height="35">MonthPanel.java</font></a></p>
</blockquote>

<hr>

<blockquote>
    <p><a href="c312.html"><img src="next.gif" align="middle"
    border="0" width="50" height="40"><font size="5">3.12 The </font><font
    size="5" face="Arial"><i>DatePanel</i></font><font size="5">
    class</font></a></p>
    <p><a href="c310.html"><font size="5"><img src="last.gif"
    align="middle" border="0" width="50" height="40">3.10 The</font><font
    size="4"> </font><font size="5" face="Arial"><i>DayBox</i></font><font
    size="5"> </font><font size="6">class</font></a></p>
</blockquote>

<hr>
</body>
</html>
