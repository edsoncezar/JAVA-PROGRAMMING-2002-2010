<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPad 2.0">
<title> 3.6 The MessageCanvas class </title>
</head>

<body bgcolor="#FFFFFF">

<h1 align="center">3.6 The <font size="6" face="Arial"><i>MessageCanvas</i></font><font
size="5"> </font><font size="6">class</font></h1>

<p>The <font size="2" face="Arial"><i>MessageCanvas</i></font>
class is the most complex of the classes required for the <font
size="2" face="Arial"><i>StikNote</i></font> application. It is
not possible to use a <font size="2" face="Arial">Label</font>
instance to show the note's contents as a <font size="2"
face="Arial">Label</font> can only show a single line of text. It
would be possible to use a non-editable <font size="2"
face="Arial">TextArea</font> but it would be difficult to ensure
that it was just sufficiently large to contain the text. The
solution to these shortcomings is to extend the <font size="2"
face="Arial">Canvas</font> class to produce a specialized <font
size="2" face="Arial">Canvas</font> class which is capable of
displaying a multi-line <font size="2" face="Arial">String</font>
in just sufficient space. This is the only class in the <font
size="2" face="Arial"><i>StikNote</i></font> application which is
sufficiently complex to merit a class diagram, as shown in Figure
3.6.</p>

<p align="center"><b><img src="fig36.gif" width="449"
height="378"></b></p>

<p align="center"><b>Figure 3.6</b> The <font face="Arial"><i>MessageCanvas</i></font>
class diagram.</p>

<p>The diagram indicates that it supplies a single constructor
and four <font size="2" face="Arial"><b>public</b></font> methods<font
size="2" face="Arial"> <i>addNotify()</i>, <i>paint(),</i> <i>getPreferredSize()</i></font>
and <font size="2" face="Arial"><i>getMinimumSize().</i></font>
These are a minimum set of <font size="2" face="Arial">Component</font>
methods which should be overridden for any specialized component
to be able to inter-operate effectively with other components.
The constructor requires a <font size="2" face="Arial">String</font>
as an argument and will display this <font size="2" face="Arial">String</font>
in a window just large enough to accommodate it. Once the <font
size="2" face="Arial"><i>MessageCanvas</i></font><i> </i>has been
constructed there is no facility in this implementation for the
contents of its window to be queried or changed. </p>

<p>The <font size="2" face="Arial"><i>addNotify()</i></font>
method is called by the Java run-time environment when the
component's peer object has been created. It can be used to
ensure that certain methods, such as the <font size="2"
face="Arial"><b>private</b></font> <font size="2" face="Arial"><i>setSizes()
</i></font>method in this class, are not called until it is
certain that the peer has been created. The<i> </i><font size="2"
face="Arial"><i>paint()</i></font> method is called by the Java
run time environment every time it is necessary to restore the
contents of the component. This will happen when the component is
shown for the first time and thereafter whenever it becomes
visible after being hidden by another window. </p>

<p>The <font size="2" face="Arial"><i>getPreferredSize()</i></font>
and <font size="2" face="Arial"><i>getMinimumSize()</i></font>
methods may be called during <i>layout&nbsp;negotiations</i>.
These happen when the contents of a <font size="2" face="Arial">Container</font>
are packed before being shown. Briefly a <font size="2"
face="Arial">Container</font> determines its own preferred size
by asking all of its children for their preferred size and
performing the appropriate calculations. For example a <font
size="2" face="Arial">FlowLayout</font> manager with three
children would set its preferred width, based upon the combined
preferred width of all of its children and would set its
preferred height to the tallest. Sometimes the preferred size of
a component cannot be easily accommodated and then the <font
size="2" face="Arial">getMinimumSize()</font> method is asked for
the component's minimum requirements. There is never a guarantee
that the component will be given even its minimum requirements
and any methods which need to know the size of the component
should ask for it, as will be demonstrated below. </p>

<p>The implementation of the <font size="2" face="Arial"><i>MessageCanvas</i></font>
class, which is not included in the <font size="2" face="Arial"><i>StikNote</i></font>
<font size="2" face="Arial"><b>package</b></font>, as far as the
end of its constructor, is as follows. </p>

<pre><font size="3">0001  // Filename <i>MessageCanvas.java</i>.
0002  // Provides a reusable centred multi-line label component.
0003  // 
0004  // Written for the JI book, first used in Chapter 3.
0005  // Fintan Culwin, v 0.2, August 1997.
0006  
0007  
0008  <b>import</b> java.awt.*;
0009  <b>import</b> java.awt.event.*;
0010  <b>import</b> java.util.StringTokenizer;
0011  
0012  
0013  <b>public class</b> <i>MessageCanvas</i> <b>extends</b> Canvas { 
0014  
0015  <b>private int</b>    <i>maximumWidth</i>   = 0;
0016  <b>private int</b>    <i>characterHeight</i>;
0017  <b>private</b> String <i>theMessage</i>[];
0018  
0019  
0020     <b>public</b> <i>MessageCanvas</i>( String <i>message</i>) { 
0021                              
0022     StringTokenizer <i>tokenizer</i>     = <b>new</b> StringTokenizer( <i>message</i>, &quot;\n&quot;);
0023     <b>int</b>             <i>numberOfLines</i> = <i>tokenizer</i>.countTokens();
0024     <b>int</b>             <i>index</i>; 
0025     
0026        <i>theMessage</i> = <b>new</b> String[ <i>numberOfLines</i>]; 
0027        <b>for</b> ( <i>index</i> =0; <i>index</i> &lt; <i>numberOfLines</i>; <i>index</i>++){ 
0028           <i>theMessage</i>[ <i>index</i>] = ((String) <i>tokenizer</i>.nextToken()).trim();
0029        } // End for.      
0030     } // End <i>MessageCanvas</i> constructor.
</font></pre>

<p>A muti-line <font size="2" face="Arial"><i>message</i></font> <font
size="2" face="Arial">String</font> will have to be rendered onto
the <font size="2" face="Arial"><i>MessageCanvas</i></font> one
line at a time and so the major responsibility of the constructor
is to store each line of the message in a separate element of the
<font size="2" face="Arial">String</font> array instance
attribute <font size="2" face="Arial"><i>theMessage</i></font>.
To accomplish this a <font size="2" face="Arial">StringTokenizer</font>
instance is constructed, on line 0022, which will split the <font
size="2" face="Arial">String</font> argument <font size="2"
face="Arial"><i>message</i></font> on its newline
(&quot;\n&quot;) boundaries. </p>

<p>Having prepared the <font size="2" face="Arial"><i>tokenizer</i></font>
its <font size="2" face="Arial">countTokens()</font> method can
be used to find out the <font size="2" face="Arial"><i>numberOfLines</i></font>
in the message and this value is subsequently used to specify the
size of <font size="2" face="Arial"><i>theMessage</i></font>
array. Each line from the <font size="2" face="Arial"><i>message</i>
String</font> can then be extracted in turn, using the <font
size="2" face="Arial">tokenizer</font> <font size="2"
face="Arial"><i>nextToken()</i></font> method, and stored in the
array. There is no need for this class to configure its physical
appearance as it will inherit the required attributes from its
instance parent.</p>

<p>The purpose of the <font size="2" face="Arial"><i>addNotify()</i></font>
method is to ensure that certain steps are not taken until the
peer interface component is created. In this class the <font
size="2" face="Arial"><i>setSizes()</i></font> method has the
responsibility of ensuring that the <font size="2" face="Arial"><i>getPreferredSize()</i></font>
and <font size="2" face="Arial"><i>getMinimumSize()</i></font>
methods can reply in order that the <font size="2" face="Arial"><i>MessageCanvas</i></font>
will be just large enough to accommodate <font size="2"
face="Arial"><i>theMessage</i></font>. It does this by setting
the value of the <font size="2" face="Arial"><i>maximumWidth</i></font>
attribute to the screen width of the longest line of the message
and the <font size="2" face="Arial"><i>characterHeight</i></font>
attribute to the height of one character of the font being used.
This cannot happen until its peer has been constructed as, until
then, specific details of the precise font which will be used
cannot be known. Accordingly, the implementation of the <font
size="2" face="Arial"><i>addNotify() </i></font>and <font
size="2" face="Arial"><i>setSizes()</i></font> methods is as
follows. </p>

<pre><font size="3">0033     <b>public void</b> <i>addNotify</i>() { 
0034        <b>super</b>.addNotify();
0035        <b>this</b>.<i>setSizes</i>();       
0036     } // End <i>addNotify</i>.
0037  
0038  
0039     <b>private void</b> <i>setSizes</i>(){ 
0040     
0041     FontMetrics  <i>theMetrics</i> = <b>this</b>.getFontMetrics( <b>this</b>.getFont()); 
0042     <b>int</b>          <i>thisWidth</i>;
0043     <b>int</b>          <i>index</i>; 
0044     
0045        <i>characterHeight</i> = <i>theMetrics</i>.getHeight();
0046        <b>for</b> ( <i>index</i> =0; <i>index</i> &lt; <i>theMessage</i>.length; <i>index</i>++){
0047           <i>thisWidth</i> = <i>theMetrics</i>.stringWidth( <i>theMessage</i>[ <i>index</i>]);
0048           <b>if</b> ( <i>thisWidth</i> &gt; <i>maximumWidth</i>) { 
0049              <i>maximumWidth</i> = <i>thisWidth</i>;
0050           } // End if. 
0051        } // End for.
0052     } // End <i>setSizes</i>.
</font></pre>

<p>The <font size="2" face="Arial"><i>addNotify()</i></font>
method calls its parent's (<font size="2" face="Arial">Canvas</font>)
<font size="2" face="Arial">addNotify()</font> method and then
calls the <font size="2" face="Arial"><i>setSizes()</i></font>
method. This method obtains a <font size="2" face="Arial">FontMetrics</font>
instance by using its own <font size="2" face="Arial">getFont()</font>
and <font size="2" face="Arial">getFontMetrics()</font> methods.
A <font size="2" face="Arial">FontMetrics</font> instance
encapsulates information concerning the size each character in
the font will take up when rendered. Every character has the same
height and this value is obtained, and stored in the instance
attribute <font size="2" face="Arial"><i>characterHeight</i></font>,
on line 0045. The loop between lines 0046 and 0051 uses <font
size="2" face="Arial"><i>theMetrics() stringWidth()</i></font>
method to determine the width of the maximum line when rendered,
and stores this value in the <font size="2" face="Arial"><i>maximumWidth</i></font>
attribute. The <font size="2" face="Arial"><i>getPreferredSize()</i></font>
and <font size="2" face="Arial"><i>getMinimumSize()</i></font>
methods make use of these attributes, as follows. </p>

<pre><font size="3">0055     <b>public </b>Dimension <i>getPreferredSize</i>() { 
0056        <b>return new</b> Dimension( <i>maximumWidth </i>+20, 
0057                             (<i>characterHeight</i> * <i>theMessage</i>.length) +20);   
0058     } // End <i>getPreferredSize</i>.
0059     
0060     <b>public </b>Dimension <i>getMinimumSize</i>() { 
0061        <b>return new</b> Dimension( <i>maximumWidth</i>, 
0062                             (<i>characterHeight</i> * <i>theMessage</i>.length));   
0063     } // End <i>getMinimumSize</i>.
</font></pre>

<p>The <font size="2" face="Arial"><i>getMinimumSize()</i></font>
method returns the <font size="2" face="Arial"><i>maximumWidth</i></font>
and the <font size="2" face="Arial"><i>characterHeight</i></font>
times the number of lines as the <font size="2" face="Arial">Dimension</font>'s
horizontal and vertical components respectively. The <font
size="2" face="Arial"><i>getPreferredSize()</i></font> method
returns the same values plus 20 (pixels) in order to allow for a
border around the message. The <font size="2" face="Arial"><i>paint()</i></font>
method is responsible for rendering the message onto the window
and will be called by Java whenever it is required. Its
implementation is as follows. </p>

<pre><font size="3">0066     <b>public void</b> <i>paint</i>( Graphics <i>context</i>) { 
0067     
0068     <b>int</b>         <i>index</i>;
0069     <b>int</b>         <i>leftOffset</i>;
0070     <b>int</b>         <i>totalHeight</i> = <i>theMessage</i>.length * <i>characterHeight</i>;
0071     <b>int</b>         <i>itsWidth</i>    = <b>this</b>.size().width;
0072     <b>int</b>         <i>fromTop</i>     = ((<b>this</b>.size().height - <i>totalHeight</i>) /2) +
0073                               <i>characterHeight</i>/2; 
0074     FontMetrics <i>theMetrics</i>  = <b>this</b>.getFontMetrics( <b>this</b>.getFont());    
0075  
0076        <b>for</b> ( <i>index</i> =0; <i>index</i> &lt; <i>theMessage</i>.length; <i>index</i>++){  
0077           <i>leftOffset</i> = ( <i>itsWidth</i> - <i>theMetrics</i>.stringWidth( 
0078                                                     <i>theMessage</i>[ <i>index</i>]))/2;
0079           <i>context</i>.drawString( <i>theMessage</i>[ <i>index</i>], 
0080                               <i>leftOffset</i>, <i>fromTop</i>);
0081           <i>fromTop</i>+= <i>characterHeight</i>;                     
0082        } // End for.                                     
0083     } // End <i>paint</i>.</font></pre>

<p>The implementation of this method makes use of a <font
size="2" face="Arial">Graphics</font> instance called <font
size="2" face="Arial"><i>context</i></font>; the use of <i>graphics&nbsp;contexts</i>
will be described in detail in the next chapter. Briefly they
encapsulate the precise knowledge required to produce output on
the <font size="2" face="Arial">Component</font>'s window. Java
will ensure that an appropriate <font size="2" face="Arial">Graphics</font>
instance is passed as an argument whenever the <font size="2"
face="Arial"><i>paint()</i></font> method is called. </p>

<p>The first part of the method ensures that the message will be
(approximately) horizontally and vertically centered within the
window. To accomplish this the <font size="2" face="Arial">Component
size()</font> method is used to determine the actual size of the
window as no assumptions should be made regarding its size. The <font
size="2" face="Arial">size()</font> method returns a <font
size="2" face="Arial">Dimension</font> instance whose <font
size="2" face="Arial"><b>public</b></font> <font size="2"
face="Arial">width</font> and <font size="2" face="Arial">height</font>
attributes can be accessed directly, as on lines 0071 and 0071.
At the end of the local declarations, on line 0072, the variable <font
size="2" face="Arial"><i>fromTop</i></font> contains the offset
from the top of the window for the first line of the message, and
the <font size="2" face="Arial"><i>itsWidth</i></font> to the
width of the window, </p>

<p>The loop between lines 0076 and 0082 renders each line in turn
from <font size="2" face="Arial"><i>theMessage</i></font> array
using the <font size="2" face="Arial">Graphics&nbsp;<i>context</i>
drawString()</font> method. The three arguments to this method
are the <font size="2" face="Arial">String</font> to be rendered
and the <font size="2" face="Arial"><b>int</b></font>eger
horizontal and vertical locations to start at. Lines 0077 and
0078 ensure that each line is horizontally centered within the
window and 0081 that each line is vertically spaced from the
previous line by the height of one character. The effect is that
this method will <font size="2" face="Arial"><i>paint()</i></font>
the message into a <font size="2" face="Arial"><i>MessageCanvas</i></font>
window which hopefully has at least its<font size="2"
face="Arial"><i> getMinimumSize()</i></font> dimensions for it to
be rendered within. </p>

<p>This completes the implementation of the <font size="2"
face="Arial"><i>StikNote</i></font> application. It illustrates
the techniques with can be used to extend a pre-supplied <font
size="2" face="Arial">Component</font> class to supply an
extended class whose behavior is more suited to the requirements
of a particular application. The <font size="2" face="Arial"><i>MessageCanvas</i></font>
class, developed for this application, will be reused in other
applications throughout the rest of this book. Some of its design
decisions were made with this consideration in mind. In general
an extended <font size="2" face="Arial">Component</font> class
should be designed and implemented in a manner which allows for
it to be easily re-used. The techniques for extending the
pre-supplied <font size="2" face="Arial">Component</font> classes
will be further considered in the remainder of this chapter.</p>

<p>&nbsp;</p>

<hr>

<blockquote>
    <p><a href="code3\messagecanvas.java"><font size="5"><img
    src="list.gif" align="middle" border="0" width="40"
    height="35">MessageCanvas.java</font></a></p>
</blockquote>

<hr>

<blockquote>
    <p><a href="c37.html"><img src="next.gif" align="middle"
    border="0" width="50" height="40"><font size="5">3.7 The</font>
    <font size="4" face="Arial"><i>DatePanel</i></font><font
    size="4">, </font><font size="5">visual design and behavior</font></a></p>
    <p><a href="c35.html"><font size="4"><img src="last.gif"
    align="middle" border="0" width="50" height="40"></font><font
    size="5">3.5 The</font> <font size="5" face="Arial"><i>NoteWindow</i></font><font
    size="7"> </font><font size="5">class</font></a></p>
</blockquote>

<hr>
</body>
</html>
