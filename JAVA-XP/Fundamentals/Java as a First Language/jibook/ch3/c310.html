<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPad 2.0">
<title> 3.10 The DayBox class</title>
</head>

<body bgcolor="#FFFFFF">

<h1 align="center">3.10 The <font size="5" face="Arial"><i>DayBox</i></font><font
size="5"> </font><font size="6">class</font></h1>

<p>Instances of the <font size="2" face="Arial"><i>DayBox</i></font>
class are used in the <font size="2" face="Arial"><i>DatePanel</i></font>
artifact to supply each of the positions in the <font size="2"
face="Arial"><i>MonthPanel</i></font> which can be used to
display a day of the month. Each instance can be <i>active</i>,
displaying a number indicating a date in the month, or <i>inactive</i>
in the current configuration and shown without a number. Only
active boxes respond to the entry and exit of the mouse pointer,
showing a border as it traverses through it, and only active
boxes will respond to a mouse click generating an event which its
listener can respond to. A <font size="2" face="Arial"><i>DayBox</i></font>
instance is located at an ordinal location with respect to other
boxes in a <font size="2" face="Arial"><i>MonthPanel</i></font>.
The class diagram for the <font size="2" face="Arial"><i>DayBox</i></font>
class is given in Figure 3.13.</p>

<p align="center"><img src="fig313.gif" width="559" height="506"></p>

<p align="center"><font size="2"><b>Figure 3.13</b> The </font><font
size="2" face="Arial"><i>DayBox</i></font><font size="2"> class
diagram.</font></p>

<p>The <font size="2" face="Arial"><i>ordinal</i></font> data
attribute records the position of the <font size="2" face="Arial"><i>DayBox</i></font>
in relation to all the other <font size="2" face="Arial"><i>DayBox</i></font>es
in the <font size="2" face="Arial"><i>MonthPanel</i></font>, its <font
size="2" face="Arial"><i>ordinal </i></font>location is supplied
to the constructor and can be obtained by the <font size="2"
face="Arial"><i>ordinalIs()</i></font> method but cannot be
changed after construction. The <font size="2" face="Arial"><i>dayNumber</i></font>
attribute is the day of the month which the box will display and
can be changed by the <font size="2" face="Arial"><i>setDayNumber()</i></font>
method or queried by the <font size="2" face="Arial"><i>getDayNumber()</i></font>
method. The <font size="2" face="Arial"><i>isHighlighted</i></font>
attribute indicates if the box should be highlighted and the <font
size="2" face="Arial"><i>setHighlight()</i></font> and <font
size="2" face="Arial"><i>clearHighlight()</i></font> methods
support it. </p>

<p>The <font size="2" face="Arial"><i>isPrimed</i></font>
attribute is used internally to indicate that a mouse down event
has occurred so a mouse up event should be responded to. The <font
size="2" face="Arial"><i>isBordered</i></font> attribute
indicates if the box should be displayed with a border, between
the time the mouse pointer enters and leaves it. </p>

<p>The <font size="2" face="Arial"><i>processMouseEvent()</i></font>
method is needed for the class to process mouse events happening
within itself and the <font size="2" face="Arial"><i>sendToHere</i></font>
attribute is the listener to which this method will dispatch
events generated when the mouse button is released within it. The
identity of the listener object is supplied to the instance in
the <font size="2" face="Arial"><i>listener</i></font> attribute
of its constructor. </p>

<p>The public <font size="2" face="Arial"><i>paint()</i></font>
method will render the box onto the screen showing its <font
size="2" face="Arial"><i>theDayNumber</i></font>, if valid, and
with highlighting and bordering as appropriate. The
implementation of this class, as far as the end of its
constructor is as follows. </p>

<pre><font size="3">0001  // Filename <i>DayBox.java</i>.
0002  // Provides the individual boxes which contain the 
0003  // day numbers in a <i>MonthPanel</i>.
0004  //
0005  // Written for JI book, Chapter 3 see text.
0006  // Fintan Culwin, v0.2, August 1997.
0007  
0008  <b>package</b> <i>DatePanel</i>;
0009  
0010  <b>import</b> java.awt.*;
0011  <b>import</b> java.awt.event.*;
0012  
0013  
0014  <b>class</b> <i>DayBox</i> <b>extends</b> Canvas {
0015  
0016  <b>private int</b>            <i>ordinal</i>       = -1;
0017  <b>private int</b>            <i>theDayNumber</i>  = 0;
0018  <b>private boolean</b>        <i>isHighlighted</i> = <b>false</b>;
0019  <b>private boolean</b>        <i>isBordered</i>    = <b>false</b>;
0020  <b>private boolean</b>        <i>isPrimed</i>      = <b>false</b>;
0021  <b>private</b> ActionListener <i>sendToHere</i>;
0022  
0023  
0024     <b>protected</b> <i>DayBox</i>( <b>int</b>            <i>itsLocation</i>,
0025                       ActionListener <i>listener</i>) { 
0026        <b>super</b>();
0027        <i>ordinal</i> = <i>itsLocation</i>;  
0028        <b>this</b>.enableEvents( AWTEvent.MOUSE_EVENT_MASK);
0029        <i>sendToHere</i> = <i>listener</i>;
0030     } // End <i>DayBox</i> constructor.
</font></pre>

<p>The header and attribute declarations contain no surprises,
with line 0014 indicating that this class is a non-<font size="2"
face="Arial"><b>public</b></font> member of the <font size="2"
face="Arial"><i>DatePanel</i> <b>package</b></font>. The
constructor commences by calling its parent (<font size="2"
face="Arial">Canvas</font>) constructor, stores the two arguments
in their corresponding instance attributes and then, on line
0028, enables <font size="2" face="Arial"><i>MouseEvent</i></font>s
on this component. The methods which manipulate its attributes
are as follows. </p>

<pre><font size="3">0033     <b>protected int</b> <i>getOrdinal</i>() { 
0034       <b>return</b> <i>ordinal</i>;   
0035     } // End <i>ordinalIs</i>.
0036      
0037  
0038     <b>protected void</b> <i>setHighlight</i>() {
0039        <i>isHighlighted</i> = <b>true</b>;
0040        <b>this</b>.repaint();
0041     } // End <i>setHighlight</i>.
0042  
0043     <b>protected void</b> <i>clearHighlight</i>() { 
0044        <i>isHighlighted</i> = <b>false</b>;
0045        <b>this</b>.repaint();      
0046     } // End <i>clearHighlight</i>.
0047     
0048     
0049     <b>protected void</b> <i>setDayNumber</i>( <b>int</b> <i>dayNumber</i>) { 
0050        <i>theDayNumber</i> = <i>dayNumber</i>;
0051     } // End <i>setDayNumber
</i>0052        
0053     <b>protected int</b> <i>getDayNumber</i>() {
0054        <b>return</b>  <i>theDayNumber</i>;
0055     } // End <i>getDayNumber</i></font></pre>

<p>The <font size="2" face="Arial"><i>setHighlight()</i></font>
and <font size="2" face="Arial"><i>clearHighlight()</i></font>
methods not only manipulate the value of the appropriate
attribute but also call the instance's <font size="2"
face="Arial">repaint()</font> method which will, indirectly, call
the <font size="2" face="Arial"><i>paint()</i></font> method
whose implementation is as follows. The calling of <font size="2"
face="Arial"><i>repaint()</i></font> will ensure that the effects
of this change of state become visible to the user in a timely
manner. </p>

<pre><font size="3">0058     <b>public void</b> <i>paint</i>( Graphics <i>context</i>) { 
0059     
0060     Dimension   <i>location</i>;
0061     String      <i>numString</i>;
0062     FontMetrics <i>metrics</i>;
0063     <b>int</b>         <i>stringHeight</i>;
0064     <b>int</b>         <i>stringWidth</i>; 
0065             
0066        <i>location</i> = <b>this</b>.getSize();
0067        <i>context</i>.setColor( <b>this</b>.getBackground());    
0068        <i>context</i>.fillRect( 0, 0, 
0069                          <i>location</i>.width-1,
0070                          <i>location</i>.height-1); 
0071        <i>context</i>.setColor( <b>this</b>.getForeground()); 
0072         
0073        <b>if</b> ( <i>theDayNumber</i> != 0 ) {
0074           <i>numString</i>    = Integer.toString( <i>theDayNumber</i>);         
0075           <i>metrics</i>      = <b>this</b>.getFontMetrics( <b>this</b>.getFont());
0076           <i>stringHeight</i> = metrics.getHeight();
0077           <i>stringWidth</i>  = metrics.stringWidth( <i>numString</i>); 
0078           <i>context</i>.drawString( <i>numString</i>, 
0079                              (<i>location</i>.width  - <i>stringWidth</i>)/2, 
0080                              (<i>stringHeight</i> + 2));
0081                               
0082           <b>if</b> ( <i>isHighlighted</i>) { 
0083              <i>context</i>.drawRect( 2, 2, 
0084                                <i>location</i>.width  - 4, 
0085                                <i>location</i>.height - 4);
0086              <i>context</i>.drawRect( 3, 3, 
0087                                <i>location</i>.width  - 6, 
0088                                <i>location</i>.height - 6);
0089           } // End if. 
0090           
0091           <b>if</b> ( <i>isBordered</i> ) { 
0092              <i>context</i>.drawRect( 1,1, 
0093                                <i>location</i>.width  - 2, 
0094                                <i>location</i>.height - 2);
0095           } // End if.                                    
0096        } // End if                                                                                                             
0097     } // End <i>paint</i>.</font></pre>

<p>The first part of this method, on lines 0066 to 0071, clears
the entire <font size="2" face="Arial"><i>DayBox</i></font>es'
window to its <font size="2" face="Arial">background</font> color
by setting the drawing color of the <font size="2" face="Arial">Graphics
<i>context</i></font> to the background color of the <font
size="2" face="Arial">dayBox</font> component and then drawing a
filled rectangle over its entire extent. Before continuing the
drawing color of the <font size="2" face="Arial"><i>context</i></font>
is reset to the <font size="2" face="Arial"><i>dayBox</i></font>'es
foreground color. If the <font size="2" face="Arial"><i>theDayNumber</i></font>
attribute is zero, indicating that the <font size="2"
face="Arial"><i>dayBox</i></font> is inactive, the method
concludes. </p>

<p>If the <font size="2" face="Arial"><i>dayBox</i></font> is
active, lines 0074 to 0080 render <font size="2" face="Arial"><i>theDayNumber</i></font>
in the center of its window, using techniques which are
comparable to those used to render a line of text into the <font
size="2" face="Arial"><i>MessageCanvas</i></font> in the previous
part of this chapter. The <font size="2" face="Arial"><i>DayBox</i></font>
class does not attempt to establish its own size, however it can
be guaranteed that its size will be large enough to contain the
day number, for reasons which will be explained in the next
section. </p>

<p>If the <font size="2" face="Arial"><i>isHighlighted</i></font>
attribute is set, lines 0082 to 0089 then draw the highlight
around the box by drawing two concentric outline rectangles
within the limits of its extremity. Lines 0091 to 0095 then draw
the single lined border, if the <font size="2" face="Arial"><i>isBordered</i></font>
attribute is set, as a single outline rectangle at its extremity.
Both of these parts of this method make use of the <font size="2"
face="Arial"><i>drawRectangle()</i></font> method of the <font
size="2" face="Arial">Graphics</font> class which will be
described in more detail in the next chapter. </p>

<p>The final <font size="2" face="Arial">DayBox</font> method, <font
size="2" face="Arial"><i>processMouseEvent()</i></font>, will be
called every time a mouse event occurs on the component and is
required to cause the component to react only if it is currently
active. It should border the component when the mouse enters it,
unborder the component as it leaves and dispatch an <font
size="2" face="Arial">ActionEvent</font> to its listener object
if the mouse button is pressed and released within the component.
Its implementation is as follows. </p>

<pre><font size="3">0100   <b>protected void</b> <i>processMouseEvent</i>( MouseEvent <i>event</i>) {   
0101      <b>if</b> ( <b>this</b>.<i>getDayNumber</i>() != 0) { 
0102         <b>switch</b> ( <b>event</b>.getID()) { 
0103          
0104            <b>case</b> MouseEvent.MOUSE_ENTERED:        
0105               <i>isBordered</i> = <b>true</b>;
0106               repaint();
0107               <b>break</b>;
0108                   
0109            <b>case</b> MouseEvent.MOUSE_EXITED: 
0110               <i>isBordered</i> = <b>false</b>;
0111               <i>isPrimed</i>   = <b>false</b>;
0112               repaint();
0113               <b>break</b>;
0114         
0115            <b>case</b> MouseEvent.MOUSE_PRESSED: 
0116               <i>isPrimed</i> = <b>true</b>;
0117               <b>break</b>;
0118         
0119            <b>case</b> MouseEvent.MOUSE_RELEASED: 
0120               <b>if</b> ( <b>this</b>.<i>isPrimed</i>){
0121                  <i>sendToHere</i>.actionPerformed( 
0122                                   <b>new</b> ActionEvent( <b>this</b>, 
0123                                   ActionEvent.ACTION_PERFORMED,
0124                                   &quot;DateSelected&quot;));  
0125               } // End if.
0126               <b>break</b>;                      
0127         } // End switch.   
0128      } // End if.   
0129   } // End <i>processMouseEvent</i>.</font></pre>

<p>Line 0101 prevents the method from being triggered if <font
size="2" face="Arial"><i>theDayNumber</i></font> attribute of the
<font size="2" face="Arial"><i>DayBox</i></font> is zero, which
indicates that it is inactive. Otherwise the <font size="2"
face="Arial">ID</font> attribute of the <font size="2"
face="Arial"><i>event</i></font> is used to select between
different courses of actions in the <font size="2" face="Arial"><b>switch</b></font>
structure between lines 0102 and 0127. If the <font size="2"
face="Arial">ID</font> indicates that the mouse pointer has
entered the component, lines 0104 to 0107 set the <font size="2"
face="Arial"><i>isBordered</i></font> attribute to <font size="2"
face="Arial"><b>true</b></font> and then <font size="2"
face="Arial"><i>repaint()</i></font> is called to provide
feedback to the user. If the <font size="2" face="Arial">ID</font>
indicates that the mouse pointer has left the component, lines
0109 to 0113 set the <font size="2" face="Arial"><i>isBordered</i></font>
attribute to <font size="2" face="Arial"><b>false</b></font> and <font
size="2" face="Arial"><i>repaint()</i></font> is called. The <font
size="2" face="Arial"><i>isPrimed</i></font> attribute, which may
have been set <font size="2" face="Arial"><b>true</b></font> by a
mouse down event, is also set <font size="2" face="Arial"><b>false</b></font>
in this situation to prevent an <font size="2" face="Arial">ActionEvent</font>
from being generated when it is not supposed to be. </p>

<p>On lines 0115 to 0117 the <font size="2" face="Arial"><i>isPrimed</i></font>
attribute is set <font size="2" face="Arial"><b>true</b></font>
when the mouse button is pressed down, but as this has no visible
feedback <font size="2" face="Arial">repaint()</font> is not
called. Lines 0122 to 0125 are executed when the mouse button is
released within a primed component and cause the <font size="2"
face="Arial"><i>actionPerformed()</i></font> method of the
listener object referenced by <font size="2" face="Arial"><i>sendToHere</i></font>
to be called with a <font size="2" face="Arial"><b>new</b></font>
<font size="2" face="Arial">ActionEvent</font> passed as its
event argument. The three arguments to the <font size="2"
face="Arial">ActionEvent</font> constructor, on lines 0122 to
0124, are the identity of the component which generated the event
(<font size="2" face="Arial"><b>this</b></font>), the <font
size="2" face="Arial">ID</font> of the event (<font size="2"
face="Arial">AcitonEvent.ACTION_PERFORMED</font>) and the <font
size="2" face="Arial">ActionCommand</font> attribute of the event
(&quot;<i>DateSelected</i>&quot;).</p>

<p>The mouse events do not directly cause the highlighting of a <font
size="2" face="Arial"><i>DayBox</i></font> component. This is the
responsibility of the listener object which is always the
instance of the <font size="2" face="Arial"><i>MonthPanel</i></font>
class within which all <font size="2" face="Arial"><i>DayBox</i></font>
instances are contained. The implementation of this class will be
described next.</p>

<hr>

<blockquote>
    <p><a href="code3\datepanel\daybox.java"><font size="5"><img
    src="list.gif" align="middle" border="0" width="40"
    height="35">DayBox.java</font></a></p>
</blockquote>

<hr>

<blockquote>
    <p><a href="c311.html"><img src="next.gif" align="middle"
    border="0" width="50" height="40"><font size="5">3.11 The </font><font
    size="5" face="Arial"><i>MonthPanel</i></font><font size="4">
    </font><font size="5">class</font></a></p>
    <p><a href="c39.html"><font size="3"><img src="last.gif"
    align="middle" border="0" width="50" height="40"></font><font
    size="5">3.9 The </font><font size="5" face="Arial"><i>DateUtility</i></font><font
    size="4"> </font><font size="5">class</font></a></p>
</blockquote>

<hr>
</body>
</html>
