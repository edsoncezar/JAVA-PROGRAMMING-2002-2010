<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPad 2.0">
<title> 7.7 The CommandLineTuttle class </title>
</head>

<body bgcolor="#FFFFFF">

<h1 align="center">7.7 The <font size="5" face="Arial"><i>CommandLineTuttle</i></font><font
size="6"> class</font></h1>

<p>The <font size="2" face="Arial"><i>CommandLineTuttle</i></font>
constructor is comparable to the other <font size="2"
face="Arial"><i>tuttle</i></font> interface constructors,
creating, configuring and installing an instance of the <font
size="2" face="Arial"><i>TextTuttle</i></font> class, the <font
size="2" face="Arial"><i>CommandLineTuttleInterface</i></font>
class and a <font size="2" face="Arial"><i>feedbackPanel</i></font>
into the interface. The <font size="2" face="Arial">ActionListener</font>
instance passed as an argument to the <font size="2" face="Arial"><i>CommandLineTuttleInterface</i></font>
constructor is the instance of the <font size="2" face="Arial"><i>CommandLineTuttle</i></font>
currently being initialised. Consequently this class has to
implement the <font size="2" face="Arial">ActionListener</font>
interface and so an <font size="2" face="Arial"><i>actionPerformed()</i></font>
method. The implementation of the class, presented without
comment, as far as the end of its <font size="2" face="Arial"><i>init()</i></font>
method, is as follows. </p>

<pre><font size="3">0001  // Filename <i>CommandLineTuttle.java</i>.
0002  // Supplies the command line translation for  
0003  // the <i>Tuttle</i> class.
0004  //
0005  // Written for Java Interface book chapter 7.
0006  // Fintan Culwin, v 0.2, August 1997.
0007  
0008  <b>package</b> <i>CommandLineTuttle</i>;
0009  
0010  <b>import</b> java.awt.*;
0011  <b>import</b> java.awt.event.*;
0012  <b>import</b> java.applet.*;
0013  
0014  <b>import</b> java.util.StringTokenizer;
0015  
0016  <b>import</b> <i>Tuttles.TextTuttle</i>;
0017  <b>import</b> <i>CommandLineTuttle.CommandLineTuttleInterface</i>;
0018  
0019  
0020  <b>public class</b> <i>CommandLineTuttle</i> <b>extends</b>    Applet 
0021                                 <b>implements</b> ActionListener {   
0022  
0023  <b>private</b> <i>TextTuttle</i>                 <i>theTuttle</i>; 
0024  <b>private</b> <i>CommandLineTuttleInterface</i> <i>theInterface</i>;
0025  
0026  <b>private</b> Panel                      <i>feedbackPanel</i>;
0027  <b>private</b> Label                      <i>feedbackLabel</i>;
0028  
0029     <b>public void</b> <i>init</i>() { 
0030     
0031     Panel <i>tuttlePanel</i> = <b>new</b> Panel();
0032                
0033        <b>this</b>.setLayout( <b>new</b> BorderLayout());
0034        <b>this</b>.setFont(   <b>new</b> Font( &quot;TimesRoman&quot;, Font.BOLD, 14));
0035        <b>this</b>.setBackground( Color.white);
0036  
0037        <i>theTuttle</i> = <b>new</b> <i>TextTuttle</i>( <b>this</b>, 400, 400);
0038        <i>tuttlePanel</i>.add( <i>theTuttle</i>);
0039        
0040        <i>theInterface</i> = <b>new</b> <i>CommandLineTuttleInterface</i>( <b>this</b>);        
0041                   
0042        <i>feedbackPanel</i> = <b>new</b> Panel();     
0043        <i>feedbackPanel</i>.setBackground( Color.white);
0044        <i>feedbackLabel</i> = <b>new</b> Label();
0045        <i>feedbackPanel</i>.add( <i>feedbackLabel</i>);
0046        
0047        <b>this</b>.add( <i>feedbackPanel</i>, &quot;North&quot;);
0048        <b>this</b>.add( <i>tuttlePanel</i>,   &quot;Center&quot;);
0049        <b>this</b>.add( <i>theInterface</i>,  &quot;South&quot;);
0050              
0051        <b>this</b>.<i>feedback</i>();
0052     } // End <i>init</i>.   </font></pre>

<p>As this class has been registered as the <font size="2"
face="Arial">actionListener</font> attribute of the single line <font
size="2" face="Arial"><i>commandArea</i></font> shown the user
its' <font size="2" face="Arial"><i>actionPerformed()</i></font>
method will be called every time the user presses the <font
size="2">&lt;ENTER&gt;</font> key in the command area of the
interface. The <font size="2" face="Arial"><i>actionCommand</i></font>
attribute of the <font size="2" face="Arial"><i>event</i></font>
passed as an argument to the <font size="2" face="Arial"><i>actionPerformed()</i></font>
method will contain the entire line of text from the <font
size="2" face="Arial"><i>commandArea</i></font>. </p>

<p>The basis of the <font size="2" face="Arial"><i>actionPerformed()</i></font>
method is to pass the command line, extracted from the <font
size="2" face="Arial">ActionEvent</font> argument of the method,
to <font size="2" face="Arial"><i>theTuttle</i></font> instance.
The method concludes by echoing the command, and any response
received from <font size="2" face="Arial"><i>theTuttle</i></font>,
in the feedback area before clearing the command area and
updating the tuttle's feedback <font size="2" face="Arial">Panel</font>.
This outline is complicated by the need to process the <i>help</i>
and <i>exit</i> commands separately. The implementation of the <font
size="2" face="Arial"><i>actionPerformed()</i></font> method is
as follows. </p>

<pre><font size="3">0055     <b>public void</b> <i>actionPerformed</i>( ActionEvent <i>event</i>) { 
0056  
0057     String          <i>theCommand</i> = <i>event</i>.getActionCommand();
0058     StringTokenizer <i>tokenizer</i>  = <b>new</b> StringTokenizer( <i>theCommand</i>);
0059     String          <i>firstTerm</i>  = <i>tokenizer</i>.nextToken().toLowerCase();
0060     String          <i>theResponse</i>;
0061  
0062         <b>if</b> ( <i>firstTerm</i>.equals( &quot;help&quot;)) { 
0063           <i>theResponse</i> = <i>obtainHelp</i>( <i>tokenizer</i>);
0064         } <b>else if</b> ( <i>firstTerm</i>.equals( &quot;exit&quot;)) {   
0065           <i>theResponse</i> = <i>checkExit</i>( <i>tokenizer</i>);
0066         } <b>else</b> {        
0067           <i>theResponse</i> = <i>theTuttle</i>.<i>doCommand</i>( <i>theCommand</i>); 
0068         } // End if           
0069
0070         <i>theInterface</i>.<i>appendFeedback</i>( &quot;\n&gt; &quot; + <i>theCommand</i>);
0071         <b>if</b> ( <i>theResponse</i>.length() &gt; 0 ) { 
0072            <i>theInterface</i>.<i>appendFeedback</i>(&quot;\n&quot; + <i>theResponse</i>);    
0073         } // End if.   
0074         <i>theInterface</i>.<i>clearCommandArea</i>();
0075         <b>this</b>.<i>feedback</i>();
0076     } // End <i>actionPerformed</i>.</font></pre>

<p>Lines 0057 to 0059 prepare a <font size="2" face="Arial">StringTokenizer</font>
instance, called <font size="2" face="Arial"><i>tokenizer</i></font>,
initialized to parse the command extracted from the <font
size="2" face="Arial"><i>event</i></font> argument, using its <font
size="2" face="Arial"><i>getActionCommand()</i></font> method,
and extracts the first term of the command into the local <font
size="2" face="Arial">String <i>firstTerm</i></font>. Line 0060
declares a <font size="2" face="Arial">String</font> instance
called <font size="2" face="Arial"><i>theResponse</i></font>
ready to receive any reply from <font size="2" face="Arial"><i>theTuttle</i></font>.
</p>

<p>Lines 0062 and 0063 deal with a <i>help</i> command by using
the <font size="2" face="Arial"><i>obtainHelp()</i></font> method
which will be described below, likewise lines 0064 to 0065 deal
with an <i>exit</i> command by using the <font size="2"
face="Arial"><i>checkExit()</i></font> method. All other commands
are passed to <font size="2" face="Arial"><i>theTuttle</i></font>
on line 0067, by calling its' <font size="2" face="Arial"><i>doCommand()</i></font>
method passing the entire command line retrieved from the <font
size="2" face="Arial"><i>event</i></font> as its argument. As
explained above the <font size="2" face="Arial"><i>doCommand()</i></font>
method will attempt to interpret the command and, if it is valid,
instruct the <i>tuttle</i> to obey it. If it cannot be
interpreted as a valid tuttle command the <font size="2"
face="Arial"><i>doCommand()</i></font> method will return an
explanation which will be stored in <font size="2" face="Arial"><i>theResponse</i></font>.
</p>

<p>Line 0070 echoes <font size="2" face="Arial"><i>theCommand</i></font>
to the feedback area on <font size="2" face="Arial"><i>theInterface</i></font>,
preceded by a chevron ('&gt;'), by using its <font size="2"
face="Arial"><i>appendFeedback()</i></font> method. Lines 0071 to
0073 follow this by the contents of <font size="2" face="Arial"><i>theResponse</i></font>,
if any. The method concludes, on lines 0074 and 0075, by clearing
the command area on <font size="2" face="Arial"><i>theInterface</i></font>,
ready for the next command and updating the <font size="2"
face="Arial"><i>feedbackPanel</i></font> as usual. </p>

<p>As indicated on Figure 7.5 the command &quot;<i>help</i>&quot;
by itself will provide a list of recognized commands, &quot;<i>help</i>&quot;
followed by one of the possible tuttle commands will provide
specific help for that command and anything else will be reported
as an unknown command with the further advice to try &quot;<i>help</i>&quot;
by itself. The <font size="2" face="Arial"><i>obtainHelp()</i></font>
method, implemented as follows, will be called from the <font
size="2" face="Arial"><i>actionPerformed()</i></font><i> </i>method
when &quot;<i>help</i>&quot; is identified in the first term of
the user's command, and will return a suitable response to be
subsequently displayed in the text feedback area.</p>

<pre><font size="3">0090     <b>private</b> String <i>obtainHelp</i>( StringTokenizer <i>tokenizer</i>) { 
0091     
0092     StringBuffer <i>theHelp</i> = <b>new</b> StringBuffer( &quot;&quot;);
0093     String       <i>secondTerm</i>;
0094     <b>int</b>          <i>helpFor</i>;   
0095  
0096        <b>if</b> ( ! <i>tokenizer</i>.hasMoreTokens()) { 
0097           <i>theHelp</i>.append( &quot;help is available for fd, bd, tr, tl &quot; + 
0098                           &quot;fg bg pu pd cl rs cr and exit&quot;);
0099        } <b>else</b> {    
0100            <i>secondTerm</i> = <i>tokenizer</i>.nextToken().toLowerCase();
0101            <i>helpFor</i> = <i>theTuttle</i>.identifyCommand( <i>secondTerm</i>);
0102            
0103            <b>switch</b> ( <i>helpFor</i>) { 
0104            <b>case</b> <i>theTuttle.FORWARD</i>:
0105               <i>theHelp</i>.append(&quot;fd is ForwarD, it must be followed by a number, &quot; + 
0106                              &quot;\nthe tuttle will move that many steps in its &quot; + 
0107                              &quot;current direction.&quot;);
0108               <b>break</b>;

<b>----            // Other branches omitted.

</b>0187            <b>case</b> <i>theTuttle.UNKNOWN</i>:
0188               <i>theHelp</i>.append(&quot;Sorry! The command '&quot; + secondTerm + 
0189                              &quot;' is not known \n Try 'help' by itself for &quot; +
0190                              &quot;a list of commands which are known.&quot;);
0191               <b>break</b>;                                 
0192            
0193            } // End switch.
0194        } // End if.    
0195        <b>return</b> <i>theHelp</i>.toString();
0196     } // End <i>obtainHelp</i>.</font></pre>

<p>The command &quot;<i>help</i>&quot; by itself will be detected
on line 0096, by the absence of a second term in the <font
size="2" face="Arial">StringTokenizer</font> <font size="2"
face="Arial"><i>tokenizer</i></font> argument, and causes a
suitable message to be placed in <font size="2" face="Arial"><i>theHelp</i>
StringBuffer</font> on lines 0097 to 0098. Otherwise, on line
0100, the second term is extracted from the <font size="2"
face="Arial"><i>tokenizer</i></font> and passed to the <font
size="2" face="Arial"><i>TextTuttle identifyCommand()</i></font>
method on line 0101. A fourteen way <font size="2" face="Arial"><b>switch</b></font>
structure, starting on line 0103, contains a branch for each
recognized command placing a suitable message for each into <font
size="2" face="Arial"><i>theHelp</i></font>. The last branch of
the <font size="2" face="Arial"><b>switch</b></font> structure,
on lines 0187 to 0191, provides help if the second term of the
command was not recognized by the <font size="2" face="Arial"><i>TextTuttle</i></font>
as a valid command. The method concludes, on line 0195, by
returning the <font size="2" face="Arial">String</font> contained
in <font size="2" face="Arial"><i>theHelp</i></font>. </p>

<p>Figure 7.5 illustrates the operation of this method. The
&quot;<i>help&nbsp;fd&quot;</i> command was typed in by the user
and the help obtained, from lines 0105 to 0107 of the <font
size="2" face="Arial"><i>obtainHelp()</i></font> method, is shown
following the command in the feedback area. This was followed by
a &quot;<i>help&nbsp;me&quot;</i> request which causes the <font
size="1" face="Arial">UNKNOWN </font>branch to be taken and the
resulting message is shown.</p>

<p>The remaining <font size="2" face="Arial"><i>checkExit()</i></font>
method is somewhat similar and is implemented as follows. </p>

<pre><font size="3">0078     <b>private</b> String <i>checkExit</i>( StringTokenizer <i>tokenizer</i>) {    
0079        <b>if</b> ( (<i>tokenizer</i>.countTokens() == 1)  &amp;&amp;
0080             (<i>tokenizer</i>.nextToken().toLowerCase().equals( &quot;please&quot;)) ){ 
0081           System.exit( 0);
0082           <b>return</b> &quot;&quot;;  
0083        } <b>else</b> {               
0084           <b>return new</b> String( &quot;To exit from this application you have to &quot; +
0085                              &quot;type 'exit', followed by 'please'!&quot;);         
0086        } // End if.
0087     } // End <i>checkExit</i>.</font></pre>

<p>Lines 0079 and 0080 check to see if there is a second term
following the exit command and, if so, if it is &quot;<i>please&quot;</i>.
Only if both these conditions are satisfied will the applet
terminate on line 0081; a more complete applet might have to
perform some housekeeping at this stage before exiting. Otherwise
if the command was not given as <i>exit&nbsp;please</i>, on lines
0084 and 0085 advice on how to exit from the applet is returned
to be displayed in <font size="2" face="Arial"><i>theInterface</i></font>'s
feedback area. </p>

<p>&nbsp;</p>

<hr>

<blockquote>
    <p><a
    href="..\tuttles\commandlinetuttle\commandlinetuttle.java"><font
    size="5"><img src="list.gif" align="middle" border="0"
    width="40" height="35"> CommandLineTuttle.java</font></a></p>
    <p><a href="..\tuttles\commandlinetuttle.html"><font size="5"><img
    src="run.gif" align="middle" border="0" width="40"
    height="27"> CommandLineTuttle</font></a></p>
</blockquote>

<hr>

<blockquote>
    <p><a href="ch78.html"><font size="5"><img src="next.gif"
    align="middle" border="0" width="50" height="40">7.8
    Evaluating the interfaces</font></a></p>
    <p><a href="ch76.html"><font size="4"><img src="last.gif"
    align="middle" border="0" width="50" height="40"></font><font
    size="5">7.6 The </font><font size="4" face="Arial"><i>CommandLineTuttleInterface</i></font><font
    size="4"> </font><font size="5">class</font></a></p>
</blockquote>

<hr>
</body>
</html>
