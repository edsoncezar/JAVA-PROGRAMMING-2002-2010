<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPad 2.0">
<title> 7.4 The TextMenuTuttle class </title>
</head>

<body bgcolor="#FFFFFF">

<h1 align="center">7.4 The <font size="5" face="Arial"><i>TextMenuTuttle</i></font><font
size="5"> </font><font size="6">class</font></h1>

<p>As with the previous tuttle interfaces this class, which
extends the <font size="2" face="Arial">Applet</font> class, has
the responsibility, in its <font size="2" face="Arial"><i>init()</i></font>
method, of configuring itself, creating an instance of the <font
size="2" face="Arial"><i>TextTuttle</i></font> class, creating an
instance of the <font size="2" face="Arial"><i>TextMenuTuttleInterface</i></font>
class to control the tuttle, creating a feedback area and then
placing the interface into a well defined initial state so that,
on its conclusion, the interface becomes visible to the user. The
implmentation of the class, as far as the end of its constructor,
is as follows. </p>

<pre><font size="3">0001  // Filename <i>TextMenuTuttle.java</i>.
0002  // Supplies a main application text menu  
0003  // interface the <i>TextTuttle</i> class.
0004  //
0005  // Written for Java Interface book chapter 7.
0006  // Fintan Culwin, v 0.2, August 1997.
0007  
0008  <b>package</b> <i>TextMenuTuttle</i>;
0009  
0010  <b>import</b> java.awt.*;
0011  <b>import</b> java.applet.*;
0012  <b>import</b> java.awt.event.*;
0013  
0014  <b>import</b> <i>Tuttles.TextTuttle</i>;
0015  <b>import</b> <i>TextMenuTuttle.TextMenuTuttleInterface</i>;
0016  
0017  <b>public class</b> <i>TextMenuTuttle</i> <b>extends</b>    Applet
0018                              <b>implements</b> KeyListener {   
0019  
0020  <b>private</b> <i>TextTuttle</i>               <i>theTuttle</i>; 
0021  <b>private</b> <i>TextMenuTuttleInterface</i>  <i>theInterface</i>;
0022
0023  <b>private</b> Panel                    <i>feedbackPanel</i>;
0024  <b>private</b> Label                    <i>feedbackLabel</i>;
0026  
0027  
0028     <b>public</b><i> </i><b>void</b> <b>init</b>() { 
0029        
0030     Panel <i>tuttlePanel</i>;   
0031           
0032        <b>this</b>.setLayout( <b>new</b> BorderLayout());
0033        <b>this</b>.setFont( <b>new</b> Font( &quot;TimesRoman&quot;, Font.BOLD, 14));
0034        <b>this</b>.setBackground( Color.white);
0035  
0036        <i>tuttlePanel</i> = <b>new</b> Panel();   
0037        <i>theTuttle</i>   = <b>new</b> TextTuttle( <b>this</b>, 400, 400);
0038        <i>tuttlePanel</i>.add( <i>theTuttle</i>);
0039                
0040        <i>theInterface</i>  = <b>new</b> TextMenuTuttleInterface( <b>this</b>);
0041         
0042        <i>feedbackPanel</i> = <b>new</b> Panel();     
0043        <i>feedbackLabel</i> = <b>new</b> Label();
0044        <i>feedbackPanel</i>.add( <i>feedbackLabel</i>);
0045        
0046        <b>this</b>.add( feedbackPanel, &quot;North&quot;);
0047        <b>this</b>.add( tuttlePanel,   &quot;Center&quot;);
0048        <b>this</b>.add( theInterface,  &quot;South&quot;);
0049        
0050        <b>this</b>.<i>feedback</i>();
0051        <i>theInterface</i>.<i>setMenuState</i>( <i>TextMenuTuttleInterface</i>.<i>TOP_LEVEL_MENU</i>);
0052     } // End <i>init</i>.   </font></pre>

<p>The majority of this constructor is largely comparable to the
corresponding constructors from the previous tuttle interfaces.
The significant differences are that an instance of the <font
size="2" face="Arial"><i>TextMenuTuttleInterface</i></font>,
called <font size="2" face="Arial"><i>theInterface</i></font>, is
constructed on line 0040 and subsequently <font size="2"
face="Arial">add</font>ed to the <font size="2" face="Arial">applet
Panel</font> in its &quot;<font size="2" face="Arial"><i>South</i></font>&quot;
location on line 0048. It has its state set to <font size="1"
face="Arial"><i>TOP_LEVEL_MENU</i></font>, on line 0051, before
the method concludes. This will ensure that the interface, when
first visible to the user, is something like that shown in Figure
7.2. </p>

<p>The identity of <font size="2" face="Arial"><b>this</b></font>
instance of the <font size="2" face="Arial"><i>TextMenuTuttle</i></font>
class is passed to <font size="2" face="Arial"><i>theInterface</i></font>
as it is constructed and, in order for this to be allowed, the <font
size="2" face="Arial"><i>TextMenuTuttle</i></font> class has to
implement the <font size="2" face="Arial">KeyListener</font>
interface, as stated on line 0019. The <font size="2"
face="Arial">KeyListener</font> interface requires the class to
supply <font size="2" face="Arial"><i>keyTyped()</i></font>, <font
size="2" face="Arial"><i>keyPressed()</i></font> and <font
size="2" face="Arial"><i>keyReleased()</i></font> methods which
will be called as appropriate when the user interacts with the
keyboard. A <font size="2" face="Arial">KeyEvent</font> instance
will be passed as an argument to these methods which contains,
amongst other things, an attribute called <font size="2"
face="Arial">keyChar</font> indicating which key on the keyboard
was pressed. This class is only concerned with processing <font
size="2" face="Arial">KeyTyped</font> events and the
implementation of the three <font size="2" face="Arial">KeyListener</font>
methods is as follows. </p>

<pre><font size="3">0057     <b>public void</b> <i>keyTyped</i>( KeyEvent <i>event</i>) {   
0058  
0059     <b>char</b> <i>pressed</i>  = <i>event</i>.getKeyChar();
0060     <b>int</b>  <i>newMenu</i>  = <i>TextMenuTuttleInterface.TOP_LEVEL_MENU</i>;
0061     
0062        <b>switch</b> ( <i>theInterface</i>.<i>menuStateIs</i>()) {
0063        
0064        <b>case</b> <i>TextMenuTuttleInterface</i>.<i>TOP_LEVEL_MENU</i>:  
0065           <i>newMenu</i> = <i>topLevelMenu</i>( <i>pressed</i>);
0066           <b>break</b>;
0067              
0068        <b>case</b> <i>TextMenuTuttleInterface.MOVE_MENU</i>:     
0069           <i>newMenu</i> = <i>moveMenu</i>( <i>pressed</i>);
0070           <b>break</b>;
0071       
0072        <b>case</b> <i>TextMenuTuttleInterface</i>.<i>MOVE_FORWARD_MENU</i>: 
0073           <i>newMenu</i> = <i>moveForwardMenu</i>( <i>pressed</i>);
0074           <b>break</b>;  
0075              

<b>----        // Other cases omitted.

</b>0116        <b>case</b> <i>TextMenuTuttleInterface.EXIT_MENU</i>:
0117           <i>newMenu</i> = <i>exitMenu</i>( <i>pressed</i>);                     
0118           <b>break</b>; 
0119                                                                        
0120        } // End switch <i>menuState</i>.
0121           
0122       <i>theInterface</i>.<i>setMenuState</i>( <i>newMenu</i>);      
0123       <b>this</b>.<i>feedback</i>();
0124     } // End <i>keyTyped</i>.
0125  
0126     <b>public void</b> <i>keyPressed</i>(  KeyEvent <i>event</i> ) {}  // End <i>keyPressed</i>.
0127     <b>public void</b> <i>keyReleased</i>( KeyEvent <i>event</i> ) {}  // End <i>keyReleased</i>.</font></pre>

<p>The <font size="2" face="Arial"><i>keyTyped()</i></font>
method commences, on line 0059, by retrieving the identity of the
key typed from the <font size="2" face="Arial">KeyEvent <i>event</i></font>
and storing it in the local <font size="2" face="Arial"><b>char</b></font>acter
variable <font size="2" face="Arial"><i>pressed</i></font>. A
second local variable called <font size="2" face="Arial"><i>newMenu
</i></font>of type <font size="2" face="Arial"><b>int</b></font>
is declared on line 0060. This variable will be used to represent
the menu which should be displayed after this <font size="2"
face="Arial">KeyEvent</font> has been processed and is
initialised to a default value indicating that the <font size="1"
face="Arial"><i>TOP_LEVEL_MENU</i></font> should be shown.</p>

<p>The major part of the method, between lines 0062 and 0120, is
a <font size="2" face="Arial"><b>switch</b></font> structure
containing a branch for every possible menu state; its selector
expression is a call of the <font size="2" face="Arial"><i>theInterface</i></font>'s
<font size="2" face="Arial"><i>menuStateIs()</i></font> method.
Each branch calls a <font size="2" face="Arial"><b>private</b></font>
method, with a systematic name, to deal with the key<font
size="2" face="Arial"><i> pressed</i></font>. For example if the
application has just been started then it will be in the <font
size="1" face="Arial"><i>TOP_LEVEL_MENU</i></font> state, as
described above. If the user presses and releases the 't' key on
the keyboard a <font size="2" face="Arial">keyEvent</font>
containing '<i>m</i>' will be constructed and passed as the <font
size="2" face="Arial"><i>event</i></font> argument to the <font
size="2" face="Arial"><i>keyTyped()</i></font> method. The <font
size="2" face="Arial"><b>switch</b></font> selector on line 0062
will identify the <font size="1" face="Arial"><i>TOP_LEVEL_MENU</i></font>
state causing the branch on line 0065 to be taken, calling the <font
size="2" face="Arial"><i>topLevelMenu()</i></font> method and
passing as an argument the <font size="2" face="Arial">keyChar</font>acter
extracted from the <font size="2" face="Arial"><i>event</i></font>
on line 0059. The <font size="2" face="Arial"><i>topLevelMenu()</i></font>
method will process this character and return the identity of the
menu state which the interface is to transit to. All other
possible states have associated methods each of which takes as an
argument the identity of the key <font size="2" face="Arial"><i>pressed</i></font>
and returns the manifest value of the <font size="2" face="Arial"><i>newMenu</i></font>
to be displayed; examples of these methods will be given below. </p>

<p>Following the end of the <font size="2" face="Arial"><b>switch</b></font>
structure in the <font size="2" face="Arial"><i>keyTyped()</i></font>
method, the <font size="2" face="Arial"><i>setMenuState()</i></font>
method of <font size="2" face="Arial"><i>theInterface</i></font>
is called passing as an argument the <font size="2" face="Arial"><i>newMenu</i></font>
to be displayed. The final action of the <font size="2"
face="Arial"><i>keyTyped</i></font> method is to update the <font
size="2" face="Arial"><i>feedback</i> Panel</font> shown at the
top of the interface. The other two required methods of the <font
size="2" face="Arial">KeyListener</font> interface, <font
size="2" face="Arial"><i>keyPressed()</i></font> and <font
size="2" face="Arial"><i>keyReleased()</i></font> need not do
anything are declared as dummy methods on lines 0126 and 0127 in
order to satisfy the requirements of the <font size="2"
face="Arial">KeyListener</font> interface which this class
implements. </p>

<p>The <font size="2" face="Arial"><i>topLevelMenu()</i></font>
method, called from <font size="2" face="Arial"><i>keyTyped()</i></font>
whenever the interface is in its <font size="1" face="Arial"><i>TOP_MENU_STATE</i></font>,
is implemented as follows. It consists of a <font size="2"
face="Arial"><b>switch</b></font> statement, containing a branch
for each possible combination of key presses which the menu is to
respond to. Each branch sets the value of the local variable <font
size="2" face="Arial"><i>newMenuState</i></font> to indicate the
appropriate menu state which the interface is to transit to. On
line 0171 this value is <font size="2" face="Arial"><b>return</b></font>ed
from the method and, if none of the branches have been activated,
will contain its default value <font size="1" face="Arial"><i>TOP_LEVEL_MENU</i></font>.
The returned value will be used by the <font size="2"
face="Arial"><i>keyTyped()</i></font> method to set the state of
the menu. The effect is that if the user presses one of the
expected keys then the interface will transit to the appropriate
state otherwise it will remain in the <font size="1" face="Arial"><i>TOP_LEVEL_MENU
</i></font>state. </p>

<pre><font size="3">0131     <b>private int</b> <i>topLevelMenu</i>( <b>char</b> <i>pressed</i>) { 
0132     
0133     <b>int</b> <i>newMenuState</i> = <i>TextMenuTuttleInterface.TOP_LEVEL_MENU</i>; 
0134     
0135        <b>switch</b>( <i>pressed</i>) { 
0136        <b>case</b> 'M':
0137        <b>case</b> 'm':         
0138           <i>newMenuState</i> = <i>TextMenuTuttleInterface.MOVE_MENU</i>; 
0139           <b>break</b>;
0140  
0141        <b>case</b> 'T':
0142        <b>case</b> 't':
0143           <i>newMenuState</i> = <i>TextMenuTuttleInterface.TURN_MENU</i>;
0144           <b>break</b>;           
0145  

<b>---         // Other cases omitted. 

</b>0166        <b>case</b> 'E':
0167        <b>case</b> 'e':
0168           <i>newMenuState</i> = <i>TextMenuTuttleInterface.EXIT_MENU</i>;
0169           <b>break</b>;           
0170        } // End switch.
0171        <b>return</b> <i>newMenuState</i>;
0172     } // End <i>topLevelMenu</i></font></pre>

<p>Following the example above which assumed that the user
pressed '<i>m</i><b><i>'</i></b>: this will cause the branch on
line 0143 to be followed causing this method to return the value <font
size="1" face="Arial"><i>TURN_MENU</i></font> on line 0171. As
explained above this will result in the interface presenting the
user with the text menu shown at the top of Figure 7.3. The next
time the user uses the keyboard the <font size="2" face="Arial"><i>keyPressed()</i></font>
method will result in a call of the <font size="2" face="Arial"><i>moveMenu()</i></font>
method whose implementation is as follows. </p>

<pre><font size="3">0175     <b>private int</b> <i>moveMenu</i>( <b>char</b> <i>pressed</i>) { 
0176     
0177     <b>int</b> <i>newMenuState</i> = <i>TextMenuTuttleInterface.MOVE_MENU</i>;
0178  
0179        <b>switch</b>( <i>pressed</i>) { 
0180        <b>case</b> KeyEvent.VK_ESCAPE:
0181           <i>newMenuState</i> = <i>TextMenuTuttleInterface.TOP_LEVEL_MENU</i>; 
0182           <b>break</b>;
0183  
0184        <b>case</b> 'F':
0185        <b>case</b> 'f': 
0186           <i>newMenuState</i> = <i>TextMenuTuttleInterface.MOVE_FORWARD_MENU</i>; 
0187           <b>break</b>;      
0188        
0189        <b>case</b> 'B':
0190        <b>case</b> 'b': 
0191           <i>newMenuState</i> = <i>TextMenuTuttleInterface.MOVE_BACKWARD_MENU</i>; 
0192           <b>break</b>;
0193        } // End switch.   
0194        <b>return</b> <i>newMenuState</i>;
0195     } // End <i>moveMenu</i>.</font></pre>

<p>The implementation of this method is directly comparable to
the implementation of the <font size="2" face="Arial"><i>topLevelMenu()</i></font>
method above. It will respond to presses of the <font size="1"
face="Arial">&lt;ESCAPE&gt;</font> key by transiting back to the <font
size="1" face="Arial"><i>TOP_LEVEL_MENU</i></font> state, the '<b><i>f</i></b>'
or '<b><i>F</i></b>' key to the <font size="1" face="Arial"><i>MOVE_FORWARD_MENU</i></font>
state and the '<b><i>b</i></b>' or '<b><i>B</i></b>' key to the <font
size="1" face="Arial"><i>MOVE_BACKWARD_MENU</i></font> state, any
other key will leave the interface in the <font size="1"
face="Arial"><i>MOVE_MENU</i></font> state. The identity of the <font
size="1" face="Arial">&lt;ESCAPE&gt;</font> key is established,
on line 0180, by using the manifest value <font size="2"
face="Arial">VK_ESCAPE</font> (<i>V</i>irtual <i>K</i>ey <i>Escape</i>)
supplied by the <font size="2" face="Arial">KeyEvent</font>
class. Assuming that the user presses the '<b><i>f</i></b>' or '<b><i>F</i></b>'
key the interface will appear as shown at the bottom of figure
7.3 and the next <font size="2" face="Arial"><i>KeyEvent</i></font>
generated will cause the <font size="2" face="Arial"><i>KeyTyped()</i></font>
method to call the <font size="2" face="Arial"><i>moveForwardMenu()</i></font>
method, implemented as follows. <br>
</p>

<pre><font size="3">0198     <b>private int</b> <i>moveForwardMenu</i>( <b>char</b> <i>pressed</i>) { 
0199     
0200     <b>int</b> <i>newMenuState</i> = <i>TextMenuTuttleInterface.MOVE_FORWARD_MENU</i>;
0201  
0202        <b>switch</b>( <i>pressed</i>) { 
0203        <b>case</b> KeyEvent.VK_ESCAPE:
0204           <i>newMenuState</i> = <i>TextMenuTuttleInterface.MOVE_MENU</i>; 
0205           <b>break</b>;
0206  
0207        <b>case</b> '5':               
0208           <i>theTuttle.doCommand</i>(&quot;fd 5&quot;);
0209           <b>break</b>;
0210              
0211        <b>case</b> '1':
0212           <i>theTuttle.doCommand</i>(&quot;fd 10&quot;); 
0213           <b>break</b>;
0214              
0215        <b>case</b> '2':
0216           <i>theTuttle.doCommand</i>(&quot;fd 25&quot;);  
0217           <b>break</b>;            
0218        } // End switch.
0219        <b>return</b> <i>newMenuState</i>;
0220     } // End <i>moveForwardMenu</i>.   </font></pre>

<p>In this method pressing the <font size="1" face="Arial">&lt;ESCAPE&gt;</font>
key effects a transit back to the <font size="1" face="Arial"><i>MOVE_MENU</i></font>
state and other key presses will leave the interface in the <font
size="1" face="Arial"><i>MOVE_FORWARD_MENU</i></font><font
size="2" face="Arial"> </font>state. However pressing the '<b><i>5</i></b>',
'<b><i>1</i></b>' or '<b><i>2</i></b>' key will cause the <font
size="2" face="Arial"><i>theTuttle doCommand()</i></font> method
to be called, passing as an argument a suitable command string.
So if the user presses the '<b><i>1</i></b>' key the <font
size="2" face="Arial"><i>tuttle</i></font> will move forward 10
steps. As the <font size="2" face="Arial"><i>keyPressed()</i></font>
method concludes by calling the <font size="2" face="Arial"><i>feedback()</i></font>
method, whose implementation does not differ from those presented
in previous chapters, the new status of the <i>tuttle</i> will be
reported at the top of the interface. The menu system will remain
in the <font size="1" face="Arial"><i>MOVE_FORWARD_MENU</i></font><font
size="2" face="Arial"> </font>state until the <font size="1"
face="Arial">&lt;ESCAPE&gt;</font> key is pressed, allowing the
user to rapidly move the <i>tuttle</i> in its current direction.</p>

<p>A consideration of the three methods described, and the
corresponding <font size="2" face="Arial"><i>moveBackwardAction()</i></font>
will show that the behavior of the interface is as described in
the STD from Figure 7.4. The remaining parts of the <font
size="2" face="Arial"><i>TextMenuTuttle</i></font> class are
essentially identical with a specific method for each of the
possible menu states, whose implementations are comparable to
those presented above. The only significant difference is in the <font
size="2" face="Arial"><i>exitMenu()</i></font> method, as
follows, where pressing the '<b><i>y</i></b>' or '<b><i>Y</i></b>'
key will cause the applet to terminate. </p>

<pre><font size="3">0512   <b>private int</b> <i>exitMenu</i>( <b>char</b> <i>pressed</i>) { 
0513   
0514   <b>int</b> <i>newMenuState</i> = <i>theInterface</i>.<i>HELP_MENU</i>;
0515   
0516      <b>switch</b>( <i>pressed</i>) { 
0517      <b>case</b> KeyEvent.VK_ESCAPE:
0518         <i>newMenuState</i> = <i>theInterface</i>.<i>TOP_LEVEL_MENU</i>;
0519         <b>break</b>;
0520
0521      <b>case</b> 'Y':
0522      <b>case</b> 'y':         
0523         System.exit( 0);
0524         <b>break</b>;                 
0525      
0526      <b>case</b> 'N':
0527      <b>case</b> 'n':
0528         <i>newMenuState</i> = <i>theInterface</i>.<i>TOP_LEVEL_MENU</i>;
0529         <b>break</b>;          
0530      } // End switch. 
0531          
0532      <b>return</b> <i>newMenuState</i>;
0533   } // End <i>exitMenu</i>.</font></pre>

<p>The operation of this system provides a demonstration of the
correct implementation of the <font size="2" face="Arial"><i>TextTuttle</i></font>
class which will be further demonstrated by the <font size="2"
face="Arial"><i>CommandLineTuttle</i></font> class. Details of
how to obtain the parts of the source code which have been
omitted from this part of the chapter are contained in Appendix
B.</p>

<p>&nbsp;</p>

<hr>

<blockquote>
    <p><a href="..\tuttles\textmenututtle\textmenututtle.java"><img
    src="list.gif" align="middle" border="0" width="40"
    height="35"><font size="5"> TextMenuTuttle.java</font></a></p>
    <p><a href="..\tuttles\textmenututtle.html"><font size="5"><img
    src="run.gif" align="middle" border="0" width="40"
    height="27"> TextMenuTuttle</font></a></p>
</blockquote>

<hr>

<blockquote>
    <p><a href="ch75.html"><img src="next.gif" align="middle"
    border="0" width="50" height="40"><font size="5">7.5 The </font><font
    size="4" face="Arial"><i>CommandLineTuttle</i></font><font
    size="5"> interface </font></a></p>
    <p><a href="ch73.html"><font size="6"><img src="last.gif"
    align="middle" border="0" width="50" height="40"></font><font
    size="5">7.3 The </font><font size="4" face="Arial"><i>TextMenuTuttleInterface</i></font><font
    size="2" face="Arial"><i> </i></font></a></p>
</blockquote>

<hr>
</body>
</html>
