<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPad 2.0">
<title> 5.1 The TuttleButton class</title>
</head>

<body bgcolor="#FFFFFF">

<h1 align="center">5.1 The <font size="6" face="Arial"><i>TuttleButton</i></font><font
size="6"> class</font></h1>

<p>The <font size="2" face="Arial"><i>TuttleButton</i></font>
class will supply a button which implements push-button behaviour
and is capable of displaying an image, instead of the text label
of the pre-supplied Java AWT <font size="2" face="Arial"><i>Button</i></font>
class. The state transition diagram of the behaviour of a
push-button is presented in Figure 5.1 and Table 5.1.</p>

<p align="center"><font size="2"><b><img src="fig51.gif"
width="301" height="264"></b></font></p>

<p align="center"><font size="3"><b>Figure 5.1</b> The </font><font
size="3" face="Arial"><i>TuttleButton</i></font><font size="3">
State Transition Diagram</font></p>

<p align="center"><b><img src="table51.gif" width="636"
height="209"></b></p>

<p align="center"><b>Table 5.1</b> State table for the <font
face="Arial"><i>TuttleButton</i></font> STD in Figure 5.1.</p>

<p>The behaviour indicates that a button becomes <i>primed</i>
when the mouse button is pressed whilst the mouse pointer is
inside the button; this is confirmed to the user by a visual
feedback which shows the button as if it were depressed. If the
button is released whilst the mouse pointer is still inside the
button the button is raised and an action event is generated, as
indicated by the dashed arrow leaving transition 4. However, if
the mouse pointer is moved outside the button after being primed,
the button will be un-primed and raised, and when the mouse
pointer is subsequently released no action event will be
generated. </p>

<p align="center"><b><img src="fig52.gif" width="147" height="60"></b></p>

<p align="center"><b>Figure 5.2</b> Highlighting of buttons, (the
reversal of the icon is not significant).</p>

<p>The mechanism for showing a raised and depressed button is
illustrated in Figure 5.2. The button is surrounded by a pseudo
three dimensional border, which has been emphasised in this
illustration. It is imagined that the button is illuminated by a
light shining from the top left. In the left hand illustration
the button is raised so the right and bottom of the button are in
shade and are shown in a darker hue. In the right hand
illustration the button is depressed so the left and top of the
button are in the shade and are shown in a darker hue.</p>

<p>The class diagram for the <font size="2" face="Arial"><i>TuttleButton</i></font>
class is given in Figure 5.3.</p>

<p align="center"><font size="3"><b><img src="fig53.gif"
width="504" height="748"></b></font></p>

<p align="center"><font size="3"><b>Figure 5.3</b> The </font><font
size="2" face="Arial"><i>TuttleButton</i></font><font size="3">
class diagram.</font></p>

<p>The first constructor requires the identity of the <font
size="2" face="Arial">Applet</font> and the source of the image
to be used by the button to be specified and will use a default,
grey, border colour. The second constructor allows the colour to
be used for the bordering to be explicitly specified, as well as
the <font size="2" face="Arial">Applet</font> and the source for
the image. The <font size="2" face="Arial"><i>addNotify()</i></font>
action is used to initialise the button after its peer has been
constructed. The <font size="2" face="Arial"><i>getMinimumSize(),
getPreferredSize(), update()</i></font> and <font size="2"
face="Arial"><i>paint()</i></font> actions are used by the button
to interact with layout negotations and to display itself, using
the techniques which have previously been described. The <font
size="2" face="Arial"><i>processMouseEvent()</i></font> action
will implement the behaviour shown in the STD in Figure 5.1, and
is supported by the <font size="2" face="Arial"><i>setActionCommand(),
getActionCommand(), addActionListener()</i></font> and <font
size="2" face="Arial"><i>removeActionListener()</i></font>
actions. These are provided to allow instances of this class to
interact with other <font size="2" face="Arial">Compoenent</font>s
in a manner directly comparable to the AWT <font size="2"
face="Arial">Button</font> class, as described in the previous
chapter. The implementation of this class, as far as the end of
the constructors, is as follows. </p>

<pre><font size="3">0001  // Filename <i>TuttleButton.java</i>.
0002  // Contains an extended Canvas component to supply
0003  // button behaviour with an image as its label.
0004  //
0005  // Written for the Java Interface book, Chapter 5.
0006  // Fintan Culwin, v 0.2, August 1997.
0007  
0008  <b>package</b> <i>Tuttles</i>;
0009  
0010  <b>import</b> java.awt.*;
0011  <b>import</b> java.awt.event.*;
0012  <b>import</b> java.applet.*;
0013  <b>import</b> java.awt.image.*;
0014  
0015  
0016  <b>public class</b> <i>TuttleButton</i> <b>extends</b> Canvas { 
0017  
0018  <b>private static final int</b>     <i>BORDER_WIDTH</i>         = 2;
0019  <b>private static final</b> Color   <i>DEFAULT_BORDER_COLOR</i> = 
0020                                        <b>new</b> Color( 0x80, 0x80, 0x80); 
0021  
0022  <b>private</b> Image           <i>buttonImage</i>   = <b>null</b>;
0023  <b>private</b> String          <i>imageSource</i>   = <b>null</b>;
0024  <b>private int</b>             <i>buttonWidth</i>   = -1;
0025  <b>private int</b>             <i>buttonHeight</i>  = -1;
0026  <b>private boolean</b>         <i>pressed</i>       = <b>false</b>;
0027  <b>private</b> Color           <i>borderColour</i>; 
0028  <b>private </b>String          <i>actionCommand</i> = <b>null</b>;
0029  <b>private </b>ActionListener  <i>itsListener   = </i><b>null;
</b>0030  <b>private </b>Applet          <i>itsApplet</i>;
0031  
0032  
0033     <b>public</b> <i>TuttleButton</i>( String <i>theSource, 
</i>0034                          Applet <i>applet</i>) { 
0035        <b>this</b>( <i>theSource</i>, <i>applet</i>,  <i>DEFAULT_BORDER_COLOR</i>); 
0036     } // End <i>TuttleButton</i> constructor.
0037  
0038     <b>public</b> <i>TuttleButton</i>( String <i>theSource</i>,
0039                          Applet <i>applet,
</i>0040                          Color  <i>colorForBorder</i>) { 
0041        <b>super</b>();
0042        <i>imageSource</i> = <b>new</b> String( &quot;Tuttles/Images/&quot; + <i>theSource</i>);       
0043        <i>itsApplet = applet;
</i>0044        <b>this</b>.<i>setForeground</i>( <i>colorForBorder</i>);       
0045        <b>this</b>.<i>enableEvents</i>( AWTEvent.MOUSE_EVENT_MASK); 
0046     } // End <i>TuttleButton</i> constructor.</font></pre>

<p>The class wide constant attributes, <font size="2"
face="Arial"><i>BORDER_WIDTH</i></font> and <font size="2"
face="Arial"><i>DEFAULT_BORDER_COLOR</i></font>, determine the
size of the pseudo three dimensional border and the default
border colour, if no colour is explicitly specified as the button
is constructed. The instance attributes indicate the <font
size="2" face="Arial">Image</font> which is to be used and <font
size="2" face="Arial"><i>theSource</i></font> filename where it
can be obtained from, the overall <font size="2" face="Arial"><i>buttonWidth</i></font>
and <font size="2" face="Arial"><i>buttonHeight</i></font>, the <font
size="2" face="Arial"><i>pressed</i></font> state of the button,
its <font size="2" face="Arial"><i>borderColor</i></font> of the
button, the <font size="2" face="Arial"><i>commandString</i></font>
and <font size="2" face="Arial"><i>itsListener</i></font><i> </i>object,
and finally the identity of <font size="2" face="Arial"><i>itsApplet</i></font>.
</p>

<p>The first constructor indirects to the second, passing the <font
size="2" face="Arial"><i>DEFAULT_BORDER_COLOR</i></font> as the <font
size="2" face="Arial">Color</font> argument. The second
constructor calls the <font size="2" face="Arial"><b>super</b></font>
constructor and then, on line 0042, catenates the <font size="2"
face="Arial"><i>theSource</i></font> argument, identifying the
file which contains the image for this button with a path string
which indicates that it is expected to be found in the <i>Images</i>
sub-directory of the <i>Tuttles</i> package directory. The full
pathname and filename string is stored in the <font size="2"
face="Arial"><i>imageSource</i></font> instance attribute. The <font
size="2" face="Arial"><i>applet</i></font> argument is stored in
the <font size="2" face="Arial"><i>itsApplet</i></font>
attribute, on line 0043, and <font size="2" face="Arial"><i>colorForBorder</i></font>
is passed as an argument to the inherited <font size="2"
face="Arial"><i>setForeground()</i></font> action. The final step
of the constructor is to enable mouse events on the <font
size="2" face="Arial"><i>TuttleButton</i></font> in order that
its <font size="2" face="Arial"><i>processMouseEvent()</i></font>
action will be called every time the mouse is used within its
extent. The <font size="2" face="Arial"><i>addNotify()</i></font>
action will complete the initialisation of the <i>TuttleButton</i>,
and is implemented as follows. </p>

<pre><font size="3">0050     <b>public void</b> <i>addNotify</i>() { 
0051     
0052     MediaTracker <i>aTracker</i>;
0053  
0054        <b>super</b>.addNotify();     
0055         
0056        <i>buttonImage</i> = ( <i>itsApplet</i>.getImage( 
0057                        <i>itsApplet</i>.getCodeBase(), <i>imageSource</i>));         
0058        <i>aTracker</i> = <b>new</b> MediaTracker( <b>this</b>);
0059        <i>aTracker</i>.addImage( <i>buttonImage</i>, 0);
0060        <b>try</b> { 
0061            <i>aTracker</i>.waitForID( 0);
0062        } <b>catch</b> ( InterruptedException <i>exception</i>) {       
0063           // Do nothing!                                
0064        } // End try/ catch. 
0065   
0066        <b>if</b> ( <i>buttonImage</i> == <b>null</b>              ||
0067             <i>buttonImage</i>.getWidth( <b>this</b>)  &lt; 1 ||
0068             <i>buttonImage</i>.getHeight( <b>this</b>) &lt; 1 ){ 
0069           System.err.println( &quot;The image &quot; + <i>imageSource</i> + 
0070                               &quot;\nCould not be loaded, abending ...&quot;); 
0071           System.exit( -1);  
0072        } // End if.          
0073        <i>buttonWidth</i>  = <i>buttonImage</i>.getWidth( <b>this</b>) + <i>BORDER_WIDTH</i> *2;
0074        <i>buttonHeight</i> = <i>buttonImage</i>.getHeight(<b>this</b>) + <i>BORDER_WIDTH</i> *2; 
0075        <b>this</b>.setSize( <i>buttonWidth</i>, <i>buttonHeight</i>);    
0076     } // End <i>addNotify</i>;   </font></pre>

<p>The first part of this action, which loads the image from a
file on the server which provided the applet, is essentially
identical to the loading of an image in the previous chapter. It
uses the <font size="2" face="Arial"><i>itsApplet</i></font>
attribute as an argument in the <font size="2" face="Arial">getImage()</font>
call on line 0056, to load the file into the <font size="2"
face="Arial"><i>buttonImage</i></font> <font size="2"
face="Arial">Image</font> attribute. Should the image not load
successfully, for example if the file cannot be found, then the
condition, on lines 0066 to 0068, will evaluate <font size="2"
face="Arial"><b>true</b></font> and the program will abend. If
the image is loaded successfully then the <font size="2"
face="Arial"><i>buttonWidth</i></font> and <font size="2"
face="Arial"><i>buttonHeight</i></font> attributes are
initialised to the width and height of the image, plus an
allowance for the border at each edge, and, on line 0075, the
size of the <font size="2" face="Arial">Component</font> is
established based upon these dimensions. These attributes are
used by the <font size="2" face="Arial"><i>getMinimumSize()</i></font>
and <font size="2" face="Arial"><i>getPreferredSize()</i></font>
actions, as follows. </p>

<pre><font size="3">0081     <b>public</b> Dimension <i>getMinimumSize</i>() {
0082        <b>return</b>( <b>new</b> Dimension( <i>buttonWidth</i>, <i>buttonHeight</i>));
0083     } // End <i>getMinimumSize</i>.
0084  
0085     <b>public</b> Dimension <i>getPreferredSize</i>() {
0086       <b>return</b> <b>this</b>.<i>getMinimumSize</i>();
0087     } // End <i>getPreferredSize</i>.</font></pre>

<p>The implementation of the <font size="2" face="Arial"><i>update()</i></font>
and <font size="2" face="Arial"><i>paint()</i></font> actions are
as follows. </p>

<pre><font size="3">0090     <b>public void</b> <i>update</i>( Graphics <i>systemContext</i>) {
0091        <b>this</b>.<i>paint</i>( <i>systemContext</i>);
0092     } // End <i>update</i>. 
0093    
0094     <b>public void</b> <i>paint</i>( Graphics <i>systemContext</i>) { 
0095     
0096     <b>int</b> <i>index</i>;
0097  
0098        <i>systemContext</i>.drawImage( <i>buttonImage</i>, <i>BORDER_WIDTH</i>, <i>BORDER_WIDTH</i>, <b>this</b>);
0099        <b>for</b> ( <i>index</i>=0; <i>index</i> &lt; <i>BORDER_WIDTH</i>; <i>index</i>++) { 
0100           <i>systemContext</i>.draw3DRect( <i>index</i>, <i>index</i>,
0101                                     <i>buttonWidth</i>  - <i>index</i> -1,
0102                                     <i>buttonHeight</i> - <i>index</i> -1, !<i>pressed</i>);                                  
0103        } // End for.
0104     } // End <i>paint</i>.</font></pre>

<p>The <font size="2" face="Arial"><i>update()</i></font> action
indirects to the <font size="2" face="Arial"><i>paint()</i></font>
action for the reasons explained in the last chapter. The <font
size="2" face="Arial"><i>paint()</i></font> action commences, on
line 0098, by drawing the <font size="2" face="Arial"><i>buttonImage</i></font>
into the button's window offset from the top left of the window
by the width of the border. Once this has happened the border is
drawn around the image as a sequence of concentric <font size="2"
face="Arial"><i>draw3Drect()</i></font> calls. The last argument
of a <font size="2" face="Arial"><i>draw3Drect()</i></font> call
is a <font size="2" face="Arial"><b>boolean</b></font> which if <font
size="2" face="Arial"><b>true</b></font> causes the rectangle to
be drawn as if raised, and if <font size="2" face="Arial"><b>false</b></font>
depressed. Those parts of the border shown as dark grey in Figure
5.2 are drawn using a darker hue of the component's foreground
drawing colour, those parts of the border shown as light grey are
drawn using a lighter hue. The negated value of the <font
size="2" face="Arial"><i>pressed</i></font> attribute is used to
supply this last argument and its value is controlled by the <font
size="2" face="Arial"><i>processMouseEvent()</i></font>, as
follows. </p>

<pre><font size="3">0107     <b>protected void</b> <i>processMouseEvent</i>( MouseEvent <i>event</i>) {        
0108        <b>switch</b> ( <i>event</i>.getID()) { 
0109                    
0110        <b>case</b> MouseEvent.MOUSE_EXITED: 
0111           <i>pressed</i> = <b>false</b>;
0112           <i>repaint</i>();
0113           <b>break</b>;
0114           
0115        <b>case</b> MouseEvent.MOUSE_PRESSED: 
0116           <i>pressed</i> = <b>true</b>;
0117           <i>repaint</i>();        
0118           <b>break</b>;
0119           
0120        <b>case</b> MouseEvent.MOUSE_RELEASED: 
0121           <b>if</b> ( (<i>pressed</i>)             &amp;&amp; 
0122                (<i>itsListener</i> != <b>null</b>) ){
0123             <i>itsListener</i>.actionPerformed( <b>new</b> ActionEvent( <b>this</b>, 
0124                                              ActionEvent.ACTION_PERFORMED,
0125                                              <b>this</b>.<i>getActionCommand</i>()));                                                   
0126           }  // End if.
0127           <i>pressed</i> = <b>false</b>;
0128           <i>repaint</i>();       
0129           <b>break</b>;                      
0130        } // End switch.     
0131     } // End <i>processMouseEvent</i>.</font></pre>

<p>The <font size="2" face="Arial">MOUSE_EXITED</font> branch of
the <font size="2" face="Arial"><b>switch</b></font> structure
ensures that the <font size="2" face="Arial"><i>pressed</i></font>
attribute is <font size="2" face="Arial"><b>false</b></font> and
calls the <font size="2" face="Arial"><i>repaint()</i></font>
action to, indirectly, cause the <font size="2" face="Arial"><i>paint()</i></font>
action to be called. As <font size="2" face="Arial"><i>pressed</i></font>
is <font size="2" face="Arial"><b>false</b></font> the last
argument of the <font size="2" face="Arial"><i>draw3Drect()</i></font>
action will be <font size="2" face="Arial"><b>true</b></font> and
so the button will be drawn in a raised fashion. The <font
size="2" face="Arial">MOUSE_PRESSED</font> branch primes the
button by setting the <font size="2" face="Arial"><i>pressed</i></font>
attribute <font size="2" face="Arial"><b>true</b></font> and
calls <font size="2" face="Arial"><i>repaint()</i></font> which
will draw the button in a depressed state. Finally the <font
size="2" face="Arial">MOUSE_RELEASED</font> action, if the <font
size="2" face="Arial"><i>pressed</i></font> attribute is <b>true</b>
and an <font size="2" face="Arial"><i>ActionListener</i></font>
has been registered, calls the <font size="2" face="Arial"><i>actionPerformed()</i></font>
action of <font size="2" face="Arial"><i>itsListener</i></font>
passing as an argument a new <font size="2" face="Arial">ActionEvent</font>
containing the <font size="2" face="Arial"><i>TuttleButton</i></font>'s
<font size="2" face="Arial"><i>actionCommand</i></font>. This
branch concludes by setting the <font size="2" face="Arial"><i>pressed</i></font>
attribute <b>false</b> and <font size="2" face="Arial"><i>repaint</i></font>ing
the button. The list of <font size="2" face="Arial">ActionListener</font>s
in <font size="2" face="Arial"><i>itsListeners</i></font> and the
<font size="2" face="Arial"><i>commandString</i></font> attribute
are maintained by the remaining four actions, whose
implementations are directly comparable with those in the <font
size="2" face="Arial"><i>DatePanel</i></font> class from the
previous chapters, as follows. </p>

<pre><font size="3">0134     <b>public void</b> <i>setActionCommand</i>( String <i>command</i>) {
0135         <i>actionCommand</i> = <i>command</i>;
0136     } // End <i>setActionCommand</i>.
0137      
0138     <b>public</b> String <i>getActionCommand</i>() {
0139        <b>if</b> ( <i>actionCommand</i> == <b>null</b>) { 
0140           <b>return</b> &quot;Tuttle Button&quot;;
0141        } <b>else</b> { 
0142           <b>return</b> <i>actionCommand</i>;
0143        } // End if.   
0144     } // End <i>getActionCommand</i>.
0145  
0146  
0147     <b>public void</b> <i>addActionListener</i>( ActionListener <i>listener</i>) {
0148        <i>itsListener</i> = AWTEventMulticaster.add( <i>itsListener</i>, <i>listener</i>);
0149     } // End <i>addActionListener</i>.
0150  
0151     <b>public void</b> <i>removeActionListener</i>( ActionListener <i>listener</i>) {
0152        <i>itsListener</i> = AWTEventMulticaster.remove( <i>itsListener</i>, <i>listener</i>);
0153     } // End <i>removeActionListener</i>.</font></pre>

<p>Before using instances of the <font size="2" face="Arial"><i>TuttleButton</i></font>
in the semi-direct interface it should be demonstrated to be
working correctly; a demonstration harness might be as follows. </p>

<pre><font size="3">0001  // Filename TuttleButtonDemonstration.java.
0002  // A demonstration test harness for the TuttleButton class.
0003  // 
0004  // Written for the Java Interface book, Chapter 5.
0005  // Fintan Culwin, v 0.2, August 1997.
0006  
0007  
0008  <b>import</b> java.awt.*;
0009  <b>import</b> java.applet.*;
0010  <b>import</b> java.awt.event.*;
0011
0012  <b>import</b> Tuttles.TuttleButton;
0013  
0014  <b>public class</b> TuttleButtonDemonstration <b>extends</b>    Applet 
0015                                         <b>implements</b> ActionListener {
0016                                                              
0017    <b>public void</b> init() {
0018  
0019    TuttleButton leftTuttleButton;
0020    TuttleButton rightTuttleButton;
0021  
0022       this.setBackground( Color.white);
0023       
0024       leftTuttleButton  = <b>new</b> TuttleButton( &quot;greyltutt.gif&quot;, <b>this</b>);
0025       leftTuttleButton.setActionCommand( &quot;Left  button&quot;);
0026       leftTuttleButton.addActionListener( <b>this</b>);
0027       <b>this</b>.add( leftTuttleButton);
0028       
0029       rightTuttleButton = <b>new</b> TuttleButton( &quot;greyrtutt.gif&quot;, <b>this</b>, Color.red);
0030       rightTuttleButton.setActionCommand( &quot;Right button&quot;);
0031       rightTuttleButton.addActionListener( <b>this</b>);     
0032       <b>this</b>.add( rightTuttleButton);         
0033    } // End init.
0034  
0035  
0036    <b>public  void</b> actionPerformed( ActionEvent event) { 
0037       System.out.println( event.getActionCommand() + &quot; pressed.&quot;);                     
0038    } // End actionPerformed.                          
0039  } // End class TuttleButtonDemonstration.</font></pre>

<p>The <font size="2" face="Arial"><i>init()</i></font> action
constructs two <font size="2" face="Arial"><i>TuttleButton</i></font>s,
one initialised to display a grey left facing tuttle image
(&nbsp;<i>greyltutt.gif</i>&nbsp;) with the default grey border
and the other a grey right facing tuttle image (&nbsp;<i>greyrtutt.gif</i>&nbsp;)
with a red border. These two GIF files are stored in the <i>Images</i>
sub-directory of the directory on the server which contains the <font
size="2" face="Arial"><i>Tuttles</i></font> package. Figure 5.2
illustrates the appearance of this demonstration harness. </p>

<p>The <font size="2" face="Arial"><i>TuttleButtonDemonstration</i></font>
class implements the <font size="2" face="Arial">ActionListener</font>
interface and registers itself as the listener object for both
buttons. Its <font size="2" face="Arial"><i>actionPerformed()</i></font>
action will display a message on the console, containing the
button's <font size="2" face="Arial"><i>actionCommand</i></font>,
when each of the buttons is pressed. This indicates that the <font
size="2" face="Arial"><i>TuttleButtons</i></font> are calling
their registered listener object's <font size="2" face="Arial"><i>actionPerformed()</i></font>
action when they are pressed by the user and that the action can
determine which button was pressed. This client class does not
have a <font size="2" face="Arial"><i>main()</i></font> action as
the loading of the images from the server relies upon the top
level window being an <font size="2" face="Arial">Applet</font>,
consequently the demonstration can only be run from a Web browser
or an appletviewer utility.</p>

<p>&nbsp;</p>

<hr>

<blockquote>
    <p><a href="..\tuttles\tuttles\tuttlebutton.java"><font
    size="5"><img src="list.gif" align="middle" border="0"
    width="40" height="35"> TuttleButton.java</font></a></p>
    <p><a href="..\tuttles\tuttlebuttondemonstration.java"><font
    size="5"><img src="list.gif" align="middle" border="0"
    width="40" height="35">TuttleButonDemonstration.java</font></a></p>
    <p><a href="..\tuttles\tuttlebuttondemonstration.html"><font
    size="5"><img src="run.gif" align="middle" border="0"
    width="40" height="27">TuttleButtonDemonstration</font></a></p>
</blockquote>

<hr>

<blockquote>
    <p><a href="ch52.html"><img src="next.gif" align="middle"
    border="0" width="50" height="40"><font size="5">5.2 The </font><font
    size="5" face="Arial"><i>SemiDirectTuttle</i></font><font
    size="4"> </font><font size="5">interface</font></a></p>
    <p><a href="chap5.html"><font size="4"><img src="last.gif"
    align="middle" border="0" width="50" height="40"></font><font
    size="5">Chapter 5 Semi-direct user interfaces</font></a></p>
</blockquote>

<hr>
</body>
</html>
