<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPad 2.0">
<title> 2.12 PopUp menus </title>
</head>

<body bgcolor="#FFFFFF">

<h2 align="center"><font size="6">2.12 </font><font size="5"
face="Arial">PopUp</font><font size="6"> menus </font></h2>

<p>The AWT menu classes form a separate hierarchy from the <font
size="2" face="Arial">Component</font> hierarchy, used so far;
its class hierarchy diagram is shown in Figure 2.17. This section
will provide a brief introduction to implementing a popup menu; a
more detailed introduction to menus in general will be given in
Chapter 6.</p>

<p align="center"><b><img src="fig217.gif" width="573"
height="247"></b></p>

<p align="center"><b>Figure 2.17</b> The Java AWT <font
face="Arial"><i>MenuComponent</i></font> class hierarchy.</p>

<p>The state transition diagram for this interface is given in
Figure 2.18. It is based upon that for the <font size="2"
face="Arial"><i>CanvasExample</i></font> given previously. A
mouse down event will still cause drawing to start, but a double
mouse click will post the popup menu offering the user two
options, to clear the drawing or to invert the drawing colours.
It is also possible that the user will unpost the menu by
clicking with the mouse outside the extent of the popup menu. </p>

<p align="center"><font size="2"><b><img src="fig218.gif"
width="457" height="384"></b></font></p>

<p align="center"><font size="2"><b>Figure 2.18</b> Popup menu
example, state transition diagram.</font></p>

<p>The appearance of this applet showing the popup menu in the
default, black on white, and inverted, white on black, modes is
shown in Figure 2.19.</p>

<p align="center"><font size="2"><b><img src="fig219.gif"
width="456" height="197"></b></font></p>

<p align="center"><font size="2"><b>Figure 2.19</b> Popup menu
example in normal and inverted modes.</font></p>

<p>The popup menu is provided by an instance of the <font
size="2" face="Arial">PopupMenu</font> class upon which is
mounted two instances of the <font size="2" face="Arial">MenuItem</font>
class, providing the two items labeled &quot;<i>Clear</i>&quot;
and &quot;<i>Invert</i>&quot;. When the <font size="2"
face="Arial">MenuItem</font> buttons are pressed an <font
size="2" face="Arial">ActionEvent</font> is generated which can
be responded to by a registered <font size="2" face="Arial">ActionListener</font>
object. The <font size="2" face="Arial"><i>Doodle</i></font>
class, as described above, is the basis of the <font size="2"
face="Arial"><i>PoppingDoodle</i></font> class whose
implementation, as far as the end of its constructor, is as
follows. </p>

<pre><font size="3">0041  <b>class</b> <i>PoppingDoodle</i> <b>extends</b>    Canvas 
0042                      <b>implements</b> ActionListener { 
0043  
0044  <b>private int</b>       <i>lastX</i>;
0045  <b>private int</b>       <i>lastY</i>;
0046  <b>private</b> Graphics  <i>context</i>; 
0047  <b>private</b> PopupMenu <i>popup</i>;
0048  <b>private</b> MenuItem  <i>clearItem</i>;
0049  <b>private</b> MenuItem  <i>invertItem</i>;
0050  
0051     <b>protected</b> <i>PoppingDoodle</i>( <b>int</b> <i>width</i>, <b>int</b> <i>height</i>) { 
0052        <b>super</b>();
0053        <b>this</b>.setSize( <i>width</i>, <i>height</i>);
0054        <b>this</b>. enableEvents( AWTEvent.MOUSE_MOTION_EVENT_MASK |
0055                            AWTEvent.MOUSE_EVENT_MASK        |
0056                            AWTEvent.ACTION_EVENT_MASK       ); 
0057                            
0058        <i>popup</i> = <b>new</b> PopupMenu();      
0059        <b>this</b>.add( <i>popup</i>);  
0060         
0061        <i>clearItem</i> = <b>new</b> MenuItem(   &quot;Clear&quot;);
0062        <i>clearItem</i>.setActionCommand( &quot;Clear&quot;);
0063        <i>clearItem</i>.addActionListener( <b>this</b>);   
0064        <i>popup</i>.add( <i>clearItem</i>); 
0065        
0066        <i>invertItem</i> = <b>new</b> MenuItem(   &quot;Invert&quot;);
0067        <i>invertItem</i>.setActionCommand( &quot;Invert&quot;);
0068        <i>invertItem</i>.addActionListener( <b>this</b>);   
0069        <i>popup</i>.add( <i>invertItem</i>);                                                 
0070     } // End <i>PoppingDoodle</i> constructor.</font></pre>

<p>This class is not declared with <font size="2" face="Arial"><b>public</b></font>
visibility for the same reasons as explained for the <font
size="2" face="Arial"><i>Doodle</i></font> class, above. The
first part of the constructor, as far as the call of <font
size="2" face="Arial"><i>enableEvents()</i></font> starting on
line 0054 is identical to that of the <font size="2" face="Arial"><i>Doodle</i></font>
class given above. The argument to <font size="2" face="Arial"><i>enableEvents()</i></font>
differs only, on line by 0056, by enabling <font size="2"
face="Arial">ActionEvents</font> in order to allow instances of
the <font size="2" face="Arial"><i>PoppingDodle</i></font> class
to respond to such events generated by the <font size="2"
face="Arial">MenuItems</font> contained within it. </p>

<p>The remaining parts of the constructor are concerned with
constructing the popup menu and commence, on lines 0058 and 0059,
with the construction of a <font size="2" face="Arial">PopupMenu</font>
instance called <font size="2" face="Arial"><i>popup</i></font>
and <font size="2" face="Arial"><b>add</b></font>ing it to the <font
size="2" face="Arial"><i>PoppingDoodle</i></font> instance being
constructed. On lines 0061 to 0063 the first <font size="2"
face="Arial">MenuItem</font> instance, called <font size="2"
face="Arial"><i>clearItem</i></font>, is first constructed with
its label set to &quot;<i>Clear</i>&quot;, has its <font size="2"
face="Arial">actionCommand</font> attribute set to &quot;<i>Clear</i>&quot;,
has its <font size="2" face="Arial">actionListener</font>
attribute set to the current instance (<font size="2"
face="Arial"><b>this</b></font>) and is finally <font size="2"
face="Arial"><b>add</b></font>ed to the <font size="2"
face="Arial">PopupMenu <i>popup</i></font>. The constructor
concludes, on lines 0066 to 0069, by adding the <font size="2"
face="Arial"><i>invertItem</i> MenuItem</font> to the <font
size="2" face="Arial"><i>popup</i></font> menu, using the same
techniques.</p>

<p>The <font size="2" face="Arial"><i>processMouseEvent()</i></font>
method differs from that presented in the <font size="2"
face="Arial">Doodle</font> class as it now has to respond both to
a single mouse press and a double mouse click. Its
implementation, using the <font size="2" face="Arial">MouseEvent</font>
<font size="2" face="Arial">getClicksCounted()</font> method, is
as follows. </p>

<pre><font size="3">0098     <b>protected void</b> <i>processMouseEvent</i>( MouseEvent <i>event</i>) {
0099  
0100        <b>if</b> ( <i>event</i>.getId() == MouseEvent.MOUSE_PRESSED) { 
0101           <b>if</b> ( <i>event</i>.getClickCount() == 2) {  
0102              <i>popup</i>.show( <b>this</b>.getParent(), <i>event</i>.getX(), <i>event</i>.getY());       
0103           } <b>else</b> {  
0104              <i>lastX</i> = <i>event</i>.getX();
0105              <i>lastY</i> = <i>event</i>.getY();               
0106           } // End if.   
0107        } // End if.         
0108     } // End <i>processMouseEvent</i>.
</font></pre>

<p>Within the guard, on line 0100, which ensures that the method
only responds to mouse pressing events, on line 0101 the <font
size="2" face="Arial">MouseEvent getClickCount()</font> method is
use to determine if a double mouse click occurred. If so, line
0102, pops-up the <font size="2" face="Arial"><i>popup</i></font>
menu by calling its <font size="2" face="Arial">show()</font>
method passing as arguments the <font size="2" face="Arial">Component</font>
which it is to popup from and the location where it is to popup.
Otherwise the steps taken for a single click, on lines 0104 and
0105, are the same as in the <font size="2" face="Arial"><i>Doodle</i></font>
class.</p>

<p>The <font size="2" face="Arial"><i>processMouseMotion()</i></font>
method and the <font size="2" face="Arial"><i>addNotify()</i></font>
method do not differ from those of the <font size="2"
face="Arial"><i>Doodle</i></font> class but a new method, <font
size="2" face="Arial"><i>actionPerformed()</i></font>, has to be
supplied in order for this class to conform to the <font size="2"
face="Arial">ActionListener</font> interface, as stated on line
0042. This method will be called whenever one of the <font
size="2" face="Arial">MenuItem</font>s on the <font size="2"
face="Arial"><i>popup</i></font> menu is activated and is
implemented as follows. </p>

<pre><font size="3">0080     <b>public void</b> <i>actionPerformed</i>( ActionEvent <i>event</i>) {
0081        
0082     String <i>command</i> = <b>new</b> String( <i>event</i>.getActionCommand());
0083     Color  <i>hold</i>;
0084     
0085        <b>if</b> ( <i>command</i>.equals( &quot;Clear&quot;)) { 
0086           <b>this</b>.repaint();      
0087        } <b>else if</b> ( <i>command</i>.equals( &quot;Invert&quot;)) { 
0088           <i>hold</i> = <b>this</b>.getBackground();
0089           <b>this</b>.setBackground( <b>this</b>.getForeground());
0090           <b>this</b>.setForeground( <i>hold</i>);
0091           <i>context</i>.setColor( <i>hold</i>);
0092           <b>this</b>.repaint();     
0093        } // End if.      
0094     } // End <i>actionPerformed</i>.</font></pre>

<p>On line 0082 the <font size="2" face="Arial">actionCommand</font>
<font size="2" face="Arial">String</font> is extracted from the <font
size="2" face="Arial"><i>event</i></font> instance passed as an
argument to the method and used on line 0085 to decide if the <i>Clear</i>
menu item was pressed. If so then the <font size="2" face="Arial">repaint()</font>
method of the <font size="2" face="Arial"><i>PoppingDoodle</i></font>
instance (<font size="2" face="Arial"><b>this</b></font>) is
called which will clear its window. Otherwise, on line 0087 the <font
size="2" face="Arial">actionCommand</font> is tested to see if it
indicates that the <i>Invert</i> button was pressed and, if so,
on lines 0088 to 0090 the <font size="2" face="Arial">Color</font>s
stored in the <font size="2" face="Arial"><i>PoppingDoodle</i></font>'s
<font size="2" face="Arial"><i>foreground</i></font> and <font
size="2" face="Arial"><i>background</i></font> attributes are
swapped. Following this line 0091 installs the new foreground <font
size="2" face="Arial">Color</font> into the <font size="2"
face="Arial">Graphics <i>context</i></font> before <font size="2"
face="Arial"><i>repaint()</i></font> is called. The effect of
these steps is to invert the colours so, assuming that it is
currently drawing in black on a white background, it will clear
the window to a solid black background and prepare for drawing in
white. Or vice versa if it is already been inverted and is
drawing in white on a black background.</p>

<hr>

<blockquote>
    <p><b><i>Design Advice</i></b> </p>
    <p>A Popup menu can save on screen space but gives no obvious
    clue of its existence. So it is difficult for a user to
    discover and is only suitable for experienced users. </p>
</blockquote>

<hr>

<blockquote>
    <p><a href="code2\popup\popupexample.java"><font size="5"><img
    src="list.gif" align="middle" border="0" width="40"
    height="35">PopupExample.java</font></a></p>
    <p><a href="code2\popup\popupexample.html"><font size="5"><img
    src="run.gif" align="middle" border="0" width="40"
    height="27">PopupExample</font></a></p>
</blockquote>

<hr>

<blockquote>
    <p><a href="ch213.html"><img src="next.gif" align="middle"
    border="0" width="50" height="40"><font size="5">2.13</font><font
    size="6"> </font><font size="5">The</font><font size="6"> </font><font
    size="4" face="Arial">ScrollPane</font><font size="5"> class</font></a></p>
    <p><a href="ch211.html"><font size="3"><img src="last.gif"
    align="middle" border="0" width="50" height="40"></font><font
    size="5">2.11 The </font><font size="4" face="Arial">TextComponent</font><font
    size="5">, </font><font size="4" face="Arial">TextArea</font><font
    size="5"> and </font><font size="4" face="Arial">TextField</font><font
    size="5"> classes</font></a></p>
</blockquote>

<hr>
</body>
</html>
