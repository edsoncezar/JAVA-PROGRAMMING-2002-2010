<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPad 2.0">
<title> 2.10 The Canvas class</title>
</head>

<body bgcolor="#FFFFFF">

<h2 align="center"><font size="6">2.10 The </font><font size="6"
face="Arial">Canvas</font><font size="6"> class</font></h2>

<p>The <font size="2" face="Arial">Canvas</font> class supplies a
screen area upon which graphical output can be produced, or which
can be extended to provide a specialized user interface
component. The major resources of this class are presented in
Table 2.18. </p>

<p align="center"><b><img src="table218.gif" width="606"
height="139"></b></p>

<p align="center"><b>Table 2.18</b> Major resources of the <font
face="Arial">Canvas</font> class. </p>

<p>The <font size="2" face="Arial">Canvas</font> constructor
takes no arguments and creates an empty drawing area. The only
method declared by the class is <font size="2" face="Arial">paint()</font>
which overrides the <font size="2" face="Arial">Component paint()</font>
method. The argument to this method is a <font size="2"
face="Arial">Graphics&nbsp;<i>context</i></font> whose
construction, meaning and use will be explained below and in
following chapters.</p>

<p>To illustrate the <font size="2" face="Arial">Canvas</font>
class a <font size="2" face="Arial"><i>Doodle</i></font> applet
will be constructed. This applet supplies a small drawing area
upon which doodles can be produced by dragging the mouse pointer.
The appearance of this applet is given in Figure 2.13 and its STD
in Figure 2.14. </p>

<p align="center"><font size="2"><b><img src="fig213.gif"
width="216" height="185"></b></font></p>

<p align="center"><font size="2"><b>Figure 2.13</b> A </font><font
size="2" face="Arial">Canvas</font><font size="2"> based </font><font
size="2" face="Arial"><i>Doodle</i></font><font size="2"> applet.</font></p>

<p align="center"><font size="2"><b><img src="fig214.gif"
width="442" height="195"></b></font></p>

<p align="center"><font size="2"><b>Figure 2.14</b> The </font><font
size="2" face="Arial"><i>Doodle</i></font><font size="2">
applet's STD.</font></p>

<p>As with the <font size="2" face="Arial"><i>DecimalToHex</i></font>
applet above the simplicity of this STD and the absence of any
preconditions indicates that it should be very intuitive to the
user. However, in order to implement this design the <font
size="2" face="Arial">Canvas</font> class will have to be
extended to produce the <font size="2" face="Arial"><i>Doodle</i></font>
class. The reason for this is concerned with the need for the <font
size="2" face="Arial"><i>Doodle</i></font> instance to handle its
own events and not to have them handled on its behalf by a
listener object. This will require the <font size="2"
face="Arial">Doodle</font> instance handling its own events via
the event dispatching mechanism and, unlike all the examples
which have been introduced so far, not relying upon the
registration of listeners.</p>

<p>As an extension of the <font size="2" face="Arial">Canvas</font>
class, the <font size="2" face="Arial"><i>Doodle</i></font> class
should be completely self contained so that other clients could
use a <font size="2" face="Arial"><i>Doodle</i></font> instance
simply by <font size="2" face="Arial"><b>import</b></font>ing the
class and not by having to <font size="2" face="Arial"><b>import</b></font>
both the class and provide a listener. </p>

<p>In order for the <font size="2" face="Arial">Doodle</font>
class to encapsulate its own event processing functionality it
will have to enable the appropriate events upon itself, using the
<font size="2" face="Arial">Component</font> <font size="2"
face="Arial">enableEvent()</font> method and override the
appropriate <font size="2" face="Arial">process<i>Whatever</i>Event()</font>
methods. Specifically, from the STD, it will have to enable <font
size="2" face="Arial">MOUSE_MOTION</font> events and <font
size="2" face="Arial">MOUSE_EVENT</font> (mouse button) events,
and override the <font size="2" face="Arial">processMouseEvent()</font>
and <font size="2" face="Arial">processMouseMotionEvent()</font>
methods. The first part of the implementation of the <font
size="2" face="Arial">Doodle</font> class is as follows. </p>

<pre><font size="3">0038  <b>class</b> <i>Doodle</i> <b>extends</b> Canvas { 
0039  
0040  <b>private</b>  int      <i>lastX</i>;
0041  <b>private</b>  int      <i>lastY</i>;
0042  <b>private  </b>Graphics <i>context</i>; 
0043  
0044     <b>protected</b> <i>Doodle</i>( <b>int</b> <i>width</i>, <b>int</b> <i>height</i>) { 
0045        <b>super</b>();
0046        <b>this</b>.<i>setSize</i>( <i>width</i>, <i>height</i>);
0047        <b>this</b>.<i>enableEvents</i>( AWTEvent.MOUSE_MOTION_EVENT_MASK | 
0048                           AWTEvent.MOUSE_EVENT_MASK);   
0049     } // End <i>Doodle</i> constructor.
0050  
0051  
0052     <b>public void</b> <i>addNotify</i>() { 
0053        <b>super</b>.addNotify();   
0054        <i>context</i> = <b>this</b>.getGraphics().create();
0055     } // End <i>addNotify</i>.</font></pre>

<p>This class is not declared <font size="2" face="Arial"><b>public</b></font>
as it is contained, for convenience, within the <font size="2"
face="Arial"><i>CanvasExample</i></font> class file. This
restricts its visibility to the <font size="2" face="Arial"><i>CanvasExample</i></font>
class preventing it from being seen or used outside that class.
For this reason its constructor is declared without <font
size="2" face="Arial"><b>public</b></font> visibility, on line
0044.</p>

<p>The first two <font size="2" face="Arial"><b>private</b></font>
data attributes, <font size="2" face="Arial"><i>lastX</i></font>
and <font size="2" face="Arial"><i>lastY</i></font>, declared on
lines 0040 and 0041, are used to record the last known location
of the mouse pointer. The third attribute, an instance of the <font
size="2" face="Arial">Graphics</font> class called <font size="2"
face="Arial"><i>context</i></font>, is required to draw on the <font
size="2" face="Arial"><i>Doodle</i></font>'s window as will be
explained briefly below and in detail in following chapters. </p>

<p>The constructor commences by calling its parent (<font
size="2" face="Arial">Canvas</font>) constructor and then setting
its size to that indicated by its two arguments. On lines 0047
and 0048 the two masks, <font size="2" face="Arial">MOUSE_MOTION_EVENT_MASK</font>
and <font size="2" face="Arial">MOUSE_EVENT_MASK,</font> declared
in the <font size="2" face="Arial">AWTEvent</font> class, are <b><i>or</i></b>ed
(&nbsp;<b>|</b>&nbsp;) together and the resulting value passed as
an argument to the <font size="2" face="Arial"><i>Doodle</i></font>'s
<font size="2" face="Arial">enableEvent()</font> method. The
consequence of this is that events generated by moving the mouse
or pressing its buttons will be dispatched directly to the <font
size="2" face="Arial"><i>Doodle</i></font> instance and not to
any registered listener objects. In order for the instance to be
able to respond to these events its <font size="2" face="Arial">processMouseEvent()</font>
and <font size="2" face="Arial">processMouseMotionEvent()</font>
methods will have to be overridden, as shown below. </p>

<p>The <font size="2" face="Arial"><i>Doodle</i></font>'s <font
size="2" face="Arial">addNotify()</font> method also needs to be
overridden in order to initialise the <font size="2" face="Arial"><i>Graphics
context</i></font> instance. This method will be called when the
peer component is created and it is only at this stage, when the
physical properties of the component's window are known, that its
<font size="2" face="Arial">Graphic</font>s attribute can be
obtained and copied, as on line 0054.</p>

<pre><font size="3">0058     <b>protected void</b> <i>processMouseEvent</i>( MouseEvent <i>event</i>) {
0059  
0060        <b>if</b> ( <i>event</i>.getID() == MouseEvent.MOUSE_PRESSED) { 
0061           <i>lastX</i> = <i>event</i>.getX();
0062           <i>lastY</i> = <i>event</i>.getY();                      
0063        } // End if.          
0064     } // End <i>processMouseEvent</i>.
0065   
0066     
0068     <b>protected void</b> <i>processMouseMotionEvent</i>( MouseEvent <i>event</i>) { 
0069     
0070        <b>if</b> ( <i>event</i>.getID() == MouseEvent.MOUSE_DRAGGED) { 
0071        <b>int</b> <i>currentX</i> = <i>event</i>.getX();
0072        <b>int</b> <i>currentY</i> = <i>event</i>.getY();
0073        
0074           <i>context</i>.drawLine( <i>lastX</i>, <i>lastY</i>, <i>currentX</i>, <i>currentY</i>); 
0075           <i>lastX</i> = <i>currentX</i>;
0076           <i>lastY</i> = <i>currentY</i>;                     
0077        } // End if.          
0078     } // End <i>processMouseMotionEvent</i>.
0079   
0080  } // End class <i>Doodle.</i></font></pre>

<p>The <font size="2" face="Arial"><i>processMouseEvent()</i></font>
method will be called every time a mouse button is pressed or
released and, as this class is only interested in mouse press
events, line 0060 uses the <font size="2" face="Arial">MouseEvent</font>'s<font
size="2" face="Arial"> getID()</font> method to determine if the
event was generated by a mouse press. If so the <font size="2"
face="Arial">getX()</font> and <font size="2" face="Arial">getY()</font>
methods are called to obtain and store the current location of
the mouse pointer in the classes' instance attributes, <font
size="2" face="Arial"><i>lastX</i></font> and <font size="2"
face="Arial"><i>lastY</i></font>. </p>

<p>The <font size="2" face="Arial"><i>processMouseMotionEvent()</i></font>
method contains a similar guard and responds only to mouse drag
events, drawing a line from the last known mouse location to the
current location. As the current location will be the last known
location for the next mouse drag event the values of the instance
attributes are updated before the method finishes. A <font
size="2" face="Arial">Graphics</font> instance encapsulates
within itself all the knowledge required to draw onto a
particular window and its <font size="2" face="Arial">drawLine()</font>
method, as used on line 0074, will draw a line from the position
specified by its first two arguments to that specified by its
last two arguments. </p>

<p>The effect of these two methods is that when a mouse down
event occurs the <font size="2" face="Arial"><i>Doodle</i></font>
instance gets ready to draw by storing the location where the
event occurred. A succession of mouse drag events may then occur,
the first of which will cause a line to be drawn from the
location of the mouse press to the current location of the mouse,
and subsequently from where the last line ended to the current
location. When the mouse button is released mouse drag events
will stop being dispatched and the mouse can be moved, without
drawing, until the button is pressed again, repeating the
sequence. </p>

<p>The <font size="2" face="Arial"><i>processMouseEvent()</i></font>
and <font size="2" face="Arial"><i>processMouseMotionEvent()</i></font>
methods are both declared with <font size="2" face="Arial"><b>protected</b></font>
visibility as they are called indirectly from the <font size="2"
face="Arial">processEvent()</font> method, inherited from the <font
size="2" face="Arial">Component</font> class, as a consequence of
the events being enabled upon the component by the <font size="2"
face="Arial">enableEvent()</font> method called on line 0047.
This is unlike the declaration of methods by listener interfaces,
such as <font size="2" face="Arial">actionPerformed()</font>,
which must be declared with <font size="2" face="Arial"><b>public</b></font>
visibility.</p>

<p>As the <font size="2" face="Arial"><i>Doodle</i></font> class
encapsulates all the drawing functionality the <font size="2"
face="Arial">CanvasExample</font> class need only declare an
instance of the class and install it, as follows, to provide the
demonstration client. Any other client which requires a doodling
area could likewise import the <font size="2" face="Arial"><i>Doodle</i></font>
class, assuming it were stored in its own file, and create and
install an instance into its interface.</p>

<pre><font size="3">0001  // Filename <i>CanvasExample.java</i>.
0002  // Provides an initial example of extending the AWT canvas class.  
0003  // Written for the Java interface book Chapter 2 - see text.
0004  //
0005  // Fintan Culwin, v 0.2, August 1997.
0006  
0007  <b>import</b> java.awt.*;
0008  <b>import</b> java.awt.event.*;
0009  <b>import</b> java.applet.*;
0010  
0011  
0012  <b>public class</b> <i>CanvasExample</i> <b>extends</b> Applet {
0013  
0014  <b>private</b> <i>Doodle</i> <i>aDoodlingArea</i>;
0015  
0016     <b>public void</b> <i>init</i>() { 
0017        <i>aDoodlingArea</i> = <b>new</b> <i>Doodle</i>( 200, 150);     
0018        <b>this</b>.add( <i>aDoodlingArea</i>);
0019     } // End init.
0020  
0021  
0022     <b>public static void</b> <i>main</i>( String <i>args</i>[]) {
----     // Details of <i>main</i>() omitted,
0032  
0033     } // End <i>main</i>.
0034  } // End class <i>CanvasExample</i>.</font></pre>

<p>This event handling technique, enabling events on the
component and overriding the methods which process the events
enabled, should only be used when a <font size="2" face="Arial">Component</font>
is having its functionality extended. Where an established <font
size="2" face="Arial">Component</font>, either pre-supplied or
extended, is being used in an interface then the alternative
technique, of registering listeners with it, should be used. The <font
size="2" face="Arial">Doodle</font> component is totally self
contained and does not generate any events which have to be
listened to, which may be required if it is to be reused as a
part of a more complex interface. The techniques to introduce
this capability will be introduced when more complex extended
components are introduced in the next chapter. </p>

<p>&nbsp;</p>

<hr>

<blockquote>
    <p><a href="code2\canvas\canvasexample.java"><font size="5"><img
    src="list.gif" align="middle" border="0" width="40"
    height="35"> CanvasExample.java</font></a></p>
    <p><a href="code2\canvas\canvasexample.html"><font size="5"><img
    src="run.gif" align="middle" border="0" width="40"
    height="27">CanvasExample</font></a></p>
</blockquote>

<hr>

<blockquote>
    <p><a href="ch211.html"><img src="next.gif" align="middle"
    border="0" width="50" height="40"><font size="5">2.11 The </font><font
    size="4" face="Arial">TextComponent</font><font size="5">, </font><font
    size="4" face="Arial">TextArea</font><font size="5"> and </font><font
    size="4" face="Arial">TextField</font><font size="5"> classes</font></a></p>
    <p><a href="ch29.html"><font size="4"><img src="last.gif"
    align="middle" border="0" width="50" height="40"></font><font
    size="5">2.9 The </font><font size="5" face="Arial">Scrollbar</font><font
    size="5"> class</font></a></p>
</blockquote>

<hr>
</body>
</html>
