#!/usr/bin/perl
##################################################################
#set the line above this to your perl path. Usually fine as is
# or /usr/local/bin/perl  /sbin/perl
# make certain that the first line stays the first line!
################################################################## 
#   The origional author added no copywritght to the code which i altered to a large degree so...
#  (C)2000 JustEarth.com   JustEarth Instant messenger V1.4
#  This software is FREEWARE!
#  This script is a moification of a script by Synsonic@webtv.net    which i found at cgi.resourceindex.com
#  I (coleco@justearth.com) upgraded the html files in the perl code and added the color variables
#  which make the script easier to customize.
#  Do with it as you wish. It is yours
#  to share and enjoy. Modify it, improve it, and have fun with it! 
#  It is distributed strictly as a learning aid and JustEarth.com
#  disclaims all warranties- including but not limited to:          
#  fitness for a particular purpose, merchantability, loss of       
#  business, harm to your system, etc... ALWAYS BACK UP YOUR        
#  SYSTEM BEFORE INSTALLING ANY SCRIPT OR PROGRAM FROM ANY          
#  SOURCE! 
###################################################################
##### Variables #####
$database = "userpass.dat";
$messages = "data/";
$im_program_name = "justearth_m.pl";           # if you rename the script change this
$join_program_name = "justearth_m_join.pl";    # if you rename the join script change this

#home_url is the directory of where the scripts are installed no slash at the end.
$home_url = "http://downloads.justearth.com/justearth_m" ;

#The title appears at the top of the messenger.
$title = "DEMO Messenger";

#the background color is the color of the page the messenger appears on
$backgroundcolor = "#333333";

#linkcolor is the color of all links on the page
$linkcolor = "#FFFFFF";

#alinkcolor is the color of the links chen clicked
$alinkcolor = "#0099FF";

#vlinkcolor is the color of the links after you have visited them
$vlinkcolor = "#FFFFFF";

#textcolor1 is the color of the main text of the messenger page
$textcolor1 = "#FFFFFF";

#textcolor2 is the color of the text in the bars at the top and bottom of messenger
$textcolor2 = "#999999";

#tablecolor1 is the color of the bars at the top and bottom of the messenger
$tablecolor1 = "#000033";

#tablecolor2 is the color of the main section of the messenger.
$tablecolor2 = "#666666";

##### Done with Variables NOW CODE #####
use CGI qw(param);
$user = param("user");
$pass = param("pass");
$form = param("form");
print "Content-type: text/html\n\n";
if ($form eq "") {
print qq!
<html>
<head>
<title>Join Screen</title>
</head>

<body bgcolor="$backgroundcolor" text="$textcolor1" link="$linkcolor" vlink="$vlinkcolor" alink="$alinkcolor" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<table width="235" border="0" cellspacing="0" cellpadding="0" height="192">
  <tr align="left" valign="top" bgcolor="$tablecolor1"> 
    <td width="78%"><font face="Arial, Helvetica, sans-serif" size="2" color="$textcolor2" ><b>$title</b></font><font face="Arial, Helvetica, sans-serif"> </font></td>
    <td width="22%">
      <div align="right"><font face="Arial, Helvetica, sans-serif" size="1" color="$textcolor2">
        <a href="$home_url/$im_program_name" target="_self">Login</a></font></div>
    </td>
  </tr>
  <tr align="left" valign="top"> 
    <td colspan="2" bgcolor="$tablecolor2" height="12"><font face="Arial, Helvetica, sans-serif" size="2" color="$textcolor1">Instructions: </font></td>
  </tr>
  <tr align="left" valign="top" bgcolor="$tablecolor2"> 
    <td colspan="2" height="128"> 
      <form method=POST>
        <font face="Arial, Helvetica, sans-serif" size="1">
          Choose Name and Password...Thats It
        </font>
        <br>
        <br>
        <font face="Arial, Helvetica, sans-serif" size="2">
          UserName:
        </font>
        <font face="Arial, Helvetica, sans-serif" size="2">
          <input type="text" name="user" value="$user">
        </font>
        <br>
        <font face="Arial, Helvetica, sans-serif" size="2">
          Password:
        </font>
        <font face="Arial, Helvetica, sans-serif" size="2">
          <input type="text" name="pass" value="$pass">
        </font>
          <input type="hidden" name="form" value="1">
        <br>
        <center>
        <input type="submit" value="join">
        </center>
      </form>
    </td>
  </tr>
  <tr align="left" valign="top" bgcolor="$tablecolor2"> 
    <td colspan="2" height="15" bgcolor="$tablecolor2">&nbsp;
    </td>
  </tr>
  <tr align="left" valign="top" bgcolor="$tablecolor1"> 
    <td colspan="2" height="21"> 
      &nbsp;
    </td>
  </tr>
</table>

!;
} else {
$error = 0;
if ($user eq "") {print "<li>Missing Username"; ++$error;}
if ($pass eq "") {print "<li>Missing Password"; ++$error;}
open(CHECK,"$database");
$check = <CHECK>;
close(CHECK);
@lines = split(/&/,$check);
foreach $line (@lines) {
($tmp,$tmpa) = split(/\|/,$line);
if ($user eq $tmp) { print "username taken"; ++$error;}
}
if ($error == 0) {
open(ADD,">>$database");
print ADD "$user|$pass&";
close(ADD);
print qq!
<html>
<head>
<title>New User $user</title>
</head>

<body bgcolor="$backgroundcolor" text="$textcolor1" link="$linkcolor" vlink="$vlinkcolor" alink="$alinkcolor" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<table width="235" witdh="235" border="0" cellspacing="0" cellpadding="0" height="192">
  <tr align="left" valign="top" bgcolor="$tablecolor1">
    <td width="78%"><font face="Arial, Helvetica, sans-serif" size="2" color="$textcolor2">$title</font><font face="Arial, Helvetica, sans-serif"> </font></td>
    <td width="22%">
      &nbsp;
    </td>
  </tr>
  <tr align="left" valign="top"> 
    <td colspan="2" bgcolor="$tablecolor2"><font face="Arial, Helvetica, sans-serif" color="$textcolor2">FIRST
      LOGIN</font> 
      <div align="right"><font face="Arial, Helvetica, sans-serif" size="1"></font></div>
    </td>
  </tr>
  <tr align="left" valign="top" bgcolor="$tablecolor2">
    <td colspan="2" height="128"> 
      <form method=post action="$home_url/$im_program_name">
        <font face="Arial, Helvetica, sans-serif" size="1">
        Try it out.
        </font>
        <br>
        <font face="Arial, Helvetica, sans-serif" size="2">
          UserName:
        </font>
        <font face="Arial, Helvetica, sans-serif" size="2">
          <input type="text" name="user" value="$user">
        </font>
        <br>
        <font face="Arial, Helvetica, sans-serif" size="2">
          Password:
        </font>

          <input type="password" name="pass" value="$pass">
          <input type="hidden" name="form" value="1">
          <input type="hidden" name="too" value="dropdown">
          <input type="hidden" name="refreshonoff" value="on">
          <input type="hidden" name="visible" value="yes">

        <br>
        <center>
        <input type="submit" value="connect">
        </center>
      </form>
    </td>
  </tr>
  <tr align="left" valign="top" bgcolor="$tablecolor2"> 
    <td colspan="2" height="15" bgcolor="$tablecolor2">&nbsp;</td>
  </tr>
  <tr align="left" valign="top" bgcolor="$tablecolor1">
    <td colspan="2" height="19"> 
      &nbsp;
    </td>
  </tr>
</table>
</body>
</html>
!;
}
}












